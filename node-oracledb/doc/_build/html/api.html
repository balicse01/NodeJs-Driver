

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Node-oracledb 4.0 Documentation for the Oracle Database Node.js Add-on &mdash; Node.js Driver  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome to NodeJsDocument’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Node.js Driver
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Node-oracledb 4.0 Documentation for the Oracle Database Node.js Add-on</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1"></a></li>
<li class="toctree-l2"><a class="reference internal" href="#note-go-to-https-oracle-github-io-node-oracledb-doc-api-html-for-production-documentation">===&gt; *** Note: Go to https://oracle.github.io/node-oracledb/doc/api.html for production documentation ***</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manual-sections">Manual Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-contents-a-contents"><a name="contents"></a> Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-apimanual-a-node-oracledb-api-manual"><a name="apimanual"></a> NODE-ORACLEDB API MANUAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-intro-a-1-introduction"><a name="intro"></a> 1. Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-getstarted-a-1-1-getting-started-with-node-oracledb"><a name="getstarted"></a> 1.1 Getting Started with Node-oracledb</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-examplequery-a-1-1-1-example-a-sql-select-statement-in-node-js"><a name="examplequery"></a> 1.1.1 Example: A SQL SELECT statement in Node.js</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-examplesodaawait-a-1-1-2-example-simple-oracle-document-access-soda-in-node-js"><a name="examplesodaawait"></a> 1.1.2 Example: Simple Oracle Document Access (SODA) in Node.js</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-errorobj-a-2-errors"><a name="errorobj"></a> 2. Errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-properror-a-2-1-error-properties"><a name="properror"></a> 2.1 Error Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-properrerrornum-a-2-1-1-errornum"><a name="properrerrornum"></a> 2.1.1 <code class="docutils literal notranslate"><span class="pre">errorNum</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-properrmessage-a-2-1-2-message"><a name="properrmessage"></a> 2.1.2 <code class="docutils literal notranslate"><span class="pre">message</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-properroffset-a-2-1-3-offset"><a name="properroffset"></a> 2.1.3 <code class="docutils literal notranslate"><span class="pre">offset</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-oracledbclass-a-3-oracledb-class"><a name="oracledbclass"></a> 3. Oracledb Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-oracledbconstants-a-3-1-oracledb-constants"><a name="oracledbconstants"></a> 3.1 Oracledb Constants</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantsoutformat-a-3-1-1-query-outformat-constants"><a name="oracledbconstantsoutformat"></a> 3.1.1 Query <code class="docutils literal notranslate"><span class="pre">outFormat</span></code> Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantsnodbtype-a-3-1-2-node-oracledb-type-constants"><a name="oracledbconstantsnodbtype"></a> 3.1.2 Node-oracledb Type Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantsdbtype-a-3-1-3-oracle-database-type-constants"><a name="oracledbconstantsdbtype"></a> 3.1.3 Oracle Database Type Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantsbinddir-a-3-1-4-execute-bind-direction-constants"><a name="oracledbconstantsbinddir"></a> 3.1.4 Execute Bind Direction Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantsprivilege-a-3-1-5-privileged-connection-constants"><a name="oracledbconstantsprivilege"></a> 3.1.5 Privileged Connection Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantsstmttype-a-3-1-6-sql-statement-type-constants"><a name="oracledbconstantsstmttype"></a> 3.1.6 SQL Statement Type Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantssubscription-a-3-1-7-subscription-constants"><a name="oracledbconstantssubscription"></a> 3.1.7 Subscription Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantsaq-a-3-1-8-advanced-queuing-constants"><a name="oracledbconstantsaq"></a> 3.1.8 Advanced Queuing Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantscqn-a-3-1-9-continuous-query-notification-constants"><a name="oracledbconstantscqn"></a> 3.1.9 Continuous Query Notification Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantspool-a-3-1-10-pool-status-constants"><a name="oracledbconstantspool"></a> 3.1.10 Pool Status Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oracledbconstantssoda-a-3-1-11-simple-oracle-document-access-soda-constants"><a name="oracledbconstantssoda"></a> 3.1.11 Simple Oracle Document Access (SODA) Constants</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-oracledbproperties-a-3-2-oracledb-properties"><a name="oracledbproperties"></a> 3.2 Oracledb Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbisautocommit-a-3-2-1-oracledb-autocommit"><a name="propdbisautocommit"></a> 3.2.1 <code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbconclass-a-3-2-2-oracledb-connectionclass"><a name="propdbconclass"></a> 3.2.2 <code class="docutils literal notranslate"><span class="pre">oracledb.connectionClass</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbedition-a-3-2-3-oracledb-edition"><a name="propdbedition"></a> 3.2.3 <code class="docutils literal notranslate"><span class="pre">oracledb.edition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbevents-a-3-2-4-oracledb-events"><a name="propdbevents"></a> 3.2.4 <code class="docutils literal notranslate"><span class="pre">oracledb.events</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbextendedmetadata-a-3-2-5-oracledb-extendedmetadata"><a name="propdbextendedmetadata"></a> 3.2.5 <code class="docutils literal notranslate"><span class="pre">oracledb.extendedMetaData</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbisexternalauth-a-3-2-6-oracledb-externalauth"><a name="propdbisexternalauth"></a> 3.2.6 <code class="docutils literal notranslate"><span class="pre">oracledb.externalAuth</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbfetcharraysize-a-3-2-7-oracledb-fetcharraysize"><a name="propdbfetcharraysize"></a> 3.2.7 <code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbfetchasbuffer-a-3-2-8-oracledb-fetchasbuffer"><a name="propdbfetchasbuffer"></a> 3.2.8 <code class="docutils literal notranslate"><span class="pre">oracledb.fetchAsBuffer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbfetchasstring-a-3-2-9-oracledb-fetchasstring"><a name="propdbfetchasstring"></a> 3.2.9 <code class="docutils literal notranslate"><span class="pre">oracledb.fetchAsString</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdblobprefetchsize-a-3-2-10-oracledb-lobprefetchsize"><a name="propdblobprefetchsize"></a> 3.2.10 <code class="docutils literal notranslate"><span class="pre">oracledb.lobPrefetchSize</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbmaxrows-a-3-2-11-oracledb-maxrows"><a name="propdbmaxrows"></a> 3.2.11 <code class="docutils literal notranslate"><span class="pre">oracledb.maxRows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdboracleclientversion-a-3-2-12-oracledb-oracleclientversion"><a name="propdboracleclientversion"></a> 3.2.12 <code class="docutils literal notranslate"><span class="pre">oracledb.oracleClientVersion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdboracleclientversionstring-a-3-2-13-oracledb-oracleclientversionstring"><a name="propdboracleclientversionstring"></a> 3.2.13 <code class="docutils literal notranslate"><span class="pre">oracledb.oracleClientVersionString</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdboutformat-a-3-2-14-oracledb-outformat"><a name="propdboutformat"></a> 3.2.14 <code class="docutils literal notranslate"><span class="pre">oracledb.outFormat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbpoolincrement-a-3-2-15-oracledb-poolincrement"><a name="propdbpoolincrement"></a> 3.2.15 <code class="docutils literal notranslate"><span class="pre">oracledb.poolIncrement</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbpoolmax-a-3-2-16-oracledb-poolmax"><a name="propdbpoolmax"></a> 3.2.16 <code class="docutils literal notranslate"><span class="pre">oracledb.poolMax</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbpoolmin-a-3-2-17-oracledb-poolmin"><a name="propdbpoolmin"></a> 3.2.17 <code class="docutils literal notranslate"><span class="pre">oracledb.poolMin</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbpoolpinginterval-a-3-2-18-oracledb-poolpinginterval"><a name="propdbpoolpinginterval"></a> 3.2.18 <code class="docutils literal notranslate"><span class="pre">oracledb.poolPingInterval</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbpooltimeout-a-3-2-19-oracledb-pooltimeout"><a name="propdbpooltimeout"></a> 3.2.19 <code class="docutils literal notranslate"><span class="pre">oracledb.poolTimeout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbprefetchrows-a-3-2-20-oracledb-prefetchrows"><a name="propdbprefetchrows"></a> 3.2.20 <code class="docutils literal notranslate"><span class="pre">oracledb.prefetchRows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbpromise-a-3-2-21-oracledb-promise"><a name="propdbpromise"></a> 3.2.21 <code class="docutils literal notranslate"><span class="pre">oracledb.Promise</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbqueuerequests-a-3-2-22-oracledb-queuerequests"><a name="propdbqueuerequests"></a> 3.2.22 <code class="docutils literal notranslate"><span class="pre">oracledb.queueRequests</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbqueuetimeout-a-3-2-23-oracledb-queuetimeout"><a name="propdbqueuetimeout"></a> 3.2.23 <code class="docutils literal notranslate"><span class="pre">oracledb.queueTimeout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbstmtcachesize-a-3-2-24-oracledb-stmtcachesize"><a name="propdbstmtcachesize"></a> 3.2.24 <code class="docutils literal notranslate"><span class="pre">oracledb.stmtCacheSize</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbversion-a-3-2-25-oracledb-version"><a name="propdbversion"></a> 3.2.25 <code class="docutils literal notranslate"><span class="pre">oracledb.version</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbversionstring-a-3-2-26-oracledb-versionstring"><a name="propdbversionstring"></a> 3.2.26 <code class="docutils literal notranslate"><span class="pre">oracledb.versionString</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propdbversionsuffix-a-3-2-27-oracledb-versionsuffix"><a name="propdbversionsuffix"></a> 3.2.27 <code class="docutils literal notranslate"><span class="pre">oracledb.versionSuffix</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-oracledbmethods-a-3-3-oracledb-methods"><a name="oracledbmethods"></a> 3.3 Oracledb Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-createpool-a-3-3-1-oracledb-createpool"><a name="createpool"></a> 3.3.1 <code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-createpoolpoolcallback-a-3-3-1-2-createpool-callback-function"><a name="createpoolpoolcallback"></a> 3.3.1.2 <code class="docutils literal notranslate"><span class="pre">createPool()</span></code>: Callback Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getconnectiondb-a-3-3-2-oracledb-getconnection"><a name="getconnectiondb"></a> 3.3.2 <code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getpool-a-3-3-3-oracledb-getpool"><a name="getpool"></a> 3.3.3 <code class="docutils literal notranslate"><span class="pre">oracledb.getPool()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-connectionclass-a-4-connection-class"><a name="connectionclass"></a> 4. Connection Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-connectionproperties-a-4-1-connection-properties"><a name="connectionproperties"></a> 4.1 Connection Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconnaction-a-4-1-1-connection-action"><a name="propconnaction"></a> 4.1.1 <code class="docutils literal notranslate"><span class="pre">connection.action</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconncalltimeout-a-4-1-2-connection-calltimeout"><a name="propconncalltimeout"></a> 4.1.2 <code class="docutils literal notranslate"><span class="pre">connection.callTimeout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconnclientid-a-4-1-3-connection-clientid"><a name="propconnclientid"></a> 4.1.3 <code class="docutils literal notranslate"><span class="pre">connection.clientId</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconncurrentschema-a-4-1-4-connection-currentschema"><a name="propconncurrentschema"></a> 4.1.4 <code class="docutils literal notranslate"><span class="pre">connection.currentSchema</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconnmodule-a-4-1-5-connection-module"><a name="propconnmodule"></a> 4.1.5 <code class="docutils literal notranslate"><span class="pre">connection.module</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconnoracleserverversion-a-4-1-6-connection-oracleserverversion"><a name="propconnoracleserverversion"></a> 4.1.6 <code class="docutils literal notranslate"><span class="pre">connection.oracleServerVersion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconnoracleserverversionstring-a-4-1-7-connection-oracleserverversionstring"><a name="propconnoracleserverversionstring"></a> 4.1.7 <code class="docutils literal notranslate"><span class="pre">connection.oracleServerVersionString</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconnstmtcachesize-a-4-1-8-connection-stmtcachesize"><a name="propconnstmtcachesize"></a> 4.1.8 <code class="docutils literal notranslate"><span class="pre">connection.stmtCacheSize</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-propconntag-a-4-1-9-connection-tag"><a name="propconntag"></a> 4.1.9 <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-connectionmethods-a-4-2-connection-methods"><a name="connectionmethods"></a> 4.2 Connection Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-break-a-4-2-1-connection-break"><a name="break"></a> 4.2.1 <code class="docutils literal notranslate"><span class="pre">connection.break()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-changepassword-a-4-2-2-connection-changepassword"><a name="changepassword"></a> 4.2.2 <code class="docutils literal notranslate"><span class="pre">connection.changePassword()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connectionclose-a-4-2-3-connection-close"><a name="connectionclose"></a> 4.2.3 <code class="docutils literal notranslate"><span class="pre">connection.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-commit-a-4-2-4-connection-commit"><a name="commit"></a> 4.2.4 <code class="docutils literal notranslate"><span class="pre">connection.commit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connectioncreatelob-a-4-2-5-connection-createlob"><a name="connectioncreatelob"></a> 4.2.5 <code class="docutils literal notranslate"><span class="pre">connection.createLob()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-execute-a-4-2-6-connection-execute"><a name="execute"></a> 4.2.6 <code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-executemany-a-4-2-7-connection-executemany"><a name="executemany"></a> 4.2.7 <code class="docutils literal notranslate"><span class="pre">connection.executeMany()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getdbobjectclass-a-4-2-8-connection-getdbobjectclass"><a name="getdbobjectclass"></a> 4.2.8 <code class="docutils literal notranslate"><span class="pre">connection.getDbObjectClass()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getqueue-a-4-2-9-connection-getqueue"><a name="getQueue"></a> 4.2.9 <code class="docutils literal notranslate"><span class="pre">connection.getQueue()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getsodadatabase-a-4-2-10-connection-getsodadatabase"><a name="getsodadatabase"></a> 4.2.10 <code class="docutils literal notranslate"><span class="pre">connection.getSodaDatabase()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getstmtinfo-a-4-2-11-connection-getstatementinfo"><a name="getstmtinfo"></a> 4.2.11 <code class="docutils literal notranslate"><span class="pre">connection.getStatementInfo()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connectionping-a-4-2-12-connection-ping"><a name="connectionping"></a> 4.2.12 <code class="docutils literal notranslate"><span class="pre">connection.ping()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-querystream-a-4-2-13-connection-querystream"><a name="querystream"></a> 4.2.13 <code class="docutils literal notranslate"><span class="pre">connection.queryStream()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-release-a-4-2-14-connection-release"><a name="release"></a> 4.2.14 <code class="docutils literal notranslate"><span class="pre">connection.release()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-rollback-a-4-2-15-connection-rollback"><a name="rollback"></a> 4.2.15 <code class="docutils literal notranslate"><span class="pre">connection.rollback()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-consubscribe-a-4-2-16-connection-subscribe"><a name="consubscribe"></a> 4.2.16 <code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-conunsubscribe-a-4-2-17-connection-unsubscribe"><a name="conunsubscribe"></a> 4.2.17 <code class="docutils literal notranslate"><span class="pre">connection.unsubscribe()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-aqqueueclass-a-5-aqqueue-class"><a name="aqqueueclass"></a> 5. AqQueue Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-aqqueueproperties-a-5-1-aqqueue-properties"><a name="aqqueueproperties"></a> 5.1 AqQueue Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueuename-a-5-1-1-aqqueue-name"><a name="aqqueuename"></a> 5.1.1 <code class="docutils literal notranslate"><span class="pre">aqQueue.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueuedeqopts-a-5-1-2-aqqueue-deqoptions"><a name="aqqueuedeqopts"></a> 5.1.2 <code class="docutils literal notranslate"><span class="pre">aqQueue.deqOptions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueueenqopts-a-5-1-3-aqqueue-enqoptions"><a name="aqqueueenqopts"></a> 5.1.3 <code class="docutils literal notranslate"><span class="pre">aqQueue.enqOptions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueuepayloadtype-a-5-1-4-aqqueue-payloadtype"><a name="aqqueuepayloadtype"></a> 5.1.4 <code class="docutils literal notranslate"><span class="pre">aqQueue.payloadType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueuepayloadtypeclass-a-5-1-5-aqqueue-payloadtypeclass"><a name="aqqueuepayloadtypeclass"></a> 5.1.5 <code class="docutils literal notranslate"><span class="pre">aqQueue.payloadTypeClass</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueuepayloadtypename-a-5-1-6-aqqueue-payloadtypename"><a name="aqqueuepayloadtypename"></a> 5.1.6 <code class="docutils literal notranslate"><span class="pre">aqQueue.payloadTypeName</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-aqqueuemethods-a-5-2-aqqueue-methods"><a name="aqqueuemethods"></a> 5.2 AqQueue Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueuemethoddeqmany-a-5-2-1-aqqueue-deqmany"><a name="aqqueuemethoddeqmany"></a> 5.2.1 <code class="docutils literal notranslate"><span class="pre">aqQueue.deqMany()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueuemethoddeqone-a-5-2-2-aqqueue-deqone"><a name="aqqueuemethoddeqone"></a> 5.2.2 <code class="docutils literal notranslate"><span class="pre">aqQueue.deqOne()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-aqqueuemethodenqmany-a-5-2-3-aqqueue-enqmany"><a name="aqqueuemethodenqmany"></a> 5.2.3 <code class="docutils literal notranslate"><span class="pre">aqQueue.enqMany()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id87">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id88">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id89">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-aqqueuemethodenqone-a-5-2-4-aqqueue-enqone"><a name="aqqueuemethodenqone"></a> 5.2.4 <code class="docutils literal notranslate"><span class="pre">aqQueue.enqOne()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-dbobjectclass-a-6-dbobject-class"><a name="dbobjectclass"></a> 6. DbObject Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-dbobjectproperties-a-6-1-dbobject-properties"><a name="dbobjectproperties"></a> 6.1 DbObject Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributesattributes-a-6-1-1-dbobject-attributes"><a name="dbobjattributesattributes"></a> 6.1.1 <code class="docutils literal notranslate"><span class="pre">dbObject.attributes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributeselementtype-a-6-1-2-dbobject-elementtype"><a name="dbobjattributeselementtype"></a> 6.1.2 <code class="docutils literal notranslate"><span class="pre">dbObject.elementType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributeselementtypeclass-a-6-1-3-dbobject-elementtypeclass"><a name="dbobjattributeselementtypeclass"></a> 6.1.3 <code class="docutils literal notranslate"><span class="pre">dbObject.elementTypeClass</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributeselementtypename-a-6-1-4-dbobject-elementtypename"><a name="dbobjattributeselementtypename"></a> 6.1.4 <code class="docutils literal notranslate"><span class="pre">dbObject.elementTypeName</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributesfqn-a-6-1-5-dbobject-fqn"><a name="dbobjattributesfqn"></a> 6.1.5 <code class="docutils literal notranslate"><span class="pre">dbObject.fqn</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributesiscollection-a-6-1-6-dbobject-iscollection"><a name="dbobjattributesiscollection"></a> 6.1.6 <code class="docutils literal notranslate"><span class="pre">dbObject.isCollection</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributeslength-a-6-1-7-dbobject-length"><a name="dbobjattributeslength"></a> 6.1.7 <code class="docutils literal notranslate"><span class="pre">dbObject.length</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributesname-a-6-1-8-dbobject-name"><a name="dbobjattributesname"></a> 6.1.8 <code class="docutils literal notranslate"><span class="pre">dbObject.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjattributesschema-a-6-1-9-dbobject-schema"><a name="dbobjattributesschema"></a> 6.1.9 <code class="docutils literal notranslate"><span class="pre">dbObject.schema</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-dbobjectmethods-a-6-2-dbobject-methods"><a name="dbobjectmethods"></a> 6.2 DbObject Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbobjectmethodscolls-a-6-2-1-dbobject-methods-for-collections"><a name="dbobjectmethodscolls"></a> 6.2.1 DbObject Methods for Collections</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-lobclass-a-7-lob-class"><a name="lobclass"></a> 7. Lob Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-lobproperties-a-7-1-lob-properties"><a name="lobproperties"></a> 7.1 Lob Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proplobchunksize-a-7-1-1-lob-chunksize"><a name="proplobchunksize"></a> 7.1.1 <code class="docutils literal notranslate"><span class="pre">lob.chunkSize</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proploblength-a-7-1-2-lob-length"><a name="proploblength"></a> 7.1.2 <code class="docutils literal notranslate"><span class="pre">lob.length</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proplobpiecesize-a-7-1-3-lob-piecesize"><a name="proplobpiecesize"></a> 7.1.3 <code class="docutils literal notranslate"><span class="pre">lob.pieceSize</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proplobtype-a-7-1-4-lob-type"><a name="proplobtype"></a> 7.1.4 <code class="docutils literal notranslate"><span class="pre">lob.type</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-lobmethods-a-7-2-lob-methods"><a name="lobmethods"></a> 7.2 Lob Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-lobclose-a-7-2-1-lob-close"><a name="lobclose"></a> 7.2.1 <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-lobgetdata-a-7-2-2-lob-getdata"><a name="lobgetdata"></a> 7.2.2 <code class="docutils literal notranslate"><span class="pre">lob.getData()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-poolclass-a-8-pool-class"><a name="poolclass"></a> 8. Pool Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-poolproperties-a-8-1-pool-properties"><a name="poolproperties"></a> 8.1 Pool Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolconnectionsinuse-a-8-1-1-pool-connectionsinuse"><a name="proppoolconnectionsinuse"></a> 8.1.1 <code class="docutils literal notranslate"><span class="pre">pool.connectionsInUse</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolconnectionsopen-a-8-1-2-pool-connectionsopen"><a name="proppoolconnectionsopen"></a> 8.1.2 <code class="docutils literal notranslate"><span class="pre">pool.connectionsOpen</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolpoolalias-a-8-1-3-pool-poolalias"><a name="proppoolpoolalias"></a> 8.1.3 <code class="docutils literal notranslate"><span class="pre">pool.poolAlias</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolpoolincrement-a-8-1-4-pool-poolincrement"><a name="proppoolpoolincrement"></a> 8.1.4 <code class="docutils literal notranslate"><span class="pre">pool.poolIncrement</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolpoolmax-a-8-1-5-pool-poolmax"><a name="proppoolpoolmax"></a> 8.1.5 <code class="docutils literal notranslate"><span class="pre">pool.poolMax</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolpoolmin-a-8-1-6-pool-poolmin"><a name="proppoolpoolmin"></a> 8.1.6 <code class="docutils literal notranslate"><span class="pre">pool.poolMin</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolpoolpinginterval-a-8-1-7-pool-poolpinginterval"><a name="proppoolpoolpinginterval"></a> 8.1.7 <code class="docutils literal notranslate"><span class="pre">pool.poolPingInterval</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolpooltimeout-a-8-1-8-pool-pooltimeout"><a name="proppoolpooltimeout"></a> 8.1.8 <code class="docutils literal notranslate"><span class="pre">pool.poolTimeout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolqueuerequests-a-8-1-9-pool-queuerequests"><a name="proppoolqueuerequests"></a> 8.1.9 <code class="docutils literal notranslate"><span class="pre">pool.queueRequests</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolqueuetimeout-a-8-1-10-pool-queuetimeout"><a name="proppoolqueueTimeout"></a> 8.1.10 <code class="docutils literal notranslate"><span class="pre">pool.queueTimeout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolstatus-a-8-1-11-pool-status"><a name="proppoolstatus"></a> 8.1.11 <code class="docutils literal notranslate"><span class="pre">pool.status</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-proppoolstmtcachesize-a-8-1-12-pool-stmtcachesize"><a name="proppoolstmtcachesize"></a> 8.1.12 <code class="docutils literal notranslate"><span class="pre">pool.stmtCacheSize</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-poolmethods-a-8-2-pool-methods"><a name="poolmethods"></a> 8.2 Pool Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-poolclose-a-8-2-1-pool-close"><a name="poolclose"></a> 8.2.1 <code class="docutils literal notranslate"><span class="pre">pool.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getconnectionpool-a-8-2-2-pool-getconnection"><a name="getconnectionpool"></a> 8.2.2 <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-terminate-a-8-2-3-pool-terminate"><a name="terminate"></a> 8.2.3 <code class="docutils literal notranslate"><span class="pre">pool.terminate()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-resultsetclass-a-9-resultset-class"><a name="resultsetclass"></a> 9. ResultSet Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-resultsetproperties-a-9-1-resultset-properties"><a name="resultsetproperties"></a> 9.1 ResultSet Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-rsmetadata-a-9-1-1-resultset-metadata"><a name="rsmetadata"></a> 9.1.1 <code class="docutils literal notranslate"><span class="pre">resultset.metaData</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-resultsetmethods-a-9-2-resultset-methods"><a name="resultsetmethods"></a> 9.2 ResultSet Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-close-a-9-2-1-resultset-close"><a name="close"></a> 9.2.1 <code class="docutils literal notranslate"><span class="pre">resultset.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getrow-a-9-2-2-resultset-getrow"><a name="getrow"></a> 9.2.2 <code class="docutils literal notranslate"><span class="pre">resultset.getRow()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-getrows-a-9-2-3-resultset-getrows"><a name="getrows"></a> 9.2.3 <code class="docutils literal notranslate"><span class="pre">resultset.getRows()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-toquerystream-a-9-2-4-resultset-toquerystream"><a name="toquerystream"></a> 9.2.4 <code class="docutils literal notranslate"><span class="pre">resultset.toQueryStream()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-sodacollectionclass-a-10-sodacollection-class"><a name="sodacollectionclass"></a> 10. SodaCollection Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollectionproperties-a-10-1-sodacollection-properties"><a name="sodacollectionproperties"></a> 10.1 SodaCollection Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollectionpropmetadata-a-10-1-1-sodacollection-metadata"><a name="sodacollectionpropmetadata"></a> 10.1.1 <code class="docutils literal notranslate"><span class="pre">sodaCollection.metaData</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollectionpropname-a-10-1-2-sodacollection-name"><a name="sodacollectionpropname"></a> 10.1.2 <code class="docutils literal notranslate"><span class="pre">sodaCollection.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollectionmethods-a-10-2-sodacollection-methods"><a name="sodacollectionmethods"></a> 10.2 SodaCollection Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollcreateindex-a-10-2-1-sodacollection-createindex"><a name="sodacollcreateindex"></a> 10.2.1 <code class="docutils literal notranslate"><span class="pre">sodaCollection.createIndex()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id114">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id115">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacollcreateindexparams-a-10-2-1-1-createindex-parameters"><a name="sodacollcreateindexparams"></a> 10.2.1.1 <code class="docutils literal notranslate"><span class="pre">createIndex()</span></code> Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacollcreateindexcb-a-10-2-1-2-createindex-callback-function"><a name="sodacollcreateindexcb"></a> 10.2.1.2 <code class="docutils literal notranslate"><span class="pre">createIndex()</span></code>: Callback Function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacolldrop-a-10-2-2-sodacollection-drop"><a name="sodacolldrop"></a> 10.2.2 <code class="docutils literal notranslate"><span class="pre">sodaCollection.drop()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id116">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id117">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacolldropcallback-a-10-2-2-1-drop-callback-function"><a name="sodacolldropcallback"></a> 10.2.2.1 <code class="docutils literal notranslate"><span class="pre">drop()</span></code>: Callback Function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacolldropindex-a-10-2-3-sodacollection-dropindex"><a name="sodacolldropindex"></a> 10.2.3 <code class="docutils literal notranslate"><span class="pre">sodaCollection.dropIndex()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id118">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id119">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacolldropindexparams-a-10-2-3-1-dropindex-parameters"><a name="sodacolldropindexparams"></a> 10.2.3.1 <code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code>: Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacolldropindexcb-a-10-2-3-2-dropindex-callback-function"><a name="sodacolldropindexcb"></a> 10.2.3.2 <code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code> Callback Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id120">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id121">Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollfind-a-10-2-4-sodacollection-find"><a name="sodacollfind"></a> 10.2.4 <code class="docutils literal notranslate"><span class="pre">sodaCollection.find()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id122">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id123">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#returns">Returns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id124">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodaoperationclass-a-10-2-4-1-sodaoperation-class"><a name="sodaoperationclass"></a> 10.2.4.1 SodaOperation Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodaoperationclassnonterm-a-10-2-4-1-1-non-terminal-sodaoperation-methods"><a name="sodaoperationclassnonterm"></a> 10.2.4.1.1 Non-terminal SodaOperation Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id125">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id126">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id127">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id128">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id129">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id130">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id131">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id132">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id133">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id134">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id135">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id136">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodaoperationclassterm-a-10-2-4-1-2-terminal-sodaoperation-methods"><a name="sodaoperationclassterm"></a> 10.2.4.1.2 Terminal SodaOperation Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id137">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id138">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id139">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id140">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id141">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id142">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id143">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id144">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id145">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id146">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id147">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id148">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id149">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id150">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id151">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id152">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id153">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id154">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id155">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id156">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id157">Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollgetdataguide-a-10-2-5-sodacollection-getdataguide"><a name="sodacollgetdataguide"></a> 10.2.5 <code class="docutils literal notranslate"><span class="pre">sodaCollection.getDataGuide()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id158">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id159">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id160">Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollinsertmany-a-10-2-6-sodacollection-insertmany"><a name="sodacollinsertmany"></a> 10.2.6 <code class="docutils literal notranslate"><span class="pre">sodaCollection.insertMany()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id161">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id162">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollinsertmanyandget-a-10-2-7-sodacollection-insertmanyandget"><a name="sodacollinsertmanyandget"></a> 10.2.7 <code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id163">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id164">Description</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollinsertone-a-10-2-8-sodacollection-insertone"><a name="sodacollinsertone"></a> 10.2.8 <code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOne()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id165">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id166">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacollinsertoneparams-a-10-2-8-1-insertone-parameters"><a name="sodacollinsertoneparams"></a> 10.2.8.1 <code class="docutils literal notranslate"><span class="pre">insertOne()</span></code>: Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacollinsertonecb-a-10-2-8-2-insertone-callback-function"><a name="sodacollinsertonecb"></a> 10.2.8.2 <code class="docutils literal notranslate"><span class="pre">insertOne()</span></code> Callback Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id167">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id168">Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodacollinsertoneandget-a-10-2-9-sodacollection-insertoneandget"><a name="sodacollinsertoneandget"></a> 10.2.9 <code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOneAndGet()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id169">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id170">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacollinsertoneandgetparams-a-10-2-9-1-insertoneandget-parameters"><a name="sodacollinsertoneandgetparams"></a> 10.2.9.1 <code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code>: Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodacollinsertoneandgetcb-a-10-2-9-2-insertoneandget-callback-function"><a name="sodacollinsertoneandgetcb"></a> 10.2.9.2 <code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code> Callback Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id171">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id172">Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-sodadatabaseclass-a-11-sodadatabase-class"><a name="sodadatabaseclass"></a> 11. SodaDatabase Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodadatabasemethods-a-11-1-sodadatabase-methods"><a name="sodadatabasemethods"></a> 11.1 SodaDatabase Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodadbcreatecollection-a-11-1-1-sodadatabase-createcollection"><a name="sodadbcreatecollection"></a> 11.1.1 <code class="docutils literal notranslate"><span class="pre">sodaDatabase.createCollection()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id173">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id174">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbcreatecollectionname-a-11-1-1-1-createcollection-collectionname"><a name="sodadbcreatecollectionname"></a> 11.1.1.1 <code class="docutils literal notranslate"><span class="pre">createCollection():</span> <span class="pre">collectionName</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbcreatecollectionoptions-a-11-1-1-2-createcollection-options"><a name="sodadbcreatecollectionoptions"></a> 11.1.1.2 <code class="docutils literal notranslate"><span class="pre">createCollection():</span> <span class="pre">options</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbcreatecollectioncb-a-11-1-1-3-createcollection-callback-function"><a name="sodadbcreatecollectioncb"></a> 11.1.1.3 <code class="docutils literal notranslate"><span class="pre">createCollection()</span></code>: Callback Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id175">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id176">Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodadbcreatedocument-a-11-1-2-sodadatabase-createdocument"><a name="sodadbcreatedocument"></a> 11.1.2 <code class="docutils literal notranslate"><span class="pre">sodaDatabase.createDocument()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id177">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id178">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id179">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbcreatedocumentcontent-a-11-1-2-1-createdocument-content"><a name="sodadbcreatedocumentcontent"></a> 11.1.2.1 <code class="docutils literal notranslate"><span class="pre">createDocument():</span> <span class="pre">content</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbcreatedocumentoptions-a-11-1-2-2-createdocument-options"><a name="sodadbcreatedocumentoptions"></a> 11.1.2.2 <code class="docutils literal notranslate"><span class="pre">createDocument():</span> <span class="pre">options</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodadbgetcollectionnames-a-11-1-3-sodadatabase-getcollectionnames"><a name="sodadbgetcollectionnames"></a> 11.1.3 <code class="docutils literal notranslate"><span class="pre">sodaDatabase.getCollectionNames()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id180">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id181">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbgetcollectionnamesparams-a-11-1-3-1-getcollectionnames-parameters"><a name="sodadbgetcollectionnamesparams"></a> 11.1.3.1 <code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code>: Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbgetcollectionnamescb-a-11-1-3-2-getcollectionnames-callback-function"><a name="sodadbgetcollectionnamescb"></a> 11.1.3.2 <code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code>: Callback Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id182">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id183">Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodadbopencollection-a-11-1-4-sodadatabase-opencollection"><a name="sodadbopencollection"></a> 11.1.4 <code class="docutils literal notranslate"><span class="pre">sodaDatabase.openCollection()</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id184">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id185">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbopencollectionparams-a-11-1-4-1-opencollection-parameters"><a name="sodadbopencollectionparams"></a> 11.1.4.1 <code class="docutils literal notranslate"><span class="pre">openCollection()</span></code>: Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadbopencollectioncb-a-11-1-4-2-opencollection-callback-function"><a name="sodadbopencollectioncb"></a> 11.1.4.2 <code class="docutils literal notranslate"><span class="pre">openCollection()</span></code>: Callback Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id186">Prototype</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id187">Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-sodadocumentclass-a-12-sodadocument-class"><a name="sodadocumentclass"></a> 12. SodaDocument Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodadocumentproperties-a-12-1-sodadocument-properties"><a name="sodadocumentproperties"></a> 12.1 SodaDocument Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodadocumentmethods-a-12-2-sodadocument-methods"><a name="sodadocumentmethods"></a> 12.2 SodaDocument Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadocgetcontent-a-12-2-1-sodadocument-getcontent"><a name="sodadocgetcontent"></a> 12.2.1 <code class="docutils literal notranslate"><span class="pre">sodaDocument.getContent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadocgetcontentasbuffer-a-12-2-2-sodadocument-getcontentasbuffer"><a name="sodadocgetcontentasbuffer"></a> 12.2.2 <code class="docutils literal notranslate"><span class="pre">sodaDocument.getContentAsBuffer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadocgetcontentasstring-a-12-2-3-sodadocument-getcontentasstring"><a name="sodadocgetcontentasstring"></a> 12.2.3 <code class="docutils literal notranslate"><span class="pre">sodaDocument.getContentAsString()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-sodadocumentcursorclass-a-13-sodadocumentcursor-class"><a name="sodadocumentcursorclass"></a> 13. SodaDocumentCursor Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodadoccursormethods-a-13-1-sodadocumentcursor-methods"><a name="sodadoccursormethods"></a> 13.1 SodaDocumentCursor Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadoccursorclose-a-13-1-1-sodadocumentcursor-close"><a name="sodadoccursorclose"></a> 13.1.1 <code class="docutils literal notranslate"><span class="pre">sodaDocumentCursor.close()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-sodadoccursorgetnext-a-13-1-2-sodadocumentcursor-getnext"><a name="sodadoccursorgetnext"></a> 13.1.2 <code class="docutils literal notranslate"><span class="pre">sodaDocumentCursor.getNext()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-usermanual-a-node-oracledb-user-manual"><a name="usermanual"></a> NODE-ORACLEDB USER MANUAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-connectionhandling-a-14-connection-handling"><a name="connectionhandling"></a> 14. Connection Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#standalone-connections">Standalone Connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pooled-connections">Pooled Connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-configureconnections-a-14-1-configuring-connections-and-node-oracledb"><a name="configureconnections"></a> 14.1 Configuring Connections and Node-oracledb</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-environmentvariables-a-14-1-1-oracle-environment-variables"><a name="environmentvariables"></a> 14.1.1 Oracle Environment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-tnsadmin-a-14-1-2-optional-oracle-net-configuration"><a name="tnsadmin"></a> 14.1.2 Optional Oracle Net Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-oraaccess-a-14-1-3-optional-oracle-client-configuration"><a name="oraaccess"></a> 14.1.3. Optional Oracle Client Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-connectionstrings-a-14-2-connection-strings"><a name="connectionstrings"></a> 14.2 Connection Strings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-easyconnect-a-14-2-1-easy-connect-syntax-for-connection-strings"><a name="easyconnect"></a> 14.2.1 Easy Connect Syntax for Connection Strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-embedtns-a-14-2-2-embedded-connect-descriptor-strings"><a name="embedtns"></a> 14.2.2 Embedded Connect Descriptor Strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-tnsnames-a-14-2-3-net-service-names-for-connection-strings"><a name="tnsnames"></a> 14.2.3 Net Service Names for Connection Strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-notjdbc-a-14-2-4-jdbc-and-oracle-sql-developer-connection-strings"><a name="notjdbc"></a> 14.2.4 JDBC and Oracle SQL Developer Connection Strings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-numberofthreads-a-14-3-connections-and-number-of-threads"><a name="numberofthreads"></a> 14.3 Connections and Number of Threads</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-connpooling-a-14-4-connection-pooling"><a name="connpooling"></a> 14.4 Connection Pooling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-conpoolsizing-a-14-4-1-connection-pool-sizing"><a name="conpoolsizing"></a> 14.4.1 Connection Pool Sizing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-conpooldraining-a-14-4-2-connection-pool-closing-and-draining"><a name="conpooldraining"></a> 14.4.2 Connection Pool Closing and Draining</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connpoolcache-a-14-4-3-connection-pool-cache"><a name="connpoolcache"></a> 14.4.3 Connection Pool Cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connpoolqueue-a-14-4-4-connection-pool-queue"><a name="connpoolqueue"></a> 14.4.4 Connection Pool Queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connpoolmonitor-a-14-4-5-connection-pool-monitoring-and-throughput"><a name="connpoolmonitor"></a> 14.4.5 Connection Pool Monitoring and Throughput</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connpoolpinging-a-14-4-6-connection-pool-pinging"><a name="connpoolpinging"></a> 14.4.6 Connection Pool Pinging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connpooltagging-a-14-4-7-connection-tagging-and-session-state"><a name="connpooltagging"></a> 14.4.7 Connection Tagging and Session State</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connpoolproxy-a-14-4-8-heterogeneous-connection-pools-and-pool-proxy-authentication"><a name="connpoolproxy"></a> 14.4.8 Heterogeneous Connection Pools and Pool Proxy Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-extauth-a-14-4-external-authentication"><a name="extauth"></a> 14.4 External Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-drcp-a-14-5-database-resident-connection-pooling-drcp"><a name="drcp"></a> 14.5 Database Resident Connection Pooling (DRCP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-privconn-a-14-6-privileged-connections"><a name="privconn"></a> 14.6 Privileged Connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-securenetwork-a-14-7-securely-encrypting-network-traffic-to-oracle-database"><a name="securenetwork"></a> 14.7 Securely Encrypting Network Traffic to Oracle Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-changingpassword-a-14-8-changing-passwords-and-connecting-with-an-expired-password"><a name="changingpassword"></a> 14.8 Changing Passwords and Connecting with an Expired Password</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#changing-passwords">Changing Passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connecting-with-an-expired-password">Connecting with an Expired Password</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-connectionha-a-14-9-connections-and-high-availability"><a name="connectionha"></a> 14.9 Connections and High Availability</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connectionfan-a-14-9-1-fast-application-notification-fan"><a name="connectionfan"></a> 14.9.1 Fast Application Notification (FAN)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-connectionrlb-a-14-9-2-runtime-load-balancing-rlb"><a name="connectionrlb"></a> 14.9.2 Runtime Load Balancing (RLB)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-dbcalltimeouts-a-14-9-3-database-call-timeouts"><a name="dbcalltimeouts"></a> 14.9.3 Database Call Timeouts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-sqlexecution-a-15-sql-execution"><a name="sqlexecution"></a> 15. SQL Execution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-select-a-15-1-select-statements"><a name="select"></a> 15.1 SELECT Statements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-fetchingrows-a-15-1-1-fetching-rows-with-direct-fetches"><a name="fetchingrows"></a> 15.1.1 Fetching Rows with Direct Fetches</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-resultsethandling-a-15-1-2-fetching-rows-with-result-sets"><a name="resultsethandling"></a> 15.1.2 Fetching Rows with Result Sets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-streamingresults-a-15-1-3-query-streaming"><a name="streamingresults"></a> 15.1.3 Query Streaming</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-queryoutputformats-a-15-1-4-query-output-formats"><a name="queryoutputformats"></a> 15.1.4 Query Output Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-querymeta-a-15-1-5-query-column-metadata"><a name="querymeta"></a> 15.1.5 Query Column Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-typemap-a-15-1-6-query-result-type-mapping"><a name="typemap"></a> 15.1.6 Query Result Type Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-pagingdata-a-15-1-7-limiting-rows-and-creating-paged-datasets"><a name="pagingdata"></a> 15.1.7 Limiting Rows and Creating Paged Datasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-autoincrement-a-15-1-8-auto-increment-columns"><a name="autoincrement"></a> 15.1.8 Auto-Increment Columns</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-cursors1000-a-15-2-cursor-management"><a name="cursors1000"></a> 15.2 Cursor Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-plsqlexecution-a-16-pl-sql-execution"><a name="plsqlexecution"></a> 16. PL/SQL Execution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-plsqlproc-a-16-1-pl-sql-stored-procedures"><a name="plsqlproc"></a> 16.1 PL/SQL Stored Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-plsqlfunc-a-16-2-pl-sql-stored-functions"><a name="plsqlfunc"></a> 16.2 PL/SQL Stored Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-plsqlanon-a-16-3-pl-sql-anonymous-pl-sql-blocks"><a name="plsqlanon"></a> 16.3 PL/SQL Anonymous PL/SQL Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-dbmsoutput-a-16-4-using-dbms-output"><a name="dbmsoutput"></a> 16.4 Using DBMS_OUTPUT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-ebr-a-16-5-edition-based-redefinition"><a name="ebr"></a> 16.5 Edition-Based Redefinition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-implicitresults-a-16-6-implicit-results"><a name="implicitresults"></a> 16.6 Implicit Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-lobhandling-a-17-working-with-clob-and-blob-data"><a name="lobhandling"></a> 17. Working with CLOB and BLOB Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-basiclobinsert-a-17-1-simple-insertion-of-lobs"><a name="basiclobinsert"></a> 17.1 Simple Insertion of LOBs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-queryinglobs-a-17-2-simple-lob-queries-and-pl-sql-out-binds"><a name="queryinglobs"></a> 17.2 Simple LOB Queries and PL/SQL OUT Binds</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#querying-lobs">Querying LOBs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-lobs-as-string-or-buffer-from-pl-sql">Getting LOBs as String or Buffer from PL/SQL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-streamsandlobs-a-17-3-streaming-lobs"><a name="streamsandlobs"></a> 17.3 Streaming Lobs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#readable-lobs">Readable Lobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writeable-lobs">Writeable Lobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-lobinsertdiscussion-a-17-4-using-returning-into-to-insert-into-lobs"><a name="lobinsertdiscussion"></a> 17.4 Using RETURNING INTO to Insert into LOBs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-loboutstream-a-17-5-getting-lobs-as-streams-from-oracle-database"><a name="loboutstream"></a> 17.5 Getting LOBs as Streams from Oracle Database</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lob-query-example">LOB Query Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pl-sql-lob-parameter-fetch-example">PL/SQL LOB Parameter Fetch Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#streaming-out-a-lob">Streaming Out a Lob</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-templobdiscussion-a-17-6-using-createlob-for-pl-sql-in-binds"><a name="templobdiscussion"></a> 17.6 Using <code class="docutils literal notranslate"><span class="pre">createLob()</span></code> for PL/SQL IN Binds</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#passing-a-lob-into-pl-sql">Passing a Lob Into PL/SQL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-closinglobs-a-17-7-closing-lobs"><a name="closinglobs"></a> 17.7 Closing Lobs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-jsondatatype-a-18-oracle-database-json-data-type"><a name="jsondatatype"></a> 18. Oracle Database JSON Data type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-xmltype-a-19-working-with-xmltype"><a name="xmltype"></a> 19. Working with XMLType</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-bind-a-20-bind-parameters-for-prepared-statements"><a name="bind"></a> 20. Bind Parameters for Prepared Statements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-inbind-a-20-1-in-bind-parameters"><a name="inbind"></a> 20.1 IN Bind Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-bindbyname-a-bind-by-name"><a name="bindbyname"></a> Bind by Name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-bindbypos-a-bind-by-position"><a name="bindbypos"></a> Bind by Position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-binddatatypenotes-a-bind-data-type-notes"><a name="binddatatypenotes"></a> Bind Data Type Notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-outbind-a-20-2-out-and-in-out-bind-parameters"><a name="outbind"></a> 20.2 OUT and IN OUT Bind Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-outbinds-a-accessing-out-bind-values"><a name="outbinds"></a> Accessing OUT Bind Values</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-dmlreturn-a-20-3-dml-returning-bind-parameters"><a name="dmlreturn"></a> 20.3 DML RETURNING Bind Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-refcursors-a-20-4-ref-cursor-bind-parameters"><a name="refcursors"></a> 20.4 REF CURSOR Bind Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-lobbinds-a-20-5-lob-bind-parameters"><a name="lobbinds"></a> 20.5 LOB Bind Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#size-limits-for-binding-lobs-to-strings-and-buffers">Size Limits for Binding LOBs to Strings and Buffers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sqlwherein-a-20-6-binding-multiple-values-to-a-sql-where-in-clause"><a name="sqlwherein"></a> 20.6 Binding Multiple Values to a SQL <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">IN</span></code> Clause</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sqlbindtablename-a-20-7-binding-column-and-table-names-in-queries"><a name="sqlbindtablename"></a> 20.7 Binding Column and Table Names in Queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-objects-a-21-oracle-database-objects-and-collections"><a name="objects"></a> 21. Oracle Database Objects and Collections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-objectinsert-a-21-1-inserting-objects"><a name="objectinsert"></a> 21.1 Inserting Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-objectfetch-a-21-2-fetching-objects"><a name="objectfetch"></a> 21.2 Fetching Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-plsqlcollections-a-21-3-pl-sql-collection-types"><a name="plsqlcollections"></a> 21.3 PL/SQL Collection Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-plsqlindexbybinds-a-21-3-1-pl-sql-collection-associative-arrays-index-by"><a name="plsqlindexbybinds"></a> 21.3.1 PL/SQL Collection Associative Arrays (Index-by)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-plsqlvarray-a-21-3-2-pl-sql-collection-varray-types"><a name="plsqlvarray"></a> 21.3.2 PL/SQL Collection VARRAY Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-name-plsqlnestedtables-a-21-3-3-pl-sql-collection-nested-tables"><a name="plsqlnestedtables"></a> 21.3.3 PL/SQL Collection Nested Tables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-plsqlrecords-a-21-4-pl-sql-record-types"><a name="plsqlrecords"></a> 21.4 PL/SQL RECORD Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-objexecmany-a-21-5-inserting-or-passing-multiple-objects-of-the-same-type"><a name="objexecmany"></a> 21.5 Inserting or Passing Multiple Objects of the Same Type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-objectlimitations-a-21-6-oracle-database-object-type-limitations"><a name="objectlimitations"></a> 21.6 Oracle Database Object Type Limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-batchexecution-a-22-batch-statement-execution-and-bulk-loading"><a name="batchexecution"></a> 22. Batch Statement Execution and Bulk Loading</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#identifying-affected-rows-with-executemany">Identifying Affected Rows with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-handlingbatcherrors-a-handling-data-errors-with-executemany"><a name="handlingbatcherrors"></a> Handling Data Errors with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#dml-returning-with-executemany">DML RETURNING with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#calling-pl-sql-with-executemany">Calling PL/SQL with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-executemanyobjects-a-binding-objects-with-executemany"><a name="executemanyobjects"></a> Binding Objects with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-transactionmgt-a-23-transaction-management"><a name="transactionmgt"></a> 23. Transaction Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-stmtcache-a-24-statement-caching"><a name="stmtcache"></a> 24. Statement Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-cqn-a-25-continuous-query-notification-cqn"><a name="cqn"></a> 25. Continuous Query Notification (CQN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-aq-a-26-oracle-advanced-queuing-aq"><a name="aq"></a> 26. Oracle Advanced Queuing (AQ)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-aqrawexample-a-26-1-sending-simple-aq-messages"><a name="aqrawexample"></a> 26.1 Sending Simple AQ Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-aqobjexample-a-26-2-sending-oracle-database-object-aq-messages"><a name="aqobjexample"></a> 26.2 Sending Oracle Database Object AQ Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-aqoptions-a-26-3-changing-aq-options"><a name="aqoptions"></a> 26.3 Changing AQ options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-aqmultiplemessages-a-26-4-enqueuing-and-dequeuing-multiple-messages"><a name="aqmultiplemessages"></a> 26.4 Enqueuing and Dequeuing Multiple Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-aqnotifications-a-26-5-advanced-queuing-notifications"><a name="aqnotifications"></a> 26.5 Advanced Queuing Notifications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-nls-a-27-globalization-and-national-language-support-nls"><a name="nls"></a> 27. Globalization and National Language Support (NLS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-endtoend-a-28-end-to-end-tracing-mid-tier-authentication-and-auditing"><a name="endtoend"></a> 28. End-to-end Tracing, Mid-tier Authentication, and Auditing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-add-on-name">The Add-on Name</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-sodaoverview-a-29-simple-oracle-document-access-soda"><a name="sodaoverview"></a> 29. Simple Oracle Document Access (SODA)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodarequirements-a-29-1-node-oracledb-soda-requirements"><a name="sodarequirements"></a> 29.1 Node-oracledb SODA Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-creatingsodacollections-a-29-2-creating-soda-collections"><a name="creatingsodacollections"></a> 29.2 Creating SODA Collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-accessingsodadocuments-a-29-3-creating-and-accessing-soda-documents"><a name="accessingsodadocuments"></a> 29.3 Creating and Accessing SODA documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodaqbesearches-a-29-4-soda-query-by-example-searches-for-json-documents"><a name="sodaqbesearches"></a> 29.4 SODA Query-by-Example Searches for JSON Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodatextsearches-a-29-5-soda-text-searches"><a name="sodatextsearches"></a> 29.5 SODA Text Searches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodaclientkeys-a-29-6-soda-client-assigned-keys-and-collection-metadata"><a name="sodaclientkeys"></a> 29.6 SODA Client-Assigned Keys and Collection Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-sodajsondataguide-a-29-7-json-data-guides-in-soda"><a name="sodajsondataguide"></a> 29.7 JSON Data Guides in SODA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-roundtrips-a-30-database-round-trips"><a name="roundtrips"></a> 30. Database Round-trips</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-bindtrace-a-a-name-tracingsql-a-31-tracing-sql-and-pl-sql-statements"><a name="bindtrace"></a> <a name="tracingsql"></a> 31. Tracing SQL and PL/SQL Statements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#end-to-end-tracing">End-to-End Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tracing-executed-statements">Tracing Executed Statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tracing-bind-values">Tracing Bind Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-tracing-utilities">Other Tracing Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-programstyles-a-32-node-js-programming-styles-and-node-oracledb"><a name="programstyles"></a> 32. Node.js Programming Styles and node-oracledb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-callbackoverview-a-a-name-examplequerycb-a-32-1-callbacks-and-node-oracledb"><a name="callbackoverview"></a> <a name="examplequerycb"></a> 32.1 Callbacks and node-oracledb</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-promiseoverview-a-32-2-promises-and-node-oracledb"><a name="promiseoverview"></a> 32.2 Promises and node-oracledb</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-name-custompromises-a-32-2-1-custom-promise-libraries"><a name="custompromises"></a> 32.2.1 Custom Promise Libraries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-asyncawaitoverview-a-32-3-async-await-and-node-oracledb"><a name="asyncawaitoverview"></a> 32.3 Async/Await and node-oracledb</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-name-migrate-a-33-migrating-from-previous-node-oracledb-releases"><a name="migrate"></a> 33. Migrating from Previous node-oracledb Releases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-name-migratev1v2-a-33-1-migrating-from-node-oracledb-1-13-to-node-oracledb-2-0"><a name="migratev1v2"></a> 33.1 Migrating from node-oracledb 1.13 to node-oracledb 2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-migratev20v21-a-33-2-migrating-from-node-oracledb-2-0-to-node-oracledb-2-1"><a name="migratev20v21"></a> 33.2 Migrating from node-oracledb 2.0 to node-oracledb 2.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-migratev23v30-a-33-3-migrating-from-node-oracledb-2-3-to-node-oracledb-3-0"><a name="migratev23v30"></a> 33.3 Migrating from node-oracledb 2.3 to node-oracledb 3.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-migratev30v31-a-33-4-migrating-from-node-oracledb-3-0-to-node-oracledb-3-1"><a name="migratev30v31"></a> 33.4 Migrating from node-oracledb 3.0 to node-oracledb 3.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-name-migratev31v40-a-33-5-migrating-from-node-oracledb-3-1-to-node-oracledb-4-0"><a name="migratev31v40"></a> 33.5 Migrating from node-oracledb 3.1 to node-oracledb 4.0</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Node.js Driver</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Node-oracledb 4.0 Documentation for the Oracle Database Node.js Add-on</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/api.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="node-oracledb-4-0-documentation-for-the-oracle-database-node-js-add-on">
<h1>Node-oracledb 4.0 Documentation for the Oracle Database Node.js Add-on<a class="headerlink" href="#node-oracledb-4-0-documentation-for-the-oracle-database-node-js-add-on" title="Permalink to this headline">¶</a></h1>
<p><em>Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</em></p>
<p>You may not use the identified files except in compliance with the Apache
License, Version 2.0 (the “License.”)</p>
<p>You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0.</p>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</p>
<p>See the License for the specific language governing permissions and
limitations under the License.</p>
<div class="section" id="id1">
<h2><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="note-go-to-https-oracle-github-io-node-oracledb-doc-api-html-for-production-documentation">
<h2>===&gt; *** Note: Go to <a class="reference external" href="https://oracle.github.io/node-oracledb/doc/api.html">https://oracle.github.io/node-oracledb/doc/api.html</a> for production documentation ***<a class="headerlink" href="#note-go-to-https-oracle-github-io-node-oracledb-doc-api-html-for-production-documentation" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="manual-sections">
<h2>Manual Sections<a class="headerlink" href="#manual-sections" title="Permalink to this headline">¶</a></h2>
<p>This document contains:</p>
<ul class="simple">
<li><p><a class="reference external" href="#apimanual">Node-oracledb API Manual</a></p></li>
<li><p><a class="reference external" href="#usermanual">Node-oracledb User Manual</a></p></li>
</ul>
<p>For installation information, see the <a class="reference external" href="https://oracle.github.io/node-oracledb/INSTALL.html">Node-oracledb Installation Instructions</a>.</p>
</div>
<div class="section" id="a-name-contents-a-contents">
<h2><a name="contents"></a> Contents<a class="headerlink" href="#a-name-contents-a-contents" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#intro">Introduction</a></p>
<ul class="simple">
<li><p>1.1 <a class="reference external" href="#getstarted">Getting Started with Node-oracledb</a></p>
<ul>
<li><p>1.1.1 <a class="reference external" href="#examplequery">Example: A SQL SELECT statement in Node.js</a></p></li>
<li><p>1.1.2 <a class="reference external" href="#examplesodaawait">Example: Simple Oracle Document Access (SODA) in Node.js</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#errorobj">Errors</a></p>
<ul class="simple">
<li><p>2.1 <a class="reference external" href="#properror">Error Properties</a></p>
<ul>
<li><p>2.1.1 <a class="reference external" href="#properrerrornum"><code class="docutils literal notranslate"><span class="pre">errorNum</span></code></a></p></li>
<li><p>2.1.2 <a class="reference external" href="#properrmessage"><code class="docutils literal notranslate"><span class="pre">message</span></code></a></p></li>
<li><p>2.1.3 <a class="reference external" href="#properroffset"><code class="docutils literal notranslate"><span class="pre">offset</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#oracledbclass">Oracledb Class</a></p>
<ul class="simple">
<li><p>3.1 <a class="reference external" href="#oracledbconstants">Oracledb Constants</a></p>
<ul>
<li><p>3.1.1 <a class="reference external" href="#oracledbconstantsoutformat">Query <code class="docutils literal notranslate"><span class="pre">outFormat</span></code> Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantsoutformat"><code class="docutils literal notranslate"><span class="pre">OUT_FORMAT_ARRAY</span></code></a>, <a class="reference external" href="#oracledbconstantsoutformat"><code class="docutils literal notranslate"><span class="pre">OUT_FORMAT_OBJECT</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.2 <a class="reference external" href="#oracledbconstantsnodbtype">Node-oracledb Type Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">BLOB</span></code></a>, <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">BUFFER</span></code></a>, <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">CLOB</span></code></a>, <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">CURSOR</span></code></a>, <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">DATE</span></code></a>, <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code></a>, <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">NUMBER</span></code></a>, <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">STRING</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.3 <a class="reference external" href="#oracledbconstantsdbtype">Oracle Database Type Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_BFILE</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_BINARY_DOUBLE</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_BINARY_FLOAT</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_BINARY_INTEGER</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_BLOB</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_BOOLEAN</span></code></a>,
<a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_CHAR</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_CLOB</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_CURSOR</span></code></a>,
<a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_DATE</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_INTERVAL_DS</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_INTERVAL_YM</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_LONG</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_LONG_RAW</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_NCHAR</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_NCLOB</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_NUMBER</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_NVARCHAR</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_OBJECT</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_RAW</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_ROWID</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_TIMESTAMP</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_TIMESTAMP_LTZ</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_TIMESTAMP_TZ</span></code></a>, <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">DB_TYPE_VARCHAR</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.4 <a class="reference external" href="#oracledbconstantsbinddir">Execute Bind Direction Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantsbinddir"><code class="docutils literal notranslate"><span class="pre">BIND_IN</span></code></a>, <a class="reference external" href="#oracledbconstantsbinddir"><code class="docutils literal notranslate"><span class="pre">BIND_INOUT</span></code></a>, <a class="reference external" href="#oracledbconstantsbinddir"><code class="docutils literal notranslate"><span class="pre">BIND_OUT</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.5 <a class="reference external" href="#oracledbconstantsprivilege">Privileged Connection Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantsprivilege"><code class="docutils literal notranslate"><span class="pre">SYSASM</span></code></a>, <a class="reference external" href="#oracledbconstantsprivilege"><code class="docutils literal notranslate"><span class="pre">SYSBACKUP</span></code></a>, <a class="reference external" href="#oracledbconstantsprivilege"><code class="docutils literal notranslate"><span class="pre">SYSDBA</span></code></a>, <a class="reference external" href="#oracledbconstantsprivilege"><code class="docutils literal notranslate"><span class="pre">SYSDG</span></code></a>, <a class="reference external" href="#oracledbconstantsprivilege"><code class="docutils literal notranslate"><span class="pre">SYSKM</span></code></a>, <a class="reference external" href="#oracledbconstantsprivilege"><code class="docutils literal notranslate"><span class="pre">SYSOPER</span></code></a>, <a class="reference external" href="#oracledbconstantsprivilege"><code class="docutils literal notranslate"><span class="pre">SYSRAC</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.6 <a class="reference external" href="#oracledbconstantsstmttype">SQL Statement Type Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_ALTER</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_BEGIN</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_CALL</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_COMMIT</span></code></a> <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_CREATE</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_DECLARE</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_DELETE</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_DROP</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_EXPLAIN_PLAN</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_INSERT</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_MERGE</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_ROLLBACK</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_SELECT</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_UNKNOWN</span></code></a>, <a class="reference external" href="#oracledbconstantsstmttype"><code class="docutils literal notranslate"><span class="pre">STMT_TYPE_UPDATE</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.7 <a class="reference external" href="#oracledbconstantssubscription">Subscription Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_EVENT_TYPE_AQ</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_EVENT_TYPE_DEREG</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_EVENT_TYPE_OBJ_CHANGE</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_EVENT_TYPE_QUERY_CHANGE</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_EVENT_TYPE_SHUTDOWN</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_EVENT_TYPE_SHUTDOWN_ANY</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_EVENT_TYPE_STARTUP</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_GROUPING_CLASS_TIME</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_GROUPING_TYPE_LAST</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_GROUPING_TYPE_SUMMARY</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_QOS_BEST_EFFORT</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_QOS_DEREG_NFY</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_QOS_QUERY</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_QOS_RELIABLE</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_QOS_ROWIDS</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_NAMESPACE_AQ</span></code></a>, <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">SUBSCR_NAMESPACE_DBCHANGE</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.8 <a class="reference external" href="#oracledbconstantsaq">Advanced Queuing Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_MODE_BROWSE</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_MODE_LOCKED</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_MODE_REMOVE</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_MODE_REMOVE_NO_DATA</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_NAV_FIRST_MSG</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_NAV_NEXT_TRANSACTION</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_NAV_NEXT_MSG</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_NO_WAIT</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_DEQ_WAIT_FOREVER</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_MSG_DELIV_MODE_PERSISTENT</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_MSG_DELIV_MODE_BUFFERED</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_MSG_DELIV_MODE_PERSISTENT_OR_BUFFERED</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_MSG_STATE_READY</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_MSG_STATE_WAITING</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_MSG_STATE_PROCESSED</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_MSG_STATE_EXPIRED</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_VISIBILITY_IMMEDIATE</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">AQ_VISIBILITY_ON_COMMIT</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.9 <a class="reference external" href="#oracledbconstantscqn">Continuous Query Notification Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">CQN_OPCODE_ALL_OPS</span></code></a>, <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">CQN_OPCODE_ALL_ROWS</span></code></a>, <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">CQN_OPCODE_ALTER</span></code></a>, <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">CQN_OPCODE_DELETE</span></code></a>, <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">CQN_OPCODE_DROP</span></code></a>, <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">CQN_OPCODE_INSERT</span></code></a>, <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">CQN_OPCODE_UPDATE</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.10 <a class="reference external" href="#oracledbconstantspool">Pool Status Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantspool"><code class="docutils literal notranslate"><span class="pre">POOL_STATUS_CLOSED</span></code></a>, <a class="reference external" href="#oracledbconstantspool"><code class="docutils literal notranslate"><span class="pre">POOL_STATUS_DRAINING</span></code></a>, <a class="reference external" href="#oracledbconstantspool"><code class="docutils literal notranslate"><span class="pre">POOL_STATUS_OPEN</span></code></a></p></li>
</ul>
</li>
<li><p>3.1.11 <a class="reference external" href="#oracledbconstantssoda">Simple Oracle Document Access (SODA) Constants</a></p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantssoda"><code class="docutils literal notranslate"><span class="pre">SODA_COLL_MAP_MODE</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p>3.2 <a class="reference external" href="#oracledbproperties">Oracledb Properties</a></p>
<ul>
<li><p>3.2.1 <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">autoCommit</span></code></a></p></li>
<li><p>3.2.2 <a class="reference external" href="#propdbconclass"><code class="docutils literal notranslate"><span class="pre">connectionClass</span></code></a></p></li>
<li><p>3.2.3 <a class="reference external" href="#propdbedition"><code class="docutils literal notranslate"><span class="pre">edition</span></code></a></p></li>
<li><p>3.2.4 <a class="reference external" href="#propdbevents"><code class="docutils literal notranslate"><span class="pre">events</span></code></a></p></li>
<li><p>3.2.5 <a class="reference external" href="#propdbextendedmetadata"><code class="docutils literal notranslate"><span class="pre">extendedMetaData</span></code></a></p></li>
<li><p>3.2.6 <a class="reference external" href="#propdbisexternalauth"><code class="docutils literal notranslate"><span class="pre">externalAuth</span></code></a></p></li>
<li><p>3.2.7 <a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a></p></li>
<li><p>3.2.8 <a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a></p></li>
<li><p>3.2.9 <a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a></p></li>
<li><p>3.2.10 <a class="reference external" href="#propdblobprefetchsize"><code class="docutils literal notranslate"><span class="pre">lobPrefetchSize</span></code></a></p></li>
<li><p>3.2.11 <a class="reference external" href="#propdbmaxrows"><code class="docutils literal notranslate"><span class="pre">maxRows</span></code></a></p></li>
<li><p>3.2.12 <a class="reference external" href="#propdboracleclientversion"><code class="docutils literal notranslate"><span class="pre">oracleClientVersion</span></code></a></p></li>
<li><p>3.2.13 <a class="reference external" href="#propdboracleclientversionstring"><code class="docutils literal notranslate"><span class="pre">oracleClientVersionString</span></code></a></p></li>
<li><p>3.2.14 <a class="reference external" href="#propdboutformat"><code class="docutils literal notranslate"><span class="pre">outFormat</span></code></a></p></li>
<li><p>3.2.15 <a class="reference external" href="#propdbpoolincrement"><code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code></a></p></li>
<li><p>3.2.16 <a class="reference external" href="#propdbpoolmax"><code class="docutils literal notranslate"><span class="pre">poolMax</span></code></a></p></li>
<li><p>3.2.17 <a class="reference external" href="#propdbpoolmin"><code class="docutils literal notranslate"><span class="pre">poolMin</span></code></a></p></li>
<li><p>3.2.18 <a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code></a></p></li>
<li><p>3.2.19 <a class="reference external" href="#propdbpooltimeout"><code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code></a></p></li>
<li><p>3.2.20 <a class="reference external" href="#propdbprefetchrows"><code class="docutils literal notranslate"><span class="pre">prefetchRows</span></code></a></p></li>
<li><p>3.2.21 <a class="reference external" href="#propdbpromise"><code class="docutils literal notranslate"><span class="pre">Promise</span></code></a></p></li>
<li><p>3.2.22 <a class="reference external" href="#propdbqueuerequests"><code class="docutils literal notranslate"><span class="pre">queueRequests</span></code></a></p></li>
<li><p>3.2.23 <a class="reference external" href="#propdbqueuetimeout"><code class="docutils literal notranslate"><span class="pre">queueTimeout</span></code></a></p></li>
<li><p>3.2.24 <a class="reference external" href="#propdbstmtcachesize"><code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code></a></p></li>
<li><p>3.2.25 <a class="reference external" href="#propdbversion"><code class="docutils literal notranslate"><span class="pre">version</span></code></a></p></li>
<li><p>3.2.26 <a class="reference external" href="#propdbversionstring"><code class="docutils literal notranslate"><span class="pre">versionString</span></code></a></p></li>
<li><p>3.2.27 <a class="reference external" href="#propdbversionsuffix"><code class="docutils literal notranslate"><span class="pre">versionSuffix</span></code></a></p></li>
</ul>
</li>
<li><p>3.3 <a class="reference external" href="#oracledbmethods">Oracledb Methods</a></p>
<ul>
<li><p>3.3.1 <a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">createPool()</span></code></a></p>
<ul>
<li><p>3.3.1.1 <a class="reference external" href="#createpoolpoolattrs"><code class="docutils literal notranslate"><span class="pre">createPool()</span></code>: Parameters and Attributes</a></p>
<ul>
<li><p>3.3.1.1.1 <a class="reference external" href="#createpoolpoolattrsconnectstring"><code class="docutils literal notranslate"><span class="pre">connectString</span></code></a>, <a class="reference external" href="#createpoolpoolattrsconnectstring"><code class="docutils literal notranslate"><span class="pre">connectionString</span></code></a></p></li>
<li><p>3.3.1.1.2 <a class="reference external" href="#createpoolpoolattrsedition"><code class="docutils literal notranslate"><span class="pre">edition</span></code></a></p></li>
<li><p>3.3.1.1.3 <a class="reference external" href="#createpoolpoolattrsevents"><code class="docutils literal notranslate"><span class="pre">events</span></code></a></p></li>
<li><p>3.3.1.1.4 <a class="reference external" href="#createpoolpoolattrsexternalauth"><code class="docutils literal notranslate"><span class="pre">externalAuth</span></code></a></p></li>
<li><p>3.3.1.1.5 <a class="reference external" href="#createpoolpoolattrshomogeneous"><code class="docutils literal notranslate"><span class="pre">homogeneous</span></code></a></p></li>
<li><p>3.3.1.1.6 <a class="reference external" href="#createpoolpoolattrspassword"><code class="docutils literal notranslate"><span class="pre">password</span></code></a></p></li>
<li><p>3.3.1.1.7 <a class="reference external" href="#createpoolpoolattrspoolalias"><code class="docutils literal notranslate"><span class="pre">poolAlias</span></code></a></p></li>
<li><p>3.3.1.1.8 <a class="reference external" href="#createpoolpoolattrspoolincrement"><code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code></a></p></li>
<li><p>3.3.1.1.9 <a class="reference external" href="#createpoolpoolattrspoolmax"><code class="docutils literal notranslate"><span class="pre">poolMax</span></code></a></p></li>
<li><p>3.3.1.1.10 <a class="reference external" href="#createpoolpoolattrspoolmin"><code class="docutils literal notranslate"><span class="pre">poolMin</span></code></a></p></li>
<li><p>3.3.1.1.11 <a class="reference external" href="#createpoolpoolattrspoolpinginterval"><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code></a></p></li>
<li><p>3.3.1.1.12 <a class="reference external" href="#createpoolpoolattrspooltimeout"><code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code></a></p></li>
<li><p>3.3.1.1.13 <a class="reference external" href="#createpoolpoolattrsqueuerequests"><code class="docutils literal notranslate"><span class="pre">queueRequests</span></code></a></p></li>
<li><p>3.3.1.1.14 <a class="reference external" href="#createpoolpoolattrsqueuetimeout"><code class="docutils literal notranslate"><span class="pre">queueTimeout</span></code></a></p></li>
<li><p>3.3.1.1.15 <a class="reference external" href="#createpoolpoolattrssessioncallback"><code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code></a></p></li>
<li><p>3.3.1.1.16 <a class="reference external" href="#createpoolpoolattrsstmtcachesize"><code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code></a></p></li>
<li><p>3.3.1.1.17 <a class="reference external" href="#createpoolpoolattrsuser"><code class="docutils literal notranslate"><span class="pre">user</span></code></a></p></li>
</ul>
</li>
<li><p>3.3.1.2 <a class="reference external" href="#createpoolpoolcallback"><code class="docutils literal notranslate"><span class="pre">createPool()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>3.3.2 <a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a></p>
<ul>
<li><p>3.3.2.1 <a class="reference external" href="#getconnectiondbattrs"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>: Parameters</a></p>
<ul>
<li><p>3.3.2.1.1 <a class="reference external" href="#getconnectionpoolalias">Pool Alias</a></p></li>
<li><p>3.3.2.1.2 <a class="reference external" href="#getconnectiondbattrsconnattrs"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>: Attributes</a></p>
<ul>
<li><p>3.3.2.1.2.1 <a class="reference external" href="#getconnectiondbattrsconnectstring"><code class="docutils literal notranslate"><span class="pre">connectString</span></code></a>, <a class="reference external" href="#getconnectiondbattrsconnectstring"><code class="docutils literal notranslate"><span class="pre">connectionString</span></code></a></p></li>
<li><p>3.3.2.1.2.2 <a class="reference external" href="#getconnectiondbattrsedition"><code class="docutils literal notranslate"><span class="pre">edition</span></code></a></p></li>
<li><p>3.3.2.1.2.3 <a class="reference external" href="#getconnectiondbattrsevents"><code class="docutils literal notranslate"><span class="pre">events</span></code></a></p></li>
<li><p>3.3.2.1.2.4 <a class="reference external" href="#getconnectiondbattrsexternalauth"><code class="docutils literal notranslate"><span class="pre">externalAuth</span></code></a></p></li>
<li><p>3.3.2.1.2.5 <a class="reference external" href="#getconnectiondbattrsmatchany"><code class="docutils literal notranslate"><span class="pre">matchAny</span></code></a></p></li>
<li><p>3.3.2.1.2.6 <a class="reference external" href="#getconnectiondbattrsnewpassword"><code class="docutils literal notranslate"><span class="pre">newPassword</span></code></a></p></li>
<li><p>3.3.2.1.2.7 <a class="reference external" href="#getconnectiondbattrspoolalias"><code class="docutils literal notranslate"><span class="pre">poolAlias</span></code></a></p></li>
<li><p>3.3.2.1.2.8 <a class="reference external" href="#getconnectiondbattrspassword"><code class="docutils literal notranslate"><span class="pre">password</span></code></a></p></li>
<li><p>3.3.2.1.2.9 <a class="reference external" href="#getconnectiondbattrsprivilege"><code class="docutils literal notranslate"><span class="pre">privilege</span></code></a></p></li>
<li><p>3.3.2.1.2.10 <a class="reference external" href="#getconnectiondbattrsstmtcachesize"><code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code></a></p></li>
<li><p>3.3.2.1.2.11 <a class="reference external" href="#getconnectiondbattrstag"><code class="docutils literal notranslate"><span class="pre">tag</span></code></a></p></li>
<li><p>3.3.2.1.2.12 <a class="reference external" href="#getconnectiondbattrsuser"><code class="docutils literal notranslate"><span class="pre">user</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p>3.3.2.2 <a class="reference external" href="#getconnectiondbcallback"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>3.3.3 <a class="reference external" href="#getpool"><code class="docutils literal notranslate"><span class="pre">getPool()</span></code></a></p>
<ul>
<li><p>3.3.3.1 <a class="reference external" href="#getpoolattrs"><code class="docutils literal notranslate"><span class="pre">getPool()</span></code>: Parameters</a></p>
<ul>
<li><p>3.3.3.1.1 <a class="reference external" href="#getpoolattrsalias"><code class="docutils literal notranslate"><span class="pre">poolAlias</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#connectionclass">Connection Class</a></p>
<ul class="simple">
<li><p>4.1 <a class="reference external" href="#connectionproperties">Connection Properties</a></p>
<ul>
<li><p>4.1.1 <a class="reference external" href="#propconnaction"><code class="docutils literal notranslate"><span class="pre">action</span></code></a></p></li>
<li><p>4.1.2 <a class="reference external" href="#propconncalltimeout"><code class="docutils literal notranslate"><span class="pre">callTimeout</span></code></a></p></li>
<li><p>4.1.3 <a class="reference external" href="#propconnclientid"><code class="docutils literal notranslate"><span class="pre">clientId</span></code></a></p></li>
<li><p>4.1.4 <a class="reference external" href="#propconncurrentschema"><code class="docutils literal notranslate"><span class="pre">currentSchema</span></code></a></p></li>
<li><p>4.1.5 <a class="reference external" href="#propconnmodule"><code class="docutils literal notranslate"><span class="pre">module</span></code></a></p></li>
<li><p>4.1.6 <a class="reference external" href="#propconnoracleserverversion"><code class="docutils literal notranslate"><span class="pre">oracleServerVersion</span></code></a></p></li>
<li><p>4.1.7 <a class="reference external" href="#propconnoracleserverversionstring"><code class="docutils literal notranslate"><span class="pre">oracleServerVersionString</span></code></a></p></li>
<li><p>4.1.8 <a class="reference external" href="#propconnstmtcachesize"><code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code></a></p></li>
<li><p>4.1.9 <a class="reference external" href="#propconntag"><code class="docutils literal notranslate"><span class="pre">tag</span></code></a></p></li>
</ul>
</li>
<li><p>4.2 <a class="reference external" href="#connectionmethods">Connection Methods</a></p>
<ul>
<li><p>4.2.1 <a class="reference external" href="#break"><code class="docutils literal notranslate"><span class="pre">break()</span></code></a></p></li>
<li><p>4.2.2 <a class="reference external" href="#changepassword"><code class="docutils literal notranslate"><span class="pre">changePassword()</span></code></a></p></li>
<li><p>4.2.3 <a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></p></li>
<li><p>4.2.4 <a class="reference external" href="#commit"><code class="docutils literal notranslate"><span class="pre">commit()</span></code></a></p></li>
<li><p>4.2.5 <a class="reference external" href="#connectioncreatelob"><code class="docutils literal notranslate"><span class="pre">createLob()</span></code></a></p></li>
<li><p>4.2.6 <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a></p>
<ul>
<li><p>4.2.6.1 <a class="reference external" href="#executesqlparam"><code class="docutils literal notranslate"><span class="pre">execute()</span></code>: SQL Statement</a></p></li>
<li><p>4.2.6.2 <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">execute()</span></code>: Bind Parameters</a></p>
<ul>
<li><p><a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">dir</span></code></a>, <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code></a>, <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">maxSize</span></code></a>, <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">type</span></code></a>, <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">val</span></code></a></p></li>
</ul>
</li>
<li><p>4.2.6.3 <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">execute()</span></code>: Options</a></p>
<ul>
<li><p>4.2.6.3.1 <a class="reference external" href="#propexecautocommit"><code class="docutils literal notranslate"><span class="pre">autoCommit</span></code></a></p></li>
<li><p>4.2.6.3.2 <a class="reference external" href="#propexecextendedmetadata"><code class="docutils literal notranslate"><span class="pre">extendedMetaData</span></code></a></p></li>
<li><p>4.2.6.3.3 <a class="reference external" href="#propexecfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a></p></li>
<li><p>4.2.6.3.4 <a class="reference external" href="#propexecfetchinfo"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a></p></li>
<li><p>4.2.6.3.5 <a class="reference external" href="#propexecmaxrows"><code class="docutils literal notranslate"><span class="pre">maxRows</span></code></a></p></li>
<li><p>4.2.6.3.6 <a class="reference external" href="#propexecoutformat"><code class="docutils literal notranslate"><span class="pre">outFormat</span></code></a></p></li>
<li><p>4.2.6.3.7 <a class="reference external" href="#propexecprefetchrows"><code class="docutils literal notranslate"><span class="pre">prefetchRows</span></code></a></p></li>
<li><p>4.2.6.3.8 <a class="reference external" href="#propexecresultset"><code class="docutils literal notranslate"><span class="pre">resultSet</span></code></a></p></li>
</ul>
</li>
<li><p>4.2.6.4 <a class="reference external" href="#executecallback"><code class="docutils literal notranslate"><span class="pre">execute()</span></code>: Callback Function</a></p>
<ul>
<li><p>4.2.6.4.1 <a class="reference external" href="#execimplicitresults"><code class="docutils literal notranslate"><span class="pre">implicitResults</span></code></a></p></li>
<li><p>4.2.6.4.2 <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">metaData</span></code></a></p>
<ul>
<li><p><a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">byteSize</span></code></a>, <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">dbType</span></code></a>, <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">dbTypeClass</span></code></a>, <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">dbTypeName</span></code></a>, <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">fetchType</span></code></a>, <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">name</span></code></a>, <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">nullable</span></code></a>, <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">precision</span></code></a>, <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">scale</span></code></a></p></li>
</ul>
</li>
<li><p>4.2.6.4.3 <a class="reference external" href="#execoutbinds"><code class="docutils literal notranslate"><span class="pre">outBinds</span></code></a></p></li>
<li><p>4.2.6.4.4 <a class="reference external" href="#execresultset"><code class="docutils literal notranslate"><span class="pre">resultSet</span></code></a></p></li>
<li><p>4.2.6.4.5 <a class="reference external" href="#execrows"><code class="docutils literal notranslate"><span class="pre">rows</span></code></a></p></li>
<li><p>4.2.6.4.6 <a class="reference external" href="#execrowsaffected"><code class="docutils literal notranslate"><span class="pre">rowsAffected</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p>4.2.7 <a class="reference external" href="#executemany"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a></p>
<ul>
<li><p>4.2.7.1 <a class="reference external" href="#executemanysqlparam"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code>: SQL Statement</a></p></li>
<li><p>4.2.7.2 <a class="reference external" href="#executemanybinds"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code>: Binds</a></p></li>
<li><p>4.2.7.3 <a class="reference external" href="#executemanyoptions"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code>: Options</a></p>
<ul>
<li><p>4.2.7.3.1 <a class="reference external" href="#executemanyoptautocommit"><code class="docutils literal notranslate"><span class="pre">autoCommit</span></code></a></p></li>
<li><p>4.2.7.3.2 <a class="reference external" href="#executemanyoptbatcherrors"><code class="docutils literal notranslate"><span class="pre">batchErrors</span></code></a></p></li>
<li><p>4.2.7.3.3 <a class="reference external" href="#executemanyoptbinddefs"><code class="docutils literal notranslate"><span class="pre">bindDefs</span></code></a></p>
<ul>
<li><p><a class="reference external" href="#executemanyoptbinddefs"><code class="docutils literal notranslate"><span class="pre">dir</span></code></a>, <a class="reference external" href="#executemanyoptbinddefs"><code class="docutils literal notranslate"><span class="pre">maxSize</span></code></a>, <a class="reference external" href="#executemanyoptbinddefs"><code class="docutils literal notranslate"><span class="pre">type</span></code></a></p></li>
</ul>
</li>
<li><p>4.2.7.3.4 <a class="reference external" href="#executemanyoptdmlrowcounts"><code class="docutils literal notranslate"><span class="pre">dmlRowCounts</span></code></a></p></li>
</ul>
</li>
<li><p>4.2.7.4 <a class="reference external" href="#executemanycallback"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code>: Callback Function</a></p>
<ul>
<li><p>4.2.7.4.1 <a class="reference external" href="#execmanybatcherrors"><code class="docutils literal notranslate"><span class="pre">batchErrors</span></code></a></p></li>
<li><p>4.2.7.4.2 <a class="reference external" href="#execmanydmlrowscounts"><code class="docutils literal notranslate"><span class="pre">dmlRowCounts</span></code></a></p></li>
<li><p>4.2.7.4.3 <a class="reference external" href="#execmanyoutbinds"><code class="docutils literal notranslate"><span class="pre">outBinds</span></code></a></p></li>
<li><p>4.2.7.4.4 <a class="reference external" href="#execmanyrowsaffected"><code class="docutils literal notranslate"><span class="pre">rowsAffected</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p>4.2.8 <a class="reference external" href="#getdbobjectclass"><code class="docutils literal notranslate"><span class="pre">getDbObjectClass()</span></code></a></p></li>
<li><p>4.2.9 <a class="reference external" href="#getqueue"><code class="docutils literal notranslate"><span class="pre">getQueue()</span></code></a></p></li>
<li><p>4.2.10 <a class="reference external" href="#getsodadatabase"><code class="docutils literal notranslate"><span class="pre">getSodaDatabase()</span></code></a></p></li>
<li><p>4.2.11 <a class="reference external" href="#getstmtinfo"><code class="docutils literal notranslate"><span class="pre">getStatementInfo()</span></code></a></p></li>
<li><p>4.2.12 <a class="reference external" href="#connectionping"><code class="docutils literal notranslate"><span class="pre">ping()</span></code></a></p></li>
<li><p>4.2.13 <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a></p></li>
<li><p>4.2.14 <a class="reference external" href="#release"><code class="docutils literal notranslate"><span class="pre">release()</span></code></a></p></li>
<li><p>4.2.15 <a class="reference external" href="#rollback"><code class="docutils literal notranslate"><span class="pre">rollback()</span></code></a></p></li>
<li><p>4.2.16 <a class="reference external" href="#consubscribe"><code class="docutils literal notranslate"><span class="pre">subscribe()</span></code></a></p>
<ul>
<li><p>4.2.16.1 <a class="reference external" href="#consubscribename"><code class="docutils literal notranslate"><span class="pre">subscribe()</span></code>: Name</a></p></li>
<li><p>4.2.16.2 <a class="reference external" href="#consubscribeoptions"><code class="docutils literal notranslate"><span class="pre">subscribe()</span></code>: Options</a></p>
<ul>
<li><p>4.2.16.2.1 <a class="reference external" href="#consubscribeoptbinds"><code class="docutils literal notranslate"><span class="pre">binds</span></code></a></p></li>
<li><p>4.2.16.2.2 <a class="reference external" href="#consubscribeoptcallback"><code class="docutils literal notranslate"><span class="pre">callback</span></code></a></p></li>
<li><p>4.2.16.2.3 <a class="reference external" href="#consubscribeoptgroupingclass"><code class="docutils literal notranslate"><span class="pre">groupingClass</span></code></a></p></li>
<li><p>4.2.16.2.4 <a class="reference external" href="#consubscribeoptgroupingtype"><code class="docutils literal notranslate"><span class="pre">groupingType</span></code></a></p></li>
<li><p>4.2.16.2.5 <a class="reference external" href="#consubscribeoptgroupingvalue"><code class="docutils literal notranslate"><span class="pre">groupingValue</span></code></a></p></li>
<li><p>4.2.16.2.6 <a class="reference external" href="#consubscribeoptipaddress"><code class="docutils literal notranslate"><span class="pre">ipAddress</span></code></a></p></li>
<li><p>4.2.16.2.7 <a class="reference external" href="#consubscribeoptnamespace"><code class="docutils literal notranslate"><span class="pre">namespace</span></code></a></p></li>
<li><p>4.2.16.2.8 <a class="reference external" href="#consubscribeoptoperations"><code class="docutils literal notranslate"><span class="pre">operations</span></code></a></p></li>
<li><p>4.2.16.2.9 <a class="reference external" href="#consubscribeoptport"><code class="docutils literal notranslate"><span class="pre">port</span></code></a></p></li>
<li><p>4.2.16.2.10 <a class="reference external" href="#consubscribeoptqos"><code class="docutils literal notranslate"><span class="pre">qos</span></code></a></p></li>
<li><p>4.2.16.2.11 <a class="reference external" href="#consubscribeoptsql"><code class="docutils literal notranslate"><span class="pre">sql</span></code></a></p></li>
<li><p>4.2.16.2.12 <a class="reference external" href="#consubscribeopttimeout"><code class="docutils literal notranslate"><span class="pre">timeout</span></code></a></p></li>
</ul>
</li>
<li><p>4.2.16.3 <a class="reference external" href="#consubscribecallback"><code class="docutils literal notranslate"><span class="pre">subscribe()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>4.2.17 <a class="reference external" href="#conunsubscribe"><code class="docutils literal notranslate"><span class="pre">unsubscribe()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#aqqueueclass">AqQueue Class</a></p>
<ul class="simple">
<li><p>5.1 <a class="reference external" href="#aqqueueproperties">AqQueue Properties</a></p>
<ul>
<li><p>5.1.1 <a class="reference external" href="#aqqueuename"><code class="docutils literal notranslate"><span class="pre">name</span></code></a></p></li>
<li><p>5.1.2 <a class="reference external" href="#aqqueuedeqopts"><code class="docutils literal notranslate"><span class="pre">deqOptions</span></code></a></p>
<ul>
<li><p>5.1.2.1 <a class="reference external" href="#aqdeqoptionsclass">AqDeqOptions Class</a></p></li>
</ul>
</li>
<li><p>5.1.3 <a class="reference external" href="#aqqueueenqopts"><code class="docutils literal notranslate"><span class="pre">enqOptions</span></code></a></p>
<ul>
<li><p>5.1.3.1 <a class="reference external" href="#aqenqoptionsclass">AqEnqOptions Class</a></p></li>
</ul>
</li>
<li><p>5.1.4 <a class="reference external" href="#aqqueuepayloadtype"><code class="docutils literal notranslate"><span class="pre">payloadType</span></code></a></p></li>
<li><p>5.1.5 <a class="reference external" href="#aqqueuepayloadtypeclass"><code class="docutils literal notranslate"><span class="pre">payloadTypeClass</span></code></a></p></li>
<li><p>5.1.6 <a class="reference external" href="#aqqueuepayloadtypename"><code class="docutils literal notranslate"><span class="pre">payloadTypeName</span></code></a></p></li>
</ul>
</li>
<li><p>5.2 <a class="reference external" href="#aqqueuemethods">AqQueue Methods</a></p>
<ul>
<li><p>5.2.1 <a class="reference external" href="#aqqueuemethoddeqmany"><code class="docutils literal notranslate"><span class="pre">deqMany()</span></code></a></p></li>
<li><p>5.2.2 <a class="reference external" href="#aqqueuemethoddeqone"><code class="docutils literal notranslate"><span class="pre">deqOne()</span></code></a></p>
<ul>
<li><p>5.2.2.1 <a class="reference external" href="#aqmessageclass">AqMessage Class</a></p></li>
</ul>
</li>
<li><p>5.2.3 <a class="reference external" href="#aqqueuemethodenqmany"><code class="docutils literal notranslate"><span class="pre">enqMany()</span></code></a></p></li>
<li><p>5.2.4 <a class="reference external" href="#aqqueuemethodenqone"><code class="docutils literal notranslate"><span class="pre">enqOne()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#dbobjectclass">DbObject Class</a></p>
<ul class="simple">
<li><p>6.1 <a class="reference external" href="#dbobjectproperties">DbObject Properties</a></p>
<ul>
<li><p>6.1.1 <a class="reference external" href="#dbobjattributesattributes"><code class="docutils literal notranslate"><span class="pre">attributes</span></code></a></p></li>
<li><p>6.1.2 <a class="reference external" href="#dbobjattributeselementtype"><code class="docutils literal notranslate"><span class="pre">elementType</span></code></a></p></li>
<li><p>6.1.3 <a class="reference external" href="#dbobjattributeselementtypeclass"><code class="docutils literal notranslate"><span class="pre">elementTypeClass</span></code></a></p></li>
<li><p>6.1.4 <a class="reference external" href="#dbobjattributeselementtypename"><code class="docutils literal notranslate"><span class="pre">elementTypeName</span></code></a></p></li>
<li><p>6.1.5 <a class="reference external" href="#dbobjattributesfqn"><code class="docutils literal notranslate"><span class="pre">fqn</span></code></a></p></li>
<li><p>6.1.6 <a class="reference external" href="#dbobjattributesiscollection"><code class="docutils literal notranslate"><span class="pre">isCollection</span></code></a></p></li>
<li><p>6.1.7 <a class="reference external" href="#dbobjattributeslength"><code class="docutils literal notranslate"><span class="pre">length</span></code></a></p></li>
<li><p>6.1.8 <a class="reference external" href="#dbobjattributesname"><code class="docutils literal notranslate"><span class="pre">name</span></code></a></p></li>
<li><p>6.1.9 <a class="reference external" href="#dbobjattributesschema"><code class="docutils literal notranslate"><span class="pre">schema</span></code></a></p></li>
</ul>
</li>
<li><p>6.2 <a class="reference external" href="#dbobjectmethods">DbObject Methods</a></p>
<ul>
<li><p>6.2.1 <a class="reference external" href="#dbobjectmethodscolls">DbObject Methods for Collections</a></p>
<ul>
<li><p><a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">append()</span></code></a>, <a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">deleteElement()</span></code></a>, <a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">getElement()</span></code></a>,
<a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">getFirstIndex()</span></code></a>, <a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">getKeys()</span></code></a>, <a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">getLastIndex()</span></code></a>,
<a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">getNextIndex()</span></code></a>, <a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">getPrevIndex()</span></code></a>, <a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">hasElement()</span></code></a>,
<a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">setElement()</span></code></a>, <a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">getValues()</span></code></a>, <a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">trim()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#lobclass">Lob Class</a></p>
<ul class="simple">
<li><p>7.1 <a class="reference external" href="#lobproperties">Lob Properties</a></p>
<ul>
<li><p>7.1.1 <a class="reference external" href="#proplobchunksize"><code class="docutils literal notranslate"><span class="pre">chunkSize</span></code></a></p></li>
<li><p>7.1.2 <a class="reference external" href="#proploblength"><code class="docutils literal notranslate"><span class="pre">length</span></code></a></p></li>
<li><p>7.1.3 <a class="reference external" href="#proplobpiecesize"><code class="docutils literal notranslate"><span class="pre">pieceSize</span></code></a></p></li>
<li><p>7.1.4 <a class="reference external" href="#proplobtype"><code class="docutils literal notranslate"><span class="pre">type</span></code></a></p></li>
</ul>
</li>
<li><p>7.2 <a class="reference external" href="#lobmethods">Lob Methods</a></p>
<ul>
<li><p>7.2.1 <a class="reference external" href="#lobclose"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></p></li>
<li><p>7.2.2 <a class="reference external" href="#lobgetdata"><code class="docutils literal notranslate"><span class="pre">getData()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#poolclass">Pool Class</a></p>
<ul class="simple">
<li><p>8.1 <a class="reference external" href="#poolproperties">Pool Properties</a></p>
<ul>
<li><p>8.1.1 <a class="reference external" href="#proppoolconnectionsinuse"><code class="docutils literal notranslate"><span class="pre">connectionsInUse</span></code></a></p></li>
<li><p>8.1.2 <a class="reference external" href="#proppoolconnectionsopen"><code class="docutils literal notranslate"><span class="pre">connectionsOpen</span></code></a></p></li>
<li><p>8.1.3 <a class="reference external" href="#proppoolpoolalias"><code class="docutils literal notranslate"><span class="pre">poolAlias</span></code></a></p></li>
<li><p>8.1.4 <a class="reference external" href="#proppoolpoolincrement"><code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code></a></p></li>
<li><p>8.1.5 <a class="reference external" href="#proppoolpoolmax"><code class="docutils literal notranslate"><span class="pre">poolMax</span></code></a></p></li>
<li><p>8.1.6 <a class="reference external" href="#proppoolpoolmin"><code class="docutils literal notranslate"><span class="pre">poolMin</span></code></a></p></li>
<li><p>8.1.7 <a class="reference external" href="#proppoolpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code></a></p></li>
<li><p>8.1.8 <a class="reference external" href="#proppoolpooltimeout"><code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code></a></p></li>
<li><p>8.1.9 <a class="reference external" href="#proppoolqueuerequests"><code class="docutils literal notranslate"><span class="pre">queueRequests</span></code></a></p></li>
<li><p>8.1.10 <a class="reference external" href="#proppoolqueueTimeout"><code class="docutils literal notranslate"><span class="pre">queueTimeout</span></code></a></p></li>
<li><p>8.1.11 <a class="reference external" href="#proppoolstatus"><code class="docutils literal notranslate"><span class="pre">status</span></code></a></p></li>
<li><p>8.1.12 <a class="reference external" href="#proppoolstmtcachesize"><code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code></a></p></li>
</ul>
</li>
<li><p>8.2 <a class="reference external" href="#poolmethods">Pool Methods</a></p>
<ul>
<li><p>8.2.1 <a class="reference external" href="#poolclose"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></p></li>
<li><p>8.2.2 <a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a></p></li>
<li><p>8.2.3 <a class="reference external" href="#terminate"><code class="docutils literal notranslate"><span class="pre">terminate()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#resultsetclass">ResultSet Class</a></p>
<ul class="simple">
<li><p>9.1 <a class="reference external" href="#resultsetproperties">ResultSet Properties</a></p>
<ul>
<li><p>9.1.1 <a class="reference external" href="#rsmetadata"><code class="docutils literal notranslate"><span class="pre">metaData</span></code></a></p></li>
</ul>
</li>
<li><p>9.2 <a class="reference external" href="#resultsetmethods">ResultSet Methods</a></p>
<ul>
<li><p>9.2.1 <a class="reference external" href="#close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></p></li>
<li><p>9.2.2 <a class="reference external" href="#getrow"><code class="docutils literal notranslate"><span class="pre">getRow()</span></code></a></p></li>
<li><p>9.2.3 <a class="reference external" href="#getrows"><code class="docutils literal notranslate"><span class="pre">getRows()</span></code></a></p></li>
<li><p>9.2.4 <a class="reference external" href="#toquerystream"><code class="docutils literal notranslate"><span class="pre">toQueryStream()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#sodacollectionclass">SodaCollection Class</a></p>
<ul class="simple">
<li><p>10.1 <a class="reference external" href="#sodacollectionproperties">SodaCollection Properties</a></p>
<ul>
<li><p>10.1.1 <a class="reference external" href="#sodacollectionpropmetadata"><code class="docutils literal notranslate"><span class="pre">metaData</span></code></a></p></li>
<li><p>10.1.2 <a class="reference external" href="#sodacollectionpropname"><code class="docutils literal notranslate"><span class="pre">name</span></code></a></p></li>
</ul>
</li>
<li><p>10.2 <a class="reference external" href="#sodacollectionmethods">SodaCollection Methods</a></p>
<ul>
<li><p>10.2.1 <a class="reference external" href="#sodacollcreateindex"><code class="docutils literal notranslate"><span class="pre">createIndex()</span></code></a></p>
<ul>
<li><p>10.2.1.1 <a class="reference external" href="#sodacollcreateindexparams"><code class="docutils literal notranslate"><span class="pre">createIndex()</span></code>: Parameters</a></p>
<ul>
<li><p>10.2.1.1.1 <a class="reference external" href="#sodacollcreateindexspec"><code class="docutils literal notranslate"><span class="pre">indexSpec</span></code></a></p></li>
</ul>
</li>
<li><p>10.2.1.2 <a class="reference external" href="#sodacollcreateindexcb"><code class="docutils literal notranslate"><span class="pre">createIndex()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>10.2.2 <a class="reference external" href="#sodacolldrop"><code class="docutils literal notranslate"><span class="pre">drop()</span></code></a></p>
<ul>
<li><p>10.2.2.1 <a class="reference external" href="#sodacolldropcallback"><code class="docutils literal notranslate"><span class="pre">drop()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>10.2.3 <a class="reference external" href="#sodacolldropindex"><code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code></a></p>
<ul>
<li><p>10.2.3.1 <a class="reference external" href="#sodacolldropindexparams"><code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code>: Parameters</a></p>
<ul>
<li><p>10.2.3.1.1 <a class="reference external" href="#sodacolldropindexindexname"><code class="docutils literal notranslate"><span class="pre">indexName</span></code></a></p></li>
<li><p>10.2.3.1.2 <a class="reference external" href="#sodacolldropindexoptions"><code class="docutils literal notranslate"><span class="pre">options</span></code></a></p></li>
</ul>
</li>
<li><p>10.2.3.2 <a class="reference external" href="#sodacolldropindexcb"><code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>10.2.4 <a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">find()</span></code></a></p>
<ul>
<li><p>10.2.4.1 <a class="reference external" href="#sodaoperationclass">SodaOperation Class</a></p>
<ul>
<li><p>10.2.4.1.1 <a class="reference external" href="#sodaoperationclassnonterm">Non-terminal SodaOperation Methods</a></p>
<ul>
<li><p>10.2.4.1.1.1 <a class="reference external" href="#sodaoperationclassfilter"><code class="docutils literal notranslate"><span class="pre">filter()</span></code></a></p></li>
<li><p>10.2.4.1.1.2 <a class="reference external" href="#sodaoperationclasskey"><code class="docutils literal notranslate"><span class="pre">key()</span></code></a></p></li>
<li><p>10.2.4.1.1.3 <a class="reference external" href="#sodaoperationclasskeys"><code class="docutils literal notranslate"><span class="pre">keys()</span></code></a></p></li>
<li><p>10.2.4.1.1.4 <a class="reference external" href="#sodaoperationclasslimit"><code class="docutils literal notranslate"><span class="pre">limit()</span></code></a></p></li>
<li><p>10.2.4.1.1.5 <a class="reference external" href="#sodaoperationclassskip"><code class="docutils literal notranslate"><span class="pre">skip()</span></code></a></p></li>
<li><p>10.2.4.1.1.6 <a class="reference external" href="#sodaoperationclassversion"><code class="docutils literal notranslate"><span class="pre">version()</span></code></a></p></li>
</ul>
</li>
<li><p>10.2.4.1.2 <a class="reference external" href="#sodaoperationclassterm">Terminal SodaOperation Methods</a></p>
<ul>
<li><p>10.2.4.1.2.1 <a class="reference external" href="#sodaoperationclasscount"><code class="docutils literal notranslate"><span class="pre">count()</span></code></a></p></li>
<li><p>10.2.4.1.2.2 <a class="reference external" href="#sodaoperationclassgetcursor"><code class="docutils literal notranslate"><span class="pre">getCursor()</span></code></a></p></li>
<li><p>10.2.4.1.2.3 <a class="reference external" href="#sodaoperationclassgetdocuments"><code class="docutils literal notranslate"><span class="pre">getDocuments()</span></code></a></p></li>
<li><p>10.2.4.1.2.4 <a class="reference external" href="#sodaoperationclassgetone"><code class="docutils literal notranslate"><span class="pre">getOne()</span></code></a></p></li>
<li><p>10.2.4.1.2.5 <a class="reference external" href="#sodaoperationclassremove"><code class="docutils literal notranslate"><span class="pre">remove()</span></code></a></p></li>
<li><p>10.2.4.1.2.6 <a class="reference external" href="#sodaoperationclassreplaceone"><code class="docutils literal notranslate"><span class="pre">replaceOne()</span></code></a></p></li>
<li><p>10.2.4.1.2.7 <a class="reference external" href="#sodaoperationclassreplaceoneandget"><code class="docutils literal notranslate"><span class="pre">replaceOneAndGet()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>10.2.5 <a class="reference external" href="#sodacollgetdataguide"><code class="docutils literal notranslate"><span class="pre">getDataGuide()</span></code></a></p></li>
<li><p>10.2.6 <a class="reference external" href="#sodacollinsertmany"><code class="docutils literal notranslate"><span class="pre">insertMany()</span></code></a></p></li>
<li><p>10.2.7 <a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">insertManyAndGet()</span></code></a></p></li>
<li><p>10.2.8 <a class="reference external" href="#sodacollinsertone"><code class="docutils literal notranslate"><span class="pre">insertOne()</span></code></a></p>
<ul>
<li><p>10.2.8.1 <a class="reference external" href="#sodacollinsertoneparams"><code class="docutils literal notranslate"><span class="pre">insertOne()</span></code>: Parameters</a></p>
<ul>
<li><p>10.2.8.1.1 <a class="reference external" href="#sodacollinsertoneparamsdoc"><code class="docutils literal notranslate"><span class="pre">newDocumentContent</span></code></a>, <a class="reference external" href="#sodacollinsertoneparamsdoc"><code class="docutils literal notranslate"><span class="pre">newSodaDocument</span></code></a></p></li>
</ul>
</li>
<li><p>10.2.8.2 <a class="reference external" href="#sodacollinsertonecb"><code class="docutils literal notranslate"><span class="pre">insertOne()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>10.2.9 <a class="reference external" href="#sodacollinsertoneandget"><code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code></a></p>
<ul>
<li><p>10.2.9.1 <a class="reference external" href="#sodacollinsertoneandgetparams"><code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code>: Parameters</a></p>
<ul>
<li><p>10.2.9.1.1 <a class="reference external" href="#sodacollinsertoneandgetparamsdoc"><code class="docutils literal notranslate"><span class="pre">newDocumentContent</span></code></a>, <a class="reference external" href="#sodacollinsertoneandgetparamsdoc"><code class="docutils literal notranslate"><span class="pre">newSodaDocument</span></code></a></p></li>
</ul>
</li>
<li><p>10.2.9.2 <a class="reference external" href="#sodacollinsertoneandgetcb"><code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code>: Callback Function</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#sodadatabaseclass">SodaDatabase Class</a></p>
<ul class="simple">
<li><p>11.1 <a class="reference external" href="#sodadatabasemethods">SodaDatabase Methods</a></p>
<ul>
<li><p>11.1.1 <a class="reference external" href="#sodadbcreatecollection"><code class="docutils literal notranslate"><span class="pre">createCollection()</span></code></a></p>
<ul>
<li><p>11.1.1.1 <a class="reference external" href="#sodadbcreatecollectionname"><code class="docutils literal notranslate"><span class="pre">createCollection():</span> <span class="pre">collectionName</span></code></a></p></li>
<li><p>11.1.1.2 <a class="reference external" href="#sodadbcreatecollectionoptions"><code class="docutils literal notranslate"><span class="pre">createCollection():</span> <span class="pre">options</span></code></a></p>
<ul>
<li><p>11.1.1.2.1 <a class="reference external" href="#sodadbcreatecollectionoptsmetadata"><code class="docutils literal notranslate"><span class="pre">metaData</span></code></a></p></li>
<li><p>11.1.1.2.2 <a class="reference external" href="#sodadbcreatecollectionoptsmode"><code class="docutils literal notranslate"><span class="pre">mode</span></code></a></p></li>
</ul>
</li>
<li><p>11.1.1.3 <a class="reference external" href="#sodadbcreatecollectioncb"><code class="docutils literal notranslate"><span class="pre">createCollection()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>11.1.2 <a class="reference external" href="#sodadbcreatedocument"><code class="docutils literal notranslate"><span class="pre">createDocument()</span></code></a></p>
<ul>
<li><p>11.1.2.1 <a class="reference external" href="#sodadbcreatedocumentcontent"><code class="docutils literal notranslate"><span class="pre">createDocument():</span> <span class="pre">content</span></code></a></p></li>
<li><p>11.1.2.2 <a class="reference external" href="#sodadbcreatedocumentoptions"><code class="docutils literal notranslate"><span class="pre">createDocument():</span> <span class="pre">options</span></code></a></p>
<ul>
<li><p>11.1.2.2.1 <a class="reference external" href="#sodadbcreatedocumentoptskey"><code class="docutils literal notranslate"><span class="pre">key</span></code></a></p></li>
<li><p>11.1.2.2.2 <a class="reference external" href="#sodadbcreatedocumentoptsmediatype"><code class="docutils literal notranslate"><span class="pre">mediaType</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p>11.1.3 <a class="reference external" href="#sodadbgetcollectionnames"><code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code></a></p>
<ul>
<li><p>11.1.3.1 <a class="reference external" href="#sodadbgetcollectionnamesparams"><code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code>: Parameters</a></p>
<ul>
<li><p>11.1.3.1.1 <a class="reference external" href="#sodadbgetcollectionnamesoptions"><code class="docutils literal notranslate"><span class="pre">options</span></code></a></p></li>
</ul>
</li>
<li><p>11.1.3.2 <a class="reference external" href="#sodadbgetcollectionnamescb"><code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code>: Callback Function</a></p></li>
</ul>
</li>
<li><p>11.1.4 <a class="reference external" href="#sodadbopencollection"><code class="docutils literal notranslate"><span class="pre">openCollection()</span></code></a></p>
<ul>
<li><p>11.1.4.1 <a class="reference external" href="#sodadbopencollectionparams"><code class="docutils literal notranslate"><span class="pre">openCollection()</span></code>: Parameters</a></p>
<ul>
<li><p>11.1.4.1.1 <a class="reference external" href="#sodadbopencollectionname"><code class="docutils literal notranslate"><span class="pre">collectionName</span></code></a></p></li>
</ul>
</li>
<li><p>11.1.4.2 <a class="reference external" href="#sodadbopencollectioncb"><code class="docutils literal notranslate"><span class="pre">openCollection()</span></code>: Callback Function</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#sodadocumentclass">SodaDocument Class</a></p>
<ul class="simple">
<li><p>12.1 <a class="reference external" href="#sodadocumentproperties">SodaDocument Properties</a></p></li>
<li><p>12.2 <a class="reference external" href="#sodadocumentmethods">SodaDocument Methods</a></p>
<ul>
<li><p>12.2.1 <a class="reference external" href="#sodadocgetcontent"><code class="docutils literal notranslate"><span class="pre">getContent()</span></code></a></p></li>
<li><p>12.2.2 <a class="reference external" href="#sodadocgetcontentasbuffer"><code class="docutils literal notranslate"><span class="pre">getContentAsBuffer()</span></code></a></p></li>
<li><p>12.2.3 <a class="reference external" href="#sodadocgetcontentasstring"><code class="docutils literal notranslate"><span class="pre">getContentAsString()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#sodadocumentcursorclass">SodaDocumentCursor Class</a></p>
<ul class="simple">
<li><p>13.1 <a class="reference external" href="#sodadoccursormethods">SodaDocumentCursor Methods</a></p>
<ul>
<li><p>13.1.1 <a class="reference external" href="#sodadoccursorclose"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></p></li>
<li><p>13.1.2 <a class="reference external" href="#sodadoccursorgetnext"><code class="docutils literal notranslate"><span class="pre">getNext()</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#connectionhandling">Connection Handling</a></p>
<ul class="simple">
<li><p>14.1 <a class="reference external" href="#configureconnections">Configuring Connections and Node-oracledb</a></p>
<ul>
<li><p>14.1.1 <a class="reference external" href="#environmentvariables">Oracle Environment Variables</a></p></li>
<li><p>14.1.2 <a class="reference external" href="#tnsadmin">Optional Oracle Net Configuration</a></p></li>
<li><p>14.1.3 <a class="reference external" href="#oraaccess">Optional Oracle Client Configuration</a></p></li>
</ul>
</li>
<li><p>14.2 <a class="reference external" href="#connectionstrings">Connection Strings</a></p>
<ul>
<li><p>14.2.1 <a class="reference external" href="#easyconnect">Easy Connect Syntax for Connection Strings</a></p></li>
<li><p>14.2.2 <a class="reference external" href="#embedtns">Embedded Connect Descriptor Strings</a></p></li>
<li><p>14.2.3 <a class="reference external" href="#tnsnames">Net Service Names for Connection Strings</a></p></li>
<li><p>14.2.4 <a class="reference external" href="#notjdbc">JDBC and Oracle SQL Developer Connection Strings</a></p></li>
</ul>
</li>
<li><p>14.3 <a class="reference external" href="#numberofthreads">Connections and Number of Threads</a></p></li>
<li><p>14.4 <a class="reference external" href="#connpooling">Connection Pooling</a></p>
<ul>
<li><p>14.4.1 <a class="reference external" href="#conpoolsizing">Connection Pool Sizing</a></p></li>
<li><p>14.4.2 <a class="reference external" href="#conpooldraining">Connection Pool Closing and Draining</a></p></li>
<li><p>14.4.3 <a class="reference external" href="#connpoolcache">Connection Pool Cache</a></p></li>
<li><p>14.4.4 <a class="reference external" href="#connpoolqueue">Connection Pool Queue</a></p></li>
<li><p>14.4.5 <a class="reference external" href="#connpoolmonitor">Connection Pool Monitoring and Throughput</a></p></li>
<li><p>14.4.6 <a class="reference external" href="#connpoolpinging">Connection Pool Pinging</a></p></li>
<li><p>14.4.7 <a class="reference external" href="#connpooltagging">Connection Tagging and Session State</a></p>
<ul>
<li><p>14.4.7.1 <a class="reference external" href="#sessionfixupnode">Node.js Session Callback</a></p></li>
<li><p>14.4.7.2 <a class="reference external" href="#sessionfixuptagging">Connection Tagging</a></p></li>
<li><p>14.4.7.3 <a class="reference external" href="#sessiontaggingnode">Node.js Session Tagging Callback</a></p></li>
<li><p>14.4.7.4 <a class="reference external" href="#sessiontaggingplsql">PL/SQL Session Tagging Callback</a></p></li>
</ul>
</li>
<li><p>14.4.8 <a class="reference external" href="#connpoolproxy">Heterogeneous Connection Pools and Pool Proxy Authentication</a></p></li>
</ul>
</li>
<li><p>14.4 <a class="reference external" href="#extauth">External Authentication</a></p></li>
<li><p>14.5 <a class="reference external" href="#drcp">Database Resident Connection Pooling (DRCP)</a></p></li>
<li><p>14.6 <a class="reference external" href="#privconn">Privileged Connections</a></p></li>
<li><p>14.7 <a class="reference external" href="#securenetwork">Securely Encrypting Network Traffic to Oracle Database</a></p></li>
<li><p>14.8 <a class="reference external" href="#changingpassword">Changing Passwords and Connecting with an Expired Password</a></p></li>
<li><p>14.9 <a class="reference external" href="#connectionha">Connections and High Availability</a></p>
<ul>
<li><p>14.9.1 <a class="reference external" href="#connectionfan">Fast Application Notification (FAN)</a></p></li>
<li><p>14.9.2 <a class="reference external" href="#connectionrlb">Runtime Load Balancing (RLB)</a></p></li>
<li><p>14.9.3 <a class="reference external" href="#dbcalltimeouts">Database Call Timeouts</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#sqlexecution">SQL Execution</a></p>
<ul class="simple">
<li><p>15.1 <a class="reference external" href="#select">SELECT Statements</a></p>
<ul>
<li><p>15.1.1 <a class="reference external" href="#fetchingrows">Fetching Rows with Direct Fetches</a></p></li>
<li><p>15.1.2 <a class="reference external" href="#resultsethandling">Fetching Rows with Result Sets</a></p></li>
<li><p>15.1.3 <a class="reference external" href="#streamingresults">Query Streaming</a></p></li>
<li><p>15.1.4 <a class="reference external" href="#queryoutputformats">Query Output Formats</a></p></li>
<li><p>15.1.5 <a class="reference external" href="#querymeta">Query Column Metadata</a></p></li>
<li><p>15.1.6 <a class="reference external" href="#typemap">Query Result Type Mapping</a></p>
<ul>
<li><p>15.1.6.1 <a class="reference external" href="#stringhandling">Fetching CHAR, VARCHAR2, NCHAR and NVARCHAR</a></p></li>
<li><p>15.1.6.2 <a class="reference external" href="#numberhandling">Fetching Numbers</a></p></li>
<li><p>15.1.6.3 <a class="reference external" href="#datehandling">Fetching Dates and Timestamps</a></p></li>
<li><p>15.1.6.4 <a class="reference external" href="#fetchasstringhandling">Fetching Numbers and Dates as String</a></p></li>
<li><p>15.1.6.5 <a class="reference external" href="#fetchlob">Fetching BLOB and CLOB</a></p></li>
<li><p>15.1.6.6 <a class="reference external" href="#fetchlong">Fetching LONG and LONG RAW</a></p></li>
<li><p>15.1.6.7 <a class="reference external" href="#fetchrowid">Fetching ROWID and UROWID</a></p></li>
<li><p>15.1.6.8 <a class="reference external" href="#fetchxml">Fetching XMLType</a></p></li>
<li><p>15.1.6.9 <a class="reference external" href="#fetchraw">Fetching RAW</a></p></li>
<li><p>15.1.6.10 <a class="reference external" href="#fetchobjects">Fetching Oracle Database Objects and Collections</a></p></li>
</ul>
</li>
<li><p>15.1.7 <a class="reference external" href="#pagingdata">Limiting Rows and Creating Paged Datasets</a></p></li>
<li><p>15.1.8 <a class="reference external" href="#autoincrement">Auto-Increment Columns</a></p></li>
</ul>
</li>
<li><p>15.2 <a class="reference external" href="#cursors1000">Cursor Management</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#plsqlexecution">PL/SQL Execution</a></p>
<ul class="simple">
<li><p>16.1 <a class="reference external" href="#plsqlproc">PL/SQL Stored Procedures</a></p></li>
<li><p>16.2 <a class="reference external" href="#plsqlfunc">PL/SQL Stored Functions</a></p></li>
<li><p>16.3 <a class="reference external" href="#plsqlanon">Anonymous PL/SQL blocks</a></p></li>
<li><p>16.4 <a class="reference external" href="#dbmsoutput">Using DBMS_OUTPUT</a></p></li>
<li><p>16.5 <a class="reference external" href="#ebr">Edition-Based Redefinition</a></p></li>
<li><p>16.6 <a class="reference external" href="#implicitresults">Implicit Results</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#lobhandling">Working with CLOB and BLOB Data</a></p>
<ul class="simple">
<li><p>17.1 <a class="reference external" href="#basiclobinsert">Simple Insertion of LOBs</a></p></li>
<li><p>17.2 <a class="reference external" href="#queryinglobs">Simple LOB Queries and PL/SQL OUT Binds</a></p></li>
<li><p>17.3 <a class="reference external" href="#streamsandlobs">Streaming Lobs</a></p></li>
<li><p>17.4 <a class="reference external" href="#lobinsertdiscussion">Using RETURNING INTO to Insert into LOBs</a></p></li>
<li><p>17.5 <a class="reference external" href="#loboutstream">Getting LOBs as Streams from Oracle Database</a></p></li>
<li><p>17.6 <a class="reference external" href="#templobdiscussion">Using <code class="docutils literal notranslate"><span class="pre">createLob()</span></code> for PL/SQL IN Binds</a></p></li>
<li><p>17.7 <a class="reference external" href="#closinglobs">Closing Lobs</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#jsondatatype">Oracle Database 12c JSON Data type</a></p></li>
<li><p><a class="reference external" href="#xmltype">Working with XMLType</a></p></li>
<li><p><a class="reference external" href="#bind">Bind Parameters for Prepared Statements</a></p>
<ul class="simple">
<li><p>20.1 <a class="reference external" href="#inbind">IN Bind Parameters</a></p></li>
<li><p>20.2 <a class="reference external" href="#outbind">OUT and IN OUT Bind Parameters</a></p></li>
<li><p>20.3 <a class="reference external" href="#dmlreturn">DML RETURNING Bind Parameters</a></p></li>
<li><p>20.4 <a class="reference external" href="#refcursors">REF CURSOR Bind Parameters</a></p></li>
<li><p>20.5 <a class="reference external" href="#lobbinds">LOB Bind Parameters</a></p></li>
<li><p>20.6 <a class="reference external" href="#sqlwherein">Binding Multiple Values to a SQL <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">IN</span></code> Clause</a></p></li>
<li><p>20.7 <a class="reference external" href="#sqlbindtablename">Binding Column and Table Names in Queries</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#objects">Oracle Database Objects and Collections</a></p>
<ul class="simple">
<li><p>21.1 <a class="reference external" href="#objectinsert">Inserting Objects</a></p></li>
<li><p>21.2 <a class="reference external" href="#objectfetch">Fetching Objects</a></p></li>
<li><p>21.3 <a class="reference external" href="#plsqlcollections">PL/SQL Collection Types</a></p>
<ul>
<li><p>21.3.1 <a class="reference external" href="#plsqlindexbybinds">PL/SQL Collection Associative Arrays (Index-by)</a></p></li>
<li><p>21.3.2 <a class="reference external" href="#plsqlvarray">PL/SQL Collection VARRAY Types</a></p></li>
<li><p>21.3.3 <a class="reference external" href="#plsqlnestedtables">PL/SQL Collection Nested Tables</a></p></li>
</ul>
</li>
<li><p>21.4 <a class="reference external" href="#plsqlrecords">PL/SQL RECORD Types</a></p></li>
<li><p>21.5 <a class="reference external" href="#objexecmany">Inserting or Passing Multiple Objects of the Same Type</a></p></li>
<li><p>21.6 <a class="reference external" href="#objectlimitations">Oracle Database Object Type Limitations</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#batchexecution">Batch Statement Execution and Bulk Loading</a></p></li>
<li><p><a class="reference external" href="#transactionmgt">Transaction Management</a></p></li>
<li><p><a class="reference external" href="#stmtcache">Statement Caching</a></p></li>
<li><p><a class="reference external" href="#cqn">Continuous Query Notification (CQN)</a></p></li>
<li><p><a class="reference external" href="#aq">Oracle Advanced Queuing (AQ)</a></p>
<ul class="simple">
<li><p>26.1 <a class="reference external" href="#aqrawexample">Sending Simple AQ Messages</a></p></li>
<li><p>26.2 <a class="reference external" href="#aqobjexample">Sending Oracle Database Object AQ Messages</a></p></li>
<li><p>26.3 <a class="reference external" href="#aqoptions">Changing AQ options</a></p></li>
<li><p>26.4 <a class="reference external" href="#aqmultiplemessages">Enqueuing and Dequeuing Multiple Messages</a></p></li>
<li><p>26.5 <a class="reference external" href="#aqnotifications">Advanced Queuing Notifications</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#nls">Globalization and National Language Support (NLS)</a></p></li>
<li><p><a class="reference external" href="#endtoend">End-to-end Tracing, Mid-tier Authentication, and Auditing</a></p></li>
<li><p><a class="reference external" href="#sodaoverview">Simple Oracle Document Access (SODA)</a></p>
<ul class="simple">
<li><p>29.1 <a class="reference external" href="#sodarequirements">Node-oracledb SODA Requirements</a></p></li>
<li><p>29.2 <a class="reference external" href="#creatingsodacollections">Creating SODA Collections</a></p></li>
<li><p>29.3 <a class="reference external" href="#accessingsodadocuments">Creating and Accessing SODA documents</a></p></li>
<li><p>29.4 <a class="reference external" href="#sodaqbesearches">SODA Query-by-Example Searches for JSON Documents</a></p></li>
<li><p>29.5 <a class="reference external" href="#sodatextsearches">SODA Text Searches</a></p></li>
<li><p>29.6 <a class="reference external" href="#sodaclientkeys">SODA Client-Assigned Keys and Collection Metadata</a></p></li>
<li><p>29.7 <a class="reference external" href="#sodajsondataguide">JSON Data Guides in SODA</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#roundtrips">Database Round-trips</a></p></li>
<li><p><a class="reference external" href="#tracingsql">Tracing SQL and PL/SQL Statements</a></p></li>
<li><p><a class="reference external" href="#programstyles">Node.js Programming Styles and node-oracledb</a></p>
<ul class="simple">
<li><p>32.1 <a class="reference external" href="#callbackoverview">Callbacks and node-oracledb</a></p></li>
<li><p>32.2 <a class="reference external" href="#promiseoverview">Promises and node-oracledb</a></p>
<ul>
<li><p>32.2.1 <a class="reference external" href="#custompromises">Custom Promise Libraries</a></p></li>
</ul>
</li>
<li><p>32.3 <a class="reference external" href="#asyncawaitoverview">Async/Await and node-oracledb</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#migrate">Migrating from Previous node-oracledb Releases</a></p>
<ul class="simple">
<li><p>33.1 <a class="reference external" href="#migratev1v2">Migrating from node-oracledb 1.13 to node-oracledb 2.0</a></p></li>
<li><p>33.2 <a class="reference external" href="#migratev20v21">Migrating from node-oracledb 2.0 to node-oracledb 2.1</a></p></li>
<li><p>33.3 <a class="reference external" href="#migratev23v30">Migrating from node-oracledb 2.3 to node-oracledb 3.0</a></p></li>
<li><p>33.4 <a class="reference external" href="#migratev30v31">Migrating from node-oracledb 3.0 to node-oracledb 3.1</a></p></li>
<li><p>33.5 <a class="reference external" href="#migratev31v40">Migrating from node-oracledb 3.1 to node-oracledb 4.0</a></p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="a-name-apimanual-a-node-oracledb-api-manual">
<h2><a name="apimanual"></a> NODE-ORACLEDB API MANUAL<a class="headerlink" href="#a-name-apimanual-a-node-oracledb-api-manual" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="a-name-intro-a-1-introduction">
<h2><a name="intro"></a> 1. Introduction<a class="headerlink" href="#a-name-intro-a-1-introduction" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.npmjs.com/package/oracledb"><em>node-oracledb</em></a> add-on for Node.js powers high performance Oracle Database applications.</p>
<p>This document shows how to use node-oracledb version 4.  The API
reference is in the first sections of this document and the <a class="reference external" href="#usermanual">user
manual</a> in subsequent sections.  Documentation about
node-oracledb version 1 is <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/node-oracledb-v1/doc/api">here</a>.  Documentation about
node-oracledb version 2 is <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/v2.3.0/doc/api">here</a>.  Documentation about
node-oracledb version 3 is <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/v3.1.2/doc/api">here</a>.</p>
<p>The node-oracledb API is a generic Oracle Database access layer.
Almost all the functionality described here is common across all
current Oracle Databases.  However the documentation may describe some
database features that are in specific Oracle Database versions,
editions, or require additional database options or packs.</p>
<div class="section" id="a-name-getstarted-a-1-1-getting-started-with-node-oracledb">
<h3><a name="getstarted"></a> 1.1 Getting Started with Node-oracledb<a class="headerlink" href="#a-name-getstarted-a-1-1-getting-started-with-node-oracledb" title="Permalink to this headline">¶</a></h3>
<p>Install Node.js from <a class="reference external" href="https://nodejs.org/en/download/">nodejs.org</a>.</p>
<p>Install node-oracledb using the <a class="reference external" href="https://oracle.github.io/node-oracledb/INSTALL.html#quickstart">Quick Start Node-oracledb
Installation</a> steps.</p>
<p>Download node-oracledb <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples">examples</a> or create a script like the one
below.  As well as <a class="reference external" href="#asyncawaitoverview">Async/Await</a> functions,
node-oracledb can also use <a class="reference external" href="#callbackoverview">Callbacks</a>, and
<a class="reference external" href="#promiseoverview">Promises</a>.</p>
<p>Scripts to create Oracle’s sample schemas can be found at
<a class="reference external" href="https://github.com/oracle/db-sample-schemas">github.com/oracle/db-sample-schemas</a>.</p>
<p>Locate your Oracle Database <a class="reference external" href="https://www.youtube.com/watch?v=WDJacg0NuLo">user name and password</a>, and the database
<a class="reference external" href="#connectionstrings">connection string</a>.  The connection string is
commonly of the format <code class="docutils literal notranslate"><span class="pre">hostname/servicename</span></code>, using the host name
where the database is running and the Oracle Database service name of
the database instance.</p>
<p>Substitute your user name, password and connection string in the code.
For downloaded examples, put these in <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/dbconfig.js"><code class="docutils literal notranslate"><span class="pre">dbconfig.js</span></code></a>.</p>
<p>Run the script, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">node</span> <span class="n">myscript</span><span class="o">.</span><span class="n">js</span>
</pre></div>
</div>
<div class="section" id="a-name-examplequery-a-1-1-1-example-a-sql-select-statement-in-node-js">
<h4><a name="examplequery"></a> 1.1.1 Example: A SQL SELECT statement in Node.js<a class="headerlink" href="#a-name-examplequery-a-1-1-1-example-a-sql-select-statement-in-node-js" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// myscript.js</span>
<span class="c1">// This example uses Node 8&#39;s async/await syntax.</span>

<span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="nx">oracledb</span><span class="p">.</span><span class="nx">outFormat</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">OUT_FORMAT_OBJECT</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// set mypw to the hr schema password</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">let</span> <span class="nx">connection</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>  <span class="p">{</span>
      <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
      <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
      <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
    <span class="p">});</span>

    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
      <span class="sb">`SELECT manager_id, department_id, department_name</span>
<span class="sb">       FROM departments</span>
<span class="sb">       WHERE manager_id = :id`</span><span class="p">,</span>
      <span class="p">[</span><span class="mi">103</span><span class="p">],</span>  <span class="c1">// bind value for :id</span>
    <span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">();</span>
</pre></div>
</div>
<p>With Oracle’s sample HR schema, the output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">{</span> <span class="n">MANAGER_ID</span><span class="p">:</span> <span class="mi">103</span><span class="p">,</span> <span class="n">DEPARTMENT_ID</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="n">DEPARTMENT_NAME</span><span class="p">:</span> <span class="s1">&#39;IT&#39;</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-examplesodaawait-a-1-1-2-example-simple-oracle-document-access-soda-in-node-js">
<h4><a name="examplesodaawait"></a> 1.1.2 Example: Simple Oracle Document Access (SODA) in Node.js<a class="headerlink" href="#a-name-examplesodaawait-a-1-1-2-example-simple-oracle-document-access-soda-in-node-js" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="#sodaoverview">node-oracledb’s SODA API</a> can be used with Oracle Database 18
and above, when node-oracledb uses Oracle Client 18.5 or Oracle Client 19.3, or
later.  Users who have been granted the SODA_APP role.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// mysoda.js</span>
<span class="c1">// This example uses Node 8&#39;s async/await syntax.</span>

<span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// set mypw to the hr schema password</span>

<span class="nx">oracledb</span><span class="p">.</span><span class="nx">autoCommit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">let</span> <span class="nx">connection</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>  <span class="p">{</span>
      <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
      <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
      <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span>
    <span class="p">});</span>

    <span class="c1">// Create a new (or open an existing) document collection</span>
    <span class="kr">const</span> <span class="nx">soda</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getSodaDatabase</span><span class="p">();</span>
    <span class="kr">const</span> <span class="nx">collectionName</span> <span class="o">=</span> <span class="s1">&#39;nodb_soda_collection&#39;</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">myCollection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">soda</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">);</span>

    <span class="c1">// Insert a new document</span>
    <span class="kr">const</span> <span class="nx">myContent</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Sally&quot;</span><span class="p">,</span> <span class="nx">address</span><span class="o">:</span> <span class="p">{</span><span class="nx">city</span><span class="o">:</span> <span class="s2">&quot;Melbourne&quot;</span><span class="p">}</span> <span class="p">};</span>
    <span class="nx">await</span> <span class="nx">myCollection</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span><span class="nx">myContent</span><span class="p">);</span>

    <span class="c1">// Print names of people living in Melbourne</span>
    <span class="kr">const</span> <span class="nx">filterSpec</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;address.city&quot;</span><span class="o">:</span> <span class="s2">&quot;Melbourne&quot;</span> <span class="p">};</span>
    <span class="kr">const</span> <span class="nx">myDocuments</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">myCollection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nx">filterSpec</span><span class="p">).</span><span class="nx">getDocuments</span><span class="p">();</span>
    <span class="nx">myDocuments</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">getContent</span><span class="p">();</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; lives in Melbourne.&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error in processing:\n&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error in closing connection:\n&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-errorobj-a-2-errors">
<h2><a name="errorobj"></a> 2. Errors<a class="headerlink" href="#a-name-errorobj-a-2-errors" title="Permalink to this headline">¶</a></h2>
<p>The last parameter of each method is a callback, unless
<a class="reference external" href="#promiseoverview">Promises</a> or <a class="reference external" href="#asyncawaitoverview">Async/Await</a> are
being used.  The first parameter of the callback is an <em>Error</em> object
that contains error information if the call fails.  If the call
succeeds, then the object is null.</p>
<p>When using Promises or Async/Await, the <code class="docutils literal notranslate"><span class="pre">catch()</span></code> error object will
contain error information when a failure occurs.</p>
<p>If an invalid value is set for a property, then an error occurs.  The
same is true for invalid operations on read-only or write-only
properties.  If an unrecognized property name is used, it will be
ignored.</p>
<div class="section" id="a-name-properror-a-2-1-error-properties">
<h3><a name="properror"></a> 2.1 Error Properties<a class="headerlink" href="#a-name-properror-a-2-1-error-properties" title="Permalink to this headline">¶</a></h3>
<p>The <em>Error</em> object contains <code class="docutils literal notranslate"><span class="pre">errorNum</span></code>, <code class="docutils literal notranslate"><span class="pre">message</span></code> and <code class="docutils literal notranslate"><span class="pre">offset</span></code> properties.</p>
<div class="section" id="a-name-properrerrornum-a-2-1-1-errornum">
<h4><a name="properrerrornum"></a> 2.1.1 <code class="docutils literal notranslate"><span class="pre">errorNum</span></code><a class="headerlink" href="#a-name-properrerrornum-a-2-1-1-errornum" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">errorNum</span>
</pre></div>
</div>
<p>The Oracle error number.  This value is undefined for non-Oracle
errors and for messages prefixed with NJS or DPI.</p>
</div>
<div class="section" id="a-name-properrmessage-a-2-1-2-message">
<h4><a name="properrmessage"></a> 2.1.2 <code class="docutils literal notranslate"><span class="pre">message</span></code><a class="headerlink" href="#a-name-properrmessage-a-2-1-2-message" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">message</span>
</pre></div>
</div>
<p>The text of the error message.</p>
<p>The error may be a standard Oracle message with a prefix like ORA or
PLS.  Alternatively it may be a node-oracledb specific error prefixed with
NJS or DPI.</p>
<p>A single line error message may look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ORA</span><span class="o">-</span><span class="mi">01017</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">username</span><span class="o">/</span><span class="n">password</span><span class="p">;</span> <span class="n">logon</span> <span class="n">denied</span>
</pre></div>
</div>
<p>A multi-line error message may look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ORA</span><span class="o">-</span><span class="mi">06550</span><span class="p">:</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span> <span class="mi">7</span><span class="p">:</span>
<span class="n">PLS</span><span class="o">-</span><span class="mi">00201</span><span class="p">:</span> <span class="n">identifier</span> <span class="s1">&#39;TESTPRC&#39;</span> <span class="n">must</span> <span class="n">be</span> <span class="n">declared</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">06550</span><span class="p">:</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span> <span class="mi">7</span><span class="p">:</span>
<span class="n">PL</span><span class="o">/</span><span class="n">SQL</span><span class="p">:</span> <span class="n">Statement</span> <span class="n">ignored</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-properroffset-a-2-1-3-offset">
<h4><a name="properroffset"></a> 2.1.3 <code class="docutils literal notranslate"><span class="pre">offset</span></code><a class="headerlink" href="#a-name-properroffset-a-2-1-3-offset" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">offset</span>
</pre></div>
</div>
<p>Generally <code class="docutils literal notranslate"><span class="pre">offset</span></code> is the character offset into the SQL text that
resulted in the Oracle error.  The value may be <code class="docutils literal notranslate"><span class="pre">0</span></code> in non-SQL
contexts.  This value is undefined for non-Oracle errors and for
messages prefixed with NJS or DPI.</p>
<p>When <a class="reference external" href="#executemanyoptbatcherrors"><code class="docutils literal notranslate"><span class="pre">batchErrors</span></code></a> mode in
<a class="reference external" href="#executemany"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a> returns an array of Error objects in
the callback result parameter, each <code class="docutils literal notranslate"><span class="pre">offset</span></code> property is a 0-based
index corresponding to the <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> <a class="reference external" href="#executemanybinds">binds
parameter</a> array, indicating which record could not
be processed. See <a class="reference external" href="#handlingbatcherrors">Handling Data Errors</a>.</p>
</div>
</div>
</div>
<div class="section" id="a-name-oracledbclass-a-3-oracledb-class">
<h2><a name="oracledbclass"></a> 3. Oracledb Class<a class="headerlink" href="#a-name-oracledbclass-a-3-oracledb-class" title="Permalink to this headline">¶</a></h2>
<p>The <em>Oracledb</em> object is the factory class for <em>Pool</em> and <em>Connection</em> objects.</p>
<p>The <em>Oracledb</em> object is instantiated by loading node-oracledb:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;oracledb&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Internally, the add-on creates the <em>Oracledb</em> object as a singleton.
Reloading it in the same Node.js process creates a new pointer to the
same object.</p>
<div class="section" id="a-name-oracledbconstants-a-3-1-oracledb-constants">
<h3><a name="oracledbconstants"></a> 3.1 Oracledb Constants<a class="headerlink" href="#a-name-oracledbconstants-a-3-1-oracledb-constants" title="Permalink to this headline">¶</a></h3>
<p>These constants are defined in the <code class="docutils literal notranslate"><span class="pre">oracledb</span></code> module.  Usage is
described later in this document.</p>
<p>The numeric values for the constants are shown to aid debugging.  They
may change in future, so use the constant names in applications.</p>
<div class="section" id="a-name-oracledbconstantsoutformat-a-3-1-1-query-outformat-constants">
<h4><a name="oracledbconstantsoutformat"></a> 3.1.1 Query <code class="docutils literal notranslate"><span class="pre">outFormat</span></code> Constants<a class="headerlink" href="#a-name-oracledbconstantsoutformat-a-3-1-1-query-outformat-constants" title="Permalink to this headline">¶</a></h4>
<p>Constants for the query result <a class="reference external" href="#propdboutformat">outFormat</a> option:</p>
<p>Constant Name                        | Value |Description
————————————-|——-|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_ARRAY</span></code>          | 4001  | Fetch each row as array of column values
<code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_OBJECT</span></code>         | 4002  | Fetch each row as an object</p>
<p>The <code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_ARRAY</span></code> and <code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_OBJECT</span></code>
constants were introduced in node-oracledb 4.0.  The previous
constants <code class="docutils literal notranslate"><span class="pre">oracledb.ARRAY</span></code> and <code class="docutils literal notranslate"><span class="pre">oracledb.OBJECT</span></code> are deprecated but
still usable.</p>
</div>
<div class="section" id="a-name-oracledbconstantsnodbtype-a-3-1-2-node-oracledb-type-constants">
<h4><a name="oracledbconstantsnodbtype"></a> 3.1.2 Node-oracledb Type Constants<a class="headerlink" href="#a-name-oracledbconstantsnodbtype-a-3-1-2-node-oracledb-type-constants" title="Permalink to this headline">¶</a></h4>
<p>Constants for <code class="docutils literal notranslate"><span class="pre">execute()</span></code> <a class="reference external" href="#executebindParams">bind parameter</a> <code class="docutils literal notranslate"><span class="pre">type</span></code> property,
for the <a class="reference external" href="#connectioncreatelob"><code class="docutils literal notranslate"><span class="pre">createLob()</span></code></a> <code class="docutils literal notranslate"><span class="pre">type</span></code> parameter,
for the <a class="reference external" href="#proplobtype">Lob</a> <code class="docutils literal notranslate"><span class="pre">type</span></code> property,
for <a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a>,
for <a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a>
and <a class="reference external" href="#propexecfetchinfo"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a>, and
for <a class="reference external" href="#propdbextendedmetadata">extended metadata</a>.</p>
<p>Not all constants can be used in all places.</p>
<p>Constant Name                        | Value |Description
————————————-|——-|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code>                      | 2019  | Bind a BLOB to a Node.js Stream or create a temporary BLOB, or for fetchAsBuffer and fetchInfo
<code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>                    | 2006  | Bind a RAW, LONG RAW or BLOB to a Node.js Buffer
<code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code>                      | 2017  | Bind a CLOB to a Node.js Stream, create a temporary CLOB, or for fetchAsString and fetchInfo
<code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code>                    | 2021  | Bind a REF CURSOR to a node-oracledb ResultSet class
<code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code>                      | 2014  | Bind as JavaScript date type.  Can also be used for fetchAsString and fetchInfo
<code class="docutils literal notranslate"><span class="pre">oracledb.DEFAULT</span></code>                   |    0  | Used with fetchInfo to reset the fetch type to the database type
<code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code>                    | 2010  | Bind as JavaScript number type.  Can also be used for fetchAsString and fetchInfo
<code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>                    | 2001  | Bind as JavaScript String type.  Can be used for most database types.</p>
<p>Note the values for these constants changed in node-oracledb 4.0.</p>
</div>
<div class="section" id="a-name-oracledbconstantsdbtype-a-3-1-3-oracle-database-type-constants">
<h4><a name="oracledbconstantsdbtype"></a> 3.1.3 Oracle Database Type Constants<a class="headerlink" href="#a-name-oracledbconstantsdbtype-a-3-1-3-oracle-database-type-constants" title="Permalink to this headline">¶</a></h4>
<p>These values indicate the Oracle Database type shown in <a class="reference external" href="#propdbextendedmetadata">extended
metadata</a> for queries and REF CURSORS, and
also shown for <a class="reference external" href="#dbobjectclass">DbObject</a> types.</p>
<p>Constant Name                        | Value |Description
————————————-|——-|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_BFILE</span></code>             | 2020  | BFILE
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_BINARY_DOUBLE</span></code>     | 2008  | BINARY_DOUBLE
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_BINARY_FLOAT</span></code>      | 2007  | BINARY_FLOAT
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_BINARY_INTEGER</span></code>    | 2009  | BINARY_INTEGER, PLS_INTEGER, SMALLINT, etc.
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_BLOB</span></code>              | 2019  | BLOB
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_BOOLEAN</span></code>           | 2022  | PL/SQL BOOLEAN
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_CHAR</span></code>              | 2003  | CHAR
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_CLOB</span></code>              | 2017  | CLOB
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_CURSOR</span></code>            | 2021  | Nested Cursors, SYS_REFCURSOR
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_DATE</span></code>              | 2011  | DATE
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_INTERVAL_DS</span></code>       | 2015  | Interval Day to Second
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_INTERVAL_YM</span></code>       | 2016  | Interval Year to Month
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_LONG</span></code>              | 2024  | LONG
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_LONG_RAW</span></code>          | 2025  | LONG RAW
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_NCHAR</span></code>             | 2004  | NCHAR
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_NCLOB</span></code>             | 2018  | NCLOB
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_NUMBER</span></code>            | 2010  | NUMBER or FLOAT
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_NVARCHAR</span></code>          | 2002  | NVARCHAR
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_OBJECT</span></code>            | 2023  | OBJECT
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_RAW</span></code>               | 2006  | RAW
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_ROWID</span></code>             | 2005  | ROWID
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_TIMESTAMP</span></code>         | 2012  | TIMESTAMP
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_TIMESTAMP_LTZ</span></code>     | 2014  | TIMESTAMP WITH LOCAL TIME ZONE
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_TIMESTAMP_TZ</span></code>      | 2013  | TIMESTAMP WITH TIME ZONE
<code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_VARCHAR</span></code>           | 2001  | VARCHAR2</p>
<p>Note the values for constants changed in node-oracledb 4.0.</p>
</div>
<div class="section" id="a-name-oracledbconstantsbinddir-a-3-1-4-execute-bind-direction-constants">
<h4><a name="oracledbconstantsbinddir"></a> 3.1.4 Execute Bind Direction Constants<a class="headerlink" href="#a-name-oracledbconstantsbinddir-a-3-1-4-execute-bind-direction-constants" title="Permalink to this headline">¶</a></h4>
<p>Constants for the <code class="docutils literal notranslate"><span class="pre">dir</span></code> property of <code class="docutils literal notranslate"><span class="pre">execute()</span></code>
<a class="reference external" href="#executebindParams">bindParams</a>, <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> and
<code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> <a class="reference external" href="#executemanyoptbinddefs"><code class="docutils literal notranslate"><span class="pre">bindDefs</span></code></a>.</p>
<p>These specify whether data values bound to SQL or PL/SQL bind
parameters are passed into, or out from, the database:</p>
<p>Constant Name                        | Value |Description
————————————-|——-|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.BIND_IN</span></code>                   |  3001 | Direction for IN binds
<code class="docutils literal notranslate"><span class="pre">oracledb.BIND_INOUT</span></code>                |  3002 | Direction for IN OUT binds
<code class="docutils literal notranslate"><span class="pre">oracledb.BIND_OUT</span></code>                  |  3003 | Direction for OUT binds</p>
</div>
<div class="section" id="a-name-oracledbconstantsprivilege-a-3-1-5-privileged-connection-constants">
<h4><a name="oracledbconstantsprivilege"></a> 3.1.5 Privileged Connection Constants<a class="headerlink" href="#a-name-oracledbconstantsprivilege-a-3-1-5-privileged-connection-constants" title="Permalink to this headline">¶</a></h4>
<p>Constants for <a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a>
<a class="reference external" href="#getconnectiondbattrsprivilege"><code class="docutils literal notranslate"><span class="pre">privilege</span></code></a> properties.</p>
<p>These specify what privilege should
be used by the connection that is being established.</p>
<p>Constant Name                        | Value |Description
————————————-|———|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.SYSASM</span></code>                    |   32768 | SYSASM privileges
<code class="docutils literal notranslate"><span class="pre">oracledb.SYSBACKUP</span></code>                 |  131072 | SYSBACKUP privileges
<code class="docutils literal notranslate"><span class="pre">oracledb.SYSDBA</span></code>                    |       2 | SYSDBA privileges
<code class="docutils literal notranslate"><span class="pre">oracledb.SYSDG</span></code>                     |  262144 | SYSDG privileges
<code class="docutils literal notranslate"><span class="pre">oracledb.SYSKM</span></code>                     |  524288 | SYSKM privileges
<code class="docutils literal notranslate"><span class="pre">oracledb.SYSOPER</span></code>                   |       4 | SYSOPER privileges
<code class="docutils literal notranslate"><span class="pre">oracledb.SYSRAC</span></code>                    | 1048576 | SYSRAC privileges</p>
</div>
<div class="section" id="a-name-oracledbconstantsstmttype-a-3-1-6-sql-statement-type-constants">
<h4><a name="oracledbconstantsstmttype"></a> 3.1.6 SQL Statement Type Constants<a class="headerlink" href="#a-name-oracledbconstantsstmttype-a-3-1-6-sql-statement-type-constants" title="Permalink to this headline">¶</a></h4>
<p>Constants for <a class="reference external" href="#getstmtinfo"><code class="docutils literal notranslate"><span class="pre">connection.getStatementInfo()</span></code></a>
properties.</p>
<p>Constant Name                        | Value |Description
————————————-|——-|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_ALTER</span></code>           |     7 | ALTER
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_BEGIN</span></code>           |     8 | BEGIN
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_CALL</span></code>            |    10 | CALL
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_COMMIT</span></code>          |    21 | COMMIT
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_CREATE</span></code>          |     5 | CREATE
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_DECLARE</span></code>         |     9 | DECLARE
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_DELETE</span></code>          |     3 | DELETE
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_DROP</span></code>            |     6 | DROP
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_EXPLAIN_PLAN</span></code>    |    15 | EXPLAIN PLAN
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_INSERT</span></code>          |     4 | INSERT
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_MERGE</span></code>           |    16 | MERGE
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_ROLLBACK</span></code>        |    17 | ROLLBACK
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_SELECT</span></code>          |     1 | SELECT
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_UNKNOWN</span></code>         |     0 | Unknown statement type
<code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_UPDATE</span></code>          |     2 | UPDATE</p>
</div>
<div class="section" id="a-name-oracledbconstantssubscription-a-3-1-7-subscription-constants">
<h4><a name="oracledbconstantssubscription"></a> 3.1.7 Subscription Constants<a class="headerlink" href="#a-name-oracledbconstantssubscription-a-3-1-7-subscription-constants" title="Permalink to this headline">¶</a></h4>
<p>Constants for the Continuous Query Notification <a class="reference external" href="#consubscribeoptcallback"><code class="docutils literal notranslate"><span class="pre">message.type</span></code></a>.</p>
<p>Constant Name                               | Value |Description
——————————————–|——-|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_AQ</span></code>             | 100   | Advanced Queuing notifications are being used
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_DEREG</span></code>          | 5     | A subscription has been closed or the timeout value has been reached
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_OBJ_CHANGE</span></code>     | 6     | Object-level notifications are being used (Database Change Notification)
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_QUERY_CHANGE</span></code>   | 7     | Query-level notifications are being used (Continuous Query Notification)
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_SHUTDOWN</span></code>       | 2     | The database is being shut down
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_SHUTDOWN_ANY</span></code>   | 3     | An instance of Oracle Real Application Clusters (RAC) is being shut down
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_STARTUP</span></code>        | 1     | The database is being started up</p>
<p>Constant for the Continuous Query Notification <a class="reference external" href="#consubscribeoptgroupingclass"><code class="docutils literal notranslate"><span class="pre">groupingClass</span></code></a>.</p>
<p>Constant Name                           | Value |Description
—————————————-|——-|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_GROUPING_CLASS_TIME</span></code>   | 1     | Group notifications by time into a single notification</p>
<p>Constants for the Continuous Query Notification <a class="reference external" href="#consubscribeoptgroupingtype"><code class="docutils literal notranslate"><span class="pre">groupingType</span></code></a>.</p>
<p>Constant Name                           | Value |Description
—————————————-|——-|———————————————–
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_GROUPING_TYPE_LAST</span></code>    | 2     | The last notification in the group is sent
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_GROUPING_TYPE_SUMMARY</span></code> | 1     | A summary of the grouped notifications is sent</p>
<p>Constants for the Continuous Query Notification <a class="reference external" href="#consubscribeoptqos"><code class="docutils literal notranslate"><span class="pre">qos</span></code></a> Quality of Service.</p>
<p>Constant Name                      | Value |Description
———————————–|——-|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_BEST_EFFORT</span></code>  | 16    | When best effort filtering for query result set changes is acceptable. False positive notifications may be received. This behavior may be suitable for caching applications.
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_DEREG_NFY</span></code>    |  2    | The subscription will be automatically unregistered as soon as the first notification is received.
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_QUERY</span></code>        |  8    | Continuous Query Notification will be used instead of Database Change Notification.  This means that notifications are only sent if the result set of the registered query changes. By default no false positive notifications are generated. Use <code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_BEST_EFFORT</span></code> if this is not needed.
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_RELIABLE</span></code>     |  1    | Notifications are not lost in the event of database failure.
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_ROWIDS</span></code>       |  4    | Notifications include the ROWIDs of the rows that were affected</p>
<p>Constants for the Continuous Query Notification <a class="reference external" href="#consubscribeoptnamespace"><code class="docutils literal notranslate"><span class="pre">namespace</span></code></a>.</p>
<p>Constant Name                        | Value |Description
————————————-|——-|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_NAMESPACE_AQ</span></code>       | 1     | For Advanced Queuing notifications.
<code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_NAMESPACE_DBCHANGE</span></code> | 2     | For Continuous Query Notifications.</p>
</div>
<div class="section" id="a-name-oracledbconstantsaq-a-3-1-8-advanced-queuing-constants">
<h4><a name="oracledbconstantsaq"></a> 3.1.8 Advanced Queuing Constants<a class="headerlink" href="#a-name-oracledbconstantsaq-a-3-1-8-advanced-queuing-constants" title="Permalink to this headline">¶</a></h4>
<p>Refer to <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADQUE">Advanced Queuing documentation</a> for more details about attributes.</p>
<p>Constants for <a class="reference external" href="#aqdeqoptionsclass">AqDeqOptions Class</a> <code class="docutils literal notranslate"><span class="pre">mode</span></code>.</p>
<p>Constant Name                                           | Value      | Description
——————————————————–|————|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_MODE_BROWSE</span></code>                           | 1          | Read a message without acquiring a lock.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_MODE_LOCKED</span></code>                           | 2          | Read and obtain write lock on message.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_MODE_REMOVE</span></code>                           | 3          | Read the message and delete it.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_MODE_REMOVE_NO_DATA</span></code>                   | 4          | Delete message without returning payload.</p>
<p>Constants for <a class="reference external" href="#aqdeqoptionsclass">AqDeqOptions Class</a> <code class="docutils literal notranslate"><span class="pre">navigation</span></code>.</p>
<p>Constant Name                                           | Value      | Description
——————————————————–|————|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_NAV_FIRST_MSG</span></code>                         | 1          | Get the message at the head of queue.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_NAV_NEXT_TRANSACTION</span></code>                  | 2          | Get first message of next transaction group.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_NAV_NEXT_MSG</span></code>                          | 3          | Get the next message in the queue.</p>
<p>Constants for <a class="reference external" href="#aqdeqoptionsclass">AqDeqOptions Class</a> <code class="docutils literal notranslate"><span class="pre">wait</span></code>.</p>
<p>Constant Name                                           | Value      | Description
——————————————————–|————|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_NO_WAIT</span></code>                               | 0          | Do not wait if no message is available.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_WAIT_FOREVER</span></code>                          | 4294967295 | Wait forever if no message is available.</p>
<p>Constants for <a class="reference external" href="#aqenqoptionsclass">AqEnqOptions Class</a> <code class="docutils literal notranslate"><span class="pre">deliveryMode</span></code>.</p>
<p>Constant Name                                           | Value      | Description
——————————————————–|————|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_DELIV_MODE_PERSISTENT</span></code>                 | 1          | Messages are persistent.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_DELIV_MODE_BUFFERED</span></code>                   | 2          | Messages are buffered.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_DELIV_MODE_PERSISTENT_OR_BUFFERED</span></code>     | 3          | Messages are either persistent or buffered.</p>
<p>Constants for <a class="reference external" href="#aqmessageclass">AqMessage Class</a> <code class="docutils literal notranslate"><span class="pre">state</span></code>.</p>
<p>Constant Name                                           | Value      | Description
——————————————————–|————|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_STATE_READY</span></code>                           | 0          | Consumers can dequeue messages that are in the READY state.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_STATE_WAITING</span></code>                         | 1          | Message is hidden for a given retry delay interval.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_STATE_PROCESSED</span></code>                       | 2          | All intended consumers have successfully dequeued the message.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_STATE_EXPIRED</span></code>                         | 3          | One or more consumers did not dequeue the message before the expiration time.</p>
<p>Constants for <a class="reference external" href="#aqenqoptionsclass">AqEnqOptions Class</a> and <a class="reference external" href="#aqdeqoptionsclass">AqDeqOptions
Class</a> <code class="docutils literal notranslate"><span class="pre">visibility</span></code>.</p>
<p>Constant Name                                           | Value      | Description
——————————————————–|————|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_VISIBILITY_IMMEDIATE</span></code>                      | 1          | The message is not part of the current transaction. It constitutes a transaction on its own.
<code class="docutils literal notranslate"><span class="pre">oracledb.AQ_VISIBILITY_ON_COMMIT</span></code>                      | 2          | The message is part of the current transaction.</p>
</div>
<div class="section" id="a-name-oracledbconstantscqn-a-3-1-9-continuous-query-notification-constants">
<h4><a name="oracledbconstantscqn"></a> 3.1.9 Continuous Query Notification Constants<a class="headerlink" href="#a-name-oracledbconstantscqn-a-3-1-9-continuous-query-notification-constants" title="Permalink to this headline">¶</a></h4>
<p>Constants for the Continuous Query Notification
<code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code> option <a class="reference external" href="#consubscribeoptoperations"><code class="docutils literal notranslate"><span class="pre">operations</span></code></a>, and for the
notification message <a class="reference external" href="#consubscribeoptcallback"><code class="docutils literal notranslate"><span class="pre">operation</span></code></a> properties.</p>
<p>Constant Name                   | Value |Description
——————————–|——-|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_ALL_OPS</span></code>   |  0    | Default.  Used to request notification of all operations.
<code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_ALL_ROWS</span></code>  |  1    | Indicates that row information is not available. This occurs if the <code class="docutils literal notranslate"><span class="pre">qos</span></code> quality of service flags do not specify the desire for ROWIDs, or if grouping has taken place and summary notifications are being sent.
<code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_ALTER</span></code>     | 16    | Set if the table was altered in the notifying transaction
<code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_DELETE</span></code>    |  8    | Set if the notifying transaction included deletes on the table
<code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_DROP</span></code>      | 32    | Set if the table was dropped in the notifying transaction
<code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_INSERT</span></code>    |  2    | Set if the notifying transaction included inserts on the table
<code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_UPDATE</span></code>    |  4    | Set if the notifying transaction included updates on the table</p>
</div>
<div class="section" id="a-name-oracledbconstantspool-a-3-1-10-pool-status-constants">
<h4><a name="oracledbconstantspool"></a> 3.1.10 Pool Status Constants<a class="headerlink" href="#a-name-oracledbconstantspool-a-3-1-10-pool-status-constants" title="Permalink to this headline">¶</a></h4>
<p>Constants for the connection <a class="reference external" href="#proppoolstatus"><code class="docutils literal notranslate"><span class="pre">pool.status</span></code></a> readonly attribute.</p>
<p>Constant Name                   | Value |Description
——————————–|——-|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.POOL_STATUS_CLOSED</span></code>   | 6002  | The connection pool has been closed.
<code class="docutils literal notranslate"><span class="pre">oracledb.POOL_STATUS_DRAINING</span></code> | 6001  | The connection pool is being drained of in-use connections and will be force closed soon.
<code class="docutils literal notranslate"><span class="pre">oracledb.POOL_STATUS_OPEN</span></code>     | 6000  | The connection pool is open.</p>
</div>
<div class="section" id="a-name-oracledbconstantssoda-a-3-1-11-simple-oracle-document-access-soda-constants">
<h4><a name="oracledbconstantssoda"></a> 3.1.11 Simple Oracle Document Access (SODA) Constants<a class="headerlink" href="#a-name-oracledbconstantssoda-a-3-1-11-simple-oracle-document-access-soda-constants" title="Permalink to this headline">¶</a></h4>
<p>Constant Name                   | Value |Description
——————————–|——-|—————————————————
<code class="docutils literal notranslate"><span class="pre">oracledb.SODA_COLL_MAP_MODE</span></code>   | 5001  | Indicate <a class="reference external" href="#sodadbcreatecollection"><code class="docutils literal notranslate"><span class="pre">sodaDatabase.createCollection()</span></code></a> should use an externally created table to store the collection</p>
</div>
</div>
<div class="section" id="a-name-oracledbproperties-a-3-2-oracledb-properties">
<h3><a name="oracledbproperties"></a> 3.2 Oracledb Properties<a class="headerlink" href="#a-name-oracledbproperties-a-3-2-oracledb-properties" title="Permalink to this headline">¶</a></h3>
<p>The properties of the <em>Oracledb</em> object are used for setting up
configuration parameters for deployment.</p>
<p>If required, these properties can be overridden for the <em>Pool</em> or
<em>Connection</em> objects.</p>
<p>These properties may be read or modified. If a property is modified,
only subsequent invocations of the <code class="docutils literal notranslate"><span class="pre">createPool()</span></code> or <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>
methods will be affected. Objects that exist before a property is
modified are not altered.</p>
<p>Invalid values, or combinations of values, for pool configuration
properties can result in the error <em>ORA-24413: Invalid number of
sessions specified</em>.</p>
<p>Each of the configuration properties is described below.</p>
<div class="section" id="a-name-propdbisautocommit-a-3-2-1-oracledb-autocommit">
<h4><a name="propdbisautocommit"></a> 3.2.1 <code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code><a class="headerlink" href="#a-name-propdbisautocommit-a-3-2-1-oracledb-autocommit" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">autoCommit</span>
</pre></div>
</div>
<p>If this property is <em>true</em>, then the transaction in the current
connection is automatically committed at the end of statement
execution.</p>
<p>The default value is <em>false</em>.</p>
<p>This property may be overridden in an <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> call.</p>
<p>Note prior to node-oracledb 0.5 this property was called
<code class="docutils literal notranslate"><span class="pre">isAutoCommit</span></code>.</p>
<div class="section" id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">autoCommit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbconclass-a-3-2-2-oracledb-connectionclass">
<h4><a name="propdbconclass"></a> 3.2.2 <code class="docutils literal notranslate"><span class="pre">oracledb.connectionClass</span></code><a class="headerlink" href="#a-name-propdbconclass-a-3-2-2-oracledb-connectionclass" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">connectionClass</span>
</pre></div>
</div>
<p>The user-chosen Connection class value defines a logical name for connections.
Most single purpose applications should set <code class="docutils literal notranslate"><span class="pre">connectionClass</span></code> when
using a connection pool or DRCP.</p>
<p>When a pooled session has a connection class, Oracle ensures that the
session is not shared outside of that connection class.</p>
<p>The connection class value is similarly used by
<a class="reference external" href="#drcp">Database Resident Connection Pooling (DRCP)</a> to allow or
disallow sharing of sessions.</p>
<p>For example, where two different kinds of users share one pool, you
might set <code class="docutils literal notranslate"><span class="pre">connectionClass</span></code> to ‘HRPOOL’ for connections that access a
Human Resources system, and it might be set to ‘OEPOOL’ for users of an
Order Entry system.  Users will only be given sessions of the
appropriate class, allowing maximal reuse of resources in each case,
and preventing any session information leaking between the two systems.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">connectionClass</span></code> is set for a non-pooled connection, the driver
name is not recorded in <code class="docutils literal notranslate"><span class="pre">V$</span></code> views.
See
<a class="reference external" href="#endtoend">End-to-end Tracing, Mid-tier Authentication, and Auditing</a>.</p>
<div class="section" id="id2">
<h5>Example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">connectionClass</span> <span class="o">=</span> <span class="s1">&#39;HRPOOL&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbedition-a-3-2-3-oracledb-edition">
<h4><a name="propdbedition"></a> 3.2.3 <code class="docutils literal notranslate"><span class="pre">oracledb.edition</span></code><a class="headerlink" href="#a-name-propdbedition-a-3-2-3-oracledb-edition" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">edition</span>
</pre></div>
</div>
<p>Sets the name used for Edition-Based Redefinition by connections.</p>
<p>See <a class="reference external" href="#ebr">Edition-Based Redefinition</a> for more information.</p>
<p>This property was added in node-oracledb 2.2.</p>
<div class="section" id="id3">
<h5>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">edition</span> <span class="o">=</span> <span class="s1">&#39;ed_2&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbevents-a-3-2-4-oracledb-events">
<h4><a name="propdbevents"></a> 3.2.4 <code class="docutils literal notranslate"><span class="pre">oracledb.events</span></code><a class="headerlink" href="#a-name-propdbevents-a-3-2-4-oracledb-events" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">events</span>
</pre></div>
</div>
<p>Determines whether Oracle Client events mode should be enabled.</p>
<p>The default value for <code class="docutils literal notranslate"><span class="pre">events</span></code> is <em>true</em>.</p>
<p>This property can be overridden in the
<a class="reference external" href="#createpoolpoolattrsevents"><code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code></a> call and when
getting a standalone connection from
<a class="reference external" href="#getconnectiondbattrsevents"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a>.</p>
<p>Events mode is required for <a class="reference external" href="#consubscribe">Continuous Query
Notification</a>, <a class="reference external" href="#connectionfan">Fast Application Notification
(FAN)</a> and <a class="reference external" href="#connectionrlb">Runtime Load Balancing
(RLB)</a>.</p>
<p>This property was added in node-oracledb 2.2.  Up until node-oracledb
4.0 the default value for <code class="docutils literal notranslate"><span class="pre">events</span></code> was <em>false</em>.</p>
<div class="section" id="id4">
<h5>Example<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbextendedmetadata-a-3-2-5-oracledb-extendedmetadata">
<h4><a name="propdbextendedmetadata"></a> 3.2.5 <code class="docutils literal notranslate"><span class="pre">oracledb.extendedMetaData</span></code><a class="headerlink" href="#a-name-propdbextendedmetadata-a-3-2-5-oracledb-extendedmetadata" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">extendedMetaData</span>
</pre></div>
</div>
<p>Determines whether additional metadata is available for queries and
for REF CURSORs returned from PL/SQL blocks.</p>
<p>The default value for <code class="docutils literal notranslate"><span class="pre">extendedMetaData</span></code> is <em>false</em>. With this value,
the <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">result.metaData</span></code></a>
<a class="reference external" href="#rsmetadata"><code class="docutils literal notranslate"><span class="pre">result.resultSet.metaData</span></code></a> objects only include column
names.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">extendedMetaData</span></code> is <em>true</em> then <code class="docutils literal notranslate"><span class="pre">metaData</span></code> will contain
additional attributes.  These are listed in
<a class="reference external" href="#execmetadata">Result Object Properties</a>.</p>
<p>This property may be overridden in an <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> call.</p>
<p>This property was added in node-oracledb 1.10.</p>
</div>
<div class="section" id="a-name-propdbisexternalauth-a-3-2-6-oracledb-externalauth">
<h4><a name="propdbisexternalauth"></a> 3.2.6 <code class="docutils literal notranslate"><span class="pre">oracledb.externalAuth</span></code><a class="headerlink" href="#a-name-propdbisexternalauth-a-3-2-6-oracledb-externalauth" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">externalAuth</span>
</pre></div>
</div>
<p>If this property is <em>true</em> then connections are established using
external authentication.  See <a class="reference external" href="#extauth">External Authentication</a> for
more information.</p>
<p>The default value is <em>false</em>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> properties should not be set when
<code class="docutils literal notranslate"><span class="pre">externalAuth</span></code> is <em>true</em>.</p>
<p>This property can be overridden in the
<a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code></a> call and when getting a
standalone connection from
<a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a>.</p>
<p>Note prior to node-oracledb 0.5 this property was called
<code class="docutils literal notranslate"><span class="pre">isExternalAuth</span></code>.</p>
<div class="section" id="id5">
<h5>Example<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">externalAuth</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbfetcharraysize-a-3-2-7-oracledb-fetcharraysize">
<h4><a name="propdbfetcharraysize"></a> 3.2.7 <code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code><a class="headerlink" href="#a-name-propdbfetcharraysize-a-3-2-7-oracledb-fetcharraysize" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">fetchArraySize</span>
</pre></div>
</div>
<p>This property sets the size of an internal buffer used for fetching
query rows from Oracle Database.  Changing it may affect query
performance but does not affect how many rows are returned to the
application.</p>
<p>The default value is 100.</p>
<p>The property is used during the default <a class="reference external" href="#fetchingrows">direct
fetches</a>, during ResultSet <a class="reference external" href="#getrow"><code class="docutils literal notranslate"><span class="pre">getRow()</span></code></a> calls,
and for <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a>.  It is not used for
<a class="reference external" href="#getrows"><code class="docutils literal notranslate"><span class="pre">getRows()</span></code></a>.</p>
<p>Increasing this value reduces the number of <a class="reference external" href="#roundtrips">round-trips</a>
to the database but increases memory usage for each data fetch.  For
queries that return a large number of rows, higher values of
<code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code> may give better performance.  For queries that only
return a few rows, reduce the value of <code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code> to minimize
the amount of memory management during data fetches.  JavaScript
memory fragmentation may occur in some cases, see <a class="reference external" href="#fetchingrows">Fetching Rows with
Direct Fetches</a>.</p>
<p>For direct fetches (those using <code class="docutils literal notranslate"><span class="pre">execute()</span></code> option <a class="reference external" href="#propexecresultset"><code class="docutils literal notranslate"><span class="pre">resultSet:</span> <span class="pre">false</span></code></a>), the internal buffer size will be based
on the lesser of <a class="reference external" href="#propdbmaxrows"><code class="docutils literal notranslate"><span class="pre">maxRows</span></code></a> and <code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code>.</p>
<p>The property was introduced in node-oracledb version 2.0.  It replaces
<a class="reference external" href="#propdbprefetchrows"><code class="docutils literal notranslate"><span class="pre">prefetchRows</span></code></a>.</p>
<div class="section" id="id6">
<h5>Example<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">fetchArraySize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbfetchasbuffer-a-3-2-8-oracledb-fetchasbuffer">
<h4><a name="propdbfetchasbuffer"></a> 3.2.8 <code class="docutils literal notranslate"><span class="pre">oracledb.fetchAsBuffer</span></code><a class="headerlink" href="#a-name-propdbfetchasbuffer-a-3-2-8-oracledb-fetchasbuffer" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span> <span class="n">fetchAsBuffer</span>
</pre></div>
</div>
<p>An array of node-oracledb types.  Currently the only valid type
is <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code></a>.  When a BLOB column is
queried with <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a>
or <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a>, the column data is returned as a
Buffer instead of the default representation.</p>
<p>By default in node-oracledb, all columns are returned as native types
or as <a class="reference external" href="#lobclass">Lob</a> instances, in the case of CLOB and BLOB types.</p>
<p>Individual query columns in <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a>
or <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> calls can override the
<code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code> global setting by
using <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a>.</p>
<p>This property was added in node-oracledb 1.13.</p>
<div class="section" id="id7">
<h5>Example<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">fetchAsBuffer</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BLOB</span> <span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbfetchasstring-a-3-2-9-oracledb-fetchasstring">
<h4><a name="propdbfetchasstring"></a> 3.2.9 <code class="docutils literal notranslate"><span class="pre">oracledb.fetchAsString</span></code><a class="headerlink" href="#a-name-propdbfetchasstring-a-3-2-9-oracledb-fetchasstring" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span> <span class="n">fetchAsString</span>
</pre></div>
</div>
<p>An array of node-oracledb types.  The valid types are
<a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code></a>,
<a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code></a>,
<a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code></a>,
and <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code></a>.  When any column having one
of the specified types is queried with <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a>
or <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a>, the column data is returned as a
string instead of the default representation.</p>
<p>By default in node-oracledb, all columns are returned as native types
or as <a class="reference external" href="#lobclass">Lob</a> instances, in the case of CLOB and BLOB types.</p>
<p>This property helps avoid situations where using JavaScript types can
lead to numeric precision loss, or where date conversion is unwanted.
See <a class="reference external" href="#typemap">Query Result Type Mapping</a> for more discussion.</p>
<p>For raw data returned as a string, Oracle returns the data as a hex-encoded
string.  For dates and numbers returned as a string, the maximum length of a
string created by this mapping is 200 bytes.  Strings created for CLOB columns
will generally be limited by Node.js and V8 memory restrictions.</p>
<p>Individual query columns in <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a>
or <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> calls can override the
<code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code> global setting by
using <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a>.</p>
<p>For non-CLOB types, the conversion to string is handled by Oracle
client libraries and is often referred to as <em>defining</em> the fetch
type.</p>
<div class="section" id="id8">
<h5>Example<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">fetchAsString</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">DATE</span><span class="p">,</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdblobprefetchsize-a-3-2-10-oracledb-lobprefetchsize">
<h4><a name="propdblobprefetchsize"></a> 3.2.10 <code class="docutils literal notranslate"><span class="pre">oracledb.lobPrefetchSize</span></code><a class="headerlink" href="#a-name-propdblobprefetchsize-a-3-2-10-oracledb-lobprefetchsize" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">lobPrefetchSize</span>
</pre></div>
</div>
<p>This attribute is temporarily disabled.  Setting it has no effect.</p>
<p>Node-oracledb internally uses Oracle <em>LOB Locators</em> to manipulate long
object (LOB) data.  LOB Prefetching allows LOB data to be returned
early to node-oracledb when these locators are first returned.  This
is similar to the way <a class="reference external" href="#rowprefetching">row prefetching</a> allows for
efficient use of resources and <a class="reference external" href="#roundtrips">round-trips</a> between
node-oracledb and the database.</p>
<p>Prefetching of LOBs is mostly useful for small LOBs.</p>
<p>The default size is 16384.</p>
<div class="section" id="id9">
<h5>Example<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">lobPrefetchSize</span> <span class="o">=</span> <span class="mi">16384</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbmaxrows-a-3-2-11-oracledb-maxrows">
<h4><a name="propdbmaxrows"></a> 3.2.11 <code class="docutils literal notranslate"><span class="pre">oracledb.maxRows</span></code><a class="headerlink" href="#a-name-propdbmaxrows-a-3-2-11-oracledb-maxrows" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">maxRows</span>
</pre></div>
</div>
<p>The maximum number of rows that are fetched by a query with
<a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code></a> when <em>not</em> using a
<a class="reference external" href="#resultsetclass">ResultSet</a>.  Rows beyond this limit are not fetched
from the database.  A value of 0 means there is no limit.</p>
<p>The default value is 0, meaning unlimited.</p>
<p>This property may be overridden in an <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a>
call.</p>
<p>To improve database efficiency, SQL queries should use a row limiting
clause like <a class="reference external" href="#pagingdata"><code class="docutils literal notranslate"><span class="pre">OFFSET</span></code> / <code class="docutils literal notranslate"><span class="pre">FETCH</span></code></a> or equivalent. The <code class="docutils literal notranslate"><span class="pre">maxRows</span></code>
property can be used to stop badly coded queries from returning
unexpectedly large numbers of rows.</p>
<p>When the number of query rows is relatively big, or can not be
predicted, it is recommended to use a <a class="reference external" href="#resultsetclass">ResultSet</a> or
<a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a>.  This allows applications to process
rows in smaller chunks or individually, preventing the Node.js memory
limit being exceeded or query results being unexpectedly truncated by
a <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> limit.</p>
<p>In version 1, the default value was 100.</p>
<div class="section" id="id10">
<h5>Example<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">maxRows</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdboracleclientversion-a-3-2-12-oracledb-oracleclientversion">
<h4><a name="propdboracleclientversion"></a> 3.2.12 <code class="docutils literal notranslate"><span class="pre">oracledb.oracleClientVersion</span></code><a class="headerlink" href="#a-name-propdboracleclientversion-a-3-2-12-oracledb-oracleclientversion" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">oracleClientVersion</span>
</pre></div>
</div>
<p>This readonly property gives a numeric representation of the Oracle client library version which is useful in comparisons.
For version <em>a.b.c.d.e</em>, this property gives the number: <code class="docutils literal notranslate"><span class="pre">(100000000</span> <span class="pre">*</span> <span class="pre">a)</span> <span class="pre">+</span> <span class="pre">(1000000</span> <span class="pre">*</span> <span class="pre">b)</span> <span class="pre">+</span> <span class="pre">(10000</span> <span class="pre">*</span> <span class="pre">c)</span> <span class="pre">+</span> <span class="pre">(100</span> <span class="pre">*</span> <span class="pre">d)</span> <span class="pre">+</span> <span class="pre">e</span></code></p>
<p>This property was added in node-oracledb 1.3.</p>
<p>From node-oracledb 3.1.0, using <code class="docutils literal notranslate"><span class="pre">oracledb.oracleClientVersion</span></code> will
throw a <em>DPI-1047</em> error if node-oracledb cannot load Oracle Client
libraries.  Previous versions threw this error from
<code class="docutils literal notranslate"><span class="pre">require('oracledb')</span></code>.</p>
<div class="section" id="id11">
<h5>Example<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Oracle client library version number is &quot;</span> <span class="o">+</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">oracleClientVersion</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdboracleclientversionstring-a-3-2-13-oracledb-oracleclientversionstring">
<h4><a name="propdboracleclientversionstring"></a> 3.2.13 <code class="docutils literal notranslate"><span class="pre">oracledb.oracleClientVersionString</span></code><a class="headerlink" href="#a-name-propdboracleclientversionstring-a-3-2-13-oracledb-oracleclientversionstring" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">oracleClientVersionString</span>
</pre></div>
</div>
<p>This readonly property gives a string representation of the Oracle client library version which is useful for display.</p>
<p>This property was added in node-oracledb 2.2.</p>
<p>From node-oracledb 3.1.0, using <code class="docutils literal notranslate"><span class="pre">oracledb.oracleClientVersionString</span></code>
will throw a <em>DPI-1047</em> error if node-oracledb cannot load Oracle
Client libraries.  Previous versions threw this error from
<code class="docutils literal notranslate"><span class="pre">require('oracledb')</span></code>.</p>
<div class="section" id="id12">
<h5>Example<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Oracle client library version is &quot;</span> <span class="o">+</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">oracleClientVersionString</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdboutformat-a-3-2-14-oracledb-outformat">
<h4><a name="propdboutformat"></a> 3.2.14 <code class="docutils literal notranslate"><span class="pre">oracledb.outFormat</span></code><a class="headerlink" href="#a-name-propdboutformat-a-3-2-14-oracledb-outformat" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">outFormat</span>
</pre></div>
</div>
<p>The format of query rows fetched when
using <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code></a>
or <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">connection.queryStream()</span></code></a>.  It affects
both <a class="reference external" href="#propexecresultset">ResultSet</a> and non-ResultSet queries.  It
can be used for top level queries and REF CURSOR output.</p>
<p>This can be either of the <a class="reference external" href="#oracledbconstantsoutformat">Oracledb constants</a>
<code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_ARRAY</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_OBJECT</span></code>.  The default value
is <code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_ARRAY</span></code> which is more efficient.  The older, equivalent
constants <code class="docutils literal notranslate"><span class="pre">oracledb.ARRAY</span></code> and <code class="docutils literal notranslate"><span class="pre">oracledb.OBJECT</span></code> are deprecated.</p>
<p>If specified as <code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_ARRAY</span></code>, each row is fetched as an array of
column values.</p>
<p>If specified as <code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_OBJECT</span></code>, each row is fetched as a
JavaScript object.  The object has a property for each column name, with the
property value set to the respective column value.  The property name follows
Oracle’s standard name-casing rules.  It will commonly be uppercase, since most
applications create tables using unquoted, case-insensitive names.</p>
<p>This property may be overridden in
an <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a>
or <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> call.</p>
<p>See <a class="reference external" href="#queryoutputformats">Query Output Formats</a> for more information.</p>
<div class="section" id="id13">
<h5>Example<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">outFormat</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">OUT_FORMAT_ARRAY</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbpoolincrement-a-3-2-15-oracledb-poolincrement">
<h4><a name="propdbpoolincrement"></a> 3.2.15 <code class="docutils literal notranslate"><span class="pre">oracledb.poolIncrement</span></code><a class="headerlink" href="#a-name-propdbpoolincrement-a-3-2-15-oracledb-poolincrement" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolIncrement</span>
</pre></div>
</div>
<p>The number of connections that are opened whenever a connection
request exceeds the number of currently open connections.</p>
<p>The default value is 1.</p>
<p>This property may be overridden when <a class="reference external" href="#createpool">creating a connection pool</a>.</p>
<div class="section" id="id14">
<h5>Example<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">poolIncrement</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbpoolmax-a-3-2-16-oracledb-poolmax">
<h4><a name="propdbpoolmax"></a> 3.2.16 <code class="docutils literal notranslate"><span class="pre">oracledb.poolMax</span></code><a class="headerlink" href="#a-name-propdbpoolmax-a-3-2-16-oracledb-poolmax" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolMax</span>
</pre></div>
</div>
<p>The maximum number of connections to which a connection pool can grow.</p>
<p>The default value is 4.</p>
<p>This property may be overridden when <a class="reference external" href="#createpool">creating a connection pool</a>.</p>
<p>Importantly, if you increase <code class="docutils literal notranslate"><span class="pre">poolMax</span></code> you should also increase the
number of threads available to node-oracledb.  See <a class="reference external" href="#numberofthreads">Connections and
Number of Threads</a>.</p>
<p>See <a class="reference external" href="#connpooling">Connection Pooling</a> for other pool sizing guidelines.</p>
<div class="section" id="id15">
<h5>Example<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">poolMax</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbpoolmin-a-3-2-17-oracledb-poolmin">
<h4><a name="propdbpoolmin"></a> 3.2.17 <code class="docutils literal notranslate"><span class="pre">oracledb.poolMin</span></code><a class="headerlink" href="#a-name-propdbpoolmin-a-3-2-17-oracledb-poolmin" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolMin</span>
</pre></div>
</div>
<p>The minimum number of connections a connection pool maintains, even
when there is no activity to the target database.</p>
<p>The default value is 0.</p>
<p>This property may be overridden when <a class="reference external" href="#createpool">creating a connection pool</a>.</p>
<p>For pools created with <a class="reference external" href="#extauth">External Authentication</a> or with
<a class="reference external" href="#createpoolpoolattrshomogeneous"><code class="docutils literal notranslate"><span class="pre">homogeneous</span></code></a> set to <em>false</em>, the
number of connections initially created is zero even if a larger value
is specified for <code class="docutils literal notranslate"><span class="pre">poolMin</span></code>.  The pool increment is always 1,
regardless of the value of
<a class="reference external" href="#createpoolpoolattrspoolincrement"><code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code></a>.  Once the number
of open connections exceeds <code class="docutils literal notranslate"><span class="pre">poolMin</span></code> and connections are idle for
more than the <a class="reference external" href="#propdbpooltimeout"><code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code></a> seconds, then the
number of open connections does not fall below <code class="docutils literal notranslate"><span class="pre">poolMin</span></code>.</p>
<div class="section" id="id16">
<h5>Example<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">poolMin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbpoolpinginterval-a-3-2-18-oracledb-poolpinginterval">
<h4><a name="propdbpoolpinginterval"></a> 3.2.18 <code class="docutils literal notranslate"><span class="pre">oracledb.poolPingInterval</span></code><a class="headerlink" href="#a-name-propdbpoolpinginterval-a-3-2-18-oracledb-poolpinginterval" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolPingInterval</span>
</pre></div>
</div>
<p>When a pool <a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a> is called and the
connection has been idle in the pool for at least <code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code>
seconds, node-oracledb internally “pings” the database to check the
connection is alive.  After a ping, an unusable connection is
destroyed and a usable one is returned by <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>.
Connection pinging improves the chance a pooled connection is valid
when it is first used because identified unusable connections will not
be returned to the application.</p>
<p>The default <code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code> value is 60 seconds.  Possible values
are:</p>
<p><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code> Value     | Behavior of a Pool <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> Call
———-|——————————————
<code class="docutils literal notranslate"><span class="pre">n</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">0</span></code> | Never checks for connection aliveness
<code class="docutils literal notranslate"><span class="pre">n</span></code> = <code class="docutils literal notranslate"><span class="pre">0</span></code> | Always checks for connection aliveness. This value is not recommended for most applications because of the overhead in performing each ping
<code class="docutils literal notranslate"><span class="pre">n</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">0</span></code> | Checks aliveness if the connection has been idle in the pool (not “checked out” to the application by <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>) for at least <code class="docutils literal notranslate"><span class="pre">n</span></code> seconds</p>
<p>This property may be overridden when <a class="reference external" href="#createpool">creating a connection pool</a>.</p>
<p>See <a class="reference external" href="#connpoolpinging">Connection Pool Pinging</a> for more discussion.</p>
<p>This property was added in node-oracledb 1.12.  It was disabled when
using Oracle Client 12.2 (and later) until node-oracledb 3.0.</p>
<div class="section" id="id17">
<h5>Example<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">poolPingInterval</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>     <span class="c1">// seconds</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbpooltimeout-a-3-2-19-oracledb-pooltimeout">
<h4><a name="propdbpooltimeout"></a> 3.2.19 <code class="docutils literal notranslate"><span class="pre">oracledb.poolTimeout</span></code><a class="headerlink" href="#a-name-propdbpooltimeout-a-3-2-19-oracledb-pooltimeout" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolTimeout</span>
</pre></div>
</div>
<p>The number of seconds after which idle connections (unused in the
pool) are terminated.  Idle connections are terminated only when the
pool is accessed.  If the <code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code> is set to 0, then idle
connections are never terminated.</p>
<p>The default value is 60.</p>
<p>This property may be overridden when <a class="reference external" href="#createpool">creating a connection pool</a>.</p>
<div class="section" id="id18">
<h5>Example<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">poolTimeout</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbprefetchrows-a-3-2-20-oracledb-prefetchrows">
<h4><a name="propdbprefetchrows"></a> 3.2.20 <code class="docutils literal notranslate"><span class="pre">oracledb.prefetchRows</span></code><a class="headerlink" href="#a-name-propdbprefetchrows-a-3-2-20-oracledb-prefetchrows" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">prefetchRows</span>
</pre></div>
</div>
<p>This attribute is no longer used in node-oracledb version 2 and has no
effect on applications.  Use
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code></a> instead.</p>
<div class="section" id="id19">
<h5>Example<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">prefetchRows</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbpromise-a-3-2-21-oracledb-promise">
<h4><a name="propdbpromise"></a> 3.2.21 <code class="docutils literal notranslate"><span class="pre">oracledb.Promise</span></code><a class="headerlink" href="#a-name-propdbpromise-a-3-2-21-oracledb-promise" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Promise</span> <span class="n">Promise</span>
</pre></div>
</div>
<p>Node-oracledb supports Promises on all methods.  The standard Promise
library is used.</p>
<p>See <a class="reference external" href="#promiseoverview">Promises and node-oracledb</a> for a discussion of
using Promises.</p>
<p>This property can be set to override or disable the Promise
implementation.</p>
<div class="section" id="id20">
<h5>Example<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">mylib</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;myfavpromiseimplementation&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nb">Promise</span> <span class="o">=</span> <span class="nx">mylib</span><span class="p">;</span>
</pre></div>
</div>
<p>Promises can be completely disabled by setting</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nb">Promise</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbqueuerequests-a-3-2-22-oracledb-queuerequests">
<h4><a name="propdbqueuerequests"></a> 3.2.22 <code class="docutils literal notranslate"><span class="pre">oracledb.queueRequests</span></code><a class="headerlink" href="#a-name-propdbqueuerequests-a-3-2-22-oracledb-queuerequests" title="Permalink to this headline">¶</a></h4>
<p>This property was removed in node-oracledb 3.0.  Queuing is now always
enabled.  See <a class="reference external" href="#connpoolqueue">Connection Pool Queue</a> for more
information.</p>
</div>
<div class="section" id="a-name-propdbqueuetimeout-a-3-2-23-oracledb-queuetimeout">
<h4><a name="propdbqueuetimeout"></a> 3.2.23 <code class="docutils literal notranslate"><span class="pre">oracledb.queueTimeout</span></code><a class="headerlink" href="#a-name-propdbqueuetimeout-a-3-2-23-oracledb-queuetimeout" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">queueTimeout</span>
</pre></div>
</div>
<p>The number of milliseconds after which connection requests waiting in
the connection request queue are terminated.  If <code class="docutils literal notranslate"><span class="pre">queueTimeout</span></code> is
0, then queued connection requests are never terminated.</p>
<p>The default value is 60000.</p>
<p>This property may be overridden when <a class="reference external" href="#createpool">creating a connection pool</a>.</p>
<p>See <a class="reference external" href="#connpoolqueue">Connection Pool Queue</a> for more information.</p>
<p>This property was added in node-oracledb 1.7.</p>
<div class="section" id="id21">
<h5>Example<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">queueTimeout</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span> <span class="c1">// 3 seconds</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbstmtcachesize-a-3-2-24-oracledb-stmtcachesize">
<h4><a name="propdbstmtcachesize"></a> 3.2.24 <code class="docutils literal notranslate"><span class="pre">oracledb.stmtCacheSize</span></code><a class="headerlink" href="#a-name-propdbstmtcachesize-a-3-2-24-oracledb-stmtcachesize" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">stmtCacheSize</span>
</pre></div>
</div>
<p>The number of statements that are cached in the <a class="reference external" href="#stmtcache">statement cache</a> of
each connection.</p>
<p>The default value is 30.</p>
<p>This property may be overridden for specific <em>Pool</em> or <em>Connection</em>
objects.</p>
<p>In general, set the statement cache to the size of the working set of
statements being executed by the application.  Statement caching can
be disabled by setting the size to 0.</p>
<p>See <a class="reference external" href="#stmtcache">Statement Caching</a> for examples.</p>
<div class="section" id="id22">
<h5>Example<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">stmtCacheSize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbversion-a-3-2-25-oracledb-version">
<h4><a name="propdbversion"></a> 3.2.25 <code class="docutils literal notranslate"><span class="pre">oracledb.version</span></code><a class="headerlink" href="#a-name-propdbversion-a-3-2-25-oracledb-version" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">version</span>
</pre></div>
</div>
<p>This readonly property gives a numeric representation of the node-oracledb version.
For version <em>x.y.z</em>, this property gives the number: <code class="docutils literal notranslate"><span class="pre">(10000</span> <span class="pre">*</span> <span class="pre">x)</span> <span class="pre">+</span> <span class="pre">(100</span> <span class="pre">*</span> <span class="pre">y)</span> <span class="pre">+</span> <span class="pre">z</span></code></p>
<div class="section" id="id23">
<h5>Example<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Driver version number is &quot;</span> <span class="o">+</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">version</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbversionstring-a-3-2-26-oracledb-versionstring">
<h4><a name="propdbversionstring"></a> 3.2.26 <code class="docutils literal notranslate"><span class="pre">oracledb.versionString</span></code><a class="headerlink" href="#a-name-propdbversionstring-a-3-2-26-oracledb-versionstring" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">versionString</span>
</pre></div>
</div>
<p>This readonly property gives a string representation of the node-oracledb version, including the version suffix if one is present.</p>
<p>This property was added in node-oracledb 2.1.</p>
<div class="section" id="id24">
<h5>Example<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Driver version is &quot;</span> <span class="o">+</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">versionString</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-propdbversionsuffix-a-3-2-27-oracledb-versionsuffix">
<h4><a name="propdbversionsuffix"></a> 3.2.27 <code class="docutils literal notranslate"><span class="pre">oracledb.versionSuffix</span></code><a class="headerlink" href="#a-name-propdbversionsuffix-a-3-2-27-oracledb-versionsuffix" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">versionSuffix</span>
</pre></div>
</div>
<p>This readonly property gives a string representing the version suffix (e.g. “-dev” or “-beta”) or an empty string if no version suffix is present.</p>
<p>This property was added in node-oracledb 2.1.</p>
<div class="section" id="id25">
<h5>Example<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Driver version suffix is &quot;</span> <span class="o">+</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">versionSuffix</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-oracledbmethods-a-3-3-oracledb-methods">
<h3><a name="oracledbmethods"></a> 3.3 Oracledb Methods<a class="headerlink" href="#a-name-oracledbmethods-a-3-3-oracledb-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-createpool-a-3-3-1-oracledb-createpool">
<h4><a name="createpool"></a> 3.3.1 <code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code><a class="headerlink" href="#a-name-createpool-a-3-3-1-oracledb-createpool" title="Permalink to this headline">¶</a></h4>
<div class="section" id="prototype">
<h5>Prototype<a class="headerlink" href="#prototype" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">createPool</span><span class="p">(</span><span class="n">Object</span> <span class="n">poolAttrs</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Pool</span> <span class="n">pool</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">createPool</span><span class="p">(</span><span class="n">Object</span> <span class="n">poolAttrs</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="description">
<h5>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h5>
<p>This method creates a pool of connections with the specified user
name, password and connection string.  A pool is typically created
once during application initialization.</p>
<p>Internally, <code class="docutils literal notranslate"><span class="pre">createPool()</span></code> creates an <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C">Oracle Call Interface Session
Pool</a> for each Pool object.</p>
<p>The default properties may be overridden by specifying new properties
in the <code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code> parameter.</p>
<p>It is possible to add pools to the pool cache when calling <code class="docutils literal notranslate"><span class="pre">createPool()</span></code>.
This allows pools to later be accessed by name, removing the need to
pass the pool object through code.
See <a class="reference external" href="#connpoolcache">Connection Pool Cache</a> for more details.</p>
<p>A pool should be terminated with the <a class="reference external" href="#poolclose"><code class="docutils literal notranslate"><span class="pre">pool.close()</span></code></a>
call.</p>
<p>From node-oracledb 3.1.0, the <code class="docutils literal notranslate"><span class="pre">createPool()</span></code> error callback will
return a <em>DPI-1047</em> error if node-oracledb cannot load Oracle Client
libraries.  Previous versions threw this error from
<code class="docutils literal notranslate"><span class="pre">require('oracledb')</span></code>.</p>
<p>See <a class="reference external" href="#connpooling">Connection Pooling</a> for more information about pooling.</p>
<div class="section" id="a-name-createpoolpoolattrs-a-3-3-1-1-createpool-parameters-and-attributes">
<h6><a name="createpoolpoolattrs"></a> 3.3.1.1 <code class="docutils literal notranslate"><span class="pre">createPool()</span></code>: Parameters and Attributes<a class="headerlink" href="#a-name-createpoolpoolattrs-a-3-3-1-1-createpool-parameters-and-attributes" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">poolAttrs</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code> parameter object provides connection credentials and
pool-specific configuration properties, such as the maximum or minimum
number of connections for the pool, or the statement cache size for
the connections.</p>
<p>The properties provided in the <code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code> parameter override the
default pooling properties of the <em>Oracledb</em> object.  If an attribute
is not set, or is null, the value of the related <em>Oracledb</em> property
will be used.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code> parameter may have configuration
properties that are not used by the <code class="docutils literal notranslate"><span class="pre">createPool()</span></code> method.  These are
ignored.</p>
<p>The properties of <code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code> are described below.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrsconnectstring-a-3-3-1-1-1-connectstring-connectionstring">
<h6><a name="createpoolpoolattrsconnectstring"></a> 3.3.1.1.1 <code class="docutils literal notranslate"><span class="pre">connectString</span></code>, <code class="docutils literal notranslate"><span class="pre">connectionString</span></code><a class="headerlink" href="#a-name-createpoolpoolattrsconnectstring-a-3-3-1-1-1-connectstring-connectionstring" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">connectString</span>
<span class="n">String</span> <span class="n">connectionString</span>
</pre></div>
</div>
<p>The two properties are aliases for each other.  Use only one of the properties.</p>
<p>The Oracle database instance used by connections in the pool.  The
string can be an Easy Connect string, or a Net Service Name from a
<code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code> file, or the name of a local Oracle Database instance.
See <a class="reference external" href="#connectionstrings">Connection Strings</a> for examples.</p>
<p>The alias <code class="docutils literal notranslate"><span class="pre">connectionString</span></code> was added in node-oracledb 2.1.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrsedition-a-3-3-1-1-2-edition">
<h6><a name="createpoolpoolattrsedition"></a> 3.3.1.1.2 <code class="docutils literal notranslate"><span class="pre">edition</span></code><a class="headerlink" href="#a-name-createpoolpoolattrsedition-a-3-3-1-1-2-edition" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">edition</span>
</pre></div>
</div>
<p>Sets the name used for <a class="reference external" href="#ebr">Edition-Based Redefinition</a> by
connections in the pool.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbedition"><code class="docutils literal notranslate"><span class="pre">oracledb.edition</span></code></a> property.</p>
<p>This property was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrsevents-a-3-3-1-1-3-events">
<h6><a name="createpoolpoolattrsevents"></a> 3.3.1.1.3 <code class="docutils literal notranslate"><span class="pre">events</span></code><a class="headerlink" href="#a-name-createpoolpoolattrsevents-a-3-3-1-1-3-events" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">events</span>
</pre></div>
</div>
<p>Indicate whether Oracle Call Interface events mode should be enabled for this pool.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbevents"><code class="docutils literal notranslate"><span class="pre">oracledb.events</span></code></a> property.</p>
<p>This property was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrsexternalauth-a-3-3-1-1-4-externalauth">
<h6><a name="createpoolpoolattrsexternalauth"></a> 3.3.1.1.4 <code class="docutils literal notranslate"><span class="pre">externalAuth</span></code><a class="headerlink" href="#a-name-createpoolpoolattrsexternalauth-a-3-3-1-1-4-externalauth" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">externalAuth</span>
</pre></div>
</div>
<p>Indicate whether pooled connections should be established using
<a class="reference external" href="#extauth">External Authentication</a>.</p>
<p>The default is <em>false</em>.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbisexternalauth"><code class="docutils literal notranslate"><span class="pre">oracledb.externalAuth</span></code></a> property.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> properties should not be set when
<code class="docutils literal notranslate"><span class="pre">externalAuth</span></code> is <em>true</em>.</p>
<p>Note prior to node-oracledb 0.5 this property was called
<code class="docutils literal notranslate"><span class="pre">isExternalAuth</span></code>.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrshomogeneous-a-3-3-1-1-5-homogeneous">
<h6><a name="createpoolpoolattrshomogeneous"></a> 3.3.1.1.5 <code class="docutils literal notranslate"><span class="pre">homogeneous</span></code><a class="headerlink" href="#a-name-createpoolpoolattrshomogeneous-a-3-3-1-1-5-homogeneous" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">homogeneous</span>
</pre></div>
</div>
<p>Indicate whether connections in the pool all have the same credentials
(a ‘homogeneous’ pool), or whether different credentials can be used
(a ‘heterogeneous’ pool).</p>
<p>The default is <em>true</em>.</p>
<p>When set to <em>false</em>, the user name and password can be omitted from
the <code class="docutils literal notranslate"><span class="pre">connection.createPool()</span></code> call, but will need to be given for
subsequent <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> calls.  Different
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> calls can provide different user credentials.
Alternatively, when <code class="docutils literal notranslate"><span class="pre">homogeneous</span></code> is <em>false</em>, the user name (the
‘proxy’ user name) and password can be given, but subsequent
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> calls can specify a different user name to
access that user’s schema.</p>
<p>Heterogeneous pools cannot be used with the <a class="reference external" href="#connpoolcache">connection pool
cache</a>.  Applications should ensure the pool object is
explicitly passed between code modules, or use a homogeneous pool and
make use of <a class="reference external" href="#propconnclientid"><code class="docutils literal notranslate"><span class="pre">connection.clientId</span></code></a>.</p>
<p>See <a class="reference external" href="#connpoolproxy">Heterogeneous Connection Pools and Pool Proxy
Authentication</a> for details and examples.</p>
<p>This property was added in node-oracledb 2.3.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrspassword-a-3-3-1-1-6-password">
<h6><a name="createpoolpoolattrspassword"></a> 3.3.1.1.6 <code class="docutils literal notranslate"><span class="pre">password</span></code><a class="headerlink" href="#a-name-createpoolpoolattrspassword-a-3-3-1-1-6-password" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">password</span>
</pre></div>
</div>
<p>The password of the database user used by connections in the pool.  A
password is also necessary if a proxy user is specified at pool creation.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">homogeneous</span></code> is <em>false</em>, then the password may be omitted at pool
creation but given in subsequent <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> calls.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrspoolalias-a-3-3-1-1-7-poolalias">
<h6><a name="createpoolpoolattrspoolalias"></a> 3.3.1.1.7 <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code><a class="headerlink" href="#a-name-createpoolpoolattrspoolalias-a-3-3-1-1-7-poolalias" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">poolAlias</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code> is an optional property that is used to explicitly add pools to the
connection pool cache. If a pool alias is provided, then the new pool will be added
to the connection pool cache and the <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code> value can then be used with methods
that utilize the connection pool cache, such as <a class="reference external" href="#getpool"><code class="docutils literal notranslate"><span class="pre">oracledb.getPool()</span></code></a> and
<a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a>.</p>
<p>See <a class="reference external" href="#connpoolcache">Connection Pool Cache</a> for details and examples.</p>
<p>This property was added in node-oracledb 1.11.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrspoolincrement-a-3-3-1-1-8-poolincrement">
<h6><a name="createpoolpoolattrspoolincrement"></a> 3.3.1.1.8 <code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code><a class="headerlink" href="#a-name-createpoolpoolattrspoolincrement-a-3-3-1-1-8-poolincrement" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolIncrement</span>
</pre></div>
</div>
<p>The number of connections that are opened whenever a connection
request exceeds the number of currently open connections.</p>
<p>The default value is 1.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbpoolincrement"><code class="docutils literal notranslate"><span class="pre">oracledb.poolIncrement</span></code></a> property.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrspoolmax-a-3-3-1-1-9-poolmax">
<h6><a name="createpoolpoolattrspoolmax"></a> 3.3.1.1.9 <code class="docutils literal notranslate"><span class="pre">poolMax</span></code><a class="headerlink" href="#a-name-createpoolpoolattrspoolmax-a-3-3-1-1-9-poolmax" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolMax</span>
</pre></div>
</div>
<p>The maximum number of connections to which a connection pool can grow.</p>
<p>The default value is 4.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbpoolmax"><code class="docutils literal notranslate"><span class="pre">oracledb.poolMax</span></code></a> property.</p>
<p>Importantly, if you increase <code class="docutils literal notranslate"><span class="pre">poolMax</span></code> you should also increase the
number of threads available to node-oracledb.  See <a class="reference external" href="#numberofthreads">Connections and
Number of Threads</a>.</p>
<p>See <a class="reference external" href="#connpooling">Connection Pooling</a> for other pool sizing guidelines.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrspoolmin-a-3-3-1-1-10-poolmin">
<h6><a name="createpoolpoolattrspoolmin"></a> 3.3.1.1.10 <code class="docutils literal notranslate"><span class="pre">poolMin</span></code><a class="headerlink" href="#a-name-createpoolpoolattrspoolmin-a-3-3-1-1-10-poolmin" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolMin</span>
</pre></div>
</div>
<p>The minimum number of connections a connection pool maintains, even
when there is no activity to the target database.</p>
<p>The default value is 0.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbpoolmin"><code class="docutils literal notranslate"><span class="pre">oracledb.poolMin</span></code></a> property.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrspoolpinginterval-a-3-3-1-1-11-poolpinginterval">
<h6><a name="createpoolpoolattrspoolpinginterval"></a> 3.3.1.1.11 <code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code><a class="headerlink" href="#a-name-createpoolpoolattrspoolpinginterval-a-3-3-1-1-11-poolpinginterval" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolPingInterval</span>
</pre></div>
</div>
<p>When a pool <a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a> is called and the
connection has been idle in the pool for at least <code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code>
seconds, an internal “ping” will be performed first to check the
aliveness of the connection.</p>
<p>The default value is 60.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">oracledb.poolPingInterval</span></code></a> property.</p>
<p>See <a class="reference external" href="#connpoolpinging">Connection Pool Pinging</a> for more discussion.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrspooltimeout-a-3-3-1-1-12-pooltimeout">
<h6><a name="createpoolpoolattrspooltimeout"></a> 3.3.1.1.12 <code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code><a class="headerlink" href="#a-name-createpoolpoolattrspooltimeout-a-3-3-1-1-12-pooltimeout" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">poolTimeout</span>
</pre></div>
</div>
<p>The number of seconds after which idle connections (unused in the
pool) may be terminated.  Idle connections are terminated only when
the pool is accessed.</p>
<p>The default value is 60.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbpooltimeout"><code class="docutils literal notranslate"><span class="pre">oracledb.poolTimeout</span></code></a> property.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrsqueuerequests-a-3-3-1-1-13-queuerequests">
<h6><a name="createpoolpoolattrsqueuerequests"></a> 3.3.1.1.13 <code class="docutils literal notranslate"><span class="pre">queueRequests</span></code><a class="headerlink" href="#a-name-createpoolpoolattrsqueuerequests-a-3-3-1-1-13-queuerequests" title="Permalink to this headline">¶</a></h6>
<p>This property was removed in node-oracledb 3.0.  Queuing is now always
enabled.  See <a class="reference external" href="#connpoolqueue">Connection Pool Queue</a> for more
information.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrsqueuetimeout-a-3-3-1-1-14-queuetimeout">
<h6><a name="createpoolpoolattrsqueuetimeout"></a> 3.3.1.1.14 <code class="docutils literal notranslate"><span class="pre">queueTimeout</span></code><a class="headerlink" href="#a-name-createpoolpoolattrsqueuetimeout-a-3-3-1-1-14-queuetimeout" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">queueTimeout</span>
</pre></div>
</div>
<p>The number of milliseconds after which connection requests waiting in the
connection request queue are terminated.  If <code class="docutils literal notranslate"><span class="pre">queueTimeout</span></code> is
set to 0, then queued connection requests are never terminated.</p>
<p>The default value is 60000.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbqueuetimeout"><code class="docutils literal notranslate"><span class="pre">oracledb.queueTimeout</span></code></a> property.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrssessioncallback-a-3-3-1-1-15-sessioncallback">
<h6><a name="createpoolpoolattrssessioncallback"></a> 3.3.1.1.15 <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code><a class="headerlink" href="#a-name-createpoolpoolattrssessioncallback-a-3-3-1-1-15-sessioncallback" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sessionCallback</span> <span class="o">|</span> <span class="n">function</span> <span class="n">sessionCallback</span><span class="p">(</span><span class="n">Connection</span> <span class="n">connection</span><span class="p">,</span> <span class="n">String</span> <span class="n">requestedTag</span><span class="p">,</span> <span class="n">function</span> <span class="n">callback</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Connection</span> <span class="n">connection</span><span class="p">){})</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> is a Node.js function, each <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> will
select a connection from the pool and may invoke <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> before
returning.  The <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> function is called:</p>
<ul class="simple">
<li><p>when the pool selects a brand new, never used connection in the pool.</p></li>
<li><p>if the pool selects a connection from the pool with a given
<a class="reference external" href="#getconnectiondbattrstag"><code class="docutils literal notranslate"><span class="pre">tag</span></code></a> but that tag string value does not match
the connection’s current, actual tag.  The tag requested (if any) by
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> is available in the <code class="docutils literal notranslate"><span class="pre">requestedTag</span></code> parameter.  The
actual tag in the connection selected by the pool is available in
<a class="reference external" href="#propconntag"><code class="docutils literal notranslate"><span class="pre">connection.tag</span></code></a>.</p></li>
</ul>
<p>It will not be invoked for other <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> calls.</p>
<p>The session callback is called before <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> returns so it can
be used for logging or to efficiently set session state, such as with ALTER
SESSION statements.  Make sure any session state is set and <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> is
updated in the <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> function prior to it calling its own
<code class="docutils literal notranslate"><span class="pre">callback()</span></code> function otherwise the session will not be correctly set when
<code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> returns.  The connection passed into <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> should
be passed out through <code class="docutils literal notranslate"><span class="pre">callback()</span></code> so it is returned from the application’s
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> call.</p>
<p>When node-oracledb is using Oracle Client libraries 12.2 or later, tags are
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C">multi-property tags</a> with name=value pairs like “k1=v1;k2=v2”.</p>
<p>When using Oracle Client libraries 12.2 or later, <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code>
can be a string containing the name of a PL/SQL procedure to be called
when <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> requests a
<a class="reference external" href="#getconnectiondbattrstag"><code class="docutils literal notranslate"><span class="pre">tag</span></code></a>, and that tag does not match the
connection’s actual tag.  When the application uses <a class="reference external" href="#drcp">DRCP
connections</a>, a PL/SQL callback can avoid the
<a class="reference external" href="#roundtrips">round-trip</a> calls that a Node.js function would require
to set session state.  For non-DRCP connections, the PL/SQL callback
will require a round-trip from the application.</p>
<p>The PL/SQL procedure declaration is:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">PROCEDURE</span> <span class="n">mycallback</span> <span class="p">(</span>
  <span class="n">desired_props</span> <span class="k">IN</span>  <span class="n">VARCHAR2</span><span class="p">,</span>
  <span class="n">actual_props</span>  <span class="k">IN</span>  <span class="n">VARCHAR2</span>
<span class="p">);</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#connpooltagging">Connection Tagging and Session State</a> for more
information.</p>
<p>This property was added in node-oracledb 3.1.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrsstmtcachesize-a-3-3-1-1-16-stmtcachesize">
<h6><a name="createpoolpoolattrsstmtcachesize"></a> 3.3.1.1.16 <code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code><a class="headerlink" href="#a-name-createpoolpoolattrsstmtcachesize-a-3-3-1-1-16-stmtcachesize" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">stmtCacheSize</span>
</pre></div>
</div>
<p>The number of statements to be cached in the
<a class="reference external" href="#stmtcache">statement cache</a> of each connection in the pool.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbstmtcachesize"><code class="docutils literal notranslate"><span class="pre">oracledb.stmtCacheSize</span></code></a> property.</p>
</div>
<div class="section" id="a-name-createpoolpoolattrsuser-a-3-3-1-1-17-user">
<h6><a name="createpoolpoolattrsuser"></a> 3.3.1.1.17 <code class="docutils literal notranslate"><span class="pre">user</span></code><a class="headerlink" href="#a-name-createpoolpoolattrsuser-a-3-3-1-1-17-user" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">user</span>
</pre></div>
</div>
<p>The database user name for connections in the pool.  Can be a simple
user name or a proxy of the form <em>alison[fred]</em>. See the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D77D0D4A-7483-423A-9767-CBB5854A15CC">Client
Access Through a Proxy</a> section in the Oracle Call Interface manual
for more details about proxy authentication.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">homogeneous</span></code> is <em>false</em>, then the pool user name and password need
to be specified only if the application wants that user to proxy the
users supplied in subsequent <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> calls.</p>
</div>
</div>
</div>
<div class="section" id="a-name-createpoolpoolcallback-a-3-3-1-2-createpool-callback-function">
<h4><a name="createpoolpoolcallback"></a> 3.3.1.2 <code class="docutils literal notranslate"><span class="pre">createPool()</span></code>: Callback Function<a class="headerlink" href="#a-name-createpoolpoolcallback-a-3-3-1-2-createpool-callback-function" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id26">
<h5>Prototype<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Pool</span> <span class="n">pool</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parameters">
<h5>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h5>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">createPool()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>Pool pool</em>   | The newly created connection pool. If <code class="docutils literal notranslate"><span class="pre">createPool()</span></code> fails, <code class="docutils literal notranslate"><span class="pre">pool</span></code> will be NULL.  If the pool will be accessed via the <a class="reference external" href="#connpoolcache">pool cache</a>, this parameter can be omitted.  See <a class="reference external" href="#poolclass">Pool class</a> for more information.</p>
</div>
</div>
<div class="section" id="a-name-getconnectiondb-a-3-3-2-oracledb-getconnection">
<h4><a name="getconnectiondb"></a> 3.3.2 <code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code><a class="headerlink" href="#a-name-getconnectiondb-a-3-3-2-oracledb-getconnection" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id27">
<h5>Prototype<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getConnection</span><span class="p">([</span><span class="n">String</span> <span class="n">poolAlias</span> <span class="o">|</span> <span class="n">Object</span> <span class="n">connAttrs</span><span class="p">],</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Connection</span> <span class="n">connection</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getConnection</span><span class="p">([</span><span class="n">String</span> <span class="n">poolAlias</span> <span class="o">|</span> <span class="n">Object</span> <span class="n">connAttrs</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id28">
<h5>Description<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h5>
<p>Obtains a connection from a pool in the <a class="reference external" href="#connpoolcache">connection pool
cache</a> or creates a new, standalone, non-pooled
connection.</p>
<p>For situations where connections are used infrequently, creating a
standalone connection may be more efficient than creating and managing
a connection pool. However, in most cases, Oracle recommends getting
connections from a <a class="reference external" href="#createpool">connection pool</a>.</p>
<p>The following table shows the various signatures that can be used when invoking
<code class="docutils literal notranslate"><span class="pre">getConnection</span></code> and describes how the function will behave as a result.</p>
<p>Signature | Description
——— | ———–
<code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code> | Gets a connection from the previously created default pool.  Returns a promise.
<code class="docutils literal notranslate"><span class="pre">oracledb.getConnection(callback)</span></code> | Gets a connection from the previously created default pool.  Invokes the callback.
<code class="docutils literal notranslate"><span class="pre">oracledb.getConnection(poolAlias)</span></code> | Gets a connection from the previously created pool with the specified <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code>.  Returns a promise.
<code class="docutils literal notranslate"><span class="pre">oracledb.getConnection(poolAlias,</span> <span class="pre">callback)</span></code> | Gets a connection from the previously created pool with the specified <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code>.  Invokes the callback.
<code class="docutils literal notranslate"><span class="pre">oracledb.getConnection(connAttrs)</span></code> | Creates a standalone, non-pooled connection. Returns a promise.
<code class="docutils literal notranslate"><span class="pre">oracledb.getConnection(connAttrs,</span> <span class="pre">callback)</span></code> | Creates a standalone, non-pooled connection.  Invokes the callback.</p>
<p>Note if the application opens a number of connections, you should
increase the number of threads available to node-oracledb.
See <a class="reference external" href="#numberofthreads">Connections and Number of Threads</a>.</p>
<p>From node-oracledb 3.1.0, a non-pooled <code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code> call
will return a <em>DPI-1047</em> error if node-oracledb cannot load Oracle
Client libraries.  Previous versions threw this error from
<code class="docutils literal notranslate"><span class="pre">require('oracledb')</span></code>.</p>
<p>See <a class="reference external" href="#connectionhandling">Connection Handling</a> for more information on
connections.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrs-a-3-3-2-1-getconnection-parameters">
<h5><a name="getconnectiondbattrs"></a> 3.3.2.1 <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>: Parameters<a class="headerlink" href="#a-name-getconnectiondbattrs-a-3-3-2-1-getconnection-parameters" title="Permalink to this headline">¶</a></h5>
<div class="section" id="a-name-getconnectionpoolalias-a-3-3-2-1-1-pool-alias">
<h6><a name="getconnectionpoolalias"></a> 3.3.2.1.1 Pool Alias<a class="headerlink" href="#a-name-getconnectionpoolalias-a-3-3-2-1-1-pool-alias" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">poolAlias</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code> parameter specifies which previously created pool in
the <a class="reference external" href="#connpoolcache">connection pool cache</a> to use to obtain the
connection.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsconnattrs-a-3-3-2-1-2-getconnection-attributes">
<h6><a name="getconnectiondbattrsconnattrs"></a> 3.3.2.1.2 <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>: Attributes<a class="headerlink" href="#a-name-getconnectiondbattrsconnattrs-a-3-3-2-1-2-getconnection-attributes" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">connAttrs</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">connAttrs</span></code> parameter object provides connection credentials and
connection-specific configuration properties.</p>
<p>Any <code class="docutils literal notranslate"><span class="pre">connAttrs</span></code> properties that are not used by the <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>
method are ignored.</p>
<p>The properties of the <code class="docutils literal notranslate"><span class="pre">connAttrs</span></code> object are described below.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsconnectstring-a-3-3-2-1-2-1-connectstring-connectionstring">
<h6><a name="getconnectiondbattrsconnectstring"></a> 3.3.2.1.2.1 <code class="docutils literal notranslate"><span class="pre">connectString</span></code>, <code class="docutils literal notranslate"><span class="pre">connectionString</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsconnectstring-a-3-3-2-1-2-1-connectstring-connectionstring" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">connectString</span>
<span class="n">String</span> <span class="n">connectionString</span>
</pre></div>
</div>
<p>The two properties are aliases for each other.  Use only one of the properties.</p>
<p>The Oracle database instance to connect to.  The string can be an Easy Connect string, or a
Net Service Name from a <code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code> file, or the name of a local
Oracle database instance.  See
<a class="reference external" href="#connectionstrings">Connection Strings</a> for examples.</p>
<p>The alias <code class="docutils literal notranslate"><span class="pre">connectionString</span></code> was added in node-oracledb 2.1.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsedition-a-3-3-2-1-2-2-edition">
<h6><a name="getconnectiondbattrsedition"></a> 3.3.2.1.2.2 <code class="docutils literal notranslate"><span class="pre">edition</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsedition-a-3-3-2-1-2-2-edition" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">edition</span>
</pre></div>
</div>
<p>Sets the name used for <a class="reference external" href="#ebr">Edition-Based Redefinition</a> by this connection.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbedition"><code class="docutils literal notranslate"><span class="pre">oracledb.edition</span></code></a> property.</p>
<p>This property was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsevents-a-3-3-2-1-2-3-events">
<h6><a name="getconnectiondbattrsevents"></a> 3.3.2.1.2.3 <code class="docutils literal notranslate"><span class="pre">events</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsevents-a-3-3-2-1-2-3-events" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">events</span>
</pre></div>
</div>
<p>Determines if the standalone connection is created using Oracle Call Interface events mode.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbisevents"><code class="docutils literal notranslate"><span class="pre">oracledb.events</span></code></a> property.</p>
<p>This property was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsexternalauth-a-3-3-2-1-2-4-externalauth">
<h6><a name="getconnectiondbattrsexternalauth"></a> 3.3.2.1.2.4 <code class="docutils literal notranslate"><span class="pre">externalAuth</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsexternalauth-a-3-3-2-1-2-4-externalauth" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">externalAuth</span>
</pre></div>
</div>
<p>If this optional property is <em>true</em> then the connection will be
established using <a class="reference external" href="#extauth">External Authentication</a>.</p>
<p>This optional property overrides the
<a class="reference external" href="#propdbisexternalauth"><code class="docutils literal notranslate"><span class="pre">oracledb.externalAuth</span></code></a> property.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> properties should not be set when
<code class="docutils literal notranslate"><span class="pre">externalAuth</span></code> is <em>true</em>.</p>
<p>Note prior to node-oracledb 0.5 this property was called
<code class="docutils literal notranslate"><span class="pre">isExternalAuth</span></code>.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsmatchany-a-3-3-2-1-2-5-matchany">
<h6><a name="getconnectiondbattrsmatchany"></a> 3.3.2.1.2.5 <code class="docutils literal notranslate"><span class="pre">matchAny</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsmatchany-a-3-3-2-1-2-5-matchany" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">matchAny</span>
</pre></div>
</div>
<p>Used in conjunction with <a class="reference external" href="#getconnectiondbattrstag"><code class="docutils literal notranslate"><span class="pre">tag</span></code></a> when
getting a connection from a <a class="reference external" href="#poolclass">connection pool</a>.</p>
<p>Indicates that the tag in a connection returned from a connection pool
may not match the requested tag.</p>
<p>See <a class="reference external" href="#connpooltagging">Connection Tagging and Session State</a>.</p>
<p>This property was added in node-oracledb 3.1.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsnewpassword-a-3-3-2-1-2-6-newpassword">
<h6><a name="getconnectiondbattrsnewpassword"></a> 3.3.2.1.2.6 <code class="docutils literal notranslate"><span class="pre">newPassword</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsnewpassword-a-3-3-2-1-2-6-newpassword" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">newPassword</span>
</pre></div>
</div>
<p>The new password to use for the database user.  When using
<code class="docutils literal notranslate"><span class="pre">newPassword</span></code>, the <a class="reference external" href="#getconnectiondbattrspassword"><code class="docutils literal notranslate"><span class="pre">password</span></code></a>
property should be set to the current password.</p>
<p>This allows passwords to be changed at the time of connection, in
particular it can be used to connect when the old password has
expired.</p>
<p>See <a class="reference external" href="#changingpassword">Changing Passwords and Connecting with an Expired Password</a>.</p>
<p>This property was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrspoolalias-a-3-3-2-1-2-7-poolalias">
<h6><a name="getconnectiondbattrspoolalias"></a> 3.3.2.1.2.7 <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code><a class="headerlink" href="#a-name-getconnectiondbattrspoolalias-a-3-3-2-1-2-7-poolalias" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">poolAlias</span>
</pre></div>
</div>
<p>Specifies which previously created pool in the <a class="reference external" href="#connpoolcache">connection pool
cache</a> to obtain the connection from.  See <a class="reference external" href="#getconnectionpoolalias">Pool
Alias</a>.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrspassword-a-3-3-2-1-2-8-password">
<h6><a name="getconnectiondbattrspassword"></a> 3.3.2.1.2.8 <code class="docutils literal notranslate"><span class="pre">password</span></code><a class="headerlink" href="#a-name-getconnectiondbattrspassword-a-3-3-2-1-2-8-password" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">password</span>
</pre></div>
</div>
<p>The password of the database user. A password is also necessary if a
proxy user is specified.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsprivilege-a-3-3-2-1-2-9-privilege">
<h6><a name="getconnectiondbattrsprivilege"></a> 3.3.2.1.2.9 <code class="docutils literal notranslate"><span class="pre">privilege</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsprivilege-a-3-3-2-1-2-9-privilege" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">privilege</span>
</pre></div>
</div>
<p>The privilege to use when establishing connection to the database. This
optional property should be one of the
<a class="reference external" href="#oracledbconstantsprivilege">privileged connection constants</a>.</p>
<p>See <a class="reference external" href="#privconn">Privileged Connections</a> for more information.</p>
<p>Note only non-pooled connections can be privileged.</p>
<p>This property was added in node-oracledb 2.1.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsstmtcachesize-a-3-3-2-1-2-10-stmtcachesize">
<h6><a name="getconnectiondbattrsstmtcachesize"></a> 3.3.2.1.2.10 <code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsstmtcachesize-a-3-3-2-1-2-10-stmtcachesize" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">stmtCacheSize</span>
</pre></div>
</div>
<p>The number of statements to be cached in the
<a class="reference external" href="#stmtcache">statement cache</a> of each connection.  This optional
property may be used to override the
<a class="reference external" href="#propdbstmtcachesize"><code class="docutils literal notranslate"><span class="pre">oracledb.stmtCacheSize</span></code></a> property.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrstag-a-3-3-2-1-2-11-tag">
<h6><a name="getconnectiondbattrstag"></a> 3.3.2.1.2.11 <code class="docutils literal notranslate"><span class="pre">tag</span></code><a class="headerlink" href="#a-name-getconnectiondbattrstag-a-3-3-2-1-2-11-tag" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">tag</span>
</pre></div>
</div>
<p>Used when getting a connection from a <a class="reference external" href="#poolclass">connection pool</a>.</p>
<p>Indicates the tag that a connection returned from a connection pool
should have.  Various heuristics determine the tag that is actually
returned, see <a class="reference external" href="#connpooltagging">Connection Tagging and Session
State</a>.</p>
<p>This property was added in node-oracledb 3.1.</p>
</div>
<div class="section" id="a-name-getconnectiondbattrsuser-a-3-3-2-1-2-12-user">
<h6><a name="getconnectiondbattrsuser"></a> 3.3.2.1.2.12 <code class="docutils literal notranslate"><span class="pre">user</span></code><a class="headerlink" href="#a-name-getconnectiondbattrsuser-a-3-3-2-1-2-12-user" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">user</span>
</pre></div>
</div>
<p>The database user name.  Can be a simple user name or a proxy of the
form <em>alison[fred]</em>. See the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D77D0D4A-7483-423A-9767-CBB5854A15CC">Client Access Through a Proxy</a>
section in the Oracle Call Interface manual for more details about
proxy authentication.</p>
</div>
</div>
<div class="section" id="a-name-getconnectiondbcallback-a-3-3-2-2-getconnection-callback-function">
<h5><a name="getconnectiondbcallback"></a> 3.3.2.2 <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>: Callback Function<a class="headerlink" href="#a-name-getconnectiondbcallback-a-3-3-2-2-getconnection-callback-function" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id29">
<h5>Prototype<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Connection</span> <span class="n">connection</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h5>Parameters<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h5>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>Connection connection</em> | The newly created connection.  If <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> fails, <code class="docutils literal notranslate"><span class="pre">connection</span></code> will be NULL.  See <a class="reference external" href="#connectionclass">Connection class</a> for more details.</p>
</div>
</div>
<div class="section" id="a-name-getpool-a-3-3-3-oracledb-getpool">
<h4><a name="getpool"></a> 3.3.3 <code class="docutils literal notranslate"><span class="pre">oracledb.getPool()</span></code><a class="headerlink" href="#a-name-getpool-a-3-3-3-oracledb-getpool" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id31">
<h5>Prototype<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getPool</span><span class="p">([</span><span class="n">String</span> <span class="n">poolAlias</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h5>Description<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h5>
<p>Retrieves a previously created pool from the <a class="reference external" href="#connpoolcache">connection pool
cache</a>. Note that this is a synchronous method.</p>
</div>
<div class="section" id="a-name-getpoolattrs-a-3-3-3-1-parameters">
<h5><a name="getpoolattrs"></a> 3.3.3.1 Parameters<a class="headerlink" href="#a-name-getpoolattrs-a-3-3-3-1-parameters" title="Permalink to this headline">¶</a></h5>
<div class="section" id="a-name-getpoolattrsalias-a-3-3-3-1-1-alias">
<h6><a name="getpoolattrsalias"></a> 3.3.3.1.1 <code class="docutils literal notranslate"><span class="pre">alias</span></code><a class="headerlink" href="#a-name-getpoolattrsalias-a-3-3-3-1-1-alias" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">poolAlias</span>
</pre></div>
</div>
<p>The pool alias of the pool to retrieve from the connection pool cache. The default
value is ‘default’ which will retrieve the default pool from the cache.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-connectionclass-a-4-connection-class">
<h2><a name="connectionclass"></a> 4. Connection Class<a class="headerlink" href="#a-name-connectionclass-a-4-connection-class" title="Permalink to this headline">¶</a></h2>
<p>A <em>Connection</em> object is obtained by a <em>Pool</em> class
<a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a> or
<em>Oracledb</em> class <a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a>
call.</p>
<p>The connection is used to access an Oracle database.</p>
<div class="section" id="a-name-connectionproperties-a-4-1-connection-properties">
<h3><a name="connectionproperties"></a> 4.1 Connection Properties<a class="headerlink" href="#a-name-connectionproperties-a-4-1-connection-properties" title="Permalink to this headline">¶</a></h3>
<p>The properties of a <em>Connection</em> object are listed below.</p>
<div class="section" id="a-name-propconnaction-a-4-1-1-connection-action">
<h4><a name="propconnaction"></a> 4.1.1 <code class="docutils literal notranslate"><span class="pre">connection.action</span></code><a class="headerlink" href="#a-name-propconnaction-a-4-1-1-connection-action" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writeonly</span> <span class="n">String</span> <span class="n">action</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-624A4771-58C5-4E2B-8131-E3389F58A0D6">action</a> attribute for end-to-end application tracing.</p>
<p>This is a write-only property.  Displaying a Connection object will
show a value of <code class="docutils literal notranslate"><span class="pre">null</span></code> for this attribute.  See
<a class="reference external" href="#endtoend">End-to-end Tracing, Mid-tier Authentication, and Auditing</a>.</p>
</div>
<div class="section" id="a-name-propconncalltimeout-a-4-1-2-connection-calltimeout">
<h4><a name="propconncalltimeout"></a> 4.1.2 <code class="docutils literal notranslate"><span class="pre">connection.callTimeout</span></code><a class="headerlink" href="#a-name-propconncalltimeout-a-4-1-2-connection-calltimeout" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">callTimeout</span>
</pre></div>
</div>
<p>Sets the maximum number of milliseconds that each underlying
<a class="reference external" href="#roundtrips">round-trip</a> between node-oracledb and Oracle Database
may take.  Each node-oracledb method or operation may make zero or
more round-trips.  The <code class="docutils literal notranslate"><span class="pre">callTimeout</span></code> value applies to each round-trip
individually, not to the sum of all round-trips.  Time spent
processing in node-oracledb before or after the completion of each
round-trip is not counted.</p>
<p>See <a class="reference external" href="#dbcalltimeouts">Database Call Timeouts</a> for more information.</p>
<p>This property was added in node-oracledb 3.0.  An exception will occur
if node-oracledb is not using Oracle client library version 18.1 or
later.</p>
</div>
<div class="section" id="a-name-propconnclientid-a-4-1-3-connection-clientid">
<h4><a name="propconnclientid"></a> 4.1.3 <code class="docutils literal notranslate"><span class="pre">connection.clientId</span></code><a class="headerlink" href="#a-name-propconnclientid-a-4-1-3-connection-clientid" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writeonly</span> <span class="n">String</span> <span class="n">clientId</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-8A9F1295-4360-4AC6-99A4-050C5C82E0B0">client identifier</a> for end-to-end application tracing, use
with mid-tier authentication, and with <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-89DB0C3C-A36F-4254-8C82-020F5F6DE31F">Virtual Private
Databases</a>.</p>
<p>This is a write-only property.  Displaying a Connection object will
show a value of <code class="docutils literal notranslate"><span class="pre">null</span></code> for this attribute.  See
<a class="reference external" href="#endtoend">End-to-end Tracing, Mid-tier Authentication, and Auditing</a>.</p>
</div>
<div class="section" id="a-name-propconncurrentschema-a-4-1-4-connection-currentschema">
<h4><a name="propconncurrentschema"></a> 4.1.4 <code class="docutils literal notranslate"><span class="pre">connection.currentSchema</span></code><a class="headerlink" href="#a-name-propconncurrentschema-a-4-1-4-connection-currentschema" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">currentSchema</span>
</pre></div>
</div>
<p>After setting <code class="docutils literal notranslate"><span class="pre">currentSchema</span></code>, SQL statements using unqualified
references to schema objects will resolve to objects in the specified
schema.</p>
<p>This setting does not change the session user or the current user, nor
does it give the session user any additional system or object
privileges for the session.</p>
<p>The value of <code class="docutils literal notranslate"><span class="pre">currentSchema</span></code> will be empty until it has been
explicitly set.</p>
<p>This property is an efficient alternative to <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-DC7B8CDD-4F89-40CC-875F-F70F673711D4"><code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">SESSION</span> <span class="pre">SET</span> <span class="pre">CURRENT_SCHEMA</span></code></a>.</p>
<p>This property was added in node-oracledb 4.0.</p>
</div>
<div class="section" id="a-name-propconnmodule-a-4-1-5-connection-module">
<h4><a name="propconnmodule"></a> 4.1.5 <code class="docutils literal notranslate"><span class="pre">connection.module</span></code><a class="headerlink" href="#a-name-propconnmodule-a-4-1-5-connection-module" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writeonly</span> <span class="n">String</span> <span class="n">module</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-624A4771-58C5-4E2B-8131-E3389F58A0D6">module</a> attribute for end-to-end application tracing.</p>
<p>This is a write-only property.  Displaying a Connection object will
show a value of <code class="docutils literal notranslate"><span class="pre">null</span></code> for this attribute.  See
<a class="reference external" href="#endtoend">End-to-end Tracing, Mid-tier Authentication, and Auditing</a>.</p>
</div>
<div class="section" id="a-name-propconnoracleserverversion-a-4-1-6-connection-oracleserverversion">
<h4><a name="propconnoracleserverversion"></a> 4.1.6 <code class="docutils literal notranslate"><span class="pre">connection.oracleServerVersion</span></code><a class="headerlink" href="#a-name-propconnoracleserverversion-a-4-1-6-connection-oracleserverversion" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">oracleServerVersion</span>
</pre></div>
</div>
<p>This readonly property gives a numeric representation of the Oracle database version which is useful in comparisons.
For version <em>a.b.c.d.e</em>, this property gives the number: <code class="docutils literal notranslate"><span class="pre">(100000000</span> <span class="pre">*</span> <span class="pre">a)</span> <span class="pre">+</span> <span class="pre">(1000000</span> <span class="pre">*</span> <span class="pre">b)</span> <span class="pre">+</span> <span class="pre">(10000</span> <span class="pre">*</span> <span class="pre">c)</span> <span class="pre">+</span> <span class="pre">(100</span> <span class="pre">*</span> <span class="pre">d)</span> <span class="pre">+</span> <span class="pre">e</span></code></p>
<p>Note if you connect to Oracle Database 18, the version will only be
accurate if node-oracledb is also using Oracle Database 18 client
libraries.  Otherwise it will show the base release such as 1800000000
instead of 1803000000.</p>
<p>This property was added in node-oracledb 1.3.</p>
</div>
<div class="section" id="a-name-propconnoracleserverversionstring-a-4-1-7-connection-oracleserverversionstring">
<h4><a name="propconnoracleserverversionstring"></a> 4.1.7 <code class="docutils literal notranslate"><span class="pre">connection.oracleServerVersionString</span></code><a class="headerlink" href="#a-name-propconnoracleserverversionstring-a-4-1-7-connection-oracleserverversionstring" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">oracleServerVersionString</span>
</pre></div>
</div>
<p>This readonly property gives a string representation of the Oracle database version which is useful for display.</p>
<p>Note if you connect to Oracle Database 18, or later, then the version
will only be accurate if node-oracledb is also using Oracle Database
18, or later, client libraries.  Otherwise it will show the base
release such as “18.0.0.0.0” instead of “18.3.0.0.0”.</p>
<p>This property was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="a-name-propconnstmtcachesize-a-4-1-8-connection-stmtcachesize">
<h4><a name="propconnstmtcachesize"></a> 4.1.8 <code class="docutils literal notranslate"><span class="pre">connection.stmtCacheSize</span></code><a class="headerlink" href="#a-name-propconnstmtcachesize-a-4-1-8-connection-stmtcachesize" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">stmtCacheSize</span>
</pre></div>
</div>
<p>The number of statements to be cached in the
<a class="reference external" href="#stmtcache">statement cache</a> of the connection.  The default value is
the <code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code> property in effect in the <em>Pool</em> object when the
connection is created in the pool.</p>
</div>
<div class="section" id="a-name-propconntag-a-4-1-9-connection-tag">
<h4><a name="propconntag"></a> 4.1.9 <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code><a class="headerlink" href="#a-name-propconntag-a-4-1-9-connection-tag" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">tag</span>
</pre></div>
</div>
<p>Applications can set the tag property on pooled connections to
indicate the ‘session state’ that a connection has.  The tag will be
retained when the connection is released to the pool.  A subsequent
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> can request a connection that has a given
<a class="reference external" href="#getconnectiondbattrstag"><code class="docutils literal notranslate"><span class="pre">tag</span></code></a>.  It is up to the application to set
any desired session state and set <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> prior to closing
the connection.</p>
<p>The tag property is not used for standalone connections.</p>
<p>When node-oracledb is using Oracle Client libraries 12.2 or later, the
tag must be a <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C">multi-property tag</a> with name=value pairs like
“k1=v1;k2=v2”.</p>
<p>An empty string represents not having a tag set.</p>
<p>See <a class="reference external" href="#connpooltagging">Connection Tagging and Session State</a>.</p>
<p>This property was added in node-oracledb 3.1.</p>
<div class="section" id="getting-the-tag">
<h5>Getting the tag<a class="headerlink" href="#getting-the-tag" title="Permalink to this headline">¶</a></h5>
<p>After a <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> requests a <a class="reference external" href="#getconnectiondbattrstag">tagged
connection</a>:</p>
<ul class="simple">
<li><p>When no <a class="reference external" href="#createpoolpoolattrssessioncallback"><code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code></a> is
in use, then <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> will contain the actual tag of the
connection.</p></li>
<li><p>When a Node.js <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> function is used, then
<code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> will be set to the value of the connection’s actual
tag prior to invoking the callback.  The callback can then set
connection state and alter <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code>, as desired, before the
connection is returned from <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code>.</p></li>
<li><p>When a PL/SQL <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> procedure is used, then after
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> returns, <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> contains a tag with
the same property values as the tag that was requested.  The
properties may be in a different order.  If <code class="docutils literal notranslate"><span class="pre">matchAnyTag</span></code> is <em>true</em>,
then <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> may contain other properties in addition to
the requested properties.  Code after each <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code>
call mirroring the PL/SQL code may be needed so <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> can
be set to a value representing the session state changed in the
PL/SQL procedure.</p></li>
</ul>
</div>
<div class="section" id="setting-the-tag">
<h5>Setting the tag<a class="headerlink" href="#setting-the-tag" title="Permalink to this headline">¶</a></h5>
<p>A tag can be set anytime prior to closing the connection.  If a
Node.js <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> function is being used, the best practice
recommendation is to set the tag in the callback function.</p>
<p>To clear a connection’s tag, set <code class="docutils literal notranslate"><span class="pre">connection.tag</span> <span class="pre">=</span> <span class="pre">&quot;&quot;</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="a-name-connectionmethods-a-4-2-connection-methods">
<h3><a name="connectionmethods"></a> 4.2 Connection Methods<a class="headerlink" href="#a-name-connectionmethods-a-4-2-connection-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-break-a-4-2-1-connection-break">
<h4><a name="break"></a> 4.2.1 <code class="docutils literal notranslate"><span class="pre">connection.break()</span></code><a class="headerlink" href="#a-name-break-a-4-2-1-connection-break" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id33">
<h5>Prototype<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">break</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="k">break</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id34">
<h5>Description<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h5>
<p>This call stops the currently running operation on the connection.</p>
<p>If there is no operation in progress or the operation has completed by
the time the break is issued, the <code class="docutils literal notranslate"><span class="pre">break()</span></code> is effectively a no-op.</p>
<p>If the running asynchronous operation is interrupted, its callback
will return an error.</p>
<p>In network configurations that drop (or in-line) out-of-band breaks,
<code class="docutils literal notranslate"><span class="pre">break()</span></code> may hang unless you have <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-42E939DC-EF37-49A0-B4F0-14158F0E55FD"><code class="docutils literal notranslate"><span class="pre">DISABLE_OOB=ON</span></code></a> in a
<code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> file, see <a class="reference external" href="#tnsadmin">Optional Oracle Net Configuration</a>.</p>
<p>If you use use <code class="docutils literal notranslate"><span class="pre">break()</span></code> with <a class="reference external" href="#drcp">DRCP connections</a>, it is
currently recommended to drop the connection when releasing it back to
the pool: <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">connection.close({drop:</span> <span class="pre">true})</span></code>.  See Oracle bug
29116892.</p>
</div>
<div class="section" id="id35">
<h5>Parameters<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">break()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-changepassword-a-4-2-2-connection-changepassword">
<h4><a name="changepassword"></a> 4.2.2 <code class="docutils literal notranslate"><span class="pre">connection.changePassword()</span></code><a class="headerlink" href="#a-name-changepassword-a-4-2-2-connection-changepassword" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id36">
<h5>Prototype<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">changePassword</span><span class="p">(</span><span class="n">String</span> <span class="n">user</span><span class="p">,</span> <span class="n">String</span> <span class="n">oldPassword</span><span class="p">,</span> <span class="n">String</span> <span class="n">newPassword</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">changePassword</span><span class="p">(</span><span class="n">String</span> <span class="n">user</span><span class="p">,</span> <span class="n">String</span> <span class="n">oldPassword</span><span class="p">,</span> <span class="n">String</span> <span class="n">newPassword</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id37">
<h5>Description<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h5>
<p>Changes the password of the specified user.</p>
<p>Only users with the ALTER USER privilege can change passwords of other
users.</p>
<p>See <a class="reference external" href="#changingpassword">Changing Passwords and Connecting with an Expired Password</a>.</p>
<p>This method was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="id38">
<h5>Parameters<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">user</span>
</pre></div>
</div>
<p>The name of the user whose password is to be changed.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">oldPassword</span>
</pre></div>
</div>
<p>The current password of the currently connected user.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">changePassword()</span></code> is being used by a DBA to change the password of
another user, the value of <code class="docutils literal notranslate"><span class="pre">oldPassword</span></code> is ignored and can be an
empty string.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">newPassword</span>
</pre></div>
</div>
<p>The new password of the user whose password is to be changed.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">changePassword()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-connectionclose-a-4-2-3-connection-close">
<h4><a name="connectionclose"></a> 4.2.3 <code class="docutils literal notranslate"><span class="pre">connection.close()</span></code><a class="headerlink" href="#a-name-connectionclose-a-4-2-3-connection-close" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id39">
<h5>Prototype<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">close</span><span class="p">([</span><span class="n">Object</span> <span class="n">options</span><span class="p">,</span> <span class="p">]</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">close</span><span class="p">([</span><span class="n">Object</span> <span class="n">options</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id40">
<h5>Description<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h5>
<p>Releases a connection.</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">close()</span></code> as soon as a connection is no longer required is
strongly encouraged for system efficiency.  Calling <code class="docutils literal notranslate"><span class="pre">close()</span></code> for
pooled connections is required to prevent the pool running out of
connections.</p>
<p>When a connection is released, any ongoing transaction on the
connection is rolled back.</p>
<p>If an error occurs on a pooled connection and that error is known to
make the connection unusable, then <code class="docutils literal notranslate"><span class="pre">close()</span></code> will drop that connection
from the connection pool so a future pooled <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> call
that grows the pool will create a new, valid connection.</p>
<p>This method was added to node-oracledb 1.9, replacing the equivalent
alias <code class="docutils literal notranslate"><span class="pre">connection.release()</span></code>.</p>
</div>
<div class="section" id="id41">
<h5>Parameters<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">options</span>
</pre></div>
</div>
<p>This parameter only affects pooled connections.</p>
<p>The only valid option attribute is <code class="docutils literal notranslate"><span class="pre">drop</span></code>.</p>
<p>For pooled connections, if <code class="docutils literal notranslate"><span class="pre">drop</span></code> is <em>false</em>, then the
connection is returned to the pool for reuse.  If <code class="docutils literal notranslate"><span class="pre">drop</span></code> is <em>true</em>,
the connection will be completely dropped from the connection pool, for example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">({</span><span class="nx">drop</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
</pre></div>
</div>
<p>The default is <em>false</em>.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">close()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-commit-a-4-2-4-connection-commit">
<h4><a name="commit"></a> 4.2.4 <code class="docutils literal notranslate"><span class="pre">connection.commit()</span></code><a class="headerlink" href="#a-name-commit-a-4-2-4-connection-commit" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id42">
<h5>Prototype<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">commit</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">commit</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id43">
<h5>Description<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h5>
<p>This call commits the current transaction in progress on the connection.</p>
</div>
<div class="section" id="id44">
<h5>Parameters<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">commit()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-connectioncreatelob-a-4-2-5-connection-createlob">
<h4><a name="connectioncreatelob"></a> 4.2.5 <code class="docutils literal notranslate"><span class="pre">connection.createLob()</span></code><a class="headerlink" href="#a-name-connectioncreatelob-a-4-2-5-connection-createlob" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id45">
<h5>Prototype<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">createLob</span><span class="p">(</span><span class="n">Number</span> <span class="nb">type</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Lob</span> <span class="n">lob</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">createLob</span><span class="p">(</span><span class="n">Number</span> <span class="nb">type</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id46">
<h5>Description<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h5>
<p>Creates a <a class="reference external" href="#lobclass">Lob</a> as an Oracle <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-8E91CBE9-6CE1-4482-A694-04444C22B288">temporary LOB</a>.  The LOB
is initially empty.  Data can be streamed to the LOB, which can then
be passed into PL/SQL blocks, or inserted into the database.</p>
<p>When no longer required, Lobs created with <code class="docutils literal notranslate"><span class="pre">createLob()</span></code> should be
closed with <a class="reference external" href="#lobclose"><code class="docutils literal notranslate"><span class="pre">lob.close()</span></code></a> because Oracle Database
resources are held open if temporary LOBs are not closed.</p>
<p>Open temporary LOB usage can be monitored using the view
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D3873ED4-5FAD-479F-85F9-EE56D4B18ED5"><code class="docutils literal notranslate"><span class="pre">V$TEMPORARY_LOBS</span></code></a>.</p>
<p>LOBs created with <code class="docutils literal notranslate"><span class="pre">createLob()</span></code> can be bound for IN, IN OUT and OUT
binds.</p>
<p>See <a class="reference external" href="#lobhandling">Working with CLOB and BLOB Data</a> and <a class="reference external" href="#lobbinds">LOB Bind Parameters</a> for more information.</p>
</div>
<div class="section" id="id47">
<h5>Parameters<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="nb">type</span>
</pre></div>
</div>
<p>One of the constants <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code></a>
or <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code></a>.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">createLob()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-execute-a-4-2-6-connection-execute">
<h4><a name="execute"></a> 4.2.6 <code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code><a class="headerlink" href="#a-name-execute-a-4-2-6-connection-execute" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id48">
<h5>Prototype<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execute</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">bindParams</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">]],</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">execute</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">bindParams</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">]]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id49">
<h5>Description<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h5>
<p>This call executes a single SQL or PL/SQL statement.
See <a class="reference external" href="#sqlexecution">SQL Execution</a> for examples.  Also
see <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> for an alternative way of executing
queries.</p>
<p>The statement to be executed may contain <a class="reference external" href="#inbind">IN binds</a>,
<a class="reference external" href="#outbind">OUT or IN OUT</a> bind values or variables, which are bound
using either an object or an array.</p>
<p>A callback function returns a <a class="reference external" href="#executecallback"><code class="docutils literal notranslate"><span class="pre">result</span></code></a> object,
containing any fetched rows, the values of any OUT and IN OUT bind
variables, and the number of rows affected by the execution of
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2E008D4A-F6FD-4F34-9071-7E10419CA24D">DML</a> statements.</p>
</div>
<div class="section" id="id50">
<h5>Parameters<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h5>
<p>Parameter | Description
———-|————
<a class="reference external" href="#executesqlparam"><code class="docutils literal notranslate"><span class="pre">String</span> <span class="pre">sql</span></code></a> | The SQL statement that is executed. The statement may contain bind parameters.
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">Object</span> <span class="pre">bindParams</span></code></a> | This function parameter is needed if there are bind parameters in the SQL statement.
<a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">Object</span> <span class="pre">options</span></code></a> | This is an optional parameter to <code class="docutils literal notranslate"><span class="pre">execute()</span></code> that may be used to control statement execution.
<a class="reference external" href="#executecallback"><code class="docutils literal notranslate"><span class="pre">function(Error</span> <span class="pre">error,</span> <span class="pre">Object</span> <span class="pre">result)</span></code></a> | Callback function with the execution results.</p>
<p>The parameters are discussed in the next sections.</p>
</div>
<div class="section" id="a-name-executesqlparam-a-4-2-6-1-execute-sql-statement">
<h5><a name="executesqlparam"></a> 4.2.6.1 <code class="docutils literal notranslate"><span class="pre">execute()</span></code>: SQL Statement<a class="headerlink" href="#a-name-executesqlparam-a-4-2-6-1-execute-sql-statement" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span>
</pre></div>
</div>
<p>The SQL or PL/SQL statement that <code class="docutils literal notranslate"><span class="pre">execute()</span></code> executes. The statement
may contain bind variables.</p>
</div>
<div class="section" id="a-name-executebindparams-a-4-2-6-2-execute-bind-parameters">
<h5><a name="executebindParams"></a> 4.2.6.2 <code class="docutils literal notranslate"><span class="pre">execute()</span></code>: Bind Parameters<a class="headerlink" href="#a-name-executebindparams-a-4-2-6-2-execute-bind-parameters" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">bindParams</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">execute()</span></code> function <code class="docutils literal notranslate"><span class="pre">bindParams</span></code> parameter is needed if there are
bind variables in the statement, or if <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">options</span></code></a>
are used.  It can be either an object that associates values or
JavaScript variables to the statement’s bind variables by name, or an
array of values or JavaScript variables that associate to the
statement’s bind variables by their relative positions.
See <a class="reference external" href="#bind">Bind Parameters for Prepared Statements</a> for more details
on binding.</p>
<p>If a bind value is an object it may have the following properties:</p>
<p>Bind Property | Description
—————|————
<code class="docutils literal notranslate"><span class="pre">dir</span></code> | The direction of the bind.  One of the <a class="reference external" href="#oracledbconstantsbinddir">Execute Bind Direction Constants</a> <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_IN</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_INOUT</span></code>, or <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_OUT</span></code>. The default is <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_IN</span></code>.
<code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code> | The number of array elements to be allocated for a PL/SQL Collection INDEX BY associative array OUT or IN OUT array bind variable.  For IN binds, the value of <code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code> is ignored.  See <a class="reference external" href="#plsqlindexbybinds">PL/SQL Collection Associative Arrays</a>.
<code class="docutils literal notranslate"><span class="pre">maxSize</span></code> | The maximum number of bytes that an OUT or IN OUT bind variable of type <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code> can use to get data. The default value is 200. The maximum limit depends on the database type, see below.  When binding IN OUT, then <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> refers to the size of the returned  value: the input value can be smaller or bigger.  For IN binds, <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> is ignored.
<code class="docutils literal notranslate"><span class="pre">type</span></code> | The node-oracledb or JavaScript data type or Oracle object type name to be bound.  Can be one of the <a class="reference external" href="#oracledbconstantsnodbtype">Node-oracledb Type Constants</a> <code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code>, or <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>.  It may also be the name of an Oracle Database object or collection, or a <a class="reference external" href="#dbobjectclass">DbObject Class</a>.  With IN or IN OUT binds the type can be explicitly set with <code class="docutils literal notranslate"><span class="pre">type</span></code> or it will default to the type of the input data value.  With OUT binds, the type defaults to <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> whenever <code class="docutils literal notranslate"><span class="pre">type</span></code> is not specified.
<code class="docutils literal notranslate"><span class="pre">val</span></code> | The input value or variable to be used for an IN or IN OUT bind variable.</p>
<p>The limit for <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> when binding as <code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code> is 2000
bytes, and as <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> is 4000 bytes unless you are using
Oracle Database 12 or later, and the database initialization parameter
<code class="docutils literal notranslate"><span class="pre">MAX_STRING_SIZE</span></code> has a value of <code class="docutils literal notranslate"><span class="pre">EXTENDED</span></code>.  In this case the limit
is 32767 bytes.</p>
<p>When binding Oracle LOBs as <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>,
the value of <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> can be much larger, see the limits
in <a class="reference external" href="#lobbinds">LOB Bind Parameters</a>.</p>
<p>When binding to get a UROWID value from the database, note that
UROWIDs can take up to 5267 bytes when fetched from the database so
<code class="docutils literal notranslate"><span class="pre">maxSize</span></code> should be set to at least this value.</p>
<p>Note <code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code> bind variables can be used only for PL/SQL OUT binds.</p>
</div>
<div class="section" id="a-name-executeoptions-a-4-2-6-3-execute-options">
<h5><a name="executeoptions"></a> 4.2.6.3 <code class="docutils literal notranslate"><span class="pre">execute()</span></code>: Options<a class="headerlink" href="#a-name-executeoptions-a-4-2-6-3-execute-options" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">options</span>
</pre></div>
</div>
<p>This is an optional parameter to <code class="docutils literal notranslate"><span class="pre">execute()</span></code> that may be used to
control statement execution.</p>
<p>If there are no bind variables in the SQL statement, then a null
<code class="docutils literal notranslate"><span class="pre">bindParams</span></code>, for example <code class="docutils literal notranslate"><span class="pre">{}</span></code>, must be specified before <code class="docutils literal notranslate"><span class="pre">options</span></code>
otherwise you will get an error like <em>ORA-01036: Illegal variable
name/number</em> or <em>NJS-012: encountered invalid bind data type in parameter</em>.</p>
<p>The following properties can be set or overridden for the execution of
a statement.</p>
<div class="section" id="a-name-propexecautocommit-a-4-2-6-3-1-autocommit">
<h6><a name="propexecautocommit"></a> 4.2.6.3.1 <code class="docutils literal notranslate"><span class="pre">autoCommit</span></code><a class="headerlink" href="#a-name-propexecautocommit-a-4-2-6-3-1-autocommit" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">autoCommit</span>
</pre></div>
</div>
<p>Overrides <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a>.</p>
</div>
<div class="section" id="a-name-propexecextendedmetadata-a-4-2-6-3-2-extendedmetadata">
<h6><a name="propexecextendedmetadata"></a> 4.2.6.3.2 <code class="docutils literal notranslate"><span class="pre">extendedMetaData</span></code><a class="headerlink" href="#a-name-propexecextendedmetadata-a-4-2-6-3-2-extendedmetadata" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">extendedMetaData</span>
</pre></div>
</div>
<p>Overrides <a class="reference external" href="#propdbextendedmetadata"><code class="docutils literal notranslate"><span class="pre">oracledb.extendedMetaData</span></code></a>.</p>
</div>
<div class="section" id="a-name-propexecfetcharraysize-a-4-2-6-3-3-fetcharraysize">
<h6><a name="propexecfetcharraysize"></a> 4.2.6.3.3 <code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code><a class="headerlink" href="#a-name-propexecfetcharraysize-a-4-2-6-3-3-fetcharraysize" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">fetchArraySize</span>
</pre></div>
</div>
<p>Overrides <a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code></a>.</p>
</div>
<div class="section" id="a-name-propfetchinfo-a-a-name-propexecfetchinfo-a-4-2-6-3-4-fetchinfo">
<h6><a name="propfetchinfo"></a> <a name="propexecfetchinfo"></a> 4.2.6.3.4 <code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code><a class="headerlink" href="#a-name-propfetchinfo-a-a-name-propexecfetchinfo-a-4-2-6-3-4-fetchinfo" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">fetchInfo</span>
</pre></div>
</div>
<p>Object defining how query column data should be represented in
JavaScript.  It can be used in conjunction with, or instead of, the
global settings <a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a>
and <a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a>.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fetchInfo</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;HIRE_DATE&quot;</span><span class="p">:</span>    <span class="p">{</span> <span class="nb">type</span><span class="p">:</span> <span class="n">oracledb</span><span class="o">.</span><span class="n">STRING</span> <span class="p">},</span>  <span class="o">//</span> <span class="k">return</span> <span class="n">the</span> <span class="n">date</span> <span class="k">as</span> <span class="n">a</span> <span class="n">string</span>
  <span class="s2">&quot;HIRE_DETAILS&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nb">type</span><span class="p">:</span> <span class="n">oracledb</span><span class="o">.</span><span class="n">DEFAULT</span> <span class="p">}</span>  <span class="o">//</span> <span class="n">override</span> <span class="n">fetchAsString</span> <span class="ow">or</span> <span class="n">fetchAsBuffer</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each column is specified by name, using Oracle’s standard naming
convention.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> property can be set to one of:</p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code></a> for number, date and
raw columns in a query to indicate they should be returned as
Strings instead of their native format.  CLOB column data can also
be returned as Strings instead of <a class="reference external" href="#lobclass">Lob</a> instances.</p>
<p>Raw columns returned as strings will be returned as hex-encoded
strings.  The maximum length of a string created by type mapping
number and date columns is 200 bytes.  If a database column that is
already being fetched as type <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> is specified in
<code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code>, then the actual database metadata will be used to
determine the maximum length.</p>
</li>
<li><p><a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code></a> for a BLOB column,
each BLOB item will be returned as a Buffer instead of a
<a class="reference external" href="#lobclass">Lob</a> instance.</p></li>
<li><p><a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.DEFAULT</span></code></a> overrides any
global mapping given by <a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a> or
<a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a>.  The column data is
returned in native format.</p></li>
</ul>
<p>Strings and Buffers created for LOB columns will generally be limited
by Node.js and V8 memory restrictions.</p>
<p>Columns fetched from REF CURSORS are not mapped by <code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code>
settings in the <code class="docutils literal notranslate"><span class="pre">execute()</span></code> call.  Use the
global <a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a>
or <a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a> settings instead.</p>
<p>See <a class="reference external" href="#typemap">Query Result Type Mapping</a> for more information on query type
mapping.</p>
</div>
<div class="section" id="a-name-propexecmaxrows-a-4-2-6-3-5-maxrows">
<h6><a name="propexecmaxrows"></a> 4.2.6.3.5 <code class="docutils literal notranslate"><span class="pre">maxRows</span></code><a class="headerlink" href="#a-name-propexecmaxrows-a-4-2-6-3-5-maxrows" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">maxRows</span>
</pre></div>
</div>
<p>Overrides <a class="reference external" href="#propdbmaxrows"><code class="docutils literal notranslate"><span class="pre">oracledb.maxRows</span></code></a>.</p>
</div>
<div class="section" id="a-name-propexecoutformat-a-4-2-6-3-6-outformat">
<h6><a name="propexecoutformat"></a> 4.2.6.3.6 <code class="docutils literal notranslate"><span class="pre">outFormat</span></code><a class="headerlink" href="#a-name-propexecoutformat-a-4-2-6-3-6-outformat" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">outFormat</span>
</pre></div>
</div>
<p>Overrides <a class="reference external" href="#propdboutformat"><code class="docutils literal notranslate"><span class="pre">oracledb.outFormat</span></code></a>.</p>
</div>
<div class="section" id="a-name-propexecprefetchrows-a-4-2-6-3-7-prefetchrows">
<h6><a name="propexecprefetchrows"></a> 4.2.6.3.7 <code class="docutils literal notranslate"><span class="pre">prefetchRows</span></code><a class="headerlink" href="#a-name-propexecprefetchrows-a-4-2-6-3-7-prefetchrows" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">prefetchRows</span>
</pre></div>
</div>
<p>This attribute is no longer supported in node-oracledb version 2 and
has no effect on applications.  Use
<a class="reference external" href="#propexecfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a> instead.</p>
</div>
<div class="section" id="a-name-propexecresultset-a-4-2-6-3-8-resultset">
<h6><a name="propexecresultset"></a> 4.2.6.3.8 <code class="docutils literal notranslate"><span class="pre">resultSet</span></code><a class="headerlink" href="#a-name-propexecresultset-a-4-2-6-3-8-resultset" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">resultSet</span>
</pre></div>
</div>
<p>Determines whether query results and <a class="reference external" href="#implicitresults">Implicit
Results</a> should be returned as a
<a class="reference external" href="#resultsetclass">ResultSet</a> object or directly.  The default is
<em>false</em>.</p>
</div>
</div>
<div class="section" id="a-name-executecallback-a-4-2-6-4-execute-callback-function">
<h5><a name="executecallback"></a> 4.2.6.4 <code class="docutils literal notranslate"><span class="pre">execute()</span></code>: Callback Function<a class="headerlink" href="#a-name-executecallback-a-4-2-6-4-execute-callback-function" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the <code class="docutils literal notranslate"><span class="pre">execute()</span></code> callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">execute()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>Object result</em> | The <a class="reference external" href="#resultobject"><code class="docutils literal notranslate"><span class="pre">result</span></code></a> object, described below.  The <code class="docutils literal notranslate"><span class="pre">result</span></code> parameter can be omitted for <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-FD9A8CB4-6B9A-44E5-B114-EFB8DA76FC88">DDL</a> and <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2E008D4A-F6FD-4F34-9071-7E10419CA24D">DML</a> statements where the application only checks <code class="docutils literal notranslate"><span class="pre">error</span></code> for success or failure.</p>
</div>
<div class="section" id="a-name-resultobject-a-result-object-properties">
<h5><a name="resultobject"></a> Result Object Properties<a class="headerlink" href="#a-name-resultobject-a-result-object-properties" title="Permalink to this headline">¶</a></h5>
<p>The properties of <code class="docutils literal notranslate"><span class="pre">result</span></code> object from the <code class="docutils literal notranslate"><span class="pre">execute()</span></code> callback are described below.</p>
<div class="section" id="a-name-execimplicitresults-a-4-2-6-4-1-implicitresults">
<h6><a name="execimplicitresults"></a> 4.2.6.4.1 <code class="docutils literal notranslate"><span class="pre">implicitResults</span></code><a class="headerlink" href="#a-name-execimplicitresults-a-4-2-6-4-1-implicitresults" title="Permalink to this headline">¶</a></h6>
<p>This property will be defined if the executed statement returned
Implicit Results.  Depending on the value of
<a class="reference external" href="#propexecresultset"><code class="docutils literal notranslate"><span class="pre">resultSet</span></code></a> it will either be an array, each
element containing an array of rows from one query, or an array of
<a class="reference external" href="#resultsethandling">ResultSets</a> each corresponding to a query.</p>
<p>See <a class="reference external" href="#implicitresults">Implicit Results</a> for examples.</p>
<p>This property was added in node-oracledb 4.0. Implicit Results
requires Oracle Database 12.1 or later, and Oracle Client 12.1 or
later.</p>
</div>
<div class="section" id="a-name-execmetadata-a-4-2-6-4-2-metadata">
<h6><a name="execmetadata"></a> 4.2.6.4.2 <code class="docutils literal notranslate"><span class="pre">metaData</span></code><a class="headerlink" href="#a-name-execmetadata-a-4-2-6-4-2-metadata" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Array</span> <span class="n">metaData</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statements, this contains an array of objects describing
details of columns for the select list.  For non queries, this property is undefined.</p>
<p>Each column’s <code class="docutils literal notranslate"><span class="pre">name</span></code> is always given.  If the
<a class="reference external" href="#propdbextendedmetadata"><code class="docutils literal notranslate"><span class="pre">oracledb.extendedMetaData</span></code></a> or <code class="docutils literal notranslate"><span class="pre">execute()</span></code> option
<a class="reference external" href="#propexecextendedmetadata"><code class="docutils literal notranslate"><span class="pre">extendedMetaData</span></code></a> are <em>true</em> then
additional information is included.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">byteSize</span></code>: the database byte size.  This is only set for <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_VARCHAR</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_CHAR</span></code> and <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_RAW</span></code> column types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dbType</span></code>: one of the <a class="reference external" href="#oracledbconstantsdbtype">Oracle Database Type Constant</a> values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dbTypeClass</span></code>: the class associated with the database type.  This is only set if the database type is an object type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dbTypeName</span></code>: the name of the database type, such as “NUMBER” or “VARCHAR2”.  For object types, this will be the object name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fetchType</span></code>: one of the <a class="reference external" href="#oracledbconstantsnodbtype">Node-oracledb Type Constant</a> values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: The column name follows Oracle’s standard name-casing rules.  It will commonly be uppercase, since most applications create tables using unquoted, case-insensitive names.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nullable</span></code>: indicates whether <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values are permitted for this column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">precision</span></code>: set only for <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_NUMBER</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_TIMESTAMP</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_TIMESTAMP_TZ</span></code> and <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_TIMESTAMP_LTZ</span></code> columns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale</span></code>: set only for <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_NUMBER</span></code> columns.</p></li>
</ul>
<p>For numeric columns: when <code class="docutils literal notranslate"><span class="pre">precision</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code>, then the column is
simply a NUMBER.  If <code class="docutils literal notranslate"><span class="pre">precision</span></code> is nonzero and <code class="docutils literal notranslate"><span class="pre">scale</span></code> is <code class="docutils literal notranslate"><span class="pre">-127</span></code>,
then the column is a FLOAT.  Otherwise, it is a NUMBER(precision,
scale).</p>
<p>Metadata for ResultSets and REF CURSORS is available in a
<a class="reference external" href="#rsmetadata">ResultSet property</a>.  For Lobs, a
<a class="reference external" href="#proplobtype">Lob type property</a> also indicates whether the object is
a BLOB or CLOB.</p>
<p>To get query metadata without fetching rows, use a
<a class="reference external" href="#resultsetclass">ResultSet</a>.  Access
<a class="reference external" href="#rsmetadata"><code class="docutils literal notranslate"><span class="pre">resultset.metaData</span></code></a> and then close the ResultSet.  Do
not call <code class="docutils literal notranslate"><span class="pre">getRow()</span></code> or <code class="docutils literal notranslate"><span class="pre">getRows()</span></code>.  Preferably use a query clause
such as <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">1</span> <span class="pre">=</span> <span class="pre">0</span></code> so the database does minimal work.</p>
<p>See <a class="reference external" href="#querymeta">Query Column Metadata</a> for examples.</p>
</div>
<div class="section" id="a-name-execoutbinds-a-4-2-6-4-3-outbinds">
<h6><a name="execoutbinds"></a> 4.2.6.4.3 <code class="docutils literal notranslate"><span class="pre">outBinds</span></code><a class="headerlink" href="#a-name-execoutbinds-a-4-2-6-4-3-outbinds" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span><span class="o">/</span><span class="nb">object</span> <span class="n">outBinds</span>
</pre></div>
</div>
<p>This contains the output values of OUT and IN OUT binds.
If <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">bindParams</span></code></a> is passed as an array, then
<code class="docutils literal notranslate"><span class="pre">outBinds</span></code> is returned as an array.  If <code class="docutils literal notranslate"><span class="pre">bindParams</span></code> is passed as an
object, then <code class="docutils literal notranslate"><span class="pre">outBinds</span></code> is returned as an object. If there are no OUT
or IN OUT binds, the value is undefined.</p>
</div>
<div class="section" id="a-name-execresultset-a-4-2-6-4-4-resultset">
<h6><a name="execresultset"></a> 4.2.6.4.4 <code class="docutils literal notranslate"><span class="pre">resultSet</span></code><a class="headerlink" href="#a-name-execresultset-a-4-2-6-4-4-resultset" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">resultSet</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statements when the <a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">resultSet</span></code></a> option
is <em>true</em>, use the <code class="docutils literal notranslate"><span class="pre">resultSet</span></code> object to fetch rows.
See <a class="reference external" href="#resultsetclass">ResultSet Class</a>
and <a class="reference external" href="#resultsethandling">Fetching Rows with Result Sets</a>.</p>
<p>When using this option, <a class="reference external" href="#close"><code class="docutils literal notranslate"><span class="pre">resultSet.close()</span></code></a> must be called
when the ResultSet is no longer needed.  This is true whether or not
rows have been fetched from the ResultSet.</p>
</div>
<div class="section" id="a-name-execrows-a-4-2-6-4-5-rows">
<h6><a name="execrows"></a> 4.2.6.4.5 <code class="docutils literal notranslate"><span class="pre">rows</span></code><a class="headerlink" href="#a-name-execrows-a-4-2-6-4-5-rows" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span> <span class="n">rows</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statements using <a class="reference external" href="#fetchingrows">direct fetches</a>, <code class="docutils literal notranslate"><span class="pre">rows</span></code>
contains an array of fetched rows.  It will be NULL if there is an
error or the SQL statement was not a SELECT statement.  By default,
the rows are in an array of column value arrays, but this can be
changed to arrays of objects by setting
<a class="reference external" href="#propdboutformat"><code class="docutils literal notranslate"><span class="pre">outFormat</span></code></a> to <code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_OBJECT</span></code>.  If a single
row is fetched, then <code class="docutils literal notranslate"><span class="pre">rows</span></code> is an array that contains one single row.</p>
<p>The number of rows returned is limited by
<a class="reference external" href="#propdbmaxrows"><code class="docutils literal notranslate"><span class="pre">oracledb.maxRows</span></code></a> or the
<a class="reference external" href="#propexecmaxrows"><code class="docutils literal notranslate"><span class="pre">maxRows</span></code></a> option in an <code class="docutils literal notranslate"><span class="pre">execute()</span></code> call.  If
<code class="docutils literal notranslate"><span class="pre">maxRows</span></code> is 0, then the number of rows is limited by Node.js memory
constraints.</p>
</div>
<div class="section" id="a-name-execrowsaffected-a-4-2-6-4-6-rowsaffected">
<h6><a name="execrowsaffected"></a> 4.2.6.4.6 <code class="docutils literal notranslate"><span class="pre">rowsAffected</span></code><a class="headerlink" href="#a-name-execrowsaffected-a-4-2-6-4-6-rowsaffected" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">rowsAffected</span>
</pre></div>
</div>
<p>For <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2E008D4A-F6FD-4F34-9071-7E10419CA24D">DML</a> statements (including SELECT FOR UPDATE) this contains
the number of rows affected, for example the number of rows
inserted. For non-DML statements such as queries and PL/SQL statements,
<code class="docutils literal notranslate"><span class="pre">rowsAffected</span></code> is undefined.</p>
</div>
</div>
</div>
<div class="section" id="a-name-executemany-a-4-2-7-connection-executemany">
<h4><a name="executemany"></a> 4.2.7 <code class="docutils literal notranslate"><span class="pre">connection.executeMany()</span></code><a class="headerlink" href="#a-name-executemany-a-4-2-7-connection-executemany" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id51">
<h5>Prototype<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">executeMany</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span><span class="p">,</span> <span class="n">Array</span> <span class="n">binds</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">],</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span> <span class="p">{});</span>
<span class="n">executeMany</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span><span class="p">,</span> <span class="n">Number</span> <span class="n">numIterations</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">],</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span> <span class="p">{});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">executeMany</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span><span class="p">,</span> <span class="n">Array</span> <span class="n">binds</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">]);</span>
<span class="n">promise</span> <span class="o">=</span> <span class="n">executeMany</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span><span class="p">,</span> <span class="n">Number</span> <span class="n">numIterations</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id52">
<h5>Description<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h5>
<p>This method allows sets of data values to be bound to one DML or
PL/SQL statement for execution.  It is like calling
<a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code></a> multiple times but requires fewer
<a class="reference external" href="#roundtrips">round-trips</a>.  This is an efficient way to handle batch
changes, for example when inserting or updating multiple rows.  The
method cannot be used for queries.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> method supports IN, IN OUT and OUT binds for most
data types except <a class="reference external" href="#plsqlindexbybinds">PL/SQL Collection Associative
Arrays</a>.</p>
<p>The version of this function which accepts a number of iterations should be
used when no bind parameters are required or when all bind parameters are OUT
binds.</p>
<p>See <a class="reference external" href="#batchexecution">Batch Statement Execution and Bulk Loading</a> for more
information.</p>
<p>This method was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="a-name-executemanysqlparam-a-4-2-7-1-executemany-sql-statement">
<h5><a name="executemanysqlparam"></a> 4.2.7.1 <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code>: SQL Statement<a class="headerlink" href="#a-name-executemanysqlparam-a-4-2-7-1-executemany-sql-statement" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span>
</pre></div>
</div>
<p>The SQL or PL/SQL statement that <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> executes.  The
statement should contain bind variable names.</p>
</div>
<div class="section" id="a-name-executemanybinds-a-4-2-7-2-executemany-binds">
<h5><a name="executemanybinds"></a> 4.2.7.2 <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code>: Binds<a class="headerlink" href="#a-name-executemanybinds-a-4-2-7-2-executemany-binds" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">binds</span></code> parameter contains the values or variables to be bound to
the executed statement.  It must be an array of arrays (for ‘bind by
position’) or an array of objects whose keys match the bind variable
names in the SQL statement (for ‘bind by name’).  Each sub-array or
sub-object should contain values for the bind variables used in the
SQL statement.  At least one such record must be specified.</p>
<p>If a record contains fewer values than expected, NULL values will be
used.  For bind by position, empty values can be specified using
syntax like <code class="docutils literal notranslate"><span class="pre">[a,,c,d]</span></code>.</p>
<p>By default, the direction of binds is <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_IN</span></code>.  The first
data record determines the number of bind variables, each bind
variable’s data type, and its name (when binding by name).  If a
variable in the first record contains a null, this value is ignored
and a subsequent record is used to determine that variable’s
characteristics.  If all values in all records for a particular bind
variable are null, the type of that bind is <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> with a
maximum size of 1.</p>
<p>The maximum sizes of strings and buffers are determined by scanning
all records in the bind data.</p>
<p>If a <a class="reference external" href="#executemanyoptbinddefs"><code class="docutils literal notranslate"><span class="pre">bindDefs</span></code></a> property is used, no data
scanning occurs.  This property explicitly specifies the
characteristics of each bind variable.</p>
</div>
<div class="section" id="a-name-executemanyoptions-a-4-2-7-3-executemany-options">
<h5><a name="executemanyoptions"></a> 4.2.7.3 <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code>: Options<a class="headerlink" href="#a-name-executemanyoptions-a-4-2-7-3-executemany-options" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">options</span></code> parameter is optional.  It can contain the following
properties.</p>
<div class="section" id="a-name-executemanyoptautocommit-a-4-2-7-3-1-autocommit">
<h6><a name="executemanyoptautocommit"></a> 4.2.7.3.1 <code class="docutils literal notranslate"><span class="pre">autoCommit</span></code><a class="headerlink" href="#a-name-executemanyoptautocommit-a-4-2-7-3-1-autocommit" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">autoCommit</span>
</pre></div>
</div>
<p>This optional property overrides
<a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a>.</p>
<p>Note <a class="reference external" href="#executemanyoptbatcherrors"><code class="docutils literal notranslate"><span class="pre">batchErrors</span></code></a> can affect autocommit
mode.</p>
</div>
<div class="section" id="a-name-executemanyoptbatcherrors-a-4-2-7-3-2-batcherrors">
<h6><a name="executemanyoptbatcherrors"></a> 4.2.7.3.2 <code class="docutils literal notranslate"><span class="pre">batchErrors</span></code><a class="headerlink" href="#a-name-executemanyoptbatcherrors-a-4-2-7-3-2-batcherrors" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">batchErrors</span>
</pre></div>
</div>
<p>This optional property allows invalid data records to be rejected
while still letting valid data be processed.  It can only be set
<em>true</em> for INSERT, UPDATE, DELETE or MERGE statements.</p>
<p>When <em>false</em>, the <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> call will stop when the first error
occurs.  The callback <a class="reference external" href="#errorobj">error object</a> will be set.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">batchErrors</span></code> is <em>true</em>, processing will continue even if there
are data errors.  The <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> callback error parameter is not
set.  Instead, an array containing an error per input data record will
be returned in the callback <code class="docutils literal notranslate"><span class="pre">result</span></code> parameter.  All valid data
records will be processed and a transaction will be started but not
committed, even if <code class="docutils literal notranslate"><span class="pre">autoCommit</span></code> is <em>true</em>.  The application can
examine the errors, take action, and explicitly commit or rollback as
desired.</p>
<p>Note that some classes of error will always return via the
<code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> callback error object, not as batch errors.  No
transaction is created in this case.</p>
<p>The default value is <em>false</em>.</p>
</div>
<div class="section" id="a-name-executemanyoptbinddefs-a-4-2-7-3-3-binddefs">
<h6><a name="executemanyoptbinddefs"></a> 4.2.7.3.3 <code class="docutils literal notranslate"><span class="pre">bindDefs</span></code><a class="headerlink" href="#a-name-executemanyoptbinddefs-a-4-2-7-3-3-binddefs" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">bindDefs</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">bindDefs</span></code> object defines the bind variable types, sizes and
directions.  This object is optional in some cases but it is more
efficient to set it.</p>
<p>It should be an array or an object, depending on the structure of the
<a class="reference external" href="#executemanybinds"><code class="docutils literal notranslate"><span class="pre">binds</span> <span class="pre">parameter</span></code></a>.</p>
<p>Each value in the <code class="docutils literal notranslate"><span class="pre">bindDefs</span></code> array or object should be an object
containing the keys <code class="docutils literal notranslate"><span class="pre">dir</span></code>, <code class="docutils literal notranslate"><span class="pre">maxSize</span></code>, and <code class="docutils literal notranslate"><span class="pre">type</span></code> for each bind
variable, similar to how <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">execute()</span> <span class="pre">bind</span> <span class="pre">parameters</span></code></a> are identified.</p>
<p>BindDef Property | Description
—————|————
<code class="docutils literal notranslate"><span class="pre">dir</span></code> | The direction of the bind.  One of the <a class="reference external" href="#oracledbconstantsbinddir">Execute Bind Direction Constants</a> <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_IN</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_INOUT</span></code>  or <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_OUT</span></code>.  The default is <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_IN</span></code>.
<code class="docutils literal notranslate"><span class="pre">maxSize</span></code> | Required for Strings and Buffers.  Ignored for other types.  Specifies the maximum number of bytes allocated when processing each value of this bind variable.  When data is being passed into the database, <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> should be at least the size of the longest value.  When data is being returned from the database, <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> should be the size of the longest value.  If <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> is too small, <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> will throw an error that is not handled by <a class="reference external" href="#executemanyoptbatcherrors"><code class="docutils literal notranslate"><span class="pre">batchErrors</span></code></a>.
<code class="docutils literal notranslate"><span class="pre">type</span></code> | The node-oracledb or JavaScript data type to be bound.  One of the <a class="reference external" href="#oracledbconstantsnodbtype">Node-oracledb Type Constants</a> <code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code>, or <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>.</p>
</div>
<div class="section" id="a-name-executemanyoptdmlrowcounts-a-4-2-7-3-4-dmlrowcounts">
<h6><a name="executemanyoptdmlrowcounts"></a> 4.2.7.3.4 <code class="docutils literal notranslate"><span class="pre">dmlRowCounts</span></code><a class="headerlink" href="#a-name-executemanyoptdmlrowcounts-a-4-2-7-3-4-dmlrowcounts" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">dmlRowCounts</span>
</pre></div>
</div>
<p>When <em>true</em>, this optional property enables output of the number of
rows affected by each input data record.  It can only be set <em>true</em>
for INSERT, UPDATE, DELETE or MERGE statements.</p>
<p>The default value is <em>false</em>.</p>
<p>This feature works when node-oracledb is using version 12, or later,
of the Oracle client library.</p>
</div>
</div>
<div class="section" id="a-name-executemanycallback-a-4-2-7-4-executemany-callback-function">
<h5><a name="executemanycallback"></a> 4.2.7.4 <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code>: Callback Function<a class="headerlink" href="#a-name-executemanycallback-a-4-2-7-4-executemany-callback-function" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs,
then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> object may contain:</p>
<div class="section" id="a-name-execmanybatcherrors-a-4-2-7-4-1-result-batcherrors">
<h6><a name="execmanybatcherrors"></a> 4.2.7.4.1 <code class="docutils literal notranslate"><span class="pre">result.batchErrors</span></code><a class="headerlink" href="#a-name-execmanybatcherrors-a-4-2-7-4-1-result-batcherrors" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span> <span class="n">batchErrors</span>
</pre></div>
</div>
<p>This property is an array of <a class="reference external" href="#errorobj">error objects</a> that were
reported during execution.  The <code class="docutils literal notranslate"><span class="pre">offset</span></code> property of each error object
corresponds to the 0-based index of the <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> <a class="reference external" href="#executemanybinds">binds
parameter</a> array, indicating which record could not
be processed.</p>
<p>It will be present only if <a class="reference external" href="#executemanyoptbatcherrors"><code class="docutils literal notranslate"><span class="pre">batchErrors</span></code></a>
was <em>true</em> in the <a class="reference external" href="#executemanyoptions"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> options</a>
parameter and there are data errors to report.  Some classes of
execution error will always return via the <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> callback
error object, not in <code class="docutils literal notranslate"><span class="pre">batchErrors</span></code>.</p>
</div>
<div class="section" id="a-name-execmanydmlrowscounts-a-4-2-7-4-2-result-dmlrowcounts">
<h6><a name="execmanydmlrowscounts"></a> 4.2.7.4.2 <code class="docutils literal notranslate"><span class="pre">result.dmlRowCounts</span></code><a class="headerlink" href="#a-name-execmanydmlrowscounts-a-4-2-7-4-2-result-dmlrowcounts" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span> <span class="n">dmlRowCounts</span>
</pre></div>
</div>
<p>This is an array of integers identifying the number of rows affected
by each record of the <a class="reference external" href="#executemanybinds">binds parameter</a>. It is
present only if <a class="reference external" href="#executemanyoptdmlrowcounts"><code class="docutils literal notranslate"><span class="pre">dmlRowCounts</span></code></a> was
<em>true</em> in the <a class="reference external" href="#executemanyoptions"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> options</a> parameter
and a DML statement was executed.</p>
</div>
<div class="section" id="a-name-execmanyoutbinds-a-4-2-7-4-3-result-outbinds">
<h6><a name="execmanyoutbinds"></a> 4.2.7.4.3 <code class="docutils literal notranslate"><span class="pre">result.outBinds</span></code><a class="headerlink" href="#a-name-execmanyoutbinds-a-4-2-7-4-3-result-outbinds" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">outBinds</span>
</pre></div>
</div>
<p>This contains the value of any returned IN OUT or OUT binds.  It is an
array of arrays, or an array of objects, depending on the <a class="reference external" href="#executemanybinds"><code class="docutils literal notranslate"><span class="pre">binds</span> <span class="pre">parameters</span></code></a> structure.  The length of the array
will correspond to the length of the array passed as the <a class="reference external" href="#executemanybinds">binds
parameter</a>.  It will be present only if there is at
least one OUT bind variable identified.</p>
</div>
<div class="section" id="a-name-execmanyrowsaffected-a-4-2-7-4-4-result-rowsaffected">
<h6><a name="execmanyrowsaffected"></a> 4.2.7.4.4 <code class="docutils literal notranslate"><span class="pre">result.rowsAffected</span></code><a class="headerlink" href="#a-name-execmanyrowsaffected-a-4-2-7-4-4-result-rowsaffected" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">rowsAffected</span>
</pre></div>
</div>
<p>This is an integer identifying the total number of database rows
affected by the processing of all records of the <a class="reference external" href="#executemanybinds">binds
parameter</a>.  It is only present if a DML statement
was executed.</p>
</div>
</div>
</div>
<div class="section" id="a-name-getdbobjectclass-a-4-2-8-connection-getdbobjectclass">
<h4><a name="getdbobjectclass"></a> 4.2.8 <code class="docutils literal notranslate"><span class="pre">connection.getDbObjectClass()</span></code><a class="headerlink" href="#a-name-getdbobjectclass-a-4-2-8-connection-getdbobjectclass" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getDbObjectClass</span><span class="p">(</span><span class="n">String</span> <span class="n">className</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">DbObject</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{})</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getDbObjectClass</span><span class="p">(</span><span class="n">String</span> <span class="n">className</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id53">
<h5>Description<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h5>
<p>Returns a <a class="reference external" href="#dbobjectclass">DbObject</a> prototype object representing the
named Oracle Database object or collection.</p>
<p>When the definition of a type changes in the database, such as might
occur in a development environment, you should fully close connections
to clear the object caches used by node-oracledb and the Oracle client
libraries.  For example, when using a pool you could use <a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">connection.close({drop:</span> <span class="pre">true})</span></code></a>, or restart the
pool.  Then <code class="docutils literal notranslate"><span class="pre">getDbObjectClass()</span></code> can be called again to get the
updated type information.</p>
<p>See <a class="reference external" href="#objects">Oracle Database Objects and Collections</a>.</p>
<p>This method was added in node-oracledb 4.0.</p>
</div>
<div class="section" id="id54">
<h5>Parameters<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">className</span>
</pre></div>
</div>
<p>The name of the Oracle object or collection.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">DbObject</span> <span class="n">obj</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getDbObjectClass()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>DbObject obj</em> | A <a class="reference external" href="#dbobjectclass">DbObject</a> representing an Oracle Database object or collection.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-getqueue-a-4-2-9-connection-getqueue">
<h4><a name="getQueue"></a> 4.2.9 <code class="docutils literal notranslate"><span class="pre">connection.getQueue()</span></code><a class="headerlink" href="#a-name-getqueue-a-4-2-9-connection-getqueue" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id55">
<h5>Prototype<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getQueue</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="n">Object</span> <span class="n">options</span><span class="p">,]</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">AqQueue</span> <span class="n">queue</span><span class="p">){})</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getQueue</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="return-value">
<h5>Return Value<a class="headerlink" href="#return-value" title="Permalink to this headline">¶</a></h5>
<p>This method returns an <a class="reference external" href="#aqqueueclass">AqQueue Class</a> object.</p>
</div>
<div class="section" id="id56">
<h5>Description<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h5>
<p>This method returns a queue for enqueuing and dequeuing
<a class="reference external" href="#aq">Oracle Advanced Queuing (AQ)</a> messages.</p>
</div>
<div class="section" id="id57">
<h5>Parameters<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">name</span>
</pre></div>
</div>
<p>The name of the Advanced Queue to use.  This queue should have
been created previously, for example with the
<code class="docutils literal notranslate"><span class="pre">DBMS_AQADM.CREATE_QUEUE()</span></code> function.</p>
<p>If the Advanced Queue does not exist in the database, an error will
occur when the queue is attempted to be used.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">options</span>
</pre></div>
</div>
<p>This optional argument can be used to specify the payload type.
It is an object with the following attributes:</p>
<p>Attribute Name | Description
—————|————-
<code class="docutils literal notranslate"><span class="pre">payloadType</span></code>  | A string containing the name of an Oracle Database object type, or a <a class="reference external" href="#dbobjectclass">DbObject Class</a> earlier acquired from <a class="reference external" href="#getdbobjectclass"><code class="docutils literal notranslate"><span class="pre">connection.getDbObjectClass()</span></code></a>.  If the name of an object type is used, it is recommended that a fully qualified name be used.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">AqQueue</span> <span class="n">queue</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">queue()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-getsodadatabase-a-4-2-10-connection-getsodadatabase">
<h4><a name="getsodadatabase"></a> 4.2.10 <code class="docutils literal notranslate"><span class="pre">connection.getSodaDatabase()</span></code><a class="headerlink" href="#a-name-getsodadatabase-a-4-2-10-connection-getsodadatabase" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id58">
<h5>Prototype<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getSodaDatabase</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id59">
<h5>Return Value<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h5>
<p>This synchronous method returns a <a class="reference external" href="#sodadatabaseclass">SodaDatabase</a>.</p>
</div>
<div class="section" id="id60">
<h5>Description<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h5>
<p>Returns a parent SodaDatabase object for use with Simple Oracle
Document Access (SODA).</p>
<p>SODA can be used with Oracle Database 18.3 and above, when node-oracledb uses
Oracle Client 18.5 or Oracle Client 19.3, or later.  The SODA bulk insert methods
<a class="reference external" href="#sodacollinsertmany"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertMany()</span></code></a> and
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a>
are in Preview status.</p>
<p>See <a class="reference external" href="#sodaoverview">Simple Oracle Document Access (SODA)</a> for more
information about using SODA in node-oracledb.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
</div>
<div class="section" id="a-name-getstmtinfo-a-4-2-11-connection-getstatementinfo">
<h4><a name="getstmtinfo"></a> 4.2.11 <code class="docutils literal notranslate"><span class="pre">connection.getStatementInfo()</span></code><a class="headerlink" href="#a-name-getstmtinfo-a-4-2-11-connection-getstatementinfo" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id61">
<h5>Prototype<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getStatementInfo</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">information</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getStatementInfo</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id62">
<h5>Description<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h5>
<p>Parses a SQL statement and returns information about it.  This is most
useful for finding column names of queries, and for finding the names
of bind variables used.</p>
<p>This method performs a <a class="reference external" href="#roundtrips">round-trip</a> to the database, so
unnecessary calls should be avoided.</p>
<p>The information is provided by lower level APIs that have some
limitations.  Some uncommon statements will return the statement type
as <code class="docutils literal notranslate"><span class="pre">oracledb.STMT_TYPE_UNKNOWN</span></code>.  DDL statements are not parsed, so
syntax errors in them will not be reported.  The direction and types
of bind variables cannot be determined.</p>
<p>This method was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="id63">
<h5>Parameters<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span>
</pre></div>
</div>
<p>The SQL statement to parse.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">information</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getStatementInfo()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>Object information</em> | The <code class="docutils literal notranslate"><span class="pre">information</span></code> object, described below.</p>
<p>Depending on the statement type, the <code class="docutils literal notranslate"><span class="pre">information</span></code> object may contain:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bindNames</span></code>: an array of strings corresponding to the unique names
of the bind variables used in the SQL statement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metaData</span></code>: containing properties equivalent to those given by
<code class="docutils literal notranslate"><span class="pre">execute()</span></code> <a class="reference external" href="#execmetadata">extendedMetaData</a>.  This property exists
only for queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">statementType</span></code>: an integer corresponding to one of the <a class="reference external" href="#oracledbconstantsstmttype">SQL
Statement Type Constants</a>.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-connectionping-a-4-2-12-connection-ping">
<h4><a name="connectionping"></a> 4.2.12 <code class="docutils literal notranslate"><span class="pre">connection.ping()</span></code><a class="headerlink" href="#a-name-connectionping-a-4-2-12-connection-ping" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id64">
<h5>Prototype<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">ping</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id65">
<h5>Description<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h5>
<p>This method checks that a connection is currently usable and the
network to the database is valid.  This call can be useful for system
health checks.  A ping only confirms that a single connection is
usable at the time of the ping.</p>
<p>Pinging does not replace error checking during statement execution,
since network or database failure may occur in the interval between
<code class="docutils literal notranslate"><span class="pre">ping()</span></code> and <code class="docutils literal notranslate"><span class="pre">execute()</span></code> calls.</p>
<p>Pinging requires a <a class="reference external" href="#roundtrips">round-trip</a> to the database so unnecessary
ping calls should be avoided.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">ping()</span></code> returns an error, the application should close the
connection.</p>
<p>This method was added in node-oracledb 2.2.</p>
</div>
<div class="section" id="id66">
<h5>Parameters<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">ping()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-querystream-a-4-2-13-connection-querystream">
<h4><a name="querystream"></a> 4.2.13 <code class="docutils literal notranslate"><span class="pre">connection.queryStream()</span></code><a class="headerlink" href="#a-name-querystream-a-4-2-13-connection-querystream" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id67">
<h5>Prototype<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">queryStream</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">bindParams</span><span class="p">,</span> <span class="p">[</span><span class="n">Object</span> <span class="n">options</span><span class="p">]]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id68">
<h5>Return Value<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h5>
<p>This method will return a <a class="reference external" href="https://nodejs.org/api/stream.html">Readable Stream</a> for queries.</p>
</div>
<div class="section" id="id69">
<h5>Description<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h5>
<p>This function provides query streaming support.  The parameters are
the same as <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> except a callback is not used.
Instead this function returns a stream used to fetch data.</p>
<p>Each row is returned as a <code class="docutils literal notranslate"><span class="pre">data</span></code> event.  Query metadata is available
via a <code class="docutils literal notranslate"><span class="pre">metadata</span></code> event.  The <code class="docutils literal notranslate"><span class="pre">end</span></code> event indicates the end of the
query results.</p>
<p>The connection must remain open until the stream is completely read.</p>
<p>For tuning, adjust the value of
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code></a> or the
option <a class="reference external" href="#propexecfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a> (see <code class="docutils literal notranslate"><span class="pre">execute()</span></code>).</p>
<p>See <a class="reference external" href="#streamingresults">Query Streaming</a> for more information.</p>
<p>Support for Node.js version 8 Stream <code class="docutils literal notranslate"><span class="pre">destroy()</span></code> method was added in
node-oracledb 2.1.</p>
<p>This method was added in node-oracledb 1.8.</p>
</div>
<div class="section" id="id70">
<h5>Parameters<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h5>
<p>See <a class="reference external" href="#execute">execute()</a>.</p>
</div>
</div>
<div class="section" id="a-name-release-a-4-2-14-connection-release">
<h4><a name="release"></a> 4.2.14 <code class="docutils literal notranslate"><span class="pre">connection.release()</span></code><a class="headerlink" href="#a-name-release-a-4-2-14-connection-release" title="Permalink to this headline">¶</a></h4>
<p>An alias for <a class="reference external" href="#connectionclose">connection.close()</a>.</p>
</div>
<div class="section" id="a-name-rollback-a-4-2-15-connection-rollback">
<h4><a name="rollback"></a> 4.2.15 <code class="docutils literal notranslate"><span class="pre">connection.rollback()</span></code><a class="headerlink" href="#a-name-rollback-a-4-2-15-connection-rollback" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id71">
<h5>Prototype<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rollback</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">rollback</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id72">
<h5>Description<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h5>
<p>This call rolls back the current transaction in progress on the
connection.</p>
</div>
<div class="section" id="id73">
<h5>Parameters<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">rollback()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-consubscribe-a-4-2-16-connection-subscribe">
<h4><a name="consubscribe"></a> 4.2.16 <code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code><a class="headerlink" href="#a-name-consubscribe-a-4-2-16-connection-subscribe" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id74">
<h5>Prototype<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subscribe</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">subscribe</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id75">
<h5>Description<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h5>
<p>Register a JavaScript callback method to be invoked when data is
changed in the database by any committed transaction, or when there
are Advanced Queuing messages to be dequeued.</p>
<p>For notification to work, the connection must be created with
<a class="reference external" href="#propdbevents"><code class="docutils literal notranslate"><span class="pre">events</span></code></a> mode <em>true</em>, which is the default.</p>
<p>The database must be able to connect to the node-oracledb machine for
notifications to be received.  Typically this means that the machine
running node-oracledb needs a fixed IP address.  If there is any
problem sending a notification, then the callback method will not be
invoked.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code> method may be called multiple times with the same
<code class="docutils literal notranslate"><span class="pre">name</span></code>, as long as the same connection is used.  In this case, the second and
subsequent invocations ignore all <code class="docutils literal notranslate"><span class="pre">options</span></code> properties other than
<a class="reference external" href="#consubscribeoptsql"><code class="docutils literal notranslate"><span class="pre">sql</span></code></a> and <a class="reference external" href="#consubscribeoptbinds"><code class="docutils literal notranslate"><span class="pre">binds</span></code></a>.  Instead, the
new SQL statement is registered to the same subscription, and the same
JavaScript notification callback is used.  For performance reasons this can be
preferable to creating a new subscription for each query.</p>
<p>See <a class="reference external" href="#cqn">Continuous Query Notification (CQN)</a> and
<a class="reference external" href="#aqnotifications">Advanced Queuing Notifications</a> for more information.</p>
<p>This method was added in node-oracledb 2.3.  AQ notifications were
added in node-oracledb 4.0</p>
<p>The <a class="reference external" href="#consubscribecallback"><code class="docutils literal notranslate"><span class="pre">result</span></code></a> callback parameter was added in node-oracledb 4.0.</p>
</div>
<div class="section" id="a-name-consubscribename-a-4-2-16-1-subscribe-name">
<h5><a name="consubscribename"></a> 4.2.16.1 <code class="docutils literal notranslate"><span class="pre">subscribe()</span></code>: Name<a class="headerlink" href="#a-name-consubscribename-a-4-2-16-1-subscribe-name" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">name</span>
</pre></div>
</div>
<p>For Continuous Query Notification this is an arbitrary name given to
the subscription.  For Advanced Queuing notifications this must be the
queue name.</p>
</div>
<div class="section" id="a-name-consubscribeoptions-a-4-2-16-2-subscribe-options">
<h5><a name="consubscribeoptions"></a> 4.2.16.2 <code class="docutils literal notranslate"><span class="pre">subscribe()</span></code>: Options<a class="headerlink" href="#a-name-consubscribeoptions-a-4-2-16-2-subscribe-options" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">options</span>
</pre></div>
</div>
<p>The options that control the subscription.  The following properties can be set.</p>
<div class="section" id="a-name-consubscribeoptbinds-a-4-2-16-2-1-binds">
<h6><a name="consubscribeoptbinds"></a> 4.2.16.2.1 <code class="docutils literal notranslate"><span class="pre">binds</span></code><a class="headerlink" href="#a-name-consubscribeoptbinds-a-4-2-16-2-1-binds" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">binds</span>
</pre></div>
</div>
<p>An array (bind by position) or object (bind by name) containing the
bind values to use in the <a class="reference external" href="#consubscribeoptsql"><code class="docutils literal notranslate"><span class="pre">sql</span></code></a> property.</p>
</div>
<div class="section" id="a-name-consubscribeoptcallback-a-4-2-16-2-2-callback">
<h6><a name="consubscribeoptcallback"></a> 4.2.16.2.2 <code class="docutils literal notranslate"><span class="pre">callback</span></code><a class="headerlink" href="#a-name-consubscribeoptcallback-a-4-2-16-2-2-callback" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">callback</span><span class="p">(</span><span class="n">Object</span> <span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>The notification callback that will be called whenever notifications
are sent by the database.  It accepts one parameter which contains
details of the notification.</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Object message</em>            | Information about the notification.  Described below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">message</span></code> parameter in the notification callback is an object containing the following properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbName</span></code> - the name of the database which sent a notification. This property is only defined for CQN. It is not defined when <code class="docutils literal notranslate"><span class="pre">type</span></code> is <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_DEREG</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queueName</span></code> - the name of the Advanced Queue.  Undefined for CQN.  This was added in node-oracledb 4.0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queries</span></code> - an array of objects specifying the queries which were affected by the Query Change notification. This is only defined if the <code class="docutils literal notranslate"><span class="pre">type</span></code> key is the value <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_QUERY_CHANGE</span></code></a>. It contains the following key:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tables</span></code> - an array of objects identical to the objects created for Database Change Notification (see the <code class="docutils literal notranslate"><span class="pre">tables</span></code> property below).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">registered</span></code> - a boolean indicating whether the subscription is registered with the database.  Will be <em>false</em> if <code class="docutils literal notranslate"><span class="pre">type</span></code> is <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_DEREG</span></code></a> or if the subscription was created with the <a class="reference external" href="#consubscribeoptqos"><code class="docutils literal notranslate"><span class="pre">qos</span></code></a> property set to <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_DEREG_NFY</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tables</span></code> - an array of objects specifying the tables which were affected by the notification. This is only defined if <code class="docutils literal notranslate"><span class="pre">type</span></code> is <a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_OBJ_CHANGE</span></code></a>. It contains the following properties:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> - the name of the table which was modified in some way.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">operation</span></code> - an integer mask composed of one or more values of the following constants:</p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_ALL_ROWS</span></code></a> - if row information is not available. This occurs if the <a class="reference external" href="#consubscribeoptqos"><code class="docutils literal notranslate"><span class="pre">qos</span></code></a> quality of service flags do not specify the desire for ROWIDs or if grouping has taken place and summary notifications are being sent.  This may also be set when too many rows are returned.</p></li>
<li><p><a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_ALTER</span></code></a> - if the table was altered in the notifying transaction.</p></li>
<li><p><a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_DELETE</span></code></a> - if the notifying transaction included deletes on the table.</p></li>
<li><p><a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_DROP</span></code></a> - if the table was dropped in the notifying transaction.</p></li>
<li><p><a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_INSERT</span></code></a> - if the notifying transaction included inserts on the table.</p></li>
<li><p><a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_UPDATE</span></code></a> - if the notifying transaction included updates on the table.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">rows</span></code> - an array of objects specifying the rows which were changed. This will only be defined if the <a class="reference external" href="#consubscribeoptqos"><code class="docutils literal notranslate"><span class="pre">qos</span></code></a> quality of service used when creating the subscription indicated the desire for ROWIDs and no summary grouping took place. It contains the following properties:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">operation</span></code> - an integer which is one of <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_INSERT</span></code></a>, <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_UPDATE</span></code></a>, <a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_DELETE</span></code></a> as described earlier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rowid</span></code> - a string containing the ROWID of the row that was affected</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">txId</span></code> - a buffer containing the identifier of the CQN transaction which spawned the notification.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> - the type of notification sent. This will be the value of one of the following constants:</p>
<ul>
<li><p><a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_AQ</span></code></a> - One or more Advanced Queuing messages are available to be dequeued.</p></li>
<li><p><a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_DEREG</span></code></a> - the subscription has been closed or the timeout value has been reached.</p></li>
<li><p><a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_OBJ_CHANGE</span></code></a> - object-level notifications are being used (Database Change Notification).</p></li>
<li><p><a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_QUERY_CHANGE</span></code></a> - query-level notifications are being used (Continuous Query Notification).</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="a-name-consubscribeoptgroupingclass-a-4-2-16-2-3-groupingclass">
<h6><a name="consubscribeoptgroupingclass"></a> 4.2.16.2.3 <code class="docutils literal notranslate"><span class="pre">groupingClass</span></code><a class="headerlink" href="#a-name-consubscribeoptgroupingclass-a-4-2-16-2-3-groupingclass" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">groupingClass</span>
</pre></div>
</div>
<p>An integer mask which currently, if set, can only contain the value
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_GROUPING_CLASS_TIME</span></code></a>. If
this value is set then notifications are grouped by time into a single
notification.</p>
</div>
<div class="section" id="a-name-consubscribeoptgroupingtype-a-4-2-16-2-4-groupingtype">
<h6><a name="consubscribeoptgroupingtype"></a> 4.2.16.2.4 <code class="docutils literal notranslate"><span class="pre">groupingType</span></code><a class="headerlink" href="#a-name-consubscribeoptgroupingtype-a-4-2-16-2-4-groupingtype" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">groupingType</span>
</pre></div>
</div>
<p>Either
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_GROUPING_TYPE_SUMMARY</span></code></a>
(the default) indicating notifications should be grouped in a summary,
or
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_GROUPING_TYPE_LAST</span></code></a>
indicating the last notification in the group should be sent.</p>
</div>
<div class="section" id="a-name-consubscribeoptgroupingvalue-a-4-2-16-2-5-groupingvalue">
<h6><a name="consubscribeoptgroupingvalue"></a> 4.2.16.2.5 <code class="docutils literal notranslate"><span class="pre">groupingValue</span></code><a class="headerlink" href="#a-name-consubscribeoptgroupingvalue-a-4-2-16-2-5-groupingvalue" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">groupingValue</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">groupingClass</span></code> contains
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_GROUPING_CLASS_TIME</span></code></a>
then <code class="docutils literal notranslate"><span class="pre">groupingValue</span></code> can be used to set the number of seconds over
which notifications will be grouped together, invoking <code class="docutils literal notranslate"><span class="pre">callback</span></code>
once.  If <code class="docutils literal notranslate"><span class="pre">groupingClass</span></code> is not set, then <code class="docutils literal notranslate"><span class="pre">groupingValue</span></code> is ignored.</p>
</div>
<div class="section" id="a-name-consubscribeoptipaddress-a-4-2-16-2-6-ipaddress">
<h6><a name="consubscribeoptipaddress"></a> 4.2.16.2.6 <code class="docutils literal notranslate"><span class="pre">ipAddress</span></code><a class="headerlink" href="#a-name-consubscribeoptipaddress-a-4-2-16-2-6-ipaddress" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">ipAddress</span>
</pre></div>
</div>
<p>A string containing an IPv4 or IPv6 address on which the subscription
should listen to receive notifications.  If not specified, then the
Oracle Client library will select an IP address.</p>
</div>
<div class="section" id="a-name-consubscribeoptnamespace-a-4-2-16-2-7-namespace">
<h6><a name="consubscribeoptnamespace"></a> 4.2.16.2.7 <code class="docutils literal notranslate"><span class="pre">namespace</span></code><a class="headerlink" href="#a-name-consubscribeoptnamespace-a-4-2-16-2-7-namespace" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">namespace</span>
</pre></div>
</div>
<p>One of the
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_NAMESPACE_AQ</span></code></a> or
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_NAMESPACE_DBCHANGE</span></code></a>
(the default) constants.</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_NAMESPACE_AQ</span></code> to get notifications that
Advanced Queuing messages are available to be dequeued, see
<a class="reference external" href="#aqnotifications">Advanced Queuing Notifications</a>.</p>
</div>
<div class="section" id="a-name-consubscribeoptoperations-a-4-2-16-2-8-operations">
<h6><a name="consubscribeoptoperations"></a> 4.2.16.2.8 <code class="docutils literal notranslate"><span class="pre">operations</span></code><a class="headerlink" href="#a-name-consubscribeoptoperations-a-4-2-16-2-8-operations" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">operations</span>
</pre></div>
</div>
<p>An integer mask containing one or more of the operation type
<a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_*</span></code></a> constants to indicate
what types of database change should generation notifications.</p>
</div>
<div class="section" id="a-name-consubscribeoptport-a-4-2-16-2-9-port">
<h6><a name="consubscribeoptport"></a> 4.2.16.2.9 <code class="docutils literal notranslate"><span class="pre">port</span></code><a class="headerlink" href="#a-name-consubscribeoptport-a-4-2-16-2-9-port" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">port</span>
</pre></div>
</div>
<p>The port number on which the subscription should listen to receive
notifications.  If not specified, then the Oracle Client library will
select a port number.</p>
</div>
<div class="section" id="a-name-consubscribeoptqos-a-4-2-16-2-10-qos">
<h6><a name="consubscribeoptqos"></a> 4.2.16.2.10 <code class="docutils literal notranslate"><span class="pre">qos</span></code><a class="headerlink" href="#a-name-consubscribeoptqos-a-4-2-16-2-10-qos" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">qos</span>
</pre></div>
</div>
<p>An integer mask containing one or more of the quality of service
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_*</span></code></a> constants.</p>
</div>
<div class="section" id="a-name-consubscribeoptsql-a-4-2-16-2-11-sql">
<h6><a name="consubscribeoptsql"></a> 4.2.16.2.11 <code class="docutils literal notranslate"><span class="pre">sql</span></code><a class="headerlink" href="#a-name-consubscribeoptsql-a-4-2-16-2-11-sql" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span>
</pre></div>
</div>
<p>The SQL query string to use for notifications.</p>
</div>
<div class="section" id="a-name-consubscribeopttimeout-a-4-2-16-2-12-timeout">
<h6><a name="consubscribeopttimeout"></a> 4.2.16.2.12 <code class="docutils literal notranslate"><span class="pre">timeout</span></code><a class="headerlink" href="#a-name-consubscribeopttimeout-a-4-2-16-2-12-timeout" title="Permalink to this headline">¶</a></h6>
<p>The number of seconds the subscription should remain active.  Once
this length of time has been reached, the subscription is
automatically unregistered and a deregistration notification is sent.</p>
</div>
</div>
<div class="section" id="a-name-consubscribecallback-a-4-2-16-3-subscribe-callback-function">
<h5><a name="consubscribecallback"></a> 4.2.16.3 <code class="docutils literal notranslate"><span class="pre">subscribe()</span></code>: Callback Function<a class="headerlink" href="#a-name-consubscribecallback-a-4-2-16-3-subscribe-callback-function" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id76">
<h5>Prototype<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id77">
<h5>Parameters<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h5>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em>               | If <code class="docutils literal notranslate"><span class="pre">subscribe()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>Object result</em>             | For <a class="reference external" href="#cqn">CQN</a> <code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_NAMESPACE_DBCHANGE</span></code> subscriptions this contains a single property <code class="docutils literal notranslate"><span class="pre">regId</span></code> corresponding the value of <code class="docutils literal notranslate"><span class="pre">REGID</span></code> in the database view <code class="docutils literal notranslate"><span class="pre">USER_CHANGE_NOTIFICATION_REGS</span></code> or the value of <code class="docutils literal notranslate"><span class="pre">REG_ID</span></code> in <code class="docutils literal notranslate"><span class="pre">USER_SUBSCR_REGISTRATIONS</span></code>.  For <a class="reference external" href="#aq">AQ</a> <code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_NAMESPACE_AQ</span></code> subscriptions, <code class="docutils literal notranslate"><span class="pre">regId</span></code>is undefined.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> callback parameter was added in node-oracledb 4.0.</p>
</div>
</div>
<div class="section" id="a-name-conunsubscribe-a-4-2-17-connection-unsubscribe">
<h4><a name="conunsubscribe"></a> 4.2.17 <code class="docutils literal notranslate"><span class="pre">connection.unsubscribe()</span></code><a class="headerlink" href="#a-name-conunsubscribe-a-4-2-17-connection-unsubscribe" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id78">
<h5>Prototype<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">unsubscribe</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id79">
<h5>Description<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h5>
<p>Unregister a <a class="reference external" href="#cqn">Continuous Query Notification (CQN)</a> subscription
previously created with <a class="reference external" href="#consubscribe"><code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code></a>.  No
further notifications will be sent.  The notification callback does
not receive a notification of the deregistration event.</p>
<p>A subscription can be unregistered using a different connection to the
initial subscription, as long as the credentials are the same.</p>
<p>If the subscription <a class="reference external" href="#consubscribeoptions"><code class="docutils literal notranslate"><span class="pre">timeout</span></code></a> was reached and
the subscription was automatically unregistered, you will get an error
if you call <code class="docutils literal notranslate"><span class="pre">connection.unsubscribe()</span></code>.</p>
<p>This method was added in node-oracledb 2.3.</p>
</div>
<div class="section" id="id80">
<h5>Parameters<a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">name</span>
</pre></div>
</div>
<p>The name of the subscription used in <a class="reference external" href="#consubscribe"><code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code></a>.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em>               | If <code class="docutils literal notranslate"><span class="pre">unsubscribe()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-aqqueueclass-a-5-aqqueue-class">
<h2><a name="aqqueueclass"></a> 5. AqQueue Class<a class="headerlink" href="#a-name-aqqueueclass-a-5-aqqueue-class" title="Permalink to this headline">¶</a></h2>
<p>An AqQueue object is created by <a class="reference external" href="#getqueue"><code class="docutils literal notranslate"><span class="pre">connection.getQueue()</span></code></a>.  It
is used for enqueuing and dequeuing Oracle Advanced Queuing messages.
Each AqQueue can be used for enqueuing, dequeuing, or for both.</p>
<p>See <a class="reference external" href="#aq">Oracle Advanced Queuing (AQ)</a> for usage.</p>
<p>The AqQueue class was added in node-oracledb 4.0.</p>
<div class="section" id="a-name-aqqueueproperties-a-5-1-aqqueue-properties">
<h3><a name="aqqueueproperties"></a> 5.1 AqQueue Properties<a class="headerlink" href="#a-name-aqqueueproperties-a-5-1-aqqueue-properties" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-aqqueuename-a-5-1-1-aqqueue-name">
<h4><a name="aqqueuename"></a> 5.1.1 <code class="docutils literal notranslate"><span class="pre">aqQueue.name</span></code><a class="headerlink" href="#a-name-aqqueuename-a-5-1-1-aqqueue-name" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">name</span>
</pre></div>
</div>
<p>A string containing the name of the queue specified in the
<a class="reference external" href="#getqueue"><code class="docutils literal notranslate"><span class="pre">connection.getQueue()</span></code></a> call.</p>
</div>
<div class="section" id="a-name-aqqueuedeqopts-a-5-1-2-aqqueue-deqoptions">
<h4><a name="aqqueuedeqopts"></a> 5.1.2 <code class="docutils literal notranslate"><span class="pre">aqQueue.deqOptions</span></code><a class="headerlink" href="#a-name-aqqueuedeqopts-a-5-1-2-aqqueue-deqoptions" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AqDeqOptions</span> <span class="n">deqOptions</span>
</pre></div>
</div>
<p>An object specifying the Advanced Queuing options to use when
dequeuing messages.  Attributes can be set before each
<a class="reference external" href="#aqqueuemethoddeqone"><code class="docutils literal notranslate"><span class="pre">queue.deqOne()</span></code></a> or
<a class="reference external" href="#aqqueuemethoddeqmany"><code class="docutils literal notranslate"><span class="pre">queue.deqMany()</span></code></a>, see <a class="reference external" href="#aqoptions">Changing AQ
options</a>.</p>
<p>When a <a class="reference external" href="#getqueue">queue is created</a>, the <code class="docutils literal notranslate"><span class="pre">queue.deqOptions</span></code> property is
an <a class="reference external" href="#aqdeqoptionsclass">AqDeqOptions object</a>.  AqDeqOptions objects
cannot be created independently.</p>
<div class="section" id="a-name-aqdeqoptionsclass-a-5-1-2-1-aqdeqoptions-class">
<h5><a name="aqdeqoptionsclass"></a> 5.1.2.1 AqDeqOptions Class<a class="headerlink" href="#a-name-aqdeqoptionsclass-a-5-1-2-1-aqdeqoptions-class" title="Permalink to this headline">¶</a></h5>
<p>Attribute Name          | Description
————————|————
<code class="docutils literal notranslate"><span class="pre">condition</span></code>             | A String that defines the condition that must be satisfied in order for a message to be dequeued.
<code class="docutils literal notranslate"><span class="pre">consumerName</span></code>          | A String that defines the name of the consumer that is dequeuing messages.
<code class="docutils literal notranslate"><span class="pre">correlation</span></code>           | A String that defines the correlation to use when dequeuing.
<code class="docutils literal notranslate"><span class="pre">mode</span></code>                  | An integer value that defines the mode to use for dequeuing messages.  It can be one of the following constants: <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_MODE_BROWSE</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_MODE_LOCKED</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_MODE_REMOVE</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_MODE_REMOVE_NO_DATA</span></code></a>.
<code class="docutils literal notranslate"><span class="pre">msgId</span></code>                 | A Buffer containing a unique identifier specifying the message to be dequeued.
<code class="docutils literal notranslate"><span class="pre">navigation</span></code>            | An integer value that defines the position in the queue of the message that is to be dequeued.  It can be one of the following constants: <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_NAV_FIRST_MSG</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_NAV_NEXT_TRANSACTION</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_NAV_NEXT_MSG</span></code></a>.
<code class="docutils literal notranslate"><span class="pre">transformation</span></code>        | A String that defines the transformation that will take place on messages when they are dequeued.
<code class="docutils literal notranslate"><span class="pre">visibility</span></code>            | An integer value that defines whether the dequeue occurs in the current transaction or as a separate transaction.  It can be one of the following constants: <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_VISIBILITY_IMMEDIATE</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_VISIBILITY_ON_COMMIT</span></code></a>.
<code class="docutils literal notranslate"><span class="pre">wait</span></code>                  | An integer defining the number of seconds to wait for a message matching the search criteria to become available.  It can alternatively be one of the following constants: <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_NO_WAIT</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_DEQ_WAIT_FOREVER.</span></code></a></p>
<p>See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADQUE">Oracle Advanced Queuing Documentation</a> for more information about attributes.</p>
</div>
</div>
<div class="section" id="a-name-aqqueueenqopts-a-5-1-3-aqqueue-enqoptions">
<h4><a name="aqqueueenqopts"></a> 5.1.3 <code class="docutils literal notranslate"><span class="pre">aqQueue.enqOptions</span></code><a class="headerlink" href="#a-name-aqqueueenqopts-a-5-1-3-aqqueue-enqoptions" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AqEnqOptions</span> <span class="n">enqOptions</span>
</pre></div>
</div>
<p>An object specifying the Advanced Queuing options to use when
enqueuing messages.  Attributes can be set before each
<a class="reference external" href="#aqqueuemethodenqone"><code class="docutils literal notranslate"><span class="pre">queue.enqOne()</span></code></a> or
<a class="reference external" href="#aqqueuemethodenqmany"><code class="docutils literal notranslate"><span class="pre">queue.enqMany()</span></code></a> call to change the behavior
of message delivery, see <a class="reference external" href="#aqoptions">Changing AQ options</a>.</p>
<p>When a <a class="reference external" href="#getqueue">queue is created</a>, the <code class="docutils literal notranslate"><span class="pre">queue.enqOptions</span></code> property is
an <a class="reference external" href="#aqenqoptionsclass">AqEnqOptions object</a>.  AqEnqOptions objects
cannot be created independently.</p>
<div class="section" id="a-name-aqenqoptionsclass-a-5-1-3-1-aqenqoptions-class">
<h5><a name="aqenqoptionsclass"></a> 5.1.3.1 AqEnqOptions Class<a class="headerlink" href="#a-name-aqenqoptionsclass-a-5-1-3-1-aqenqoptions-class" title="Permalink to this headline">¶</a></h5>
<p>Attribute Name          | Description
————————|————
<code class="docutils literal notranslate"><span class="pre">deliveryMode</span></code>          | An integer defining the delivery mode when enqueuing messages.  It can be one of the following constants: <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_DELIV_MODE_PERSISTENT</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_DELIV_MODE_BUFFERED</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_DELIV_MODE_PERSISTENT_OR_BUFFERED</span></code></a>
<code class="docutils literal notranslate"><span class="pre">transformation</span></code>        | A string defining the transformation that will take place when messages are enqueued.
<code class="docutils literal notranslate"><span class="pre">visibility</span></code>            | An integer value that defines whether the enqueue occurs in the current transaction or as a separate transaction.  It can be one of the following constants: <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_VISIBILITY_IMMEDIATE</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_VISIBILITY_ON_COMMIT</span></code></a>.</p>
<p>See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADQUE">Oracle Advanced Queuing Documentation</a> for more information about attributes.</p>
</div>
</div>
<div class="section" id="a-name-aqqueuepayloadtype-a-5-1-4-aqqueue-payloadtype">
<h4><a name="aqqueuepayloadtype"></a> 5.1.4 <code class="docutils literal notranslate"><span class="pre">aqQueue.payloadType</span></code><a class="headerlink" href="#a-name-aqqueuepayloadtype-a-5-1-4-aqqueue-payloadtype" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">payloadType</span>
</pre></div>
</div>
<p>One of <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_RAW</span></code></a> or <a class="reference external" href="#oracledbconstantsdbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_OBJECT</span></code></a> constants.</p>
</div>
<div class="section" id="a-name-aqqueuepayloadtypeclass-a-5-1-5-aqqueue-payloadtypeclass">
<h4><a name="aqqueuepayloadtypeclass"></a> 5.1.5 <code class="docutils literal notranslate"><span class="pre">aqQueue.payloadTypeClass</span></code><a class="headerlink" href="#a-name-aqqueuepayloadtypeclass-a-5-1-5-aqqueue-payloadtypeclass" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">DbObject</span> <span class="n">payloadTypeClass</span>
</pre></div>
</div>
<p>The <a class="reference external" href="#dbobjectclass">DbObject Class</a> corresponding to the payload type
specified when the queue was created.</p>
<p>This is defined only if <code class="docutils literal notranslate"><span class="pre">payloadType</span></code> has the value <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_OBJECT</span></code>.</p>
</div>
<div class="section" id="a-name-aqqueuepayloadtypename-a-5-1-6-aqqueue-payloadtypename">
<h4><a name="aqqueuepayloadtypename"></a> 5.1.6 <code class="docutils literal notranslate"><span class="pre">aqQueue.payloadTypeName</span></code><a class="headerlink" href="#a-name-aqqueuepayloadtypename-a-5-1-6-aqqueue-payloadtypename" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">payloadTypeName</span>
</pre></div>
</div>
<p>Either the string “RAW” or the name of the Oracle Database object type
identified when the queue was created.</p>
</div>
</div>
<div class="section" id="a-name-aqqueuemethods-a-5-2-aqqueue-methods">
<h3><a name="aqqueuemethods"></a> 5.2 AqQueue Methods<a class="headerlink" href="#a-name-aqqueuemethods-a-5-2-aqqueue-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-aqqueuemethoddeqmany-a-5-2-1-aqqueue-deqmany">
<h4><a name="aqqueuemethoddeqmany"></a> 5.2.1 <code class="docutils literal notranslate"><span class="pre">aqQueue.deqMany()</span></code><a class="headerlink" href="#a-name-aqqueuemethoddeqmany-a-5-2-1-aqqueue-deqmany" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id81">
<h5>Prototype<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deqMany</span><span class="p">(</span><span class="n">Number</span> <span class="n">maxMessages</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Array</span> <span class="n">messages</span><span class="p">));</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">deqMany</span><span class="p">(</span><span class="n">Number</span> <span class="n">maxMessages</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id82">
<h5>Description<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h5>
<p>Dequeues up to the specified number of messages from an <a class="reference external" href="#aq">Oracle Advanced
Queue</a>.</p>
</div>
<div class="section" id="id83">
<h5>Parameters<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">maxMessages</span>
</pre></div>
</div>
<p>Dequeue at most this many messages.  Depending on the dequeue
options, the number of messages returned will be between zero and
<code class="docutils literal notranslate"><span class="pre">maxMessages</span></code>.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Array</span> <span class="n">messages</span><span class="p">,</span> <span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Array messages</em>            | An array of <a class="reference external" href="#aqmessageclass">AqMessage objects</a>.
<em>Error error</em>               | If <code class="docutils literal notranslate"><span class="pre">deqMany()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-aqqueuemethoddeqone-a-5-2-2-aqqueue-deqone">
<h4><a name="aqqueuemethoddeqone"></a> 5.2.2 <code class="docutils literal notranslate"><span class="pre">aqQueue.deqOne()</span></code><a class="headerlink" href="#a-name-aqqueuemethoddeqone-a-5-2-2-aqqueue-deqone" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id84">
<h5>Prototype<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deqOne</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">AqMessage</span> <span class="n">message</span><span class="p">));</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">deqOne</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id85">
<h5>Description<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h5>
<p>Dequeues a single message from an <a class="reference external" href="#aq">Oracle Advanced Queue</a>.
Depending on the dequeue options, the message may also be returned as
undefined if no message is available.</p>
</div>
<div class="section" id="id86">
<h5>Parameters<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">AqMessage</span> <span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em>               | If <code class="docutils literal notranslate"><span class="pre">deqOne()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>AqMessage message</em>         | The message that is dequeued.  See <a class="reference external" href="#aqmessageclass">AqMessage Class</a>.</p>
</li>
</ul>
</div>
<div class="section" id="a-name-aqmessageclass-a-5-2-2-1-aqmessage-class">
<h5><a name="aqmessageclass"></a> 5.2.2.1 AqMessage Class<a class="headerlink" href="#a-name-aqmessageclass-a-5-2-2-1-aqmessage-class" title="Permalink to this headline">¶</a></h5>
<p>Dequeued messages are returned as AqMessage objects.  Note AqMessage
objects are not used for enqueuing.</p>
<p>Attribute Name  |  Description
—————-|————–
<code class="docutils literal notranslate"><span class="pre">correlation</span></code>   | A String containing the correlation that was used during enqueue.
<code class="docutils literal notranslate"><span class="pre">delay</span></code>         | An integer containing the number of seconds the message was delayed before it could be dequeued.
<code class="docutils literal notranslate"><span class="pre">deliveryMode</span></code>  | An integer containing the delivery mode the messages was enqueued with.
<code class="docutils literal notranslate"><span class="pre">exceptionQueue</span></code>| A String containing the name of the exception queue defined when the message was enqueued.
<code class="docutils literal notranslate"><span class="pre">expiration</span></code>    | The number of seconds until expiration defined when the message was enqueued.
<code class="docutils literal notranslate"><span class="pre">msgId</span></code>         | A Buffer containing the unique identifier of the message.
<code class="docutils literal notranslate"><span class="pre">numAttempts</span></code>   | An integer containing the number of attempts that were made to dequeue the message.
<code class="docutils literal notranslate"><span class="pre">originalMsgId</span></code> | A Buffer containing the unique identifier of the message in the last queue that generated it.
<code class="docutils literal notranslate"><span class="pre">payload</span></code>       | A Buffer or DbObject containing the payload of the message, depending on the value of <code class="docutils literal notranslate"><span class="pre">queue.payloadType</span></code>.  Note that enqueued Strings are returned as UTF-8 encoded Buffers.
<code class="docutils literal notranslate"><span class="pre">priority</span></code>      | An integer containing the priority of the message when it was enqueued.
<code class="docutils literal notranslate"><span class="pre">state</span></code>         | An integer representing the state of the message.  It is one of the following constants: <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_STATE_READY</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_STATE_WAITING</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_STATE_PROCESSED</span></code></a>, <a class="reference external" href="#oracledbconstantsaq"><code class="docutils literal notranslate"><span class="pre">oracledb.AQ_MSG_STATE_EXPIRED</span></code></a></p>
<p>See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADQUE">Oracle Advanced Queuing Documentation</a> for more information about attributes.</p>
</div>
</div>
</div>
<div class="section" id="a-name-aqqueuemethodenqmany-a-5-2-3-aqqueue-enqmany">
<h3><a name="aqqueuemethodenqmany"></a> 5.2.3 <code class="docutils literal notranslate"><span class="pre">aqQueue.enqMany()</span></code><a class="headerlink" href="#a-name-aqqueuemethodenqmany-a-5-2-3-aqqueue-enqmany" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id87">
<h4>Prototype<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enqMany</span><span class="p">(</span><span class="n">Array</span> <span class="n">messages</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">));</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">enqMany</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id88">
<h4>Description<a class="headerlink" href="#id88" title="Permalink to this headline">¶</a></h4>
<p>Enqueues multiple messages to an <a class="reference external" href="#aq">Oracle Advanced Queue</a>.</p>
<p>Warning: calling <code class="docutils literal notranslate"><span class="pre">enqMany()</span></code> in parallel on different connections
acquired from the same pool may fail due to Oracle bug 29928074.
Ensure that <code class="docutils literal notranslate"><span class="pre">enqMany()</span></code> is not run in parallel, use <a class="reference external" href="#connectionhandling">standalone
connections</a>, or make multiple calls to
<code class="docutils literal notranslate"><span class="pre">enqOne()</span></code>.  The <code class="docutils literal notranslate"><span class="pre">deqMany()</span></code> method is not affected.</p>
</div>
<div class="section" id="id89">
<h4>Parameters<a class="headerlink" href="#id89" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span> <span class="n">messages</span>
</pre></div>
</div>
<p>Each element of the array must be a String, a Buffer, a <a class="reference external" href="#dbobjectclass">DbObject</a>, or a JavaScript Object
as used by <a class="reference external" href="#aqqueuemethodenqone"><code class="docutils literal notranslate"><span class="pre">enqOne()</span></code></a>.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">enqMany()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
<div class="section" id="a-name-aqqueuemethodenqone-a-5-2-4-aqqueue-enqone">
<h4><a name="aqqueuemethodenqone"></a> 5.2.4 <code class="docutils literal notranslate"><span class="pre">aqQueue.enqOne()</span></code><a class="headerlink" href="#a-name-aqqueuemethodenqone-a-5-2-4-aqqueue-enqone" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id90">
<h5>Prototype<a class="headerlink" href="#id90" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enqOne</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">));</span>
<span class="n">enqOne</span><span class="p">(</span><span class="n">Buffer</span> <span class="n">message</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">));</span>
<span class="n">enqOne</span><span class="p">(</span><span class="n">DbObject</span> <span class="n">message</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">));</span>
<span class="n">enqOne</span><span class="p">(</span><span class="n">Object</span> <span class="n">message</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">));</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">enqOne</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id91">
<h5>Description<a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h5>
<p>Enqueues a single message to an <a class="reference external" href="#aq">Oracle Advanced Queue</a>.  The
message may be a String, or a Buffer, or a <a class="reference external" href="#dbobjectclass">DbObject</a>.
It may also be a JavaScript Object containing the actual message and
some attributes controlling the behavior of the queued message.</p>
</div>
<div class="section" id="id92">
<h5>Parameters<a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="o">|</span> <span class="n">Buffer</span> <span class="o">|</span> <span class="n">DbObject</span> <span class="o">|</span> <span class="n">Object</span> <span class="n">message</span>
</pre></div>
</div>
<p>The message can be one of the following four types.</p>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">message</span>
</pre></div>
</div>
<p>If the message is a String, it will be converted to a buffer using the UTF-8 encoding.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Buffer</span> <span class="n">message</span>
</pre></div>
</div>
<p>If the message is a Buffer, it will be transferred as it is.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DbObject</span> <span class="n">message</span>
</pre></div>
</div>
<p>An object of the <a class="reference external" href="#dbobjectclass">DbObject Class</a>.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">message</span>
</pre></div>
</div>
<p><a name="aqjsmessage"></a> A JavaScript object can be used to
alter the message properties.  It must contain a <code class="docutils literal notranslate"><span class="pre">payload</span></code>
property with the actual message content.  It may contain
other attributes as noted below.</p>
<p>Message Attribute | Description
——————|————
<code class="docutils literal notranslate"><span class="pre">correlation</span></code>     | A string containing the correlation of the message to be enqueued.
<code class="docutils literal notranslate"><span class="pre">delay</span></code>           | The number of seconds to delay the message before it can be dequeued.
<code class="docutils literal notranslate"><span class="pre">exceptionQueue</span></code>  | A string containing the name of an exception queue in which to place the message if an exception takes place.
<code class="docutils literal notranslate"><span class="pre">expiration</span></code>      | The number of seconds the message is available to be dequeued before it expires.
<code class="docutils literal notranslate"><span class="pre">payload</span></code>         | A String, Buffer or <a class="reference external" href="#dbobjectclass">DbObject</a> that is the actual message to be queued.  This property must be specified.
<code class="docutils literal notranslate"><span class="pre">priority</span></code>        | An integer priority of the message.</p>
<p>See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADQUE">Oracle Advanced Queuing Documentation</a> for more information about attributes.</p>
</li>
</ul>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">enqOne()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-dbobjectclass-a-6-dbobject-class">
<h2><a name="dbobjectclass"></a> 6. DbObject Class<a class="headerlink" href="#a-name-dbobjectclass-a-6-dbobject-class" title="Permalink to this headline">¶</a></h2>
<p>Calling <a class="reference external" href="#getdbobjectclass"><code class="docutils literal notranslate"><span class="pre">connection.getDbObjectClass()</span></code></a> returns a
prototype object representing a named Oracle Database object or
collection.  Use <code class="docutils literal notranslate"><span class="pre">dbObject.prototype</span></code> on the class to see the
available attributes.</p>
<p>Objects of a named DbObject type are:</p>
<ul class="simple">
<li><p>created from a DbObject prototype by calling <code class="docutils literal notranslate"><span class="pre">new()</span></code></p></li>
<li><p>returned by queries</p></li>
<li><p>returned when using BIND_OUT for an Oracle Database object</p></li>
</ul>
<p>See <a class="reference external" href="#objects">Oracle Database Objects and Collections</a> for more information.</p>
<p>The DbObject class was added in node-oracledb 4.0.</p>
<div class="section" id="a-name-dbobjectproperties-a-6-1-dbobject-properties">
<h3><a name="dbobjectproperties"></a> 6.1 DbObject Properties<a class="headerlink" href="#a-name-dbobjectproperties-a-6-1-dbobject-properties" title="Permalink to this headline">¶</a></h3>
<p>The properties of a DbObject object are listed below.</p>
<div class="section" id="a-name-dbobjattributesattributes-a-6-1-1-dbobject-attributes">
<h4><a name="dbobjattributesattributes"></a> 6.1.1 <code class="docutils literal notranslate"><span class="pre">dbObject.attributes</span></code><a class="headerlink" href="#a-name-dbobjattributesattributes-a-6-1-1-dbobject-attributes" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">attributes</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">dbObject.isCollection</span></code> is <em>false</em>, this will be an object
containing attributes corresponding to the Oracle Database object
attributes.  The name of each attribute follows normal Oracle casing
semantics.</p>
<p>Each attribute will have an object that contains:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: the value of one of the <a class="reference external" href="#oracledbconstantsdbtype">Oracle Database Type Constants</a>, such as 2010 for <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_NUMBER</span></code> and 2023 for <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_OBJECT</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typeName</span></code>: a string corresponding to the type, such as “VARCHAR2” or “NUMBER”.  When the attribute is a DbObject, it will contain the name of the object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typeClass</span></code>: set if the value of <code class="docutils literal notranslate"><span class="pre">type</span></code> is a DbObject.  It is the DbObject class for the attribute.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">STREET_NUMBER</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">typeName</span><span class="o">:</span> <span class="s1">&#39;NUMBER&#39;</span> <span class="p">},</span>
  <span class="nx">LOCATION</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">2023</span><span class="p">,</span>
    <span class="nx">typeName</span><span class="o">:</span> <span class="s1">&#39;MDSYS.SDO_POINT_TYPE&#39;</span><span class="p">,</span>
    <span class="nx">typeClass</span><span class="o">:</span> <span class="p">[</span><span class="nb">Function</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-dbobjattributeselementtype-a-6-1-2-dbobject-elementtype">
<h4><a name="dbobjattributeselementtype"></a> 6.1.2 <code class="docutils literal notranslate"><span class="pre">dbObject.elementType</span></code><a class="headerlink" href="#a-name-dbobjattributeselementtype-a-6-1-2-dbobject-elementtype" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">elementType</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">dbObject.isCollection</span></code> is <em>true</em>, this will have a value
corresponding to one of the <a class="reference external" href="#oracledbconstantsdbtype">Oracle Database Type
Constants</a>.</p>
</div>
<div class="section" id="a-name-dbobjattributeselementtypeclass-a-6-1-3-dbobject-elementtypeclass">
<h4><a name="dbobjattributeselementtypeclass"></a> 6.1.3 <code class="docutils literal notranslate"><span class="pre">dbObject.elementTypeClass</span></code><a class="headerlink" href="#a-name-dbobjattributeselementtypeclass-a-6-1-3-dbobject-elementtypeclass" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Object</span> <span class="n">elementTypeClass</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-dbobjattributeselementtypename-a-6-1-4-dbobject-elementtypename">
<h4><a name="dbobjattributeselementtypename"></a> 6.1.4 <code class="docutils literal notranslate"><span class="pre">dbObject.elementTypeName</span></code><a class="headerlink" href="#a-name-dbobjattributeselementtypename-a-6-1-4-dbobject-elementtypename" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">elementTypeName</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">dbObject.isCollection</span></code> is <em>true</em>, this will have the name of the
element type, such as “VARCHAR2” or “NUMBER”.</p>
</div>
<div class="section" id="a-name-dbobjattributesfqn-a-6-1-5-dbobject-fqn">
<h4><a name="dbobjattributesfqn"></a> 6.1.5 <code class="docutils literal notranslate"><span class="pre">dbObject.fqn</span></code><a class="headerlink" href="#a-name-dbobjattributesfqn-a-6-1-5-dbobject-fqn" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">fqn</span>
</pre></div>
</div>
<p>The fully qualified name of the Oracle Database object or collection.</p>
</div>
<div class="section" id="a-name-dbobjattributesiscollection-a-6-1-6-dbobject-iscollection">
<h4><a name="dbobjattributesiscollection"></a> 6.1.6 <code class="docutils literal notranslate"><span class="pre">dbObject.isCollection</span></code><a class="headerlink" href="#a-name-dbobjattributesiscollection-a-6-1-6-dbobject-iscollection" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Boolean</span> <span class="n">isCollection</span>
</pre></div>
</div>
<p>This is <em>true</em> if the Oracle object is a collection, <em>false</em> otherwise.</p>
</div>
<div class="section" id="a-name-dbobjattributeslength-a-6-1-7-dbobject-length">
<h4><a name="dbobjattributeslength"></a> 6.1.7 <code class="docutils literal notranslate"><span class="pre">dbObject.length</span></code><a class="headerlink" href="#a-name-dbobjattributeslength-a-6-1-7-dbobject-length" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">length</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">dbObject.isCollection</span></code> is <em>true</em>, this will have the number of
elements in the collection.  It is undefined for non-collections.</p>
</div>
<div class="section" id="a-name-dbobjattributesname-a-6-1-8-dbobject-name">
<h4><a name="dbobjattributesname"></a> 6.1.8 <code class="docutils literal notranslate"><span class="pre">dbObject.name</span></code><a class="headerlink" href="#a-name-dbobjattributesname-a-6-1-8-dbobject-name" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">name</span>
</pre></div>
</div>
<p>The name of the Oracle Database object or collection.</p>
</div>
<div class="section" id="a-name-dbobjattributesschema-a-6-1-9-dbobject-schema">
<h4><a name="dbobjattributesschema"></a> 6.1.9 <code class="docutils literal notranslate"><span class="pre">dbObject.schema</span></code><a class="headerlink" href="#a-name-dbobjattributesschema-a-6-1-9-dbobject-schema" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">schema</span>
</pre></div>
</div>
<p>The schema owning the Oracle Database object or collection.</p>
</div>
</div>
<div class="section" id="a-name-dbobjectmethods-a-6-2-dbobject-methods">
<h3><a name="dbobjectmethods"></a> 6.2 DbObject Methods<a class="headerlink" href="#a-name-dbobjectmethods-a-6-2-dbobject-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-dbobjectmethodscolls-a-6-2-1-dbobject-methods-for-collections">
<h4><a name="dbobjectmethodscolls"></a> 6.2.1 DbObject Methods for Collections<a class="headerlink" href="#a-name-dbobjectmethodscolls-a-6-2-1-dbobject-methods-for-collections" title="Permalink to this headline">¶</a></h4>
<p>These methods can be used on Oracle Database collections, identifiable
when <a class="reference external" href="#dbobjattributesiscollection"><code class="docutils literal notranslate"><span class="pre">dbObject.isCollection</span></code></a> is
<em>true</em>.  When collections are fetched from the database, altered, and
then passed back to the database, it may be more efficient to use
these methods directly on the retrieved DbObject than it is to convert
that DbObject to and from a JavaScript object.</p>
<p>Method Name                                |  Description
——————————————-|—————————————————————
<code class="docutils literal notranslate"><span class="pre">dbObject.append(value)</span></code>                   | Add the given value to the end of the collection.
<code class="docutils literal notranslate"><span class="pre">dbObject.deleteElement(Number</span> <span class="pre">index)</span></code>     | Deletes the value from collection at the given index.
<code class="docutils literal notranslate"><span class="pre">dbObject.getElement(Number</span> <span class="pre">index)</span></code>        | Return the value associated with the given index.
<code class="docutils literal notranslate"><span class="pre">dbObject.getFirstIndex()</span></code>                 | Returns the first index for later use to obtain the value.
<code class="docutils literal notranslate"><span class="pre">dbObject.getKeys()</span></code>                       | Returns a JavaScript array containing the ‘index’ keys.
<code class="docutils literal notranslate"><span class="pre">dbObject.getLastIndex()</span></code>                  | To obtain the last index for later use to obtain a value.
<code class="docutils literal notranslate"><span class="pre">dbObject.getNextIndex(Number</span> <span class="pre">index)</span></code>      | Returns the next index value for later use to obtain a value.
<code class="docutils literal notranslate"><span class="pre">dbObject.getPrevIndex(Number</span> <span class="pre">index)</span></code>      | Returns the previous index for later use to obtain the value.
<code class="docutils literal notranslate"><span class="pre">dbObject.hasElement(Number</span> <span class="pre">index)</span></code>        | Returns <em>true</em> if an element exists in the collection at the given index. Returns <em>false</em> otherwise.
<code class="docutils literal notranslate"><span class="pre">dbObject.setElement(Number</span> <span class="pre">index,</span> <span class="pre">value)</span></code> | To set the given value at the position of the given index.
<code class="docutils literal notranslate"><span class="pre">dbObject.getValues()</span></code>                     | Returns an array of element values as a JavaScript array in key order.
<code class="docutils literal notranslate"><span class="pre">dbObject.trim(count)</span></code>                     | Trims the specified number of elements from the end of the collection.</p>
</div>
</div>
</div>
<div class="section" id="a-name-lobclass-a-7-lob-class">
<h2><a name="lobclass"></a> 7. Lob Class<a class="headerlink" href="#a-name-lobclass-a-7-lob-class" title="Permalink to this headline">¶</a></h2>
<p>Lob objects can be used to access Oracle Database CLOB and BLOB data.</p>
<p>A Lob object implements the <a class="reference external" href="https://nodejs.org/api/stream.html">Node.js Stream</a> interface.</p>
<p>See <a class="reference external" href="#lobhandling">Working with CLOB and BLOB Data</a> and <a class="reference external" href="#lobbinds">LOB Bind Parameters</a> for more information.</p>
<div class="section" id="a-name-lobproperties-a-7-1-lob-properties">
<h3><a name="lobproperties"></a> 7.1 Lob Properties<a class="headerlink" href="#a-name-lobproperties-a-7-1-lob-properties" title="Permalink to this headline">¶</a></h3>
<p>The properties of a Lob object are listed below.</p>
<div class="section" id="a-name-proplobchunksize-a-7-1-1-lob-chunksize">
<h4><a name="proplobchunksize"></a> 7.1.1 <code class="docutils literal notranslate"><span class="pre">lob.chunkSize</span></code><a class="headerlink" href="#a-name-proplobchunksize-a-7-1-1-lob-chunksize" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">chunkSize</span>
</pre></div>
</div>
<p>This corresponds to the size used by the Oracle LOB layer when
accessing or modifying the LOB value.</p>
</div>
<div class="section" id="a-name-proploblength-a-7-1-2-lob-length">
<h4><a name="proploblength"></a> 7.1.2 <code class="docutils literal notranslate"><span class="pre">lob.length</span></code><a class="headerlink" href="#a-name-proploblength-a-7-1-2-lob-length" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">length</span>
</pre></div>
</div>
<p>Length of a queried LOB in bytes (for BLOBs) or characters (for CLOBs).</p>
</div>
<div class="section" id="a-name-proplobpiecesize-a-7-1-3-lob-piecesize">
<h4><a name="proplobpiecesize"></a> 7.1.3 <code class="docutils literal notranslate"><span class="pre">lob.pieceSize</span></code><a class="headerlink" href="#a-name-proplobpiecesize-a-7-1-3-lob-piecesize" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">pieceSize</span>
</pre></div>
</div>
<p>The number of bytes (for BLOBs) or characters (for CLOBs) to read for
each Stream ‘data’ event of a queried LOB.</p>
<p>The default value is <a class="reference external" href="#proplobchunksize"><code class="docutils literal notranslate"><span class="pre">chunkSize</span></code></a>.</p>
<p>For efficiency, it is recommended that <code class="docutils literal notranslate"><span class="pre">pieceSize</span></code> be a multiple of
<code class="docutils literal notranslate"><span class="pre">chunkSize</span></code>.</p>
<p>The property should not be reset in the middle of streaming since data
will be lost when internal buffers are resized.</p>
<p>The maximum value for <code class="docutils literal notranslate"><span class="pre">pieceSize</span></code> is limited to the value of UINT_MAX.</p>
</div>
<div class="section" id="a-name-proplobtype-a-7-1-4-lob-type">
<h4><a name="proplobtype"></a> 7.1.4 <code class="docutils literal notranslate"><span class="pre">lob.type</span></code><a class="headerlink" href="#a-name-proplobtype-a-7-1-4-lob-type" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="nb">type</span>
</pre></div>
</div>
<p>This read-only attribute shows the type of Lob being used.  It will
have the value of one of the constants
<a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code></a> or
<a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code></a>.  The value is derived from the
bind type when using LOB bind variables, or from the column type when
a LOB is returned by a query.</p>
</div>
</div>
<div class="section" id="a-name-lobmethods-a-7-2-lob-methods">
<h3><a name="lobmethods"></a> 7.2 Lob Methods<a class="headerlink" href="#a-name-lobmethods-a-7-2-lob-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-lobclose-a-7-2-1-lob-close">
<h4><a name="lobclose"></a> 7.2.1 <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code><a class="headerlink" href="#a-name-lobclose-a-7-2-1-lob-close" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id93">
<h5>Prototype<a class="headerlink" href="#id93" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">close</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">close</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id94">
<h5>Description<a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h5>
<p>Explicitly closes a Lob.</p>
<p>Lobs created with <a class="reference external" href="#connectioncreatelob"><code class="docutils literal notranslate"><span class="pre">createLob()</span></code></a> should be
explicitly closed with <a class="reference external" href="#lobclose"><code class="docutils literal notranslate"><span class="pre">lob.close()</span></code></a> when no longer
needed.  This frees resources in node-oracledb and in Oracle Database.</p>
<p>Persistent or temporary Lobs returned from the database may also be
closed with <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code> as long as streaming is not currently
happening.  Note these Lobs are automatically closed when streamed to
completion or used as the source for an IN OUT bind.  If you try to
close a Lob being used for streaming you will get the error <em>NJS-023:
concurrent operations on a Lob are not allowed</em>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code> method emits the <a class="reference external" href="https://nodejs.org/api/stream.html">Node.js Stream</a> ‘close’ event
unless the Lob has already been explicitly or automatically closed.</p>
<p>The connection must be open when calling <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code> on a temporary
LOB, such as those created by <code class="docutils literal notranslate"><span class="pre">createLob()</span></code>.</p>
<p>Once a Lob is closed, it cannot be bound.</p>
<p>See <a class="reference external" href="#closinglobs">Closing Lobs</a> for more discussion.</p>
</div>
<div class="section" id="id95">
<h5>Parameters<a class="headerlink" href="#id95" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">close()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-lobgetdata-a-7-2-2-lob-getdata">
<h4><a name="lobgetdata"></a> 7.2.2 <code class="docutils literal notranslate"><span class="pre">lob.getData()</span></code><a class="headerlink" href="#a-name-lobgetdata-a-7-2-2-lob-getdata" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id96">
<h5>Prototype<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getData</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">String</span> <span class="n">data</span><span class="p">));</span>
<span class="n">getData</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Buffer</span> <span class="n">data</span><span class="p">));</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getData</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id97">
<h5>Description<a class="headerlink" href="#id97" title="Permalink to this headline">¶</a></h5>
<p>Return all the LOB data. CLOBs and NCLOBs will be returned as strings.
BLOBs will be returned as a Buffer.  This method is usable for LOBs up
to 1 GB in length.</p>
<p>For queries returning LOB columns, it can be more efficient to use
<a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a>,
<a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a>, or
<a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a> instead of <code class="docutils literal notranslate"><span class="pre">lob.getData()</span></code>.</p>
<p>Note it is an asynchronous method and requires a round-trip
to the database:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">async</span> <span class="nx">myLob</span><span class="p">.</span><span class="nx">getData</span><span class="p">();</span>
</pre></div>
</div>
<p>This method was added in node-oracledb 4.0.</p>
</div>
<div class="section" id="id98">
<h5>Parameters<a class="headerlink" href="#id98" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getData()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>String data</em> or <em>Buffer data</em> | The value of the LOB.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-poolclass-a-8-pool-class">
<h2><a name="poolclass"></a> 8. Pool Class<a class="headerlink" href="#a-name-poolclass-a-8-pool-class" title="Permalink to this headline">¶</a></h2>
<p>A connection <em>Pool</em> object is created by calling the
<a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code></a> method.</p>
<p>The <em>Pool</em> object obtains connections to the Oracle database using the
<code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> method to “check them out” from the pool. Internally
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C">Oracle Call Interface Session Pooling</a> is used.</p>
<p>After the application finishes using a connection pool, it should
release all connections and terminate the connection pool by calling
the <code class="docutils literal notranslate"><span class="pre">close()</span></code> method on the Pool object.</p>
<p>See <a class="reference external" href="#connpooling">Connection Pooling</a> for more information.</p>
<div class="section" id="a-name-poolproperties-a-8-1-pool-properties">
<h3><a name="poolproperties"></a> 8.1 Pool Properties<a class="headerlink" href="#a-name-poolproperties-a-8-1-pool-properties" title="Permalink to this headline">¶</a></h3>
<p>The <em>Pool</em> object properties may be read to determine the current
values.</p>
<div class="section" id="a-name-proppoolconnectionsinuse-a-8-1-1-pool-connectionsinuse">
<h4><a name="proppoolconnectionsinuse"></a> 8.1.1 <code class="docutils literal notranslate"><span class="pre">pool.connectionsInUse</span></code><a class="headerlink" href="#a-name-proppoolconnectionsinuse-a-8-1-1-pool-connectionsinuse" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">connectionsInUse</span>
</pre></div>
</div>
<p>The number of currently active connections in the connection pool
i.e. the number of connections currently “checked out” using
<code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>.</p>
</div>
<div class="section" id="a-name-proppoolconnectionsopen-a-8-1-2-pool-connectionsopen">
<h4><a name="proppoolconnectionsopen"></a> 8.1.2 <code class="docutils literal notranslate"><span class="pre">pool.connectionsOpen</span></code><a class="headerlink" href="#a-name-proppoolconnectionsopen-a-8-1-2-pool-connectionsopen" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">connectionsOpen</span>
</pre></div>
</div>
<p>The number of currently open connections in the underlying connection
pool.</p>
</div>
<div class="section" id="a-name-proppoolpoolalias-a-8-1-3-pool-poolalias">
<h4><a name="proppoolpoolalias"></a> 8.1.3 <code class="docutils literal notranslate"><span class="pre">pool.poolAlias</span></code><a class="headerlink" href="#a-name-proppoolpoolalias-a-8-1-3-pool-poolalias" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">poolAlias</span>
</pre></div>
</div>
<p>The alias of this pool in the <a class="reference external" href="#connpoolcache">connection pool cache</a>.  An alias cannot be changed once the pool has been created.  This property will be undefined for the second and subsequent pools that were created without an explicit alias specified.</p>
</div>
<div class="section" id="a-name-proppoolpoolincrement-a-8-1-4-pool-poolincrement">
<h4><a name="proppoolpoolincrement"></a> 8.1.4 <code class="docutils literal notranslate"><span class="pre">pool.poolIncrement</span></code><a class="headerlink" href="#a-name-proppoolpoolincrement-a-8-1-4-pool-poolincrement" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">poolIncrement</span>
</pre></div>
</div>
<p>The number of connections that are opened whenever a connection
request exceeds the number of currently open connections.</p>
<p>See <a class="reference external" href="#propdbpoolincrement"><code class="docutils literal notranslate"><span class="pre">oracledb.poolIncrement</span></code></a>.</p>
</div>
<div class="section" id="a-name-proppoolpoolmax-a-8-1-5-pool-poolmax">
<h4><a name="proppoolpoolmax"></a> 8.1.5 <code class="docutils literal notranslate"><span class="pre">pool.poolMax</span></code><a class="headerlink" href="#a-name-proppoolpoolmax-a-8-1-5-pool-poolmax" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">poolMax</span>
</pre></div>
</div>
<p>The maximum number of connections that can be open in the connection
pool.</p>
<p>See <a class="reference external" href="#propdbpoolmax"><code class="docutils literal notranslate"><span class="pre">oracledb.poolMax</span></code></a>.</p>
</div>
<div class="section" id="a-name-proppoolpoolmin-a-8-1-6-pool-poolmin">
<h4><a name="proppoolpoolmin"></a> 8.1.6 <code class="docutils literal notranslate"><span class="pre">pool.poolMin</span></code><a class="headerlink" href="#a-name-proppoolpoolmin-a-8-1-6-pool-poolmin" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">poolMin</span>
</pre></div>
</div>
<p>The minimum number of connections a connection pool maintains, even
when there is no activity to the target database.</p>
<p>See <a class="reference external" href="#propdbpoolmin"><code class="docutils literal notranslate"><span class="pre">oracledb.poolMin</span></code></a>.</p>
</div>
<div class="section" id="a-name-proppoolpoolpinginterval-a-8-1-7-pool-poolpinginterval">
<h4><a name="proppoolpoolpinginterval"></a> 8.1.7 <code class="docutils literal notranslate"><span class="pre">pool.poolPingInterval</span></code><a class="headerlink" href="#a-name-proppoolpoolpinginterval-a-8-1-7-pool-poolpinginterval" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">poolPingInterval</span>
</pre></div>
</div>
<p>The maximum number of seconds that a connection can remain idle in a
connection pool (not “checked out” to the application by
<code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>) before node-oracledb pings the database prior to
returning that connection to the application.</p>
<p>See <a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">oracledb.poolPingInterval</span></code></a>.</p>
</div>
<div class="section" id="a-name-proppoolpooltimeout-a-8-1-8-pool-pooltimeout">
<h4><a name="proppoolpooltimeout"></a> 8.1.8 <code class="docutils literal notranslate"><span class="pre">pool.poolTimeout</span></code><a class="headerlink" href="#a-name-proppoolpooltimeout-a-8-1-8-pool-pooltimeout" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">poolTimeout</span>
</pre></div>
</div>
<p>The time (in seconds) after which the pool terminates idle connections
(unused in the pool). The number of connections does not drop below
poolMin.</p>
<p>See <a class="reference external" href="#propdbpooltimeout"><code class="docutils literal notranslate"><span class="pre">oracledb.poolTimeout</span></code></a>.</p>
</div>
<div class="section" id="a-name-proppoolqueuerequests-a-8-1-9-pool-queuerequests">
<h4><a name="proppoolqueuerequests"></a> 8.1.9 <code class="docutils literal notranslate"><span class="pre">pool.queueRequests</span></code><a class="headerlink" href="#a-name-proppoolqueuerequests-a-8-1-9-pool-queuerequests" title="Permalink to this headline">¶</a></h4>
<p>This property was removed in node-oracledb 3.0.  Queuing is now always
enabled.  See <a class="reference external" href="#connpoolqueue">Connection Pool Queue</a> for more
information.</p>
</div>
<div class="section" id="a-name-proppoolqueuetimeout-a-8-1-10-pool-queuetimeout">
<h4><a name="proppoolqueueTimeout"></a> 8.1.10 <code class="docutils literal notranslate"><span class="pre">pool.queueTimeout</span></code><a class="headerlink" href="#a-name-proppoolqueuetimeout-a-8-1-10-pool-queuetimeout" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">queueTimeout</span>
</pre></div>
</div>
<p>The time (in milliseconds) that a connection request should wait in
the queue before the request is terminated.</p>
<p>See <a class="reference external" href="#propdbqueuetimeout"><code class="docutils literal notranslate"><span class="pre">oracledb.queueTimeout</span></code></a>.</p>
</div>
<div class="section" id="a-name-proppoolstatus-a-8-1-11-pool-status">
<h4><a name="proppoolstatus"></a> 8.1.11 <code class="docutils literal notranslate"><span class="pre">pool.status</span></code><a class="headerlink" href="#a-name-proppoolstatus-a-8-1-11-pool-status" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">status</span>
</pre></div>
</div>
<p>One of the <a class="reference external" href="#oracledbconstantspool"><code class="docutils literal notranslate"><span class="pre">oracledb.POOL_STATUS_OPEN</span></code></a>,
<a class="reference external" href="#oracledbconstantspool"><code class="docutils literal notranslate"><span class="pre">POOL_STATUS_DRAINING</span></code></a>, or
<a class="reference external" href="#oracledbconstantspool"><code class="docutils literal notranslate"><span class="pre">POOL_STATUS_CLOSED</span></code></a> constants indicating whether the
pool is open, being drained of in-use connections, or has been closed.</p>
<p>See <a class="reference external" href="#conpooldraining">Connection Pool Closing and Draining</a>.</p>
</div>
<div class="section" id="a-name-proppoolstmtcachesize-a-8-1-12-pool-stmtcachesize">
<h4><a name="proppoolstmtcachesize"></a> 8.1.12 <code class="docutils literal notranslate"><span class="pre">pool.stmtCacheSize</span></code><a class="headerlink" href="#a-name-proppoolstmtcachesize-a-8-1-12-pool-stmtcachesize" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Number</span> <span class="n">stmtCacheSize</span>
</pre></div>
</div>
<p>The number of statements to be cached in the
<a class="reference external" href="#stmtcache">statement cache</a> of each connection.</p>
<p>See <a class="reference external" href="#propdbstmtcachesize"><code class="docutils literal notranslate"><span class="pre">oracledb.stmtCacheSize</span></code></a>.</p>
</div>
</div>
<div class="section" id="a-name-poolmethods-a-8-2-pool-methods">
<h3><a name="poolmethods"></a> 8.2 Pool Methods<a class="headerlink" href="#a-name-poolmethods-a-8-2-pool-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-poolclose-a-8-2-1-pool-close">
<h4><a name="poolclose"></a> 8.2.1 <code class="docutils literal notranslate"><span class="pre">pool.close()</span></code><a class="headerlink" href="#a-name-poolclose-a-8-2-1-pool-close" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id99">
<h5>Prototype<a class="headerlink" href="#id99" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">close</span><span class="p">([</span><span class="n">Number</span> <span class="n">drainTime</span><span class="p">,]</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">close</span><span class="p">([</span><span class="n">Number</span> <span class="n">drainTime</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id100">
<h5>Description<a class="headerlink" href="#id100" title="Permalink to this headline">¶</a></h5>
<p>This call closes connections in the pool and terminates the connection
pool.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> is not given, then any open connections should be
released with <a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">connection.close()</span></code></a> before
<code class="docutils literal notranslate"><span class="pre">pool.close()</span></code> is called, otherwise the pool close will fail and the
pool will remain open.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> is specified, then any new <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code>
calls will fail.  If connections are in use by the application, they
can continue to be used for the specified number of seconds, after
which the pool and all open connections are forcibly closed.  Prior to
this time limit, if there are no connections currently “checked out”
from the pool with <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>, then the pool and any
connections that are idle in the pool are immediately closed.
Non-zero <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> values are strongly recommended so applications
have the opportunity to gracefully finish database operations.  A
<code class="docutils literal notranslate"><span class="pre">drainTime</span></code> of 0 may be used to close a pool and its connections
immediately.</p>
<p>In network configurations that drop (or in-line) out-of-band breaks,
forced pool termination may hang unless you have
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-42E939DC-EF37-49A0-B4F0-14158F0E55FD"><code class="docutils literal notranslate"><span class="pre">DISABLE_OOB=ON</span></code></a> in a <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> file, see <a class="reference external" href="#tnsadmin">Optional Oracle
Net Configuration</a>.</p>
<p>When the pool is closed, it will be removed from the <a class="reference external" href="#connpoolcache">connection pool
cache</a>.</p>
<p>This method was added to node-oracledb 1.9, replacing the equivalent
alias <code class="docutils literal notranslate"><span class="pre">pool.terminate()</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> parameter was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id101">
<h5>Parameters<a class="headerlink" href="#id101" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">drainTime</span>
</pre></div>
</div>
<p>The number of seconds before the pool and connections are force closed.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> is 0, the pool and its connections are closed immediately.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">close()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-getconnectionpool-a-8-2-2-pool-getconnection">
<h4><a name="getconnectionpool"></a> 8.2.2 <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code><a class="headerlink" href="#a-name-getconnectionpool-a-8-2-2-pool-getconnection" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id102">
<h5>Prototype<a class="headerlink" href="#id102" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getConnection</span><span class="p">([</span><span class="n">Object</span> <span class="n">poolAttrs</span><span class="p">,]</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Connection</span> <span class="n">connection</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getConnection</span><span class="p">([</span><span class="n">Object</span> <span class="n">poolAttrs</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id103">
<h5>Description<a class="headerlink" href="#id103" title="Permalink to this headline">¶</a></h5>
<p>This method obtains a connection from the connection pool.</p>
<p>If a previously opened connection is available in the pool, that
connection is returned.  If all connections in the pool are in use, a
new connection is created and returned to the caller, as long as the
number of connections does not exceed the specified maximum for the
pool. If the pool is at its maximum limit, the <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> call
results in an error, such as <em>ORA-24418: Cannot open further sessions</em>.</p>
<p>By default pools are created with
<a class="reference external" href="#createpoolpoolattrshomogeneous"><code class="docutils literal notranslate"><span class="pre">homogeneous</span></code></a> set to <em>true</em>.  The
user name and password are supplied when the pool is created.  Each
time <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> is called, a connection for that user is
returned:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>
</pre></div>
</div>
<p>If a heterogeneous pool was created by setting
<a class="reference external" href="#createpoolpoolattrshomogeneous"><code class="docutils literal notranslate"><span class="pre">homogeneous</span></code></a> to <em>false</em> during
creation and credentials were omitted, then the user name and password
may be used in <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
        <span class="nx">user</span>     <span class="o">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
        <span class="nx">password</span> <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
  <span class="p">}</span>
<span class="p">);,</span>
</pre></div>
</div>
<p>In this case, different user names may be used each time
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> is called.  Proxy users may also be specified.</p>
<p>See <a class="reference external" href="#connectionhandling">Connection Handling</a> for more information on
connections.</p>
<p>See <a class="reference external" href="#connpoolproxy">Heterogeneous Connection Pools and Pool Proxy
Authentication</a> for more information on heterogeneous
pools.</p>
</div>
<div class="section" id="id104">
<h5>Parameters<a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">poolAttrs</span>
</pre></div>
</div>
<p>This optional parameter is used when getting connections from
heterogeneous pools.  It can contain <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> properties
for true heterogeneous pool usage, or it can contain a <code class="docutils literal notranslate"><span class="pre">user</span></code> property
when a pool proxy user is desired.  It can contain <code class="docutils literal notranslate"><span class="pre">tag</span></code> when
<a class="reference external" href="#connpooltagging">connection tagging</a> is in use.</p>
<p>See <a class="reference external" href="#getconnectiondbattrsconnattrs">Connection Attributes</a> for
discussion of these attributes.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Connection</span> <span class="n">connection</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the <a class="reference external" href="#errorobj">error message</a>.
<em>Connection connection</em> | The newly created connection.   If <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> fails, <code class="docutils literal notranslate"><span class="pre">connection</span></code> will be NULL.  See <a class="reference external" href="#connectionclass">Connection class</a> for more details.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-terminate-a-8-2-3-pool-terminate">
<h4><a name="terminate"></a> 8.2.3 <code class="docutils literal notranslate"><span class="pre">pool.terminate()</span></code><a class="headerlink" href="#a-name-terminate-a-8-2-3-pool-terminate" title="Permalink to this headline">¶</a></h4>
<p>An alias for <a class="reference external" href="#poolclose">pool.close()</a>.</p>
</div>
</div>
</div>
<div class="section" id="a-name-resultsetclass-a-9-resultset-class">
<h2><a name="resultsetclass"></a> 9. ResultSet Class<a class="headerlink" href="#a-name-resultsetclass-a-9-resultset-class" title="Permalink to this headline">¶</a></h2>
<p>ResultSets allow query results to fetched from the database one at a
time, or in groups of rows.  They can also be converted to Readable
Streams.  ResultSets enable applications to process very large data
sets.</p>
<p>ResultSets should also be used where the number of query rows cannot
be predicted and may be larger than Node.js can handle in a single
array.</p>
<p>A <em>ResultSet</em> object is obtained by setting <code class="docutils literal notranslate"><span class="pre">resultSet:</span> <span class="pre">true</span></code> in the
<code class="docutils literal notranslate"><span class="pre">options</span></code> parameter of the <em>Connection</em> <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> method
when executing a query.  A <em>ResultSet</em> is also returned to
node-oracledb when binding as type <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code></a> to a
PL/SQL REF CURSOR bind parameter.</p>
<p>See <a class="reference external" href="#resultsethandling">Fetching Rows with Result Sets</a> for more information on ResultSets.</p>
<div class="section" id="a-name-resultsetproperties-a-9-1-resultset-properties">
<h3><a name="resultsetproperties"></a> 9.1 ResultSet Properties<a class="headerlink" href="#a-name-resultsetproperties-a-9-1-resultset-properties" title="Permalink to this headline">¶</a></h3>
<p>The properties of a <em>ResultSet</em> object are listed below.</p>
<div class="section" id="a-name-rsmetadata-a-9-1-1-resultset-metadata">
<h4><a name="rsmetadata"></a> 9.1.1 <code class="docutils literal notranslate"><span class="pre">resultset.metaData</span></code><a class="headerlink" href="#a-name-rsmetadata-a-9-1-1-resultset-metadata" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Array</span> <span class="n">metaData</span>
</pre></div>
</div>
<p>Contains an array of objects with metadata about the query or REF
CURSOR columns.</p>
<p>Each column’s <code class="docutils literal notranslate"><span class="pre">name</span></code> is always given.  If the
<a class="reference external" href="#propdbextendedmetadata"><code class="docutils literal notranslate"><span class="pre">oracledb.extendedMetaData</span></code></a> or <code class="docutils literal notranslate"><span class="pre">execute()</span></code> option
<a class="reference external" href="#propexecextendedmetadata"><code class="docutils literal notranslate"><span class="pre">extendedMetaData</span></code></a> are <em>true</em> then
additional information is included.</p>
<p>See <a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">result.metaData</span></code></a> for the available attributes.</p>
</div>
</div>
<div class="section" id="a-name-resultsetmethods-a-9-2-resultset-methods">
<h3><a name="resultsetmethods"></a> 9.2 ResultSet Methods<a class="headerlink" href="#a-name-resultsetmethods-a-9-2-resultset-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-close-a-9-2-1-resultset-close">
<h4><a name="close"></a> 9.2.1 <code class="docutils literal notranslate"><span class="pre">resultset.close()</span></code><a class="headerlink" href="#a-name-close-a-9-2-1-resultset-close" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id105">
<h5>Prototype<a class="headerlink" href="#id105" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">close</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">close</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id106">
<h5>Description<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h5>
<p>Closes a ResultSet.  Applications should always call this at the end
of fetch or when no more rows are needed.  It should also be called if
no rows are ever going to be fetched from the ResultSet.</p>
</div>
</div>
<div class="section" id="a-name-getrow-a-9-2-2-resultset-getrow">
<h4><a name="getrow"></a> 9.2.2 <code class="docutils literal notranslate"><span class="pre">resultset.getRow()</span></code><a class="headerlink" href="#a-name-getrow-a-9-2-2-resultset-getrow" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id107">
<h5>Prototype<a class="headerlink" href="#id107" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getRow</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">row</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getRow</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id108">
<h5>Description<a class="headerlink" href="#id108" title="Permalink to this headline">¶</a></h5>
<p>This call fetches one row of the ResultSet as an object or an array of
column values, depending on the value of
<a class="reference external" href="#propdboutformat">outFormat</a>.</p>
<p>At the end of fetching, the ResultSet should be freed by calling
<a class="reference external" href="#close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a>.</p>
<p>Performance of <code class="docutils literal notranslate"><span class="pre">getRow()</span></code> can be tuned by adjusting the value of
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code></a> or the <code class="docutils literal notranslate"><span class="pre">execute()</span></code>
option <a class="reference external" href="#propexecfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a>.</p>
</div>
</div>
<div class="section" id="a-name-getrows-a-9-2-3-resultset-getrows">
<h4><a name="getrows"></a> 9.2.3 <code class="docutils literal notranslate"><span class="pre">resultset.getRows()</span></code><a class="headerlink" href="#a-name-getrows-a-9-2-3-resultset-getrows" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id109">
<h5>Prototype<a class="headerlink" href="#id109" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getRows</span><span class="p">(</span><span class="n">Number</span> <span class="n">numRows</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Array</span> <span class="n">rows</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getRows</span><span class="p">(</span><span class="n">Number</span> <span class="n">numRows</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id110">
<h5>Description<a class="headerlink" href="#id110" title="Permalink to this headline">¶</a></h5>
<p>This call fetches <code class="docutils literal notranslate"><span class="pre">numRows</span></code> rows of the ResultSet as an object or an
array of column values, depending on the value of <a class="reference external" href="#propdboutformat">outFormat</a>.</p>
<p>At the end of fetching, the ResultSet should be freed by calling <a class="reference external" href="#close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a>.</p>
<p>Different values of <code class="docutils literal notranslate"><span class="pre">numRows</span></code> may alter the time needed for fetching
data from Oracle Database.  The value of
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a> has no effect on <code class="docutils literal notranslate"><span class="pre">getRows()</span></code>
performance or internal buffering.</p>
</div>
</div>
<div class="section" id="a-name-toquerystream-a-9-2-4-resultset-toquerystream">
<h4><a name="toquerystream"></a> 9.2.4 <code class="docutils literal notranslate"><span class="pre">resultset.toQueryStream()</span></code><a class="headerlink" href="#a-name-toquerystream-a-9-2-4-resultset-toquerystream" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id111">
<h5>Prototype<a class="headerlink" href="#id111" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">toQueryStream</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id112">
<h5>Return Value<a class="headerlink" href="#id112" title="Permalink to this headline">¶</a></h5>
<p>This method will return a <a class="reference external" href="https://nodejs.org/api/stream.html">Readable Stream</a>.</p>
</div>
<div class="section" id="id113">
<h5>Description<a class="headerlink" href="#id113" title="Permalink to this headline">¶</a></h5>
<p>This synchronous method converts a ResultSet into a stream.</p>
<p>It can be used to make ResultSets from top-level queries or from REF
CURSOR bind variables streamable.  To make top-level queries
streamable, the alternative <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">connection.queryStream()</span></code></a>
method may be easier to use.</p>
<p>To change the behavior of <code class="docutils literal notranslate"><span class="pre">toQueryStream()</span></code>, such as setting the
<a class="reference external" href="#queryoutputformats">query output Format</a> or the internal buffer size
for performance, adjust global attributes such as
<a class="reference external" href="#propdboutformat"><code class="docutils literal notranslate"><span class="pre">oracledb.outFormat</span></code></a> and
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code></a> before calling
<a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a>.</p>
<p>See <a class="reference external" href="#streamingresults">Query Streaming</a> for more information.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">toQueryStream()</span></code> method was added in node-oracledb 1.9.  Support
for Node.js 8’s Stream <code class="docutils literal notranslate"><span class="pre">destroy()</span></code> method was added in node-oracledb 2.1.</p>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-sodacollectionclass-a-10-sodacollection-class">
<h2><a name="sodacollectionclass"></a> 10. SodaCollection Class<a class="headerlink" href="#a-name-sodacollectionclass-a-10-sodacollection-class" title="Permalink to this headline">¶</a></h2>
<p>SODA can be used with Oracle Database 18.3 and above, when node-oracledb uses
Oracle Client 18.5 or Oracle Client 19.3, or later.  The SODA bulk insert
methods <a class="reference external" href="#sodacollinsertmany"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertMany()</span></code></a> and
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a> are in Preview
status.</p>
<div class="section" id="a-name-sodacollectionproperties-a-10-1-sodacollection-properties">
<h3><a name="sodacollectionproperties"></a> 10.1 SodaCollection Properties<a class="headerlink" href="#a-name-sodacollectionproperties-a-10-1-sodacollection-properties" title="Permalink to this headline">¶</a></h3>
<p>Each SodaCollection object contains read-only properties:</p>
</div>
<div class="section" id="a-name-sodacollectionpropmetadata-a-10-1-1-sodacollection-metadata">
<h3><a name="sodacollectionpropmetadata"></a> 10.1.1 <code class="docutils literal notranslate"><span class="pre">sodaCollection.metaData</span></code><a class="headerlink" href="#a-name-sodacollectionpropmetadata-a-10-1-1-sodacollection-metadata" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">Object</span> <span class="n">metaData</span>
</pre></div>
</div>
<p>Metadata of the current collection.  See <a class="reference external" href="#sodaclientkeys">SODA Client-Assigned Keys
and Collection Metadata</a>.</p>
<p>This property was added in node-oracledb 3.0. Its type was changed to Object in
node-oracledb 4.0.</p>
</div>
<div class="section" id="a-name-sodacollectionpropname-a-10-1-2-sodacollection-name">
<h3><a name="sodacollectionpropname"></a> 10.1.2 <code class="docutils literal notranslate"><span class="pre">sodaCollection.name</span></code><a class="headerlink" href="#a-name-sodacollectionpropname-a-10-1-2-sodacollection-name" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readonly</span> <span class="n">String</span> <span class="n">name</span>
</pre></div>
</div>
<p>Name of the current collection.</p>
<p>This property was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodacollectionmethods-a-10-2-sodacollection-methods">
<h3><a name="sodacollectionmethods"></a> 10.2 SodaCollection Methods<a class="headerlink" href="#a-name-sodacollectionmethods-a-10-2-sodacollection-methods" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="a-name-sodacollcreateindex-a-10-2-1-sodacollection-createindex">
<h3><a name="sodacollcreateindex"></a> 10.2.1 <code class="docutils literal notranslate"><span class="pre">sodaCollection.createIndex()</span></code><a class="headerlink" href="#a-name-sodacollcreateindex-a-10-2-1-sodacollection-createindex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id114">
<h4>Prototype<a class="headerlink" href="#id114" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">createIndex</span><span class="p">(</span><span class="n">Object</span> <span class="n">indexSpec</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">createIndex</span><span class="p">(</span><span class="n">Object</span> <span class="n">indexSpec</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id115">
<h4>Description<a class="headerlink" href="#id115" title="Permalink to this headline">¶</a></h4>
<p>Creates an index on a SODA collection, to improve the performance of
SODA query-by-examples (QBE) or enable text searches.  An index is
defined by a specification, which is a JSON object that specifies how
particular QBE patterns are to be indexed for quicker matching.</p>
<p>Note that a commit should be performed before attempting to create an
index.</p>
<p>Different index types can be used:</p>
<ul class="simple">
<li><p>B-tree: used to speed up query-by-example (QBE) <a class="reference external" href="#sodaoperationclassfilter"><code class="docutils literal notranslate"><span class="pre">filter()</span></code></a> searches.</p></li>
<li><p>JSON search: required for text searches using the <code class="docutils literal notranslate"><span class="pre">$contains</span></code> operator in QBEs.  Also improves QBE filter operation performance. Note a B-tree index will perform better for non-text searches.</p></li>
<li><p>GeoSpatial: for speeding up QBEs that do GeoJSON queries.</p></li>
</ul>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">createIndex()</span></code> succeeds, then any open user transaction is committed.
Note SODA DDL operations do not commit an open transaction the way that
SQL always does for DDL statements.</p>
<p>See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-4848E6A0-58A7-44FD-8D6D-A033D0CCF9CB">Overview of SODA Indexing</a>.</p>
<p>This method was added in node-oracledb 3.0.</p>
<p>As an example, if a collection has these documents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Chris&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Venkat&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Srinath&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Then a B-tree index could be created with:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">indexSpec</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;myIndex&quot;</span><span class="p">,</span> <span class="nx">fields</span><span class="o">:</span> <span class="p">[{</span><span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}]};</span>
<span class="nx">await</span> <span class="nx">createIndex</span><span class="p">(</span><span class="nx">indexSpec</span><span class="p">);</span>
</pre></div>
</div>
<p>This index would improve the performance of QBEs like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">d</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Venkat&quot;</span><span class="p">}).</span><span class="nx">getOne</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-sodacollcreateindexparams-a-10-2-1-1-createindex-parameters">
<h4><a name="sodacollcreateindexparams"></a> 10.2.1.1 <code class="docutils literal notranslate"><span class="pre">createIndex()</span></code> Parameters<a class="headerlink" href="#a-name-sodacollcreateindexparams-a-10-2-1-1-createindex-parameters" title="Permalink to this headline">¶</a></h4>
<div class="section" id="a-name-sodacollcreateindexspec-a-10-2-1-1-1-indexspec">
<h5><a name="sodacollcreateindexspec"></a> 10.2.1.1.1 <code class="docutils literal notranslate"><span class="pre">indexSpec</span></code><a class="headerlink" href="#a-name-sodacollcreateindexspec-a-10-2-1-1-1-indexspec" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">indexSpec</span>
</pre></div>
</div>
<p>An object with fields as shown in the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-00C06941-6FFD-4CEB-81B6-9A7FBD577A2C">SODA Index Specifications (Reference)</a> manual.</p>
</div>
</div>
<div class="section" id="a-name-sodacollcreateindexcb-a-10-2-1-2-createindex-callback-function">
<h4><a name="sodacollcreateindexcb"></a> 10.2.1.2 <code class="docutils literal notranslate"><span class="pre">createIndex()</span></code>: Callback Function<a class="headerlink" href="#a-name-sodacollcreateindexcb-a-10-2-1-2-createindex-callback-function" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">createIndex()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.</p>
</div>
</div>
<div class="section" id="a-name-sodacolldrop-a-10-2-2-sodacollection-drop">
<h3><a name="sodacolldrop"></a> 10.2.2 <code class="docutils literal notranslate"><span class="pre">sodaCollection.drop()</span></code><a class="headerlink" href="#a-name-sodacolldrop-a-10-2-2-sodacollection-drop" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id116">
<h4>Prototype<a class="headerlink" href="#id116" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">drop</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">drop</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id117">
<h4>Description<a class="headerlink" href="#id117" title="Permalink to this headline">¶</a></h4>
<p>Drops the current collection.</p>
<p>An error such as <em>ORA-40626</em> will be returned and the collection will
not be dropped if there are uncommitted writes to the collection in
the current transaction.</p>
<p>If the collection was created with mode
<a class="reference external" href="#oracledbconstantssoda"><code class="docutils literal notranslate"><span class="pre">oracledb.SODA_COLL_MAP_MODE</span></code></a>, then <code class="docutils literal notranslate"><span class="pre">drop()</span></code>
will not physically delete the database storage containing the
collection, and won’t drop SODA indexes.  Instead it will simply unmap
the collection, making it inaccessible to SODA operations.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is true, and <code class="docutils literal notranslate"><span class="pre">drop()</span></code>
succeeds, then any open user transaction is committed. Note SODA
operations do not commit an open transaction the way that SQL always
does for DDL statements.</p>
<p>If the collection was created with custom metadata changing the key
assignment method to SEQUENCE, the <code class="docutils literal notranslate"><span class="pre">drop()</span></code> method will not delete the
underlying Oracle sequence.  This is in case it was created outside
SODA.  To drop the sequence, use the SQL command DROP SEQUENCE after
<code class="docutils literal notranslate"><span class="pre">drop()</span></code> has completed.</p>
<p>Note you should never use SQL DROP TABLE command on the database table
underlying a collection.  This will not clean up SODA’s metadata.  If
you do accidentally execute DROP SQL, you should cleanup the metadata
with <code class="docutils literal notranslate"><span class="pre">drop()</span></code> or execute the SQL statement: <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">DBMS_SODA.DROP_COLLECTION('myCollection')</span> <span class="pre">FROM</span> <span class="pre">DUAL;</span></code>.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodacolldropcallback-a-10-2-2-1-drop-callback-function">
<h4><a name="sodacolldropcallback"></a> 10.2.2.1 <code class="docutils literal notranslate"><span class="pre">drop()</span></code>: Callback Function<a class="headerlink" href="#a-name-sodacolldropcallback-a-10-2-2-1-drop-callback-function" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">drop()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  It is not an error if the collection does not exist.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>Object result</em> | See below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> object contains one attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">dropped</span>
</pre></div>
</div>
<p>If the drop operation succeeded, <code class="docutils literal notranslate"><span class="pre">dropped</span></code> will be <em>true</em>.  If no
collection was found, <code class="docutils literal notranslate"><span class="pre">dropped</span></code> will be <em>false</em>.</p>
</div>
</div>
<div class="section" id="a-name-sodacolldropindex-a-10-2-3-sodacollection-dropindex">
<h3><a name="sodacolldropindex"></a> 10.2.3 <code class="docutils literal notranslate"><span class="pre">sodaCollection.dropIndex()</span></code><a class="headerlink" href="#a-name-sodacolldropindex-a-10-2-3-sodacollection-dropindex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id118">
<h4>Prototype<a class="headerlink" href="#id118" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dropIndex</span><span class="p">(</span><span class="n">String</span> <span class="n">indexName</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">],</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">dropIndex</span><span class="p">(</span><span class="n">String</span> <span class="n">indexName</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id119">
<h4>Description<a class="headerlink" href="#id119" title="Permalink to this headline">¶</a></h4>
<p>Drops the specified index.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>,
and <code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code> succeeds, then any open user transaction is
committed.  Note SODA operations do not commit an open transaction the
way that SQL always does for DDL statements.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodacolldropindexparams-a-10-2-3-1-dropindex-parameters">
<h4><a name="sodacolldropindexparams"></a> 10.2.3.1 <code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code>: Parameters<a class="headerlink" href="#a-name-sodacolldropindexparams-a-10-2-3-1-dropindex-parameters" title="Permalink to this headline">¶</a></h4>
<div class="section" id="a-name-sodacolldropindexindexname-a-10-2-3-1-1-indexname">
<h5><a name="sodacolldropindexindexname"></a> 10.2.3.1.1 <code class="docutils literal notranslate"><span class="pre">indexName</span></code><a class="headerlink" href="#a-name-sodacolldropindexindexname-a-10-2-3-1-1-indexname" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">indexName</span>
</pre></div>
</div>
<p>Name of the index to be dropped.</p>
</div>
<div class="section" id="a-name-sodacolldropindexoptions-a-10-2-3-1-2-options">
<h5><a name="sodacolldropindexoptions"></a> 10.2.3.1.2 <code class="docutils literal notranslate"><span class="pre">options</span></code><a class="headerlink" href="#a-name-sodacolldropindexoptions-a-10-2-3-1-2-options" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">options</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">options</span></code> parameter can have the following attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boolean</span> <span class="n">force</span>
</pre></div>
</div>
<p>Setting <code class="docutils literal notranslate"><span class="pre">force</span></code> to <em>true</em> forces dropping of a JSON Search index or
Spatial index if the underlying Oracle Database domain index does not
permit normal dropping.  See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-F60F75DF-2866-4F93-BB7F-8FCE64BF67B6">DROP INDEX</a>.</p>
</div>
</div>
<div class="section" id="a-name-sodacolldropindexcb-a-10-2-3-2-dropindex-callback-function">
<h4><a name="sodacolldropindexcb"></a> 10.2.3.2 <code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code> Callback Function<a class="headerlink" href="#a-name-sodacolldropindexcb-a-10-2-3-2-dropindex-callback-function" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="id120">
<h4>Prototype<a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id121">
<h4>Parameters<a class="headerlink" href="#id121" title="Permalink to this headline">¶</a></h4>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">dropIndex()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  It is not an error if the index does not exist.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>Boolean dropped</em> | If dropping the index succeeded, <code class="docutils literal notranslate"><span class="pre">dropped</span></code> will be <em>true</em>.  If no index was found, <code class="docutils literal notranslate"><span class="pre">dropped</span></code> will be <em>false</em>.</p>
</div>
</div>
<div class="section" id="a-name-sodacollfind-a-10-2-4-sodacollection-find">
<h3><a name="sodacollfind"></a> 10.2.4 <code class="docutils literal notranslate"><span class="pre">sodaCollection.find()</span></code><a class="headerlink" href="#a-name-sodacollfind-a-10-2-4-sodacollection-find" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id122">
<h4>Prototype<a class="headerlink" href="#id122" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id123">
<h4>Description<a class="headerlink" href="#id123" title="Permalink to this headline">¶</a></h4>
<p>The synchronous <code class="docutils literal notranslate"><span class="pre">find()</span></code> method is used to locate and order a set of
SODA documents for retrieval, replacement, or removal.  It creates and
returns a <a class="reference external" href="#sodaoperationclass">SodaOperation</a> object which is used
via method chaining with non-terminal and terminal methods described
below.  Note that SodaOperation is an internal object whose attributes
should not be accessed directly.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="returns">
<h4>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h4>
<p>Returns a <a class="reference external" href="#sodaoperationclass">SodaOperation</a> object.</p>
</div>
<div class="section" id="id124">
<h4>Example<a class="headerlink" href="#id124" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">({</span><span class="s2">&quot;address.city&quot;</span><span class="p">:</span> <span class="s2">&quot;Melbourne&quot;</span><span class="p">,</span> <span class="s2">&quot;salary&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$gt&quot;</span><span class="p">:</span> <span class="mi">500000</span><span class="p">}})</span><span class="o">.</span><span class="n">getDocuments</span><span class="p">();</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#sodaoverview">Simple Oracle Document Access (SODA)</a> for more examples.</p>
</div>
<div class="section" id="a-name-sodaoperationclass-a-10-2-4-1-sodaoperation-class">
<h4><a name="sodaoperationclass"></a> 10.2.4.1 SodaOperation Class<a class="headerlink" href="#a-name-sodaoperationclass-a-10-2-4-1-sodaoperation-class" title="Permalink to this headline">¶</a></h4>
<p>You can chain together SodaOperation methods, to specify read or write
operations against a collection.</p>
<p>Non-terminal SodaOperation methods return the same object on which
they are invoked, allowing them to be chained together.</p>
<p>A terminal SodaOperation method always appears at the end of a method
chain to execute the operation.</p>
<p>A SodaOperation object is an internal object. You should not directly
modify its properties.</p>
</div>
<div class="section" id="a-name-sodaoperationclassnonterm-a-10-2-4-1-1-non-terminal-sodaoperation-methods">
<h4><a name="sodaoperationclassnonterm"></a> 10.2.4.1.1 Non-terminal SodaOperation Methods<a class="headerlink" href="#a-name-sodaoperationclassnonterm-a-10-2-4-1-1-non-terminal-sodaoperation-methods" title="Permalink to this headline">¶</a></h4>
<p>Non-terminal SodaOperation methods are chained together to set
criteria that documents must satisfy.  At the end of the chain, a
single terminal method specifies the operation to be performed on
the matching documents.</p>
<p>When a non-terminal method is repeated, the last one overrides the
earlier one. For example if <code class="docutils literal notranslate"><span class="pre">find().key(&quot;a&quot;).key(&quot;b&quot;)...</span></code> was used,
then only documents with the key “b” are matched. If
<code class="docutils literal notranslate"><span class="pre">find().keys([&quot;a&quot;,&quot;b&quot;]).key(&quot;c&quot;)...</span></code> is used, then only the document
with the key “c” is matched.</p>
<div class="section" id="a-name-sodaoperationclassfilter-a-10-2-4-1-1-1-sodaoperation-filter">
<h5><a name="sodaoperationclassfilter"></a> 10.2.4.1.1.1 <code class="docutils literal notranslate"><span class="pre">sodaOperation.filter()</span></code><a class="headerlink" href="#a-name-sodaoperationclassfilter-a-10-2-4-1-1-1-sodaoperation-filter" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id125">
<h4>Prototype<a class="headerlink" href="#id125" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span><span class="p">(</span><span class="n">Object</span> <span class="n">filterSpec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id126">
<h4>Description<a class="headerlink" href="#id126" title="Permalink to this headline">¶</a></h4>
<p>Sets a filter specification for the operation, allowing for complex
document queries and ordering of JSON documents.  Filter
specifications can include comparisons, regular expressions, logical,
and spatial operators, among others.  See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-CB09C4E3-BBB1-40DC-88A8-8417821B0FBE">Overview of SODA Filter
Specifications (QBEs)</a> and <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-8DDB51EB-D80F-4476-9ABF-D6860C6214D1">SODA Filter Specifications
(Reference)</a>.</p>
<p>For node-oracledb examples, see <a class="reference external" href="#sodaqbesearches">SODA Query-by-Example Searches for
JSON Documents</a></p>
<p>This method was added in node-oracledb 3.0.</p>
<div class="section" id="a-name-sodaoperationclasskey-a-10-2-4-1-1-2-sodaoperation-key">
<h5><a name="sodaoperationclasskey"></a> 10.2.4.1.1.2 <code class="docutils literal notranslate"><span class="pre">sodaOperation.key()</span></code><a class="headerlink" href="#a-name-sodaoperationclasskey-a-10-2-4-1-1-2-sodaoperation-key" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id127">
<h4>Prototype<a class="headerlink" href="#id127" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span><span class="p">(</span><span class="n">String</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id128">
<h4>Description<a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h4>
<p>Sets the key value to be used to match a document for the operation.
Any previous calls made to this method or
<a class="reference external" href="#sodaoperationclasskeys"><code class="docutils literal notranslate"><span class="pre">keys()</span></code></a> will be ignored.</p>
<p>SODA document keys are unique.</p>
<p>This method was added in node-oracledb 3.0.</p>
<div class="section" id="a-name-sodaoperationclasskeys-a-10-2-4-1-1-3-sodaoperation-keys">
<h5><a name="sodaoperationclasskeys"></a> 10.2.4.1.1.3 <code class="docutils literal notranslate"><span class="pre">sodaOperation.keys()</span></code><a class="headerlink" href="#a-name-sodaoperationclasskeys-a-10-2-4-1-1-3-sodaoperation-keys" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id129">
<h4>Prototype<a class="headerlink" href="#id129" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span><span class="p">(</span><span class="n">Array</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id130">
<h4>Description<a class="headerlink" href="#id130" title="Permalink to this headline">¶</a></h4>
<p>Sets the keys to be used to match multiple documents for the
operation.  Any previous calls made to this method or
<a class="reference external" href="#sodaoperationclasskey"><code class="docutils literal notranslate"><span class="pre">key()</span></code></a> will be ignored.</p>
<p>SODA document keys are unique.</p>
<p>A maximum of 1000 keys can be used.</p>
<p>This method was added in node-oracledb 3.0.</p>
<div class="section" id="a-name-sodaoperationclasslimit-a-10-2-4-1-1-4-sodaoperation-limit">
<h5><a name="sodaoperationclasslimit"></a> 10.2.4.1.1.4 <code class="docutils literal notranslate"><span class="pre">sodaOperation.limit()</span></code><a class="headerlink" href="#a-name-sodaoperationclasslimit-a-10-2-4-1-1-4-sodaoperation-limit" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id131">
<h4>Prototype<a class="headerlink" href="#id131" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">limit</span><span class="p">(</span><span class="n">Number</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id132">
<h4>Description<a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h4>
<p>Sets the maximum number of documents that a terminal method will apply
to.  The value of <code class="docutils literal notranslate"><span class="pre">n</span></code> must be greater than 0.  The limit is applied to
documents that match the other SodaOperation criteria.  The <code class="docutils literal notranslate"><span class="pre">limit()</span></code>
method only applies to SodaOperation read operations like
<code class="docutils literal notranslate"><span class="pre">getCursor()</span></code> and <code class="docutils literal notranslate"><span class="pre">getDocuments()</span></code>.  If a filter <code class="docutils literal notranslate"><span class="pre">$orderby</span></code> is not
used, the document order is internally defined.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">limit()</span></code> method cannot be used in conjunction with
<a class="reference external" href="#sodaoperationclasscount"><code class="docutils literal notranslate"><span class="pre">count()</span></code></a>.</p>
<p>This method was added in node-oracledb 3.0.</p>
<div class="section" id="a-name-sodaoperationclassskip-a-10-2-4-1-1-5-sodaoperation-skip">
<h5><a name="sodaoperationclassskip"></a> 10.2.4.1.1.5 <code class="docutils literal notranslate"><span class="pre">sodaOperation.skip()</span></code><a class="headerlink" href="#a-name-sodaoperationclassskip-a-10-2-4-1-1-5-sodaoperation-skip" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id133">
<h4>Prototype<a class="headerlink" href="#id133" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">skip</span><span class="p">(</span><span class="n">Number</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id134">
<h4>Description<a class="headerlink" href="#id134" title="Permalink to this headline">¶</a></h4>
<p>Sets the number of documents that will be skipped before the terminal
method is applied.  The value of <code class="docutils literal notranslate"><span class="pre">n</span></code> must be greater or equal to 0.  The
skip applies to documents that match the other SodaOperation criteria.</p>
<p>If a filter <code class="docutils literal notranslate"><span class="pre">$orderby</span></code> is not used, the document order (and hence which
documents are skipped) is internally defined.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">skip()</span></code> method only applies to SodaOperation read operations like
<code class="docutils literal notranslate"><span class="pre">getDocuments()</span></code>.  It cannot be used with
<a class="reference external" href="#sodaoperationclasscount"><code class="docutils literal notranslate"><span class="pre">count()</span></code></a>.</p>
<p>This method was added in node-oracledb 3.0.</p>
<div class="section" id="a-name-sodaoperationclassversion-a-10-2-4-1-1-6-sodaoperation-version">
<h5><a name="sodaoperationclassversion"></a> 10.2.4.1.1.6 <code class="docutils literal notranslate"><span class="pre">sodaOperation.version()</span></code><a class="headerlink" href="#a-name-sodaoperationclassversion-a-10-2-4-1-1-6-sodaoperation-version" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id135">
<h4>Prototype<a class="headerlink" href="#id135" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="n">String</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id136">
<h4>Description<a class="headerlink" href="#id136" title="Permalink to this headline">¶</a></h4>
<p>Sets the document version that documents must have.</p>
<p>This is typically used in conjunction with a key, for example
<code class="docutils literal notranslate"><span class="pre">collection.find().key(&quot;k&quot;).version(&quot;v&quot;).replaceOne(doc)</span></code>.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">version()</span></code> allows for optimistic locking, so that the
subsequent SodaOperation terminal method does not affect a document
that someone else has already modified.  If the requested document
version is not matched, then your terminal operation will not impact
any document.  The application can then query to find the latest
document version and apply any desired change.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodaoperationclassterm-a-10-2-4-1-2-terminal-sodaoperation-methods">
<h4><a name="sodaoperationclassterm"></a> 10.2.4.1.2 Terminal SodaOperation Methods<a class="headerlink" href="#a-name-sodaoperationclassterm-a-10-2-4-1-2-terminal-sodaoperation-methods" title="Permalink to this headline">¶</a></h4>
<p>A terminal SodaOperation method operates on the set of documents that
satisfy the criteria specified by previous non-terminal methods in the
method chain.  Only one terminal method can be used in each chain.</p>
<div class="section" id="a-name-sodaoperationclasscount-a-10-2-4-1-2-1-sodaoperation-count">
<h5><a name="sodaoperationclasscount"></a> 10.2.4.1.2.1 <code class="docutils literal notranslate"><span class="pre">sodaOperation.count()</span></code><a class="headerlink" href="#a-name-sodaoperationclasscount-a-10-2-4-1-2-1-sodaoperation-count" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id137">
<h4>Prototype<a class="headerlink" href="#id137" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">count</span><span class="p">(</span><span class="n">function</span> <span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">count</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id138">
<h4>Description<a class="headerlink" href="#id138" title="Permalink to this headline">¶</a></h4>
<p>Finds the number of documents matching the given SodaOperation query criteria.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">skip()</span></code> or <code class="docutils literal notranslate"><span class="pre">limit()</span></code> are set, then <code class="docutils literal notranslate"><span class="pre">count()</span></code> will return an error.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">count()</span></code> succeeds, then any open transaction on the connection is
committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id139">
<h4>Parameters<a class="headerlink" href="#id139" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">count()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>Object result</em> | See below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> object contains one attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">count</span>
</pre></div>
</div>
<p>The number of documents matching the SodaOperation criteria.</p>
</li>
</ul>
<div class="section" id="a-name-sodaoperationclassgetcursor-a-10-2-4-1-2-2-sodaoperation-getcursor">
<h5><a name="sodaoperationclassgetcursor"></a> 10.2.4.1.2.2 <code class="docutils literal notranslate"><span class="pre">sodaOperation.getCursor()</span></code><a class="headerlink" href="#a-name-sodaoperationclassgetcursor-a-10-2-4-1-2-2-sodaoperation-getcursor" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id140">
<h4>Prototype<a class="headerlink" href="#id140" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getCursor</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocumentCursor</span> <span class="n">cursor</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getCursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id141">
<h4>Description<a class="headerlink" href="#id141" title="Permalink to this headline">¶</a></h4>
<p>Returns a <a class="reference external" href="#sodadocumentcursorclass">SodaDocumentCursor</a> for documents
that match the SodaOperation query criteria.  The cursor can be
iterated over with
<a class="reference external" href="#sodadoccursorgetnext"><code class="docutils literal notranslate"><span class="pre">sodaDocumentCursor.getNext()</span></code></a> to access each
<a class="reference external" href="#sodadocumentclass">SodaDocument</a>.</p>
<p>When the application has completed using the cursor it must be closed
with <a class="reference external" href="#sodadoccursorclose"><code class="docutils literal notranslate"><span class="pre">sodaDocumentCursor.close()</span></code></a>.</p>
<p>If the number of documents is known to be small, it is recommended to
use <a class="reference external" href="#sodaoperationclassgetdocuments"><code class="docutils literal notranslate"><span class="pre">sodaOperation.getDocuments()</span></code></a>
instead.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">getCursor()</span></code> succeeds, then any open transaction on the connection is
committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id142">
<h4>Parameters<a class="headerlink" href="#id142" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocumentCursor</span> <span class="n">cursor</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em>  | If <code class="docutils literal notranslate"><span class="pre">getCursor()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>SodaDocumentCursor cursor</em> | A cursor that can be iterated over to access SodaDocument objects matching the SodaOperation search criteria.</p>
</li>
</ul>
<div class="section" id="a-name-sodaoperationclassgetdocuments-a-10-2-4-1-2-3-sodaoperation-getdocuments">
<h5><a name="sodaoperationclassgetdocuments"></a> 10.2.4.1.2.3 <code class="docutils literal notranslate"><span class="pre">sodaOperation.getDocuments()</span></code><a class="headerlink" href="#a-name-sodaoperationclassgetdocuments-a-10-2-4-1-2-3-sodaoperation-getdocuments" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id143">
<h4>Prototype<a class="headerlink" href="#id143" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getDocuments</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Array</span> <span class="n">documents</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getDocuments</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id144">
<h4>Description<a class="headerlink" href="#id144" title="Permalink to this headline">¶</a></h4>
<p>Gets an array of <a class="reference external" href="#sodadocumentclass">SodaDocuments</a> matching the
SodaOperation query criteria.  An empty array will be returned when no
documents match.</p>
<p>Where the number of matching documents is known to be small, this API
should be used in preference to
<a class="reference external" href="#sodaoperationclassgetcursor"><code class="docutils literal notranslate"><span class="pre">sodaOperation.getCursor()</span></code></a>.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">getDocuments()</span></code> succeeds, then any open transaction on the connection
is committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id145">
<h4>Parameters<a class="headerlink" href="#id145" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Array</span> <span class="n">documents</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getDocuments()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>Array documents</em> | An array of SodaDocuments that match the SodaOperation query criteria.</p>
</li>
</ul>
<div class="section" id="a-name-sodaoperationclassgetone-a-10-2-4-1-2-4-sodaoperation-getone">
<h5><a name="sodaoperationclassgetone"></a> 10.2.4.1.2.4 <code class="docutils literal notranslate"><span class="pre">sodaOperation.getOne()</span></code><a class="headerlink" href="#a-name-sodaoperationclassgetone-a-10-2-4-1-2-4-sodaoperation-getone" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id146">
<h4>Prototype<a class="headerlink" href="#id146" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getOne</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getOne</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id147">
<h4>Description<a class="headerlink" href="#id147" title="Permalink to this headline">¶</a></h4>
<p>Obtains one document matching the SodaOperation query criteria.  If
the criteria match more than one document, then only the first is
returned.</p>
<p>Typically <code class="docutils literal notranslate"><span class="pre">getone()</span></code> should be used with <code class="docutils literal notranslate"><span class="pre">key(k)</span></code> or
<code class="docutils literal notranslate"><span class="pre">key(k).version(v)</span></code> to ensure only one document is matched.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">getOne()</span></code> succeeds, then any open transaction on the connection is
committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id148">
<h4>Parameters<a class="headerlink" href="#id148" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getOne()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>SodaDocument document</em> | One SodaDocument that matches the sodaOperation query criteria.  If no document is found, then <code class="docutils literal notranslate"><span class="pre">document</span></code> will be undefined.</p>
</li>
</ul>
<div class="section" id="a-name-sodaoperationclassremove-a-10-2-4-1-2-5-sodaoperation-remove">
<h5><a name="sodaoperationclassremove"></a> 10.2.4.1.2.5 <code class="docutils literal notranslate"><span class="pre">sodaOperation.remove()</span></code><a class="headerlink" href="#a-name-sodaoperationclassremove-a-10-2-4-1-2-5-sodaoperation-remove" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id149">
<h4>Prototype<a class="headerlink" href="#id149" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">remove</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">remove</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id150">
<h4>Description<a class="headerlink" href="#id150" title="Permalink to this headline">¶</a></h4>
<p>Removes a set of documents matching the SodaOperation query criteria.</p>
<p>Note settings from <code class="docutils literal notranslate"><span class="pre">skip()</span></code> and <code class="docutils literal notranslate"><span class="pre">limit()</span></code> non-terminals are ignored because they only apply to read operations.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">remove()</span></code> succeeds, then removal and any open transaction on the
connection is committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id151">
<h4>Parameters<a class="headerlink" href="#id151" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">remove()</span></code> succeeds, error is NULL.  If an error occurs, then error contains the error message.
<em>Object result</em> | See below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> object contains one attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">count</span>
</pre></div>
</div>
<p>The number of documents removed from the collection.</p>
</li>
</ul>
<div class="section" id="a-name-sodaoperationclassreplaceone-a-10-2-4-1-2-6-sodaoperation-replaceone">
<h5><a name="sodaoperationclassreplaceone"></a> 10.2.4.1.2.6 <code class="docutils literal notranslate"><span class="pre">sodaOperation.replaceOne()</span></code><a class="headerlink" href="#a-name-sodaoperationclassreplaceone-a-10-2-4-1-2-6-sodaoperation-replaceone" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id152">
<h4>Prototype<a class="headerlink" href="#id152" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">replaceOne</span><span class="p">(</span><span class="n">Object</span> <span class="n">newDocumentContent</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">){});</span>
<span class="n">replaceOne</span><span class="p">(</span><span class="n">SodaDocument</span> <span class="n">newSodaDocument</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">replaceOne</span><span class="p">(</span><span class="n">Object</span> <span class="n">newDocumentContent</span><span class="p">);</span>
<span class="n">promise</span> <span class="o">=</span> <span class="n">replaceOne</span><span class="p">(</span><span class="n">SodaDocument</span> <span class="n">newSodaDocument</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id153">
<h4>Description<a class="headerlink" href="#id153" title="Permalink to this headline">¶</a></h4>
<p>Replaces a document in a collection.  The input document can be either
a JavaScript object representing the data content, or it can be an
existing <a class="reference external" href="#sodadocumentclass">SodaDocument</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mediaType</span></code> document component and content of the document that
matches the SodaOperation query criteria will be replaced by the
content and any <code class="docutils literal notranslate"><span class="pre">mediaType</span></code> document component of the new document.
Any other document components will not be affected.  The
<code class="docutils literal notranslate"><span class="pre">lastModified</span></code> and <code class="docutils literal notranslate"><span class="pre">version</span></code> document components of the replaced
document will be updated.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">key()</span></code> non-terminal must be used when using <code class="docutils literal notranslate"><span class="pre">replaceOne()</span></code>.</p>
<p>No error is reported if the operation criteria do not match any
document.</p>
<p>Note settings from <code class="docutils literal notranslate"><span class="pre">skip()</span></code> and <code class="docutils literal notranslate"><span class="pre">limit()</span></code> non-terminals are ignored
because they only apply to read operations.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">replaceOne()</span></code> succeeds, then any open transaction on the connection
is committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id154">
<h4>Parameters<a class="headerlink" href="#id154" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">newDocumentContent</span>
<span class="n">SodaDocument</span> <span class="n">newSodaDocument</span>
</pre></div>
</div>
<p>The new document.  See
<a class="reference external" href="#sodacollinsertone">sodaCollection.insertOne()</a>, which has the same
semantics for the document.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Object</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">replaceOne()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  It is not an error if no document is replaced. If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>Object result</em> | See below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> object contains one attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">replaced</span>
</pre></div>
</div>
<p>This attribute will be <em>true</em> if the document was successfully replaced, <em>false</em> otherwise.</p>
</li>
</ul>
<div class="section" id="a-name-sodaoperationclassreplaceoneandget-a-10-2-4-1-2-7-sodaoperation-replaceoneandget">
<h5><a name="sodaoperationclassreplaceoneandget"></a> 10.2.4.1.2.7 <code class="docutils literal notranslate"><span class="pre">sodaOperation.replaceOneAndGet()</span></code><a class="headerlink" href="#a-name-sodaoperationclassreplaceoneandget-a-10-2-4-1-2-7-sodaoperation-replaceoneandget" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="id155">
<h4>Prototype<a class="headerlink" href="#id155" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">replaceOneAndGet</span><span class="p">(</span><span class="n">Object</span> <span class="n">newDocumentContent</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">updatedDocument</span><span class="p">){});</span>
<span class="n">replaceOneAndGet</span><span class="p">(</span><span class="n">SodaDocument</span> <span class="n">newSodaDocument</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">updatedDocument</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">replaceOneAndGet</span><span class="p">(</span><span class="n">Object</span> <span class="n">newDocumentContent</span><span class="p">);</span>
<span class="n">promise</span> <span class="o">=</span> <span class="n">replaceOneAndGet</span><span class="p">(</span><span class="n">SodaDocument</span> <span class="n">newSodaDocument</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id156">
<h4>Description<a class="headerlink" href="#id156" title="Permalink to this headline">¶</a></h4>
<p>Replaces a document in a collection similar to
<a class="reference external" href="#sodaoperationclassreplaceone"><code class="docutils literal notranslate"><span class="pre">replaceOne()</span></code></a>, but also returns the
result document which contains all <a class="reference external" href="#sodadocumentclass">SodaDocument</a>
components (key, version, etc.) except for content.  Content itself is not
returned for performance reasons.  The result document has new values
for components that are updated as part of the replace operation (such
as version, last-modified timestamp, and media type)</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">replaceOneAndGet()</span></code> succeeds, then any open transaction on the
connection is committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id157">
<h4>Parameters<a class="headerlink" href="#id157" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">newDocumentContent</span>
<span class="n">SodaDocument</span> <span class="n">newSodaDocument</span>
</pre></div>
</div>
<p>The new document.  See
<a class="reference external" href="#sodacollinsertone">sodaCollection.insertOne()</a>, which has the same
semantics for the document.</p>
</li>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">updatedDocument</span><span class="p">)</span>
</pre></div>
</div>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">replaceOneAndGet()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  It is not an error if no document is replaced.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>SodaDocument updatedDocument</em> | The updated <a class="reference external" href="#sodadocumentclass">SodaDocument</a> if replacement was successful, otherwise <code class="docutils literal notranslate"><span class="pre">updatedDocument</span></code> will be undefined.  The <code class="docutils literal notranslate"><span class="pre">lastModified</span></code> and <code class="docutils literal notranslate"><span class="pre">version</span></code> attributes of the stored SodaDocument will be updated.  The <code class="docutils literal notranslate"><span class="pre">mediaType</span></code> attribute and the content will be replaced.  Other attributes of <code class="docutils literal notranslate"><span class="pre">newSodaDocument</span></code> are ignored.  Note for performance reasons, <code class="docutils literal notranslate"><span class="pre">updatedDocument</span></code> will not have document content and cannot itself be passed directly to SODA insert or replace methods.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-sodacollgetdataguide-a-10-2-5-sodacollection-getdataguide">
<h3><a name="sodacollgetdataguide"></a> 10.2.5 <code class="docutils literal notranslate"><span class="pre">sodaCollection.getDataGuide()</span></code><a class="headerlink" href="#a-name-sodacollgetdataguide-a-10-2-5-sodacollection-getdataguide" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id158">
<h4>Prototype<a class="headerlink" href="#id158" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getDataGuide</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getDataGuide</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id159">
<h4>Description<a class="headerlink" href="#id159" title="Permalink to this headline">¶</a></h4>
<p>Infers the schema of a collection of JSON documents at the current
time.  A <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-219FC30E-89A7-4189-BC36-7B961A24067C">JSON data guide</a> shows details like the JSON property
names, data types and lengths.  It is useful for exploring the schema
of a collection.  The data guide is represented as JSON content in a
<a class="reference external" href="#sodadocumentclass">SodaDocument</a>.</p>
<p>This method is supported for JSON-only collections which have a <a class="reference external" href="#sodacollcreateindex">JSON
Search index</a> where the “dataguide” option is
“on”.  An error will be returned if a data guide cannot be created.</p>
<p>A data guide is a best effort heuristic and should not be used as a
schema to validate new JSON documents.  The data guide is always
additive, and does not update itself when documents are deleted.
There are some limits such as the maximum number of children under one
node, and the maximum length of a path.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">getDataGuide()</span></code> succeeds, then any open user transaction is
committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id160">
<h4>Parameters<a class="headerlink" href="#id160" title="Permalink to this headline">¶</a></h4>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getDataGuide()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>SodaDocument document</em> | The SodaDocument containing JSON content which can be accessed from the document as normal with <a class="reference external" href="#sodadocgetcontent"><code class="docutils literal notranslate"><span class="pre">sodaDocument.getContent()</span></code></a>, <a class="reference external" href="#sodadocgetcontentasstring"><code class="docutils literal notranslate"><span class="pre">sodaDocument.getContentAsString()</span></code></a> or <a class="reference external" href="#sodadocgetcontentasbuffer"><code class="docutils literal notranslate"><span class="pre">sodaDocument.getContentAsBuffer()</span></code></a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-sodacollinsertmany-a-10-2-6-sodacollection-insertmany">
<h3><a name="sodacollinsertmany"></a> 10.2.6 <code class="docutils literal notranslate"><span class="pre">sodaCollection.insertMany()</span></code><a class="headerlink" href="#a-name-sodacollinsertmany-a-10-2-6-sodacollection-insertmany" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id161">
<h4>Prototype<a class="headerlink" href="#id161" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">insertMany</span><span class="p">(</span><span class="n">Array</span> <span class="n">newDocumentContentArray</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
<span class="n">insertMany</span><span class="p">(</span><span class="n">Array</span> <span class="n">newSodaDocumentArray</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">insertMany</span><span class="p">(</span><span class="n">Array</span> <span class="n">newDocumentContentArray</span><span class="p">);</span>
<span class="n">promise</span> <span class="o">=</span> <span class="n">insertMany</span><span class="p">(</span><span class="n">Array</span> <span class="n">newSodaDocumentArray</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id162">
<h4>Description<a class="headerlink" href="#id162" title="Permalink to this headline">¶</a></h4>
<p>This is similar to <a class="reference external" href="#sodacollinsertone"><code class="docutils literal notranslate"><span class="pre">insertOne()</span></code></a> however it
accepts an array of the Objects or SodaDocuments that <code class="docutils literal notranslate"><span class="pre">insertOne()</span></code>
accepts.  When inserting multiple documents, using <code class="docutils literal notranslate"><span class="pre">insertMany()</span></code> is
recommended in preference to <code class="docutils literal notranslate"><span class="pre">insertOne()</span></code>.</p>
<p>If an error occurs, the offset attribute on the <a class="reference external" href="#errorobj">Error
objects</a> will contain the number of documents that were
successfully inserted.  Subsequent documents in the input array will
not be inserted.</p>
<p>This method is in Preview status and should not be used in production.</p>
<p>This method was added in node-oracledb 4.0.  It requires Oracle Client 18.5 or higher.</p>
</div>
</div>
<div class="section" id="a-name-sodacollinsertmanyandget-a-10-2-7-sodacollection-insertmanyandget">
<h3><a name="sodacollinsertmanyandget"></a> 10.2.7 <code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code><a class="headerlink" href="#a-name-sodacollinsertmanyandget-a-10-2-7-sodacollection-insertmanyandget" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id163">
<h4>Prototype<a class="headerlink" href="#id163" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">insertManyAndGet</span><span class="p">(</span><span class="n">Array</span> <span class="n">newDocumentContentArray</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Array</span> <span class="n">SodaDocuments</span><span class="p">){});</span>
<span class="n">insertManyAndGet</span><span class="p">(</span><span class="n">Array</span> <span class="n">newSodaDocumentArray</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Array</span> <span class="n">SodaDocuments</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">insertManyAndGet</span><span class="p">(</span><span class="n">Array</span> <span class="n">newDocumentContentArray</span><span class="p">);</span>
<span class="n">promise</span> <span class="o">=</span> <span class="n">insertManyAndGet</span><span class="p">(</span><span class="n">Array</span> <span class="n">newSodaDocumentArray</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id164">
<h4>Description<a class="headerlink" href="#id164" title="Permalink to this headline">¶</a></h4>
<p>Similar to <a class="reference external" href="#sodacollinsertmany">sodaCollection.insertMany()</a> but also returns
an array of the inserted documents so system managed properties, such as the
keys (in default collections), can be found.  Content itself is not returned for
performance reasons.  When inserting multiple documents, using
<code class="docutils literal notranslate"><span class="pre">insertManyAndGet()</span></code> is recommended in preference to <code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code>.</p>
<p>This method is in Preview status and should not be used in production.</p>
<p>This method was added in node-oracledb 4.0.  It requires Oracle Client 18.5 or higher.</p>
</div>
</div>
<div class="section" id="a-name-sodacollinsertone-a-10-2-8-sodacollection-insertone">
<h3><a name="sodacollinsertone"></a> 10.2.8 <code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOne()</span></code><a class="headerlink" href="#a-name-sodacollinsertone-a-10-2-8-sodacollection-insertone" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id165">
<h4>Prototype<a class="headerlink" href="#id165" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">insertOne</span><span class="p">(</span><span class="n">Object</span> <span class="n">newDocumentContent</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
<span class="n">insertOne</span><span class="p">(</span><span class="n">SodaDocument</span> <span class="n">newSodaDocument</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">insertOne</span><span class="p">(</span><span class="n">Object</span> <span class="n">newDocumentContent</span><span class="p">);</span>
<span class="n">promise</span> <span class="o">=</span> <span class="n">insertOne</span><span class="p">(</span><span class="n">SodaDocument</span> <span class="n">newSodaDocument</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id166">
<h4>Description<a class="headerlink" href="#id166" title="Permalink to this headline">¶</a></h4>
<p>Inserts a given document to the collection.  The input document can be
either a JavaScript object representing the data content, or it can be
an existing <a class="reference external" href="#sodadocumentclass">SodaDocument</a>.</p>
<p>Note SodaDocuments returned from
<a class="reference external" href="#sodacollinsertoneandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOneAndGet()</span></code></a>,
<a class="reference external" href="#sodaoperationclassreplaceoneandget"><code class="docutils literal notranslate"><span class="pre">sodaOperation.replaceOneAndGet()</span></code></a>, and
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a> cannot be
passed to SODA insert methods, since they do not contain any document content.
Instead, create a JavaScript object using the desired attribute values, or use
<a class="reference external" href="#sodadbcreatedocument"><code class="docutils literal notranslate"><span class="pre">sodaDatabase.createDocument()</span></code></a>, or use a SodaDocument
returned by a <a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">sodaCollection.find()</span></code></a> query.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">insertOne()</span></code> succeeds, then the new document and any open transaction
on the connection is committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
<p>The following examples are equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">newDocumentContent</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Alison&quot;</span><span class="p">};</span>
<span class="k">await</span> <span class="n">sodaCollection</span><span class="o">.</span><span class="n">insertOne</span><span class="p">(</span><span class="n">newDocumentContent</span><span class="p">);</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">newDocumentContent</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Alison&quot;</span><span class="p">};</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">sodaDatabase</span><span class="o">.</span><span class="n">createDocument</span><span class="p">(</span><span class="n">newDocumentContent</span><span class="p">);</span>
<span class="k">await</span> <span class="n">sodaCollection</span><span class="o">.</span><span class="n">insertOne</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-sodacollinsertoneparams-a-10-2-8-1-insertone-parameters">
<h4><a name="sodacollinsertoneparams"></a> 10.2.8.1 <code class="docutils literal notranslate"><span class="pre">insertOne()</span></code>: Parameters<a class="headerlink" href="#a-name-sodacollinsertoneparams-a-10-2-8-1-insertone-parameters" title="Permalink to this headline">¶</a></h4>
<div class="section" id="a-name-sodacollinsertoneparamsdoc-a-10-2-8-1-1-newdocumentcontent-newsodadocument">
<h5><a name="sodacollinsertoneparamsdoc"></a> 10.2.8.1.1 <code class="docutils literal notranslate"><span class="pre">newDocumentContent</span></code>,  <code class="docutils literal notranslate"><span class="pre">newSodaDocument</span></code><a class="headerlink" href="#a-name-sodacollinsertoneparamsdoc-a-10-2-8-1-1-newdocumentcontent-newsodadocument" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">newDocumentContent</span>
<span class="n">SodaDocument</span> <span class="n">newSodaDocument</span>
</pre></div>
</div>
<p>The document to insert.</p>
<p>Passed as a simple JavaScript object, the value is interpreted as JSON
document content.  Other document components (key, version, etc.) will
be auto-generated by SODA during insert.  The media type will be set to
“application/json”.</p>
<p>Alternatively, a <a class="reference external" href="#sodadocumentclass">SodaDocument</a> can be passed.
The <code class="docutils literal notranslate"><span class="pre">content</span></code> and <code class="docutils literal notranslate"><span class="pre">mediaType</span></code> supplied in the SodaDocument will be
used.  The <code class="docutils literal notranslate"><span class="pre">key</span></code>, if set, will also be used if collection has
client-assigned keys.  Other components in the input SodaDocument,
such as version and last-modified, will be ignored and auto-generated
values will be used instead.</p>
</div>
</div>
<div class="section" id="a-name-sodacollinsertonecb-a-10-2-8-2-insertone-callback-function">
<h4><a name="sodacollinsertonecb"></a> 10.2.8.2 <code class="docutils literal notranslate"><span class="pre">insertOne()</span></code> Callback Function<a class="headerlink" href="#a-name-sodacollinsertonecb-a-10-2-8-2-insertone-callback-function" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="id167">
<h4>Prototype<a class="headerlink" href="#id167" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id168">
<h4>Parameters<a class="headerlink" href="#id168" title="Permalink to this headline">¶</a></h4>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">insertOne()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.</p>
</div>
</div>
<div class="section" id="a-name-sodacollinsertoneandget-a-10-2-9-sodacollection-insertoneandget">
<h3><a name="sodacollinsertoneandget"></a> 10.2.9 <code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOneAndGet()</span></code><a class="headerlink" href="#a-name-sodacollinsertoneandget-a-10-2-9-sodacollection-insertoneandget" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id169">
<h4>Prototype<a class="headerlink" href="#id169" title="Permalink to this headline">¶</a></h4>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">insertOneAndGet</span><span class="p">(</span><span class="n">Object</span> <span class="n">newDocumentContent</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">){});</span>
<span class="n">insertOneAndGet</span><span class="p">(</span><span class="n">SodaDocument</span> <span class="n">newSodaDocument</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">insertOneAndGet</span><span class="p">(</span><span class="n">Object</span> <span class="n">newDocumentContent</span><span class="p">);</span>
<span class="n">promise</span> <span class="o">=</span> <span class="n">insertOneAndGet</span><span class="p">(</span><span class="n">SodaDocument</span> <span class="n">newSodaDocument</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id170">
<h4>Description<a class="headerlink" href="#id170" title="Permalink to this headline">¶</a></h4>
<p>Inserts a document in a collection similar to
<a class="reference external" href="#sodacollinsertone"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOne()</span></code></a>, but also returns the result
document which contains all <a class="reference external" href="#sodadocumentclass">SodaDocument</a> components (key,
version, etc.) except for content.  Content itself is not returned for
performance reasons.</p>
<p>If you want to insert the document again, use the original <code class="docutils literal notranslate"><span class="pre">newDocumentContent</span></code>
or <code class="docutils literal notranslate"><span class="pre">newSodaDocument</span></code>.  Alternatively construct a new object from the returned
document and add content.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code> succeeds, then any open transaction on the
connection is committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodacollinsertoneandgetparams-a-10-2-9-1-insertoneandget-parameters">
<h4><a name="sodacollinsertoneandgetparams"></a> 10.2.9.1 <code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code>: Parameters<a class="headerlink" href="#a-name-sodacollinsertoneandgetparams-a-10-2-9-1-insertoneandget-parameters" title="Permalink to this headline">¶</a></h4>
<div class="section" id="a-name-sodacollinsertoneandgetparamsdoc-a-10-2-9-1-1-newdocumentcontent-newsodadocument">
<h5><a name="sodacollinsertoneandgetparamsdoc"></a> 10.2.9.1.1 <code class="docutils literal notranslate"><span class="pre">newDocumentContent</span></code>,  <code class="docutils literal notranslate"><span class="pre">newSodaDocument</span></code><a class="headerlink" href="#a-name-sodacollinsertoneandgetparamsdoc-a-10-2-9-1-1-newdocumentcontent-newsodadocument" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">newDocumentContent</span>
<span class="n">SodaDocument</span> <span class="n">newSodaDocument</span>
</pre></div>
</div>
<p>The document to insert.</p>
<p>For related documentation, see <a class="reference external" href="#sodacollinsertoneparamsdoc"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOne()</span></code></a></p>
</div>
</div>
<div class="section" id="a-name-sodacollinsertoneandgetcb-a-10-2-9-2-insertoneandget-callback-function">
<h4><a name="sodacollinsertoneandgetcb"></a> 10.2.9.2 <code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code> Callback Function<a class="headerlink" href="#a-name-sodacollinsertoneandgetcb-a-10-2-9-2-insertoneandget-callback-function" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="id171">
<h4>Prototype<a class="headerlink" href="#id171" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id172">
<h4>Parameters<a class="headerlink" href="#id172" title="Permalink to this headline">¶</a></h4>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">insertOne()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>SodaDocument document</em> | A result <a class="reference external" href="#sodadocumentclass">SodaDocument</a> that is useful for finding the system generated key and other metadata of the newly inserted document.  Note for performance reasons, <code class="docutils literal notranslate"><span class="pre">document</span></code> will not have document content and cannot itself be passed directly to SODA insert or replace methods.</p>
</div>
</div>
</div>
<div class="section" id="a-name-sodadatabaseclass-a-11-sodadatabase-class">
<h2><a name="sodadatabaseclass"></a> 11. SodaDatabase Class<a class="headerlink" href="#a-name-sodadatabaseclass-a-11-sodadatabase-class" title="Permalink to this headline">¶</a></h2>
<p>The SodaDatabase class is the top level object for node-oracledb SODA
operations. A ‘SODA database’ is an abstraction, allowing access to
SODA collections in that ‘SODA database’, which then allow access to
documents in those collections.</p>
<p>SODA can be used with Oracle Database 18.3 and above, when node-oracledb uses
Oracle Client 18.5 or Oracle Client 19.3, or later.  The SODA bulk insert
methods <a class="reference external" href="#sodacollinsertmany"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertMany()</span></code></a> and
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a> are in Preview
status.</p>
<p>A SODA database is equivalent to an Oracle Database user, see
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-BE42F8D3-B86B-43B4-B2A3-5760A4DF79FB">Overview of SODA</a> in the Introduction to SODA manual.</p>
<p>A SODA database object is created by calling
<a class="reference external" href="#getsodadatabase"><code class="docutils literal notranslate"><span class="pre">connection.getSodaDatabase()</span></code></a>.</p>
<p>See <a class="reference external" href="#sodaoverview">Simple Oracle Document Access (SODA)</a> for more
information.</p>
<div class="section" id="a-name-sodadatabasemethods-a-11-1-sodadatabase-methods">
<h3><a name="sodadatabasemethods"></a> 11.1 SodaDatabase Methods<a class="headerlink" href="#a-name-sodadatabasemethods-a-11-1-sodadatabase-methods" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="a-name-sodadbcreatecollection-a-11-1-1-sodadatabase-createcollection">
<h3><a name="sodadbcreatecollection"></a> 11.1.1 <code class="docutils literal notranslate"><span class="pre">sodaDatabase.createCollection()</span></code><a class="headerlink" href="#a-name-sodadbcreatecollection-a-11-1-1-sodadatabase-createcollection" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id173">
<h4>Prototype<a class="headerlink" href="#id173" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">createCollection</span><span class="p">(</span><span class="n">String</span> <span class="n">collectionName</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">],</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaCollection</span> <span class="n">collection</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">createCollection</span><span class="p">(</span><span class="n">String</span> <span class="n">collectionName</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id174">
<h4>Description<a class="headerlink" href="#id174" title="Permalink to this headline">¶</a></h4>
<p>Creates a SODA collection of the given name. If you try to create a
collection, and a collection with the same name already exists, then
that existing collection is opened without error.</p>
<p>Optional metadata allows collection customization.  If metadata is not
supplied, a default collection will be created</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">createCollection()</span></code> first attempts to create the Oracle Database
table used internally to store the collection.  If the table exists already, it
will attempt to use it as the table underlying the collection.  Most users will
use this default behavior.</p>
<p>If the optional <code class="docutils literal notranslate"><span class="pre">mode</span></code> parameter is
<a class="reference external" href="#oracledbconstantssoda"><code class="docutils literal notranslate"><span class="pre">oracledb.SODA_COLL_MAP_MODE</span></code></a>, SODA will
attempt to use a pre-existing table as the table underlying the
collection.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">createCollection()</span></code> succeeds, then any open transaction on the
connection is committed.  Note SODA operations do not commit an open
transaction the way that SQL always does for DDL statements.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodadbcreatecollectionname-a-11-1-1-1-createcollection-collectionname">
<h4><a name="sodadbcreatecollectionname"></a> 11.1.1.1 <code class="docutils literal notranslate"><span class="pre">createCollection():</span> <span class="pre">collectionName</span></code><a class="headerlink" href="#a-name-sodadbcreatecollectionname-a-11-1-1-1-createcollection-collectionname" title="Permalink to this headline">¶</a></h4>
<p>Name of the collection to be created.</p>
</div>
<div class="section" id="a-name-sodadbcreatecollectionoptions-a-11-1-1-2-createcollection-options">
<h4><a name="sodadbcreatecollectionoptions"></a> 11.1.1.2 <code class="docutils literal notranslate"><span class="pre">createCollection():</span> <span class="pre">options</span></code><a class="headerlink" href="#a-name-sodadbcreatecollectionoptions-a-11-1-1-2-createcollection-options" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">options</span>
</pre></div>
</div>
<p>The options that specify the collection. The following properties can be set.</p>
<div class="section" id="a-name-sodadbcreatecollectionoptsmetadata-a-11-1-1-2-1-metadata">
<h5><a name="sodadbcreatecollectionoptsmetadata"></a> 11.1.1.2.1 <code class="docutils literal notranslate"><span class="pre">metaData</span></code><a class="headerlink" href="#a-name-sodadbcreatecollectionoptsmetadata-a-11-1-1-2-1-metadata" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">metaData</span>
</pre></div>
</div>
<p>Metadata specifying various details about the collection, such as its
database storage, whether it should track version and time stamp
document components, how such components are generated, and what
document types are</p>
<p>If undefined or null, then a default collection metadata description
will be used.  The default metadata specifies that the collection
contains only JSON documents, and is recommend for most SODA users.</p>
<p>For more discussion see <a class="reference external" href="#sodaclientkeys">SODA Client-Assigned Keys and Collection
Metadata</a>.  Also see <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-49EFF3D3-9FAB-4DA6-BDE2-2650383566A3">SODA Collection Metadata
Components</a>.</p>
</div>
<div class="section" id="a-name-sodadbcreatecollectionoptsmode-a-11-1-1-2-2-mode">
<h5><a name="sodadbcreatecollectionoptsmode"></a> 11.1.1.2.2 <code class="docutils literal notranslate"><span class="pre">mode</span></code><a class="headerlink" href="#a-name-sodadbcreatecollectionoptsmode-a-11-1-1-2-2-mode" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">mode</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">mode</span></code> is <a class="reference external" href="#oracledbconstantssoda"><code class="docutils literal notranslate"><span class="pre">oracledb.SODA_COLL_MAP_MODE</span></code></a>, the
collection will be stored in an externally, previously created table.
A future <code class="docutils literal notranslate"><span class="pre">sodaCollection.drop()</span></code> will not drop the collection table.
It will simply unmap it, making it inaccessible to SODA operations.</p>
<p>Most users will leave <code class="docutils literal notranslate"><span class="pre">mode</span></code> undefined.</p>
</div>
</div>
<div class="section" id="a-name-sodadbcreatecollectioncb-a-11-1-1-3-createcollection-callback-function">
<h4><a name="sodadbcreatecollectioncb"></a> 11.1.1.3 <code class="docutils literal notranslate"><span class="pre">createCollection()</span></code>: Callback Function<a class="headerlink" href="#a-name-sodadbcreatecollectioncb-a-11-1-1-3-createcollection-callback-function" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="id175">
<h4>Prototype<a class="headerlink" href="#id175" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaCollection</span> <span class="n">collection</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id176">
<h4>Parameters<a class="headerlink" href="#id176" title="Permalink to this headline">¶</a></h4>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">createCollection()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>SodaCollection collection</em> | The <a class="reference external" href="#sodacollectionclass">SodaCollection</a> containing zero or more SODA documents, depending whether it is a new or existing collection.</p>
</div>
</div>
<div class="section" id="a-name-sodadbcreatedocument-a-11-1-2-sodadatabase-createdocument">
<h3><a name="sodadbcreatedocument"></a> 11.1.2 <code class="docutils literal notranslate"><span class="pre">sodaDatabase.createDocument()</span></code><a class="headerlink" href="#a-name-sodadbcreatedocument-a-11-1-2-sodadatabase-createdocument" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id177">
<h4>Prototype<a class="headerlink" href="#id177" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sodaDatabase</span><span class="o">.</span><span class="n">createDocument</span><span class="p">(</span><span class="n">String</span> <span class="n">content</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">])</span>
<span class="n">sodaDatabase</span><span class="o">.</span><span class="n">createDocument</span><span class="p">(</span><span class="n">Buffer</span> <span class="n">content</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">])</span>
<span class="n">sodaDatabase</span><span class="o">.</span><span class="n">createDocument</span><span class="p">(</span><span class="n">Object</span> <span class="n">content</span> <span class="p">[,</span> <span class="n">Object</span> <span class="n">options</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="id178">
<h4>Description<a class="headerlink" href="#id178" title="Permalink to this headline">¶</a></h4>
<p>A synchronous method that constructs a proto
<a class="reference external" href="#sodadocumentclass">SodaDocument</a> object usable for SODA insert and
replace methods.  SodaDocument attributes like <code class="docutils literal notranslate"><span class="pre">createdOn</span></code> will not be
defined, and neither will attributes valid in <code class="docutils literal notranslate"><span class="pre">options</span></code> but not
specified. The document will not be stored in the database until an
insert or replace method is called.</p>
<p>You only need to call <code class="docutils literal notranslate"><span class="pre">createDocument()</span></code> if your collection requires
client-assigned keys or has non-JSON content, otherwise you can pass
your JSON content directly to the SODA insert and replace methods.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id179">
<h4>Example<a class="headerlink" href="#id179" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">myDoc</span> <span class="o">=</span> <span class="nx">soda</span><span class="p">.</span><span class="nx">createDocument</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Chris&quot;</span><span class="p">,</span> <span class="nx">city</span><span class="o">:</span> <span class="s2">&quot;Melbourne&quot;</span><span class="p">},</span> <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;123&quot;</span><span class="p">});</span> <span class="c1">// assuming client-assigned keys</span>
<span class="nx">newDoc</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">insertOneAndGet</span><span class="p">(</span><span class="nx">myDoc</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The key of the new document is: &quot;</span><span class="p">,</span> <span class="nx">newDoc</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>  <span class="c1">// 123</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-sodadbcreatedocumentcontent-a-11-1-2-1-createdocument-content">
<h4><a name="sodadbcreatedocumentcontent"></a> 11.1.2.1 <code class="docutils literal notranslate"><span class="pre">createDocument():</span> <span class="pre">content</span></code><a class="headerlink" href="#a-name-sodadbcreatedocumentcontent-a-11-1-2-1-createdocument-content" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">content</span>
<span class="n">Buffer</span> <span class="n">content</span>
<span class="n">Object</span> <span class="n">content</span>
</pre></div>
</div>
<p>The document content.</p>
<p>When a Buffer is used, and if the collection <code class="docutils literal notranslate"><span class="pre">mediaType</span></code> is (or will
be) ‘application/json’ (which is the default media type), then the
JSON must be encoded in UTF-8, UTF-16LE or UTF-16BE otherwise you will
get a SODA error on a subsequent write operation.</p>
</div>
<div class="section" id="a-name-sodadbcreatedocumentoptions-a-11-1-2-2-createdocument-options">
<h4><a name="sodadbcreatedocumentoptions"></a> 11.1.2.2 <code class="docutils literal notranslate"><span class="pre">createDocument():</span> <span class="pre">options</span></code><a class="headerlink" href="#a-name-sodadbcreatedocumentoptions-a-11-1-2-2-createdocument-options" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">options</span>
</pre></div>
</div>
<p>The following properties can be set.</p>
<div class="section" id="a-name-sodadbcreatedocumentoptskey-a-11-1-2-2-1-key">
<h5><a name="sodadbcreatedocumentoptskey"></a> 11.1.2.2.1 <code class="docutils literal notranslate"><span class="pre">key</span></code><a class="headerlink" href="#a-name-sodadbcreatedocumentoptskey-a-11-1-2-2-1-key" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">key</span>
</pre></div>
</div>
<p>Must be supplied if the document in intended to be inserted into a
collection with client-assigned keys.  It should be undefined,
otherwise.</p>
</div>
<div class="section" id="a-name-sodadbcreatedocumentoptsmediatype-a-11-1-2-2-2-mediatype">
<h5><a name="sodadbcreatedocumentoptsmediatype"></a> 11.1.2.2.2 <code class="docutils literal notranslate"><span class="pre">mediaType</span></code><a class="headerlink" href="#a-name-sodadbcreatedocumentoptsmediatype-a-11-1-2-2-2-mediatype" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">mediaType</span>
</pre></div>
</div>
<p>If the document has non-JSON content, then <code class="docutils literal notranslate"><span class="pre">mediaType</span></code> should be set
to the desired media type.  Using a MIME type is recommended.</p>
<p>The default is ‘application/json’.</p>
</div>
</div>
</div>
<div class="section" id="a-name-sodadbgetcollectionnames-a-11-1-3-sodadatabase-getcollectionnames">
<h3><a name="sodadbgetcollectionnames"></a> 11.1.3 <code class="docutils literal notranslate"><span class="pre">sodaDatabase.getCollectionNames()</span></code><a class="headerlink" href="#a-name-sodadbgetcollectionnames-a-11-1-3-sodadatabase-getcollectionnames" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id180">
<h4>Prototype<a class="headerlink" href="#id180" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getCollectionNames</span><span class="p">([</span><span class="n">Object</span> <span class="n">options</span><span class="p">,]</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Array</span> <span class="n">collectionNames</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getCollectionNames</span><span class="p">([</span><span class="n">Object</span> <span class="n">options</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="id181">
<h4>Description<a class="headerlink" href="#id181" title="Permalink to this headline">¶</a></h4>
<p>Gets an array  of collection names in alphabetical order.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code> succeeds, then any open transaction on the
connection is committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodadbgetcollectionnamesparams-a-11-1-3-1-getcollectionnames-parameters">
<h4><a name="sodadbgetcollectionnamesparams"></a> 11.1.3.1 <code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code>: Parameters<a class="headerlink" href="#a-name-sodadbgetcollectionnamesparams-a-11-1-3-1-getcollectionnames-parameters" title="Permalink to this headline">¶</a></h4>
<div class="section" id="a-name-sodadbgetcollectionnamesoptions-a-11-1-3-1-1-options">
<h5><a name="sodadbgetcollectionnamesoptions"></a> 11.1.3.1.1 <code class="docutils literal notranslate"><span class="pre">options</span></code><a class="headerlink" href="#a-name-sodadbgetcollectionnamesoptions-a-11-1-3-1-1-options" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="n">options</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">options</span></code> is undefined, then all collection names will be returned.  Otherwise, it can have the following attributes:</p>
<p>Attribute           | Description
——————–|————
<em>Number limit</em>      | Limits the number of names returned. If limit is 0 or undefined, then all collection names are returned.
<em>String startsWith</em> | Returns names that start with the given string, and all subsequent names, in alphabetic order. For example, if collections with names “cat”, “dog”, and “zebra” exist, then using <code class="docutils literal notranslate"><span class="pre">startsWith</span></code> of “d” will return “dog” and “zebra”.  If <code class="docutils literal notranslate"><span class="pre">startsWith</span></code> is an empty string or undefined, all collection names are returned, subject to the value of <code class="docutils literal notranslate"><span class="pre">limit</span></code>.</p>
</div>
</div>
<div class="section" id="a-name-sodadbgetcollectionnamescb-a-11-1-3-2-getcollectionnames-callback-function">
<h4><a name="sodadbgetcollectionnamescb"></a> 11.1.3.2 <code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code>: Callback Function<a class="headerlink" href="#a-name-sodadbgetcollectionnamescb-a-11-1-3-2-getcollectionnames-callback-function" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="id182">
<h4>Prototype<a class="headerlink" href="#id182" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">Array</span> <span class="n">collectionNames</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id183">
<h4>Parameters<a class="headerlink" href="#id183" title="Permalink to this headline">¶</a></h4>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getCollectionNames()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>Array collectionNames</em> | An array of Strings, each containing the name of a SODA collection in this SODA database. The array is in alphabetical order.</p>
</div>
</div>
<div class="section" id="a-name-sodadbopencollection-a-11-1-4-sodadatabase-opencollection">
<h3><a name="sodadbopencollection"></a> 11.1.4 <code class="docutils literal notranslate"><span class="pre">sodaDatabase.openCollection()</span></code><a class="headerlink" href="#a-name-sodadbopencollection-a-11-1-4-sodadatabase-opencollection" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id184">
<h4>Prototype<a class="headerlink" href="#id184" title="Permalink to this headline">¶</a></h4>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openCollection</span><span class="p">(</span><span class="n">String</span> <span class="n">collectionName</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaCollection</span> <span class="n">collection</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">openCollection</span><span class="p">(</span><span class="n">String</span> <span class="n">collectionName</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id185">
<h4>Description<a class="headerlink" href="#id185" title="Permalink to this headline">¶</a></h4>
<p>Opens an existing <a class="reference external" href="#sodacollectionclass">SodaCollection</a> of the given
name.  The collection can then be used to access documents.</p>
<p>If the requested collection does not exist, it is not an
error. Instead, the returned collection value will be undefined.</p>
<p>If <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, and
<code class="docutils literal notranslate"><span class="pre">openCollection()</span></code> succeeds, then any open transaction on the
connection is committed.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodadbopencollectionparams-a-11-1-4-1-opencollection-parameters">
<h4><a name="sodadbopencollectionparams"></a> 11.1.4.1 <code class="docutils literal notranslate"><span class="pre">openCollection()</span></code>: Parameters<a class="headerlink" href="#a-name-sodadbopencollectionparams-a-11-1-4-1-opencollection-parameters" title="Permalink to this headline">¶</a></h4>
<div class="section" id="a-name-sodadbopencollectionname-a-11-1-4-1-1-collectionname">
<h5><a name="sodadbopencollectionname"></a> 11.1.4.1.1 <code class="docutils literal notranslate"><span class="pre">collectionName</span></code><a class="headerlink" href="#a-name-sodadbopencollectionname-a-11-1-4-1-1-collectionname" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">collectionName</span>
</pre></div>
</div>
<p>Name of the collection to open.</p>
</div>
</div>
<div class="section" id="a-name-sodadbopencollectioncb-a-11-1-4-2-opencollection-callback-function">
<h4><a name="sodadbopencollectioncb"></a> 11.1.4.2 <code class="docutils literal notranslate"><span class="pre">openCollection()</span></code>: Callback Function<a class="headerlink" href="#a-name-sodadbopencollectioncb-a-11-1-4-2-opencollection-callback-function" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="id186">
<h4>Prototype<a class="headerlink" href="#id186" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaCollection</span> <span class="n">collection</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id187">
<h4>Parameters<a class="headerlink" href="#id187" title="Permalink to this headline">¶</a></h4>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">openCollection()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  It is not an error if the requested collection does not exist.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>SodaCollection collection</em> | The requested collection, if one is found.  Otherwise it will be undefined.</p>
</div>
</div>
</div>
<div class="section" id="a-name-sodadocumentclass-a-12-sodadocument-class">
<h2><a name="sodadocumentclass"></a> 12. SodaDocument Class<a class="headerlink" href="#a-name-sodadocumentclass-a-12-sodadocument-class" title="Permalink to this headline">¶</a></h2>
<p>SodaDocuments represents the document for SODA read and write
operations.</p>
<p>SODA can be used with Oracle Database 18.3 and above, when node-oracledb uses
Oracle Client 18.5 or Oracle Client 19.3, or later.  The SODA bulk insert
methods <a class="reference external" href="#sodacollinsertmany"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertMany()</span></code></a> and
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a> are in Preview
status.</p>
<p>SodaDocument objects can be created in three ways:</p>
<ul class="simple">
<li><p>The result of <a class="reference external" href="#sodadbcreatedocument"><code class="docutils literal notranslate"><span class="pre">sodaDatabase.createDocument()</span></code></a>.  This
is a proto SodaDocument object usable for SODA insert and replace methods.
The SodaDocument will have content and media type components set.  Attributes
like <code class="docutils literal notranslate"><span class="pre">createdOn</span></code> will not be defined.  Optional attributes not specified when
calling <code class="docutils literal notranslate"><span class="pre">createDocument()</span></code> will also not be defined.</p></li>
<li><p>The result of a read operation from the database, such as calling
<a class="reference external" href="#sodaoperationclassgetone"><code class="docutils literal notranslate"><span class="pre">sodaOperation.getOne()</span></code></a>, or from
<a class="reference external" href="#sodadoccursorgetnext"><code class="docutils literal notranslate"><span class="pre">sodaDocumentCursor.getNext()</span></code></a> after a
<a class="reference external" href="#sodaoperationclassgetcursor"><code class="docutils literal notranslate"><span class="pre">sodaOperation.getCursor()</span></code></a> call.  These
return complete SodaDocument objects containing the document content and
attributes, such as time stamps.</p></li>
<li><p>The result of <a class="reference external" href="#sodacollinsertoneandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOneAndGet()</span></code></a>,
<a class="reference external" href="#sodaoperationclassreplaceoneandget"><code class="docutils literal notranslate"><span class="pre">sodaOperation.replaceOneAndGet()</span></code></a>, or
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a> methods.
These return SodaDocuments that contain all attributes except the document
content itself.  They are useful for finding document attributes such as
system generated keys, and versions of new and updated documents.</p></li>
</ul>
<div class="section" id="a-name-sodadocumentproperties-a-12-1-sodadocument-properties">
<h3><a name="sodadocumentproperties"></a> 12.1 SodaDocument Properties<a class="headerlink" href="#a-name-sodadocumentproperties-a-12-1-sodadocument-properties" title="Permalink to this headline">¶</a></h3>
<p>The available document properties are shown below.  Document content
of queried SodaDocument objects is only accessible via one of the
accessor methods <a class="reference external" href="#sodadocgetcontent"><code class="docutils literal notranslate"><span class="pre">getContent()</span></code></a>,
<a class="reference external" href="#sodadocgetcontentasbuffer"><code class="docutils literal notranslate"><span class="pre">getContentAsBuffer()</span></code></a> or
<a class="reference external" href="#sodadocgetcontentasstring"><code class="docutils literal notranslate"><span class="pre">getContentAsString()</span></code></a>.</p>
<p>Other properties of a SodaDocument object can be accessed directly.
They are read-only.  The properties for default collections are:</p>
<p>Property              | Description
———————-|————–
<em>readonly String createdOn</em>    | The creation time of the document as a string in the UTC time zone using an ISO8601 format such as ‘2018-07-11T01:37:50.123456Z’ or ‘2018-07-11T01:37:50.123Z’. By default, SODA sets this automatically.
<em>readonly String key</em>          | A unique key value for this document.  By default, SODA automatically generates the key.
<em>readonly String lastModified</em> | Last modified time of the document as a string in the UTC time zone using an ISO8601 format such as ‘2018-07-11T01:37:50.123456Z’ or ‘2018-07-11T01:37:50.123Z’. By default, SODA sets this automatically.
<em>readonly String mediaType</em>    | An arbitrary string value designating the content media type.  The recommendation when creating documents is to use a MIME type for the media type. By default, collections store only JSON document content and this property will be ‘application/json’.  This property will be null if the media type is unknown, which will only be in the rare case when a collection was created to store mixed or non-JSON content on top of a pre-existing database table, and that table has NULLs in its <code class="docutils literal notranslate"><span class="pre">mediaType</span></code> column.
<em>readonly String version</em>      | Version of the document.  By default, SODA automatically updates the version each time the document is changed.</p>
<p>These properties were added in node-oracledb 3.0.</p>
</div>
<div class="section" id="a-name-sodadocumentmethods-a-12-2-sodadocument-methods">
<h3><a name="sodadocumentmethods"></a> 12.2 SodaDocument Methods<a class="headerlink" href="#a-name-sodadocumentmethods-a-12-2-sodadocument-methods" title="Permalink to this headline">¶</a></h3>
<p>These methods return the document content stored in a SodaDocument.
Which one to call depends on the content and how you want to use it.
For example, if the document content is JSON, then any of the methods
may be called.  But if the document content is binary, then only
<a class="reference external" href="#sodadocgetcontentasbuffer"><code class="docutils literal notranslate"><span class="pre">getContentAsBuffer()</span></code></a> may be called.</p>
<p>Although documents cannot be null, content can be.</p>
<div class="section" id="a-name-sodadocgetcontent-a-12-2-1-sodadocument-getcontent">
<h4><a name="sodadocgetcontent"></a> 12.2.1 <code class="docutils literal notranslate"><span class="pre">sodaDocument.getContent()</span></code><a class="headerlink" href="#a-name-sodadocgetcontent-a-12-2-1-sodadocument-getcontent" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id188">
<h5>Prototype<a class="headerlink" href="#id188" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getContent</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id189">
<h5>Description<a class="headerlink" href="#id189" title="Permalink to this headline">¶</a></h5>
<p>A synchronous method that returns the document content as an object.
An exception will occur if the document content is not JSON and cannot
be converted to an object.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
</div>
<div class="section" id="a-name-sodadocgetcontentasbuffer-a-12-2-2-sodadocument-getcontentasbuffer">
<h4><a name="sodadocgetcontentasbuffer"></a> 12.2.2 <code class="docutils literal notranslate"><span class="pre">sodaDocument.getContentAsBuffer()</span></code><a class="headerlink" href="#a-name-sodadocgetcontentasbuffer-a-12-2-2-sodadocument-getcontentasbuffer" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id190">
<h5>Prototype<a class="headerlink" href="#id190" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getContentAsBuffer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id191">
<h5>Description<a class="headerlink" href="#id191" title="Permalink to this headline">¶</a></h5>
<p>A synchronous method that returns the document content as a Buffer.</p>
<p>If the documents were originally created with
<a class="reference external" href="#sodadbcreatedocument"><code class="docutils literal notranslate"><span class="pre">sodaDatabase.createDocument()</span></code></a>, then
documents are returned as they were created.</p>
<p>For documents fetched from the database where the collection storage
is BLOB (which is the default), and whose <code class="docutils literal notranslate"><span class="pre">mediaType</span></code> is
‘application/json’, then the buffer returned is identical to that
which was stored.  If the storage is not BLOB, it is UTF-8 encoded.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
</div>
<div class="section" id="a-name-sodadocgetcontentasstring-a-12-2-3-sodadocument-getcontentasstring">
<h4><a name="sodadocgetcontentasstring"></a> 12.2.3 <code class="docutils literal notranslate"><span class="pre">sodaDocument.getContentAsString()</span></code><a class="headerlink" href="#a-name-sodadocgetcontentasstring-a-12-2-3-sodadocument-getcontentasstring" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id192">
<h5>Prototype<a class="headerlink" href="#id192" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getContentAsString</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id193">
<h5>Description<a class="headerlink" href="#id193" title="Permalink to this headline">¶</a></h5>
<p>A synchronous method that returns JSON document content as a String.</p>
<p>An exception will occur if the document content cannot be converted to
a string.</p>
<p>If the document encoding is not known, UTF8 will be used.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-sodadocumentcursorclass-a-13-sodadocumentcursor-class">
<h2><a name="sodadocumentcursorclass"></a> 13. SodaDocumentCursor Class<a class="headerlink" href="#a-name-sodadocumentcursorclass-a-13-sodadocumentcursor-class" title="Permalink to this headline">¶</a></h2>
<p>A SodaDocumentCursor is used to walk through a set of SODA documents
returned from a <a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">find()</span></code></a>
<a class="reference external" href="#sodaoperationclassgetcursor"><code class="docutils literal notranslate"><span class="pre">getCursor()</span></code></a> method.</p>
<div class="section" id="a-name-sodadoccursormethods-a-13-1-sodadocumentcursor-methods">
<h3><a name="sodadoccursormethods"></a> 13.1 SodaDocumentCursor Methods<a class="headerlink" href="#a-name-sodadoccursormethods-a-13-1-sodadocumentcursor-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-sodadoccursorclose-a-13-1-1-sodadocumentcursor-close">
<h4><a name="sodadoccursorclose"></a> 13.1.1 <code class="docutils literal notranslate"><span class="pre">sodaDocumentCursor.close()</span></code><a class="headerlink" href="#a-name-sodadoccursorclose-a-13-1-1-sodadocumentcursor-close" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id194">
<h5>Prototype<a class="headerlink" href="#id194" title="Permalink to this headline">¶</a></h5>
<p>Callback</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">close</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">close</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id195">
<h5>Description<a class="headerlink" href="#id195" title="Permalink to this headline">¶</a></h5>
<p>This method closes a SodaDocumentCursor. It must be called when the
cursor is no longer required.  It releases resources in node-oracledb
and Oracle Database.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id196">
<h5>Parameters<a class="headerlink" href="#id196" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">close()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-sodadoccursorgetnext-a-13-1-2-sodadocumentcursor-getnext">
<h4><a name="sodadoccursorgetnext"></a> 13.1.2 <code class="docutils literal notranslate"><span class="pre">sodaDocumentCursor.getNext()</span></code><a class="headerlink" href="#a-name-sodadoccursorgetnext-a-13-1-2-sodadocumentcursor-getnext" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id197">
<h5>Prototype<a class="headerlink" href="#id197" title="Permalink to this headline">¶</a></h5>
<p>Callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getNext</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">){});</span>
</pre></div>
</div>
<p>Promise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">promise</span> <span class="o">=</span> <span class="n">getNext</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id198">
<h5>Description<a class="headerlink" href="#id198" title="Permalink to this headline">¶</a></h5>
<p>This method returns the next <a class="reference external" href="#sodadocumentclass">SodaDocument</a> in the
cursor returned by a <a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">find()</span></code></a> terminal method read
operation.</p>
<p>If there are no more documents, the returned <code class="docutils literal notranslate"><span class="pre">document</span></code> parameter will
be undefined.</p>
<p>This method was added in node-oracledb 3.0.</p>
</div>
<div class="section" id="id199">
<h5>Parameters<a class="headerlink" href="#id199" title="Permalink to this headline">¶</a></h5>
<ul>
<li><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span><span class="p">(</span><span class="n">Error</span> <span class="n">error</span><span class="p">,</span> <span class="n">SodaDocument</span> <span class="n">document</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters of the callback function are:</p>
<p>Callback function parameter | Description
—————————-|————-
<em>Error error</em> | If <code class="docutils literal notranslate"><span class="pre">getNext()</span></code> succeeds, <code class="docutils literal notranslate"><span class="pre">error</span></code> is NULL.  If an error occurs, then <code class="docutils literal notranslate"><span class="pre">error</span></code> contains the error message.
<em>SodaDocument document</em> | The next document in the cursor.  If there are no more documents, then <code class="docutils literal notranslate"><span class="pre">document</span></code> will be undefined.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-usermanual-a-node-oracledb-user-manual">
<h2><a name="usermanual"></a> NODE-ORACLEDB USER MANUAL<a class="headerlink" href="#a-name-usermanual-a-node-oracledb-user-manual" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="a-name-connectionhandling-a-14-connection-handling">
<h2><a name="connectionhandling"></a> 14. Connection Handling<a class="headerlink" href="#a-name-connectionhandling-a-14-connection-handling" title="Permalink to this headline">¶</a></h2>
<p>Connections may be standalone or pooled.</p>
<div class="section" id="standalone-connections">
<h3>Standalone Connections<a class="headerlink" href="#standalone-connections" title="Permalink to this headline">¶</a></h3>
<p>In applications which use connections infrequently, create a
connection with <a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a>.
Connections should be released with
<a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">connection.close()</span></code></a> when no longer needed:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// set mypw to the hr schema password</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span>
      <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
      <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
      <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
    <span class="p">});</span>

    <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT last_name FROM employees`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Result is:&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>   <span class="c1">// Always close connections</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="pooled-connections">
<h3>Pooled Connections<a class="headerlink" href="#pooled-connections" title="Permalink to this headline">¶</a></h3>
<p>Applications which frequently create and close connections should use
a Connection Pool.  Since pools provide Oracle high availability
features, using one is also recommended if you have a long running
application, particularly if connections are released to the pool
while no database work is being done.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// set mypw to the hr schema password</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">pool</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span>
      <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
      <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span>  <span class="c1">// mypw contains the hr schema password</span>
      <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
    <span class="p">});</span>

    <span class="kd">let</span> <span class="nx">connection</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT last_name FROM employees`</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Result is:&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span> <span class="c1">// Put the connection back in the pool</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">();</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#connpooling">Connection Pooling</a> for more information.</p>
</div>
<div class="section" id="a-name-configureconnections-a-14-1-configuring-connections-and-node-oracledb">
<h3><a name="configureconnections"></a> 14.1 Configuring Connections and Node-oracledb<a class="headerlink" href="#a-name-configureconnections-a-14-1-configuring-connections-and-node-oracledb" title="Permalink to this headline">¶</a></h3>
<p>Connections to Oracle Database are influenced by optional Oracle
environment variables and configuration files.</p>
<div class="section" id="a-name-environmentvariables-a-14-1-1-oracle-environment-variables">
<h4><a name="environmentvariables"></a> 14.1.1 Oracle Environment Variables<a class="headerlink" href="#a-name-environmentvariables-a-14-1-1-oracle-environment-variables" title="Permalink to this headline">¶</a></h4>
<p>Some Oracle environment variables that can influence node-oracledb include:</p>
<p>Name  |  Description
——|————-
<code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> | Used on Linux and some UNIX platforms.  Set this to include the Oracle libraries, for example <code class="docutils literal notranslate"><span class="pre">$ORACLE_HOME/lib</span></code> or <code class="docutils literal notranslate"><span class="pre">/opt/oracle/instantclient_19_3</span></code>. Not needed if the libraries are located by an alternative method, such as from running <code class="docutils literal notranslate"><span class="pre">ldconfig</span></code>. On other UNIX platforms you will need to set the OS specific equivalent, such as <code class="docutils literal notranslate"><span class="pre">LIBPATH</span></code> or <code class="docutils literal notranslate"><span class="pre">SHLIB_PATH</span></code>.
<code class="docutils literal notranslate"><span class="pre">ORACLE_HOME</span></code> | The directory containing the Oracle Database software. This directory must be accessible by the Node.js process. This variable should <em>not</em> be set if node-oracledb uses Oracle Instant Client.
<code class="docutils literal notranslate"><span class="pre">NLS_DATE_FORMAT</span></code>, <code class="docutils literal notranslate"><span class="pre">NLS_TIMESTAMP_FORMAT</span></code> | See <a class="reference external" href="#fetchasstringhandling">Fetching Numbers and Dates as String</a>.  The variables are ignored if <code class="docutils literal notranslate"><span class="pre">NLS_LANG</span></code> is not set.
<code class="docutils literal notranslate"><span class="pre">NLS_LANG</span></code> | Determines the globalization options for node-oracledb.  If not set, a default value will be chosen by Oracle. Note that node-oracledb will always uses the AL32UTF8 character set.  See <a class="reference external" href="#nls">Globalization and National Language Support (NLS)</a>.
<code class="docutils literal notranslate"><span class="pre">NLS_NUMERIC_CHARACTERS</span></code> | See <a class="reference external" href="#fetchasstringhandling">Fetching Numbers and Dates as String</a>.  The variable is ignored if <code class="docutils literal notranslate"><span class="pre">NLS_LANG</span></code> is not
<code class="docutils literal notranslate"><span class="pre">TNS_ADMIN</span></code> | The location of the optional <a class="reference external" href="#tnsadmin">Oracle Net configuration files</a> and <a class="reference external" href="#oraaccess">Oracle Client configuration files</a>, including <code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code>, and <code class="docutils literal notranslate"><span class="pre">oraaccess.xml</span></code>, if they are not in a default location.</p>
<p>It is recommended to set Oracle variables in the environment before invoking
Node.js, however they may also be set in application code as long as they are
set before node-oracledb is first used.  System environment variables like
<code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> must be set before Node.js starts.</p>
<p>If you are using Linux and node-oracledb is being run on the same
computer as the database, you can set required Oracle environment
variables, such as <code class="docutils literal notranslate"><span class="pre">ORACLE_HOME</span></code> and <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> in your shell
by executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">oraenv</span>
</pre></div>
</div>
<p>Or, if you are using <a class="reference external" href="https://www.oracle.com/database/technologies/appdev/xe.html">Oracle Database XE 11.2</a>, by executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">u01</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="mf">11.2</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">xe</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">oracle_env</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Make sure the Node.js process has directory and file access
permissions for the Oracle libraries and other files.  Typically the
home directory of the Oracle software owner will need permissions
relaxed.</p>
</div>
<div class="section" id="a-name-tnsadmin-a-14-1-2-optional-oracle-net-configuration">
<h4><a name="tnsadmin"></a> 14.1.2 Optional Oracle Net Configuration<a class="headerlink" href="#a-name-tnsadmin-a-14-1-2-optional-oracle-net-configuration" title="Permalink to this headline">¶</a></h4>
<p>Optional Oracle Net configuration files are read when node-oracledb
is loaded.  These files affect connections and applications.  The common
files are:</p>
<p>Name | Description
—–|————
<code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code> | Contains net service names and Oracle Net options for databases that can be connected to, see <a class="reference external" href="#tnsnames">Net Service Names for Connection Strings</a>. This file is only needed for advanced configuration.  Not needed if connection strings use the <a class="reference external" href="#easyconnect">Easy Connect syntax</a>. The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-7F967CE5-5498-427C-9390-4A5C6767ADAA">Oracle Net documentation on <code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code></a> has more information.
<code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> | A configuration file controlling the network transport behavior.  For example it can set call timeouts for <a class="reference external" href="#connectionha">high availability</a>, or be used to <a class="reference external" href="#securenetwork">encrypt network traffic</a>, or be used to configure logging and tracing.  The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-19423B71-3F6C-430F-84CC-18145CC2A818">Oracle Net documentation on <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code></a> has more information.</p>
<p>The files should be in a directory accessible to Node.js, not the
database server.  Default locations include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/opt/oracle/instantclient_19_3/network/admin</span></code> if Instant Client is in <code class="docutils literal notranslate"><span class="pre">/opt/oracle/instantclient_19_3</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/lib/oracle/19.3/client64/lib/network/admin</span></code> if Oracle 19.3 Instant Client RPMs are used on Linux.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$ORACLE_HOME/network/admin</span></code> if node-oracledb is using libraries from the database installation.</p></li>
</ul>
<p>Alternatively, the files can be put in another, accessible directory.
Then set the environment variable <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-12C94B15-2CE1-4B98-9D0C-8226A9DDF4CB"><code class="docutils literal notranslate"><span class="pre">TNS_ADMIN</span></code></a> to that directory
name.  For example, if the file <code class="docutils literal notranslate"><span class="pre">/etc/my-oracle-config/tnsnames.ora</span></code>
is being used, set <code class="docutils literal notranslate"><span class="pre">TNS_ADMIN</span></code> to <code class="docutils literal notranslate"><span class="pre">/etc/my-oracle-config</span></code>.</p>
</div>
<div class="section" id="a-name-oraaccess-a-14-1-3-optional-oracle-client-configuration">
<h4><a name="oraaccess"></a> 14.1.3. Optional Oracle Client Configuration<a class="headerlink" href="#a-name-oraaccess-a-14-1-3-optional-oracle-client-configuration" title="Permalink to this headline">¶</a></h4>
<p>If the Oracle Client Libraries used by node-oracledb are version 12,
or later, then an optional <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-9D12F489-EC02-46BE-8CD4-5AECED0E2BA2"><code class="docutils literal notranslate"><span class="pre">oraaccess.xml</span></code></a> file can be used to
configure some behaviors of those libraries.  The file is read when
node-oracledb starts.  The directory it should be in is determined
using a similar heuristic to the <a class="reference external" href="#tnsadmin">Optional Oracle Net
Configuration</a> file directory.</p>
<p>Refer to the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-9D12F489-EC02-46BE-8CD4-5AECED0E2BA2"><code class="docutils literal notranslate"><span class="pre">oraaccess.xml</span></code> documentation</a> for more information.</p>
<p>The following <code class="docutils literal notranslate"><span class="pre">oraaccess.xml</span></code> file sets the Oracle client
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-7AE9DBE2-5316-4802-99D1-969B72823F02">‘prefetch’</a> value to 100 rows.  This value affects every SQL
query in the application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot;?&gt;
 &lt;oraaccess xmlns=&quot;http://xmlns.oracle.com/oci/oraaccess&quot;
  xmlns:oci=&quot;http://xmlns.oracle.com/oci/oraaccess&quot;
  schemaLocation=&quot;http://xmlns.oracle.com/oci/oraaccess
  http://xmlns.oracle.com/oci/oraaccess.xsd&quot;&gt;
  &lt;default_parameters&gt;
    &lt;prefetch&gt;
      &lt;rows&gt;100&lt;/rows&gt;
    &lt;/prefetch&gt;
  &lt;/default_parameters&gt;
&lt;/oraaccess&gt;
</pre></div>
</div>
<p>Prefetching is the number of additional rows the underlying Oracle
client library fetches whenever node-oracledb requests query data from
the database.  Prefetching is a tuning option to maximize data
transfer efficiency and minimize <a class="reference external" href="#roundtrips">round-trips</a> to the
database.  The prefetch size does not affect when, or how many, rows
are returned by node-oracledb to the application.  The cache
management is transparently handled by the Oracle client
libraries. Note, standard node-oracledb fetch tuning is via
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a>, but changing the prefetch
value can be useful in some cases such as when modifying the
application is not feasible.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">oraaccess.xml</span></code> file has other uses including:</p>
<ul class="simple">
<li><p>Changing the value of <a class="reference external" href="#connectionfan">Fast Application Notification (FAN)</a> events which affects FAN notifications and <a class="reference external" href="#connectionrlb">Runtime Load Balancing (RLB)</a>.</p></li>
<li><p>Configuring <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D2FA7B29-301B-4AB8-8294-2B1B015899F9">Client Result Caching</a> parameters</p></li>
<li><p>Turning on <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-6E21AA56-5BBE-422A-802C-197CAC8AAEA4">Client Statement Cache Auto-tuning</a></p></li>
</ul>
</div>
</div>
<div class="section" id="a-name-connectionstrings-a-14-2-connection-strings">
<h3><a name="connectionstrings"></a> 14.2 Connection Strings<a class="headerlink" href="#a-name-connectionstrings-a-14-2-connection-strings" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">connectString</span></code> property for <a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a>
and <a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code></a> can be one of:</p>
<ul class="simple">
<li><p>An <a class="reference external" href="#easyconnect">Easy Connect</a> string</p></li>
<li><p>A <a class="reference external" href="#embedtns">Connect Descriptor</a> string</p></li>
<li><p>A <a class="reference external" href="#tnsnames">Net Service Name</a> from a local <a class="reference external" href="#tnsnames"><code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code></a> file or external naming service</p></li>
<li><p>The SID of a local Oracle database instance</p></li>
</ul>
<p>If a connect string is not specified, the empty string “” is used
which indicates to connect to the local, default database.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">connectionString</span></code> property is an alias for <code class="docutils literal notranslate"><span class="pre">connectString</span></code>.
Use only one of the properties.</p>
<div class="section" id="a-name-easyconnect-a-14-2-1-easy-connect-syntax-for-connection-strings">
<h4><a name="easyconnect"></a> 14.2.1 Easy Connect Syntax for Connection Strings<a class="headerlink" href="#a-name-easyconnect-a-14-2-1-easy-connect-syntax-for-connection-strings" title="Permalink to this headline">¶</a></h4>
<p>An Easy Connect string is often the simplest to use.  For example, to connect to
the Oracle Database service <code class="docutils literal notranslate"><span class="pre">orclpdb1</span></code> that is running on the host
<code class="docutils literal notranslate"><span class="pre">mydbmachine.example.com</span></code> with the default Oracle Database port 1521, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">oracledb</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="n">const</span> <span class="n">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="n">oracledb</span><span class="o">.</span><span class="n">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="n">user</span>          <span class="p">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="n">password</span>      <span class="p">:</span> <span class="n">mypw</span><span class="p">,</span>  <span class="o">//</span> <span class="n">mypw</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">hr</span> <span class="n">schema</span> <span class="n">password</span>
    <span class="n">connectString</span> <span class="p">:</span> <span class="s2">&quot;mydbmachine.example.com/orclpdb1&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>If the database is using a non-default port, for example 1984, the port must be
given:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">oracledb</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="n">const</span> <span class="n">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="n">oracledb</span><span class="o">.</span><span class="n">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="n">user</span>          <span class="p">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="n">password</span>      <span class="p">:</span> <span class="n">mypw</span><span class="p">,</span>  <span class="o">//</span> <span class="n">mypw</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">hr</span> <span class="n">schema</span> <span class="n">password</span>
    <span class="n">connectString</span> <span class="p">:</span> <span class="s2">&quot;mydbmachine.example.com:1984/orclpdb1&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The Easy Connect syntax supports Oracle Database service names.  It cannot be
used with the older System Identifiers (SID).</p>
<p>The Easy Connect syntax has been extended in recent versions of Oracle Database
client since its introduction in 10g.  Check the Easy Connect Naming method in
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-B0437826-43C1-49EC-A94D-B650B6A4A6EE">Oracle Net Service Administrator’s Guide</a> for the syntax to use in your
version of the Oracle Client libraries.</p>
<p>If you are using Oracle Client 19c, the latest <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-8C85D289-6AF3-41BC-848B-BF39D32648BA">Easy Connect Plus</a> syntax
allows the use of multiple hosts or ports, along with optional entries for the
wallet location, the distinguished name of the database server, and even lets
some network configuration options be set. This means that a
<a class="reference external" href="#tnsadmin"><code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code></a> file is not needed for some common connection
scenarios.</p>
</div>
<div class="section" id="a-name-embedtns-a-14-2-2-embedded-connect-descriptor-strings">
<h4><a name="embedtns"></a> 14.2.2 Embedded Connect Descriptor Strings<a class="headerlink" href="#a-name-embedtns-a-14-2-2-embedded-connect-descriptor-strings" title="Permalink to this headline">¶</a></h4>
<p>Full Connect Descriptor strings can be embedded in applications:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=mymachine.example.com)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=orcl)))&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-tnsnames-a-14-2-3-net-service-names-for-connection-strings">
<h4><a name="tnsnames"></a> 14.2.3 Net Service Names for Connection Strings<a class="headerlink" href="#a-name-tnsnames-a-14-2-3-net-service-names-for-connection-strings" title="Permalink to this headline">¶</a></h4>
<p>Connect Descriptor strings are commmonly stored in <a class="reference external" href="#tnsadmin"><code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code></a>
files and associated with a Net Service Name, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sales</span> <span class="o">=</span>
  <span class="p">(</span><span class="n">DESCRIPTION</span> <span class="o">=</span>
    <span class="p">(</span><span class="n">ADDRESS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PROTOCOL</span> <span class="o">=</span> <span class="n">TCP</span><span class="p">)(</span><span class="n">HOST</span> <span class="o">=</span> <span class="n">mymachine</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">)(</span><span class="n">PORT</span> <span class="o">=</span> <span class="mi">1521</span><span class="p">))</span>
    <span class="p">(</span><span class="n">CONNECT_DATA</span> <span class="o">=</span>
      <span class="p">(</span><span class="n">SERVER</span> <span class="o">=</span> <span class="n">DEDICATED</span><span class="p">)</span>
      <span class="p">(</span><span class="n">SERVICE_NAME</span> <span class="o">=</span> <span class="n">orcl</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>Net Service Names may also be defined in a directory server.</p>
<p>Given a Net Service Name, node-oracledb can connect like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;sales&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Some older databases may use a ‘SID’ instead of a ‘Service Name’.  A
connection string for these databases could look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sales</span> <span class="o">=</span>
  <span class="p">(</span><span class="n">DESCRIPTION</span> <span class="o">=</span>
    <span class="p">(</span><span class="n">ADDRESS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PROTOCOL</span> <span class="o">=</span> <span class="n">TCP</span><span class="p">)(</span><span class="n">HOST</span> <span class="o">=</span> <span class="n">mymachine</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">)(</span><span class="n">PORT</span> <span class="o">=</span> <span class="mi">1521</span><span class="p">))</span>
    <span class="p">(</span><span class="n">CONNECT_DATA</span> <span class="o">=</span>
      <span class="p">(</span><span class="n">SERVER</span> <span class="o">=</span> <span class="n">DEDICATED</span><span class="p">)</span>
      <span class="p">(</span><span class="n">SID</span> <span class="o">=</span> <span class="n">orcl</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#tnsadmin">Optional Oracle Net Configuration</a> for where <code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code>
files can be located.</p>
<p>For general information on <code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code> files, see the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-7F967CE5-5498-427C-9390-4A5C6767ADAA">Oracle Net
documentation on <code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code></a>.</p>
</div>
<div class="section" id="a-name-notjdbc-a-14-2-4-jdbc-and-oracle-sql-developer-connection-strings">
<h4><a name="notjdbc"></a> 14.2.4 JDBC and Oracle SQL Developer Connection Strings<a class="headerlink" href="#a-name-notjdbc-a-14-2-4-jdbc-and-oracle-sql-developer-connection-strings" title="Permalink to this headline">¶</a></h4>
<p>The node-oracledb connection string syntax is different to Java JDBC and the
common Oracle SQL Developer syntax.  If these JDBC connection strings reference
a service name like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jdbc</span><span class="p">:</span><span class="n">oracle</span><span class="p">:</span><span class="n">thin</span><span class="p">:</span><span class="nd">@hostname</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">service_name</span>
</pre></div>
</div>
<p>for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jdbc</span><span class="p">:</span><span class="n">oracle</span><span class="p">:</span><span class="n">thin</span><span class="p">:</span><span class="nd">@mydbmachine</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">1521</span><span class="o">/</span><span class="n">orclpdb1</span>
</pre></div>
</div>
<p>then use Oracle’s Easy Connect syntax in node-oracledb:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;mydbmachine.example.com:1521/orclpdb1&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Alternatively, if a JDBC connection string uses an old-style
Oracle system identifier <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-BADFDC72-0F1D-47FA-8857-EC15DC8ACFBB">SID</a>, and there is no service name available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jdbc</span><span class="p">:</span><span class="n">oracle</span><span class="p">:</span><span class="n">thin</span><span class="p">:</span><span class="nd">@hostname</span><span class="p">:</span><span class="n">port</span><span class="p">:</span><span class="n">sid</span>
</pre></div>
</div>
<p>for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jdbc</span><span class="p">:</span><span class="n">oracle</span><span class="p">:</span><span class="n">thin</span><span class="p">:</span><span class="nd">@mydbmachine</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">1521</span><span class="p">:</span><span class="n">orcl</span>
</pre></div>
</div>
<p>then either <a class="reference external" href="#embedtns">embed the Connect Descriptor</a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=mymachine.example.com)(PORT=1521))(CONNECT_DATA=(SERVER=DEDICATED)(SID=ORCL)))&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>or create a <a class="reference external" href="#tnsnames">Net Service Name</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># tnsnames.ora</span>

<span class="n">finance</span> <span class="o">=</span>
 <span class="p">(</span><span class="n">DESCRIPTION</span> <span class="o">=</span>
   <span class="p">(</span><span class="n">ADDRESS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PROTOCOL</span> <span class="o">=</span> <span class="n">TCP</span><span class="p">)(</span><span class="n">HOST</span> <span class="o">=</span> <span class="n">mydbmachine</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">)(</span><span class="n">PORT</span> <span class="o">=</span> <span class="mi">1521</span><span class="p">))</span>
   <span class="p">(</span><span class="n">CONNECT_DATA</span> <span class="o">=</span>
     <span class="p">(</span><span class="n">SID</span> <span class="o">=</span> <span class="n">ORCL</span><span class="p">)</span>
   <span class="p">)</span>
 <span class="p">)</span>
</pre></div>
</div>
<p>This can be referenced in node-oracledb:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;finance&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-numberofthreads-a-14-3-connections-and-number-of-threads">
<h3><a name="numberofthreads"></a> 14.3 Connections and Number of Threads<a class="headerlink" href="#a-name-numberofthreads-a-14-3-connections-and-number-of-threads" title="Permalink to this headline">¶</a></h3>
<p>If you open more than four connections, such as via
increasing <a class="reference external" href="#proppoolpoolmax"><code class="docutils literal notranslate"><span class="pre">poolMax</span></code></a>, you should increase the
number of worker threads available to node-oracledb.  The thread pool
size should be at least equal to the maximum number of connections.
If the application does database and non-database work concurrently,
extra threads could also be required for optimal throughput.</p>
<p>Increase the thread pool size by setting the environment variable
<a class="reference external" href="http://docs.libuv.org/en/v1.x/threadpool.html">UV_THREADPOOL_SIZE</a> before starting Node.  For example, in a
Linux terminal, the number of Node.js worker threads can be increased
to 10 by using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ UV_THREADPOOL_SIZE=10 node myapp.js
</pre></div>
</div>
<p>If the value is set inside the application with
<code class="docutils literal notranslate"><span class="pre">process.env.UV_THREADPOOL_SIZE</span></code> ensure it is set prior to any
asynchronous call that uses the thread pool otherwise the default size
of 4 will still be used.</p>
<p>Note the ‘<a class="reference external" href="https://github.com/libuv/libuv">libuv</a>’ library used by Node.js 12.5 and earlier limits
the number of threads to 128.  In Node.js 12.6 onward the limit
is 1024.  You should restrict the maximum number of connections opened
in an application, i.e. <code class="docutils literal notranslate"><span class="pre">poolMax</span></code>, to a value lower than the
<code class="docutils literal notranslate"><span class="pre">UV_THREADPOOL_SIZE</span></code> limit.  If you have multiple pools, make sure the
sum of all <code class="docutils literal notranslate"><span class="pre">poolMax</span></code> values is no larger than <code class="docutils literal notranslate"><span class="pre">UV_THREADPOOL_SIZE</span></code>.</p>
<p>Connections can handle one database operation at a time.  Node.js
worker threads executing database statements on a connection will wait
until <a class="reference external" href="#roundtrips">round-trips</a> between node-oracledb and the
database are complete.  When an application handles a sustained number
of user requests, and database operations take some time to execute or
the network is slow, then all available threads may be held in use.
This prevents other connections from beginning work and stops Node.js
from handling more user load.  Increasing the number of worker threads
may improve throughput and prevent <a class="reference external" href="https://github.com/oracle/node-oracledb/issues/603#issuecomment-277017313">deadlocks</a>.</p>
<p>As well as correctly setting the thread pool size, structure your code
to avoid starting parallel operations on a connection.  For example,
instead of using <code class="docutils literal notranslate"><span class="pre">async.parallel</span></code> or <code class="docutils literal notranslate"><span class="pre">async.each()</span></code> which call each
of their items in parallel, use <code class="docutils literal notranslate"><span class="pre">async.series</span></code> or <code class="docutils literal notranslate"><span class="pre">async.eachSeries()</span></code>.
When you use parallel calls on a connection, the queuing ends up being
done in the C layer via a mutex.  However libuv is not aware that a
connection can only do one thing at a time - it only knows when it has
background threads available and so it sends off the work to be done.
If your application runs operations in parallel on a connection, you
could use more than one background thread (perhaps all of them) and
each could be waiting on the one before it to finish its “execute”. Of
course other users or transactions cannot use the threads at
that time either.  When you use methods like <code class="docutils literal notranslate"><span class="pre">async.series</span></code> or
<code class="docutils literal notranslate"><span class="pre">async.eachSeries()</span></code>, the queuing is instead done in the main
JavaScript thread.</p>
</div>
<div class="section" id="a-name-connpooling-a-14-4-connection-pooling">
<h3><a name="connpooling"></a> 14.4 Connection Pooling<a class="headerlink" href="#a-name-connpooling-a-14-4-connection-pooling" title="Permalink to this headline">¶</a></h3>
<p>When applications use a lot of connections for short periods, Oracle
recommends using a connection pool for efficiency.  Each node-oracledb
process can use one or more connection pools.  Each pool can contain
one or more connections.  A pool can grow or shrink, as needed.  In
addition to providing an immediately available set of connections,
pools provide <a class="reference external" href="#connpoolpinging">dead connection detection</a> and
transparently handle Oracle Database <a class="reference external" href="#connectionha">High Availability
events</a>.  This helps shield applications during planned
maintenance and from unplanned failures.  Internally <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C">Oracle Call
Interface Session Pooling</a> is used, which provides many of these
features.</p>
<p>Since pools provide Oracle high availability features, using one is
also recommended if you have a long running application, particularly
if connections are released to the pool while no database work is
being done.</p>
<p>Pools are created by calling <a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code></a>.
Generally applications will create a pool once as part of
initialization.  After an application finishes using a connection
pool, it should release all connections and terminate the connection
pool by calling the <a class="reference external" href="#poolclose"><code class="docutils literal notranslate"><span class="pre">pool.close()</span></code></a> method.</p>
<p>Connections from the pool are obtained with
<a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code></a>.  If all connections in a
pool are being used, then subsequent <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> calls will be
put in a <a class="reference external" href="#connpoolqueue">queue</a>.  Connections must be released with
<a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">connection.close()</span></code></a> when no longer needed so they
are available for reuse.  Make sure to release connections in all
codes paths, include error handlers.</p>
<p>When a connection is released back to its pool, any ongoing
transaction will be <a class="reference external" href="#transactionmgt">rolled back</a> however it will
retain session state, such as <a class="reference external" href="#nls">NLS</a> settings from ALTER SESSION
statements. See <a class="reference external" href="#connpooltagging">Connection Tagging and Session
State</a> for more information.</p>
<p>Connections can also be <a class="reference external" href="#connectionclose">dropped completely from the pool</a>.</p>
<p>A connection pool can be used like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// set mypw to the hr schema password</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">pool</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span>
      <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
      <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span>  <span class="c1">// mypw contains the hr schema password</span>
      <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
    <span class="p">});</span>

    <span class="kd">let</span> <span class="nx">connection</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT last_name FROM employees`</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Result is:&quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span> <span class="c1">// Put the connection back in the pool</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="a-name-conpoolsizing-a-14-4-1-connection-pool-sizing">
<h4><a name="conpoolsizing"></a> 14.4.1 Connection Pool Sizing<a class="headerlink" href="#a-name-conpoolsizing-a-14-4-1-connection-pool-sizing" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="#propdbpoolmax"><code class="docutils literal notranslate"><span class="pre">poolMax</span></code></a>, <a class="reference external" href="#propdbpoolmin"><code class="docutils literal notranslate"><span class="pre">poolMin</span></code></a> and
<a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code></a> attributes should be
adjusted to handle the desired workload within the bounds of available
resources in Node.js and the database.</p>
<p>Each connection should be used for a given unit of work, such as a
transaction or a set of sequentially executed statements.  Statements
should be <a class="reference external" href="#numberofthreads">executed sequentially, not in parallel</a>
on each connection.</p>
<p>If you increase the size of the pool, you must <a class="reference external" href="#numberofthreads">increase the number of
threads</a> used by Node.js.</p>
<p>The growth characteristics of a connection pool are determined by the
Pool attributes <a class="reference external" href="#proppoolpoolincrement"><code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code></a>,
<a class="reference external" href="#proppoolpoolmax"><code class="docutils literal notranslate"><span class="pre">poolMax</span></code></a>, <a class="reference external" href="#proppoolpoolmin"><code class="docutils literal notranslate"><span class="pre">poolMin</span></code></a> and
<a class="reference external" href="#proppoolpooltimeout"><code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code></a>.  Note that when External
Authentication is used, the pool behavior is different, see
<a class="reference external" href="#extauth">External Authentication</a>.</p>
<p>Pool expansion happens when the following are all true: (i)
<a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a> is called and (ii) all the
currently established connections in the pool are “checked out” by
previous <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> calls and are in-use by the application,
and (iii) the number of those connections is less than the pool’s
<code class="docutils literal notranslate"><span class="pre">poolMax</span></code> setting.</p>
<p>The Oracle Real-World Performance Group’s general recommendation for
client connection pools is for the pool to have a fixed sized.  The
values of <code class="docutils literal notranslate"><span class="pre">poolMin</span></code> and <code class="docutils literal notranslate"><span class="pre">poolMax</span></code> should be the same (and
<code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code> equal to zero), and the firewall, <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2BEF5482-CF97-4A85-BD90-9195E41E74EF">resource
manager</a> or user profile <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-ABC7AE4D-64A8-4EA9-857D-BEF7300B64C3"><code class="docutils literal notranslate"><span class="pre">IDLE_TIME</span></code></a> should not expire
idle sessions.  This avoids connection storms which can decrease
throughput.  See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-BC09F045-5D80-4AF5-93F5-FEF0531E0E1D">About Optimizing Real-World Performance with Static
Connection Pools</a>, which contains details about sizing of pools.</p>
<p>The Pool attribute <a class="reference external" href="#propconnstmtcachesize"><code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code></a> can be
used to set the statement cache size used by connections in the pool,
see <a class="reference external" href="#stmtcache">Statement Caching</a>.</p>
</div>
<div class="section" id="a-name-conpooldraining-a-14-4-2-connection-pool-closing-and-draining">
<h4><a name="conpooldraining"></a> 14.4.2 Connection Pool Closing and Draining<a class="headerlink" href="#a-name-conpooldraining-a-14-4-2-connection-pool-closing-and-draining" title="Permalink to this headline">¶</a></h4>
<p>Closing a connection pool allows database resources to be freed.  If
Node.js is killed without <a class="reference external" href="#poolclose"><code class="docutils literal notranslate"><span class="pre">pool.close()</span></code></a> being called,
it may be some time before the unused database-side of connections are
automatically cleaned up in the database.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">pool.close()</span></code> is called, the pool will be closed only if all
connections have been released to the pool with <code class="docutils literal notranslate"><span class="pre">connection.close()</span></code>.
Otherwise an error is returned and the pool will not be closed.</p>
<p>An optional <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> parameter can be used to force the pool closed
even if connections are in use.  This lets the pool be ‘drained’ of
connections.  The <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> indicates how many seconds the pool is
allowed to remain active before it and its connections are terminated.
For example, to give active connections 10 seconds to complete their
work before being terminated:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>When a pool has been closed with a specified <code class="docutils literal notranslate"><span class="pre">drainTime</span></code>, then any new
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> calls will fail.  If connections are currently
in use by the application, they can continue to be used for the
specified number of seconds, after which the pool and all open
connections are forcibly closed.  Prior to this time limit, if there
are no connections currently “checked out” from the pool with
<code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>, then the pool and its connections are immediately
closed.</p>
<p>In network configurations that drop (or in-line) out-of-band breaks,
forced pool termination may hang unless you have
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-42E939DC-EF37-49A0-B4F0-14158F0E55FD"><code class="docutils literal notranslate"><span class="pre">DISABLE_OOB=ON</span></code></a> in a <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2041545B-58D4-48DC-986F-DCC9D0DEC642"><code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code></a> file, see <a class="reference external" href="#tnsadmin">Optional Oracle
Net Configuration</a>.</p>
<p>Non-zero <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> values are recommended so applications
have the opportunity to gracefully finish database operations, however
pools can be forcibly closed by specifying a zero drain time:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>Closing the pool would commonly be one of the last stages of a Node.js
application.  A typical closing routine look likes:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Close the default connection pool with 10 seconds draining, and exit</span>
<span class="nx">async</span> <span class="kd">function</span> <span class="nx">closePoolAndExit</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;\nTerminating&quot;</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getPool</span><span class="p">().</span><span class="nx">close</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is helpful to invoke <code class="docutils literal notranslate"><span class="pre">closePoolAndExit()</span></code> if Node.js is
sent a signal or interrupted:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Close the pool cleanly if Node.js is interrupted</span>
<span class="nx">process</span>
  <span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;SIGTERM&#39;</span><span class="p">,</span> <span class="nx">closePoolAndExit</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;SIGINT&#39;</span><span class="p">,</span>  <span class="nx">closePoolAndExit</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-connpoolcache-a-14-4-3-connection-pool-cache">
<h4><a name="connpoolcache"></a> 14.4.3 Connection Pool Cache<a class="headerlink" href="#a-name-connpoolcache-a-14-4-3-connection-pool-cache" title="Permalink to this headline">¶</a></h4>
<p>When pools are created, they can be given a named alias.  The alias
can later be used to retrieve the related pool object for use.  This
facilitates sharing pools across modules and simplifies getting
connections.</p>
<p>Pools are added to the cache by using a
<a class="reference external" href="#createpoolpoolattrspoolalias"><code class="docutils literal notranslate"><span class="pre">poolAlias</span></code></a> property in the
<a class="reference external" href="#createpoolpoolattrs"><code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code></a> object:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">async</span> <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span> <span class="c1">// no need to store the returned pool</span>
      <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
      <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/XEPDB1&#39;</span><span class="p">,</span>
      <span class="nx">poolAlias</span><span class="o">:</span> <span class="s1">&#39;hrpool&#39;</span>
    <span class="p">});</span>

    <span class="c1">// do stuff</span>
    <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>

    <span class="c1">// get the pool from the cache and use it</span>
    <span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getPool</span><span class="p">(</span><span class="s1">&#39;hrpool&#39;</span><span class="p">);</span>
    <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There can be multiple pools in the cache if each pool is created with
a unique alias.</p>
<p>If a pool is created without providing a pool alias, and a pool with
an alias of ‘default’ is not in the cache already, this pool will be
cached using the alias ‘default’.  This pool is used by default in
methods that utilize the connection pool cache.  If subsequent pools
are created without explicit aliases, they will be not stored in the
pool cache.</p>
<p>Methods that can affect or use the connection pool cache include:</p>
<ul class="simple">
<li><p><a class="reference external" href="#createpool">oracledb.createPool()</a> - can add a pool to the cache</p></li>
<li><p><a class="reference external" href="#getpool">oracledb.getPool()</a> - retrieves a pool from the cache</p></li>
<li><p><a class="reference external" href="#getconnectiondb">oracledb.getConnection()</a> - can use a pool in the cache to retrieve connections</p></li>
<li><p><a class="reference external" href="#poolclose">pool.close()</a> - automatically removes a pool from the cache</p></li>
</ul>
<div class="section" id="using-the-default-pool">
<h5>Using the Default Pool<a class="headerlink" href="#using-the-default-pool" title="Permalink to this headline">¶</a></h5>
<p>Assuming the connection pool cache is empty, the following will create a new pool
and cache it using the pool alias ‘default’:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">async</span> <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span>
      <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
      <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/XEPDB1&#39;</span>
    <span class="p">});</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">pool</span><span class="p">.</span><span class="nx">poolAlias</span><span class="p">);</span> <span class="c1">// &#39;default&#39;</span>
    <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you are using callbacks, note that <code class="docutils literal notranslate"><span class="pre">createPool()</span></code> is not synchronous.</p>
<p>Once cached, the default pool can be retrieved using <a class="reference external" href="#getpool">oracledb.getPool()</a> without
passing the <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code> parameter:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getPool</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>
</pre></div>
</div>
<p>This specific sequence can be simplified by using the shortcut to
<a class="reference external" href="#getconnectiondb">oracledb.getConnection()</a> that returns a connection
from a pool:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>
<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// Use connection from the previously created &#39;default&#39; pool and then release it</span>
</pre></div>
</div>
</div>
<div class="section" id="using-multiple-pools">
<h5>Using Multiple Pools<a class="headerlink" href="#using-multiple-pools" title="Permalink to this headline">¶</a></h5>
<p>If the application needs to use more than one pool at a time, unique pool aliases
can be used when creating the pools:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span>
  <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
  <span class="nx">password</span><span class="o">:</span> <span class="nx">myhrpw</span><span class="p">,</span>  <span class="c1">// myhrpw contains the hr schema password</span>
  <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/XEPDB1&#39;</span><span class="p">,</span>
  <span class="nx">poolAlias</span><span class="o">:</span> <span class="s1">&#39;hrpool&#39;</span>
<span class="p">});</span>

<span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span>
  <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;sh&#39;</span><span class="p">,</span>
  <span class="nx">password</span><span class="o">:</span> <span class="nx">myshpw</span><span class="p">,</span>  <span class="c1">// myshpw contains the sh schema password</span>
  <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/XEPDB1&#39;</span><span class="p">,</span>
  <span class="nx">poolAlias</span><span class="o">:</span> <span class="s1">&#39;shpool&#39;</span>
<span class="p">});</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>To use the methods or attributes of a pool in the cache, a pool can be retrieved
from the cache by passing its pool alias to <a class="reference external" href="#getpool">oracledb.getPool()</a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getPool</span><span class="p">(</span><span class="s1">&#39;hrpool&#39;</span><span class="p">);</span> <span class="c1">// or &#39;shpool&#39;</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// Use connection from the pool and then release it</span>
</pre></div>
</div>
<p>The <a class="reference external" href="#getconnectiondb">oracledb.getConnection()</a> shortcut can also be used with a pool alias:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span><span class="s1">&#39;hrpool&#39;</span><span class="p">);</span>
<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// Use connection from the pool and then release it</span>
</pre></div>
</div>
<p>From node-oracledb 3.1.0 you can pass the alias as an attribute of the
options:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span> <span class="nx">poolAlias</span><span class="o">:</span> <span class="s1">&#39;hrpool&#39;</span> <span class="p">});</span>
 <span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// Use connection from the pool and then release it</span>
</pre></div>
</div>
<p>The presence of the <code class="docutils literal notranslate"><span class="pre">poolAlias</span></code> attribute indicates the previously
created connection pool should be used instead of creating a
standalone connection.  This syntax is useful when you want to pass
other attributes to a pooled <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> call, such as for
<a class="reference external" href="#connpoolproxy">proxy connections</a> or with <a class="reference external" href="#connpooltagging">connection
tagging</a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>const connection = await oracledb.getConnection({ poolAlias: &#39;hrpool&#39;, tag: &#39;loc=cn;p=1 });
 . . . // Use connection from the pool and then release it
</pre></div>
</div>
<p>To use the default pool in this way you must explicitly pass the alias
<code class="docutils literal notranslate"><span class="pre">default</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>const connection = await oracledb.getConnection({ poolAlias: &#39;default&#39;, tag: &#39;loc=cn;p=1 });
. . . // Use connection from the pool and then release it
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-connpoolqueue-a-14-4-4-connection-pool-queue">
<h4><a name="connpoolqueue"></a> 14.4.4 Connection Pool Queue<a class="headerlink" href="#a-name-connpoolqueue-a-14-4-4-connection-pool-queue" title="Permalink to this headline">¶</a></h4>
<p>If the application has called <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> so that all
connections in the pool are in use, and
further <a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code></a> requests
(or <a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a> calls that use a
pool) are made, then each new request will be queued until an in-use
connection is released back to the pool
with <a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">connection.close()</span></code></a>.  If <code class="docutils literal notranslate"><span class="pre">poolMax</span></code> has not
been reached, then connections can be satisfied and are not queued.</p>
<p>The amount of time that a queued request will wait for a free
connection can be configured with <a class="reference external" href="#propdbqueuetimeout">queueTimeout</a>.
When connections are timed out of the queue, they will return the
error <em>NJS-040: connection request timeout</em> to the application.</p>
<p>Internally the queue is implemented in node-oracledb’s JavaScript top
level.  A queued connection request is dequeued and passed down to
node-oracledb’s underlying C API connection pool when an active
connection is <a class="reference external" href="#connectionclose">released</a>, and the number of
connections in use drops below the value of
<a class="reference external" href="#proppoolpoolmax"><code class="docutils literal notranslate"><span class="pre">poolMax</span></code></a>.</p>
</div>
<div class="section" id="a-name-connpoolmonitor-a-14-4-5-connection-pool-monitoring-and-throughput">
<h4><a name="connpoolmonitor"></a> 14.4.5 Connection Pool Monitoring and Throughput<a class="headerlink" href="#a-name-connpoolmonitor-a-14-4-5-connection-pool-monitoring-and-throughput" title="Permalink to this headline">¶</a></h4>
<p>Connection pool usage should be monitored to choose the appropriate
connection pool settings for your workload.</p>
<p>The Pool attributes <a class="reference external" href="#proppoolconnectionsinuse"><code class="docutils literal notranslate"><span class="pre">connectionsInUse</span></code></a>
and <a class="reference external" href="#proppoolconnectionsopen"><code class="docutils literal notranslate"><span class="pre">connectionsOpen</span></code></a> provide basic
information about an active pool.</p>
<p>Further statistics can be enabled by setting the
<a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">createPool()</span></code></a> <code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code> parameter <code class="docutils literal notranslate"><span class="pre">_enableStats</span></code> to
<em>true</em>.  Statistics can be output to the console by calling the
<code class="docutils literal notranslate"><span class="pre">pool._logStats()</span></code> method.  The underscore prefixes indicate that
these are private attributes and methods.  <strong>This interface may be
altered or enhanced in the future</strong>.</p>
<p>To enable recording of queue statistics:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span> <span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">_enableStats</span>  <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>   <span class="c1">// default is false</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>   <span class="c1">// mypw contains the hr schema password</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
  <span class="p">});</span>
  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>The application can later, on some developer-chosen event, display the
current statistics to the console by calling:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">pool</span><span class="p">.</span><span class="nx">_logStats</span><span class="p">();</span>
</pre></div>
</div>
<p>The current implementation of <code class="docutils literal notranslate"><span class="pre">_logStats()</span></code> displays pool queue
statistics, pool settings, and related environment variables.</p>
<div class="section" id="statistics">
<h5>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h5>
<p>The statistics displayed by <code class="docutils literal notranslate"><span class="pre">_logStats()</span></code> in this release are:</p>
<p>Statistic                 | Description
————————–|————-
total up time             | The number of milliseconds this pool has been running.
total connection requests | Number of <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> requests made by the application to this pool.
total requests enqueued   | Number of <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> requests that could not be immediately satisfied because every connection in this pool was already being used, and so they had to be queued waiting for the application to return an in-use connection to the pool.
total requests dequeued   | Number of <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> requests that were dequeued when a connection in this pool became available for use.
total requests failed     | Number of <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> requests that invoked the underlying C API <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> callback with an error state. Does not include queue request timeout errors.
total request timeouts    | Number of queued <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> requests that were timed out after they had spent <a class="reference external" href="#propdbqueuetimeout">queueTimeout</a> or longer in this pool’s queue.
max queue length          | Maximum number of <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> requests that were ever waiting at one time.
sum of time in queue      | The sum of the time (milliseconds) that dequeued requests spent in the queue.
min time in queue         | The minimum time (milliseconds) that any dequeued request spent in the queue.
max time in queue         | The maximum time (milliseconds) that any dequeued request spent in the queue.
avg time in queue         | The average time (milliseconds) that dequeued requests spent in the queue.
pool connections in use   | The number of connections from this pool that <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> returned successfully to the application and have not yet been released back to the pool.
pool connections open     | The number of connections in this pool that have been established to the database.</p>
<p>Note that for efficiency, the minimum, maximum, average, and sum of
times in the queue are calculated when requests are removed from the
queue.  They do not take into account times for connection requests
still waiting in the queue.</p>
</div>
<div class="section" id="attribute-values">
<h5>Attribute Values<a class="headerlink" href="#attribute-values" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">_logStats()</span></code> method also shows attribute values of the pool:</p>
<p>Attribute                                   |
——————————————–|
<a class="reference external" href="#createpoolpoolattrspoolalias"><code class="docutils literal notranslate"><span class="pre">poolAlias</span></code></a>|
<a class="reference external" href="#propdbqueuetimeout"><code class="docutils literal notranslate"><span class="pre">queueTimeout</span></code></a>       |
<a class="reference external" href="#propdbpoolmin"><code class="docutils literal notranslate"><span class="pre">poolMin</span></code></a>                 |
<a class="reference external" href="#propdbpoolmax"><code class="docutils literal notranslate"><span class="pre">poolMax</span></code></a>                 |
<a class="reference external" href="#propdbpoolincrement"><code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code></a>     |
<a class="reference external" href="#propdbpooltimeout"><code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code></a>         |
<a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code></a> |
<a class="reference external" href="#createpoolpoolattrscallback"><code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code></a>|
<a class="reference external" href="#propdbstmtcachesize"><code class="docutils literal notranslate"><span class="pre">stmtCacheSize</span></code></a>     |</p>
</div>
<div class="section" id="pool-status">
<h5>Pool Status<a class="headerlink" href="#pool-status" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">_logStats()</span></code> method also shows the pool status:</p>
<p>Attribute                   |
—————————-|
<a class="reference external" href="#proppoolstatus"><code class="docutils literal notranslate"><span class="pre">status</span></code></a> |</p>
</div>
<div class="section" id="related-environment-variables">
<h5>Related Environment Variables<a class="headerlink" href="#related-environment-variables" title="Permalink to this headline">¶</a></h5>
<p>One related environment variable is is shown by <code class="docutils literal notranslate"><span class="pre">_logStats()</span></code>:</p>
<p>Environment Variable                                 | Description
—————————————————–|————-
<a class="reference external" href="#numberofthreads"><code class="docutils literal notranslate"><span class="pre">process.env.UV_THREADPOOL_SIZE</span></code></a> | The number of worker threads for this process.  Note this shows the value of the variable, however if this variable was set after the thread pool starts, the thread pool will actually be the default size of 4.</p>
</div>
</div>
<div class="section" id="a-name-connpoolpinging-a-14-4-6-connection-pool-pinging">
<h4><a name="connpoolpinging"></a> 14.4.6 Connection Pool Pinging<a class="headerlink" href="#a-name-connpoolpinging-a-14-4-6-connection-pool-pinging" title="Permalink to this headline">¶</a></h4>
<p>Connection pool pinging is a way for node-oracledb to identify
unusable pooled connections and replace them with usable ones before
returning them to the application.  Database connections may become
unusable due to network dropouts, database instance failures,
exceeding user profile resource limits, or by explicit session closure
from a DBA.  By default, idle connections in the pool are unaware of
these events so the pool could return unusable connections to the
application and errors would only occur when they are later used.
Pinging helps provide tolerance against this situation.</p>
<p>The frequency of pinging can be controlled with the
<a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">oracledb.poolPingInterval</span></code></a> property or
during <a class="reference external" href="#createpoolpoolattrspoolpinginterval">pool creation</a> to meet
your quality of service requirements.</p>
<p>The default <a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code></a> value is 60
seconds.  Possible values are:</p>
<p><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code> Value     | Behavior of a Pool <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> Call
———-|——————————————
<code class="docutils literal notranslate"><span class="pre">n</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">0</span></code> | Never checks for connection aliveness
<code class="docutils literal notranslate"><span class="pre">n</span></code> = <code class="docutils literal notranslate"><span class="pre">0</span></code> | Always checks for connection aliveness
<code class="docutils literal notranslate"><span class="pre">n</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">0</span></code> | Checks aliveness if the connection has been idle in the pool (not “checked out” to the application by <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>) for at least <code class="docutils literal notranslate"><span class="pre">n</span></code> seconds</p>
<p>A ping has the cost of a <a class="reference external" href="#roundtrips">round-trip</a> to the database so
always pinging after each <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> is not recommended for
most applications.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> is called to return a pooled connection, and
the connection has been idle in the pool (not “checked out” to the
application by <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>) for the specified <code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code>
time, then an internal “ping” will be performed first.  If the ping
detects the connection is invalid then node-oracledb internally drops
the unusable connection and obtains another from the pool.  This
second connection may also need a ping.  This ping-and-release process
may be repeated until:</p>
<ul class="simple">
<li><p>an existing connection that does not qualify for pinging is obtained.  The <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> call returns this to the application.  Note that since a ping may not have been performed, the connection is not guaranteed to be usable</p></li>
<li><p>a new, usable connection is opened. This is returned to the application</p></li>
<li><p>a number of unsuccessful attempts to find a valid connection have been made, after which an error is returned to the application</p></li>
</ul>
<p>Pools in active use may never have connections idle longer than
<code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code>, so pinging often only occurs for infrequently
accessed connection pools.</p>
<p>Because a ping may not occur every time a connection is returned from
<a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">getConnection()</span></code></a>, and also it is possible for
network outages to occur after <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> is called,
applications should continue to use appropriate statement execution
error checking.</p>
<p>When node-oracledb is using the Oracle client library version 12.2 or
later, then a lightweight connection check always occurs in the client
library.  While this check prevents some unusable connections from
being returned by <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code>, it does not identify errors such
as session termination from the database <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2BEF5482-CF97-4A85-BD90-9195E41E74EF">resource manager</a> or
user resource profile <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-ABC7AE4D-64A8-4EA9-857D-BEF7300B64C3"><code class="docutils literal notranslate"><span class="pre">IDLE_TIME</span></code></a>, or from an <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">SYSTEM</span> <span class="pre">KILL</span> <span class="pre">SESSION</span></code> command.  The explicit ping initiated by
<code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code> will detect these problems.</p>
<p>For ultimate scalability, use Oracle client 12.2 (or later) libraries,
disable explicit pool pinging by setting <code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code> to a
negative value, and make sure the firewall, database resource manager,
or user profile is not expiring idle sessions.</p>
<p>In all cases, when a bad connection is released back to the pool with
<a class="reference external" href="#connectionclose">connection.close()</a>, the connection is
automatically destroyed.  This allows a valid connection to the
database to be opened by some subsequent <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> call.</p>
<p>Explicit pings can be performed at any time with
<a class="reference external" href="#connectionping"><code class="docutils literal notranslate"><span class="pre">connection.ping()</span></code></a>.</p>
</div>
<div class="section" id="a-name-connpooltagging-a-14-4-7-connection-tagging-and-session-state">
<h4><a name="connpooltagging"></a> 14.4.7 Connection Tagging and Session State<a class="headerlink" href="#a-name-connpooltagging-a-14-4-7-connection-tagging-and-session-state" title="Permalink to this headline">¶</a></h4>
<p>Applications can set “session” state in each connection.  For all
practical purposes, connections are synonymous with sessions.
Examples of session state are <a class="reference external" href="#nls">NLS</a> settings from ALTER SESSION
statements.  Pooled connections will retain their session state after
they have been released back to the pool with <code class="docutils literal notranslate"><span class="pre">connection.close()</span></code>.
However, because pools can grow, or connections in the pool can be
recreated, there is no guarantee a subsequent <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code>
call will return a database connection that has any particular state.</p>
<p>The <a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code></a> option attribute
<a class="reference external" href="#createpoolpoolattrssessioncallback"><code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code></a> can be used
to set session state efficiently so that connections have a known
session state.  The <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> can be a Node.js function that
will be called whenever <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> will return a newly
created database connection that has not been used before.  It is also
called when connection tagging is being used and the requested tag is
not identical to the tag in the connection returned by the pool.  It
is called before <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> returns in these two cases.
It will not be called in other cases.  Using a callback saves the cost
of setting session state if a previous user of a connection has
already set it.  The caller of <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> can always
assume the correct state is set.  The <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> can also be a
PL/SQL procedure, described in <a class="reference external" href="#sessiontaggingplsql">PL/SQL Session Tagging
Callback</a>.</p>
<p>There are three common scenarios for <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code>:</p>
<ul class="simple">
<li><p>When all connections in the pool should have the same state: use a
<a class="reference external" href="#sessionfixupnode">Node.js callback without tagging</a>.</p></li>
<li><p>When connections in the pool require different state for different
users: use a <a class="reference external" href="#sessiontaggingnode">Node.js callback with tagging</a>.</p></li>
<li><p>When using <a class="reference external" href="#drcp">DRCP</a>: use a <a class="reference external" href="#sessiontaggingplsql">PL/SQL callback and
tagging</a>.</p></li>
</ul>
<div class="section" id="a-name-sessionfixupnode-a-14-4-7-1-node-js-session-callback">
<h5><a name="sessionfixupnode"></a> 14.4.7.1 Node.js Session Callback<a class="headerlink" href="#a-name-sessionfixupnode-a-14-4-7-1-node-js-session-callback" title="Permalink to this headline">¶</a></h5>
<p>This example sets two NLS settings in each pooled connection.  They
are only set the very first time connections are established to the
database.  The <code class="docutils literal notranslate"><span class="pre">requestedTag</span></code> parameter is ignored because it is only
valid when tagging is being used:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">initSession</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">requestedTag</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
    <span class="sb">`alter session set nls_date_format = &#39;YYYY-MM-DD&#39; nls_language = AMERICAN`</span><span class="p">,</span>
    <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span>
               <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
               <span class="nx">password</span><span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
               <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/XEPDB1&#39;</span><span class="p">,</span>
               <span class="nx">sessionCallback</span><span class="o">:</span> <span class="nx">initSession</span>
             <span class="p">});</span>
  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you need to execute multiple SQL statements in the callback, use an
anonymous PL/SQL block to save <a class="reference external" href="#roundtrips">round-trips</a> of repeated
<code class="docutils literal notranslate"><span class="pre">execute()</span></code> calls:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`begin</span>
<span class="sb">     execute immediate</span>
<span class="sb">       &#39;alter session set nls_date_format = &#39;&#39;YYYY-MM-DD&#39;&#39; nls_language = AMERICAN&#39;;</span>
<span class="sb">     -- other SQL statements could be put here</span>
<span class="sb">   end;`</span><span class="p">,</span>
  <span class="nx">cb</span><span class="p">);</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/sessionfixup.js"><code class="docutils literal notranslate"><span class="pre">sessionfixup.js</span></code></a> for a runnable example.</p>
<p>Connection tagging and <code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> are new features in
node-oracledb 3.1.</p>
</div>
<div class="section" id="a-name-sessionfixuptagging-a-14-4-7-2-connection-tagging">
<h5><a name="sessionfixuptagging"></a> 14.4.7.2 Connection Tagging<a class="headerlink" href="#a-name-sessionfixuptagging-a-14-4-7-2-connection-tagging" title="Permalink to this headline">¶</a></h5>
<p>Pooled connections can be tagged to record their session state by
setting the property <a class="reference external" href="#propconntag"><code class="docutils literal notranslate"><span class="pre">connection.tag</span></code></a> to a string.  A
<code class="docutils literal notranslate"><span class="pre">pool.getConnection({tag:</span> <span class="pre">'mytag'})</span></code> call can request a connection
that has the specified tag.  If no available connections with that tag
exist in the pool, an untagged connection or a connection with a new
session will be returned.  If the optional <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> attribute
<code class="docutils literal notranslate"><span class="pre">matchAnyTag</span></code> is <em>true</em>, then a connection that has a different tag
may be returned.</p>
<p>The <a class="reference external" href="#createpoolpoolattrssessioncallback"><code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code></a> function
is invoked before <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> returns if the requested tag
is not identical to the actual tag of the pooled connection.  The
callback can compare the requested tag with the current actual tag in
<code class="docutils literal notranslate"><span class="pre">connection.tag</span></code>.  Any desired state change can be made to the
connection and <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> can be updated to record the change.
The best practice recommendation is to set the tag in the callback
function but, if required, a tag can be set anytime prior to closing
the connection.  To clear a connection’s tag set <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> to
an empty string.</p>
<p>You would use tagging where you want <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> to return
a connection which has one of several different states.  If all
connections should have the same state then you can simply set
<code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code>, as shown <a class="reference external" href="#sessionfixupnode">earlier</a>, and not use
tagging.  Also, it may not be worthwhile using huge numbers of
different tags or using tagging where connections are being
<a class="reference external" href="#connectionclose">dropped</a> or recreated frequently since the chance
of <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> returning an already initialized connection
with the requested tag could be low, so most <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code>
calls would return a connection needing its session reset, and tag
management will just add overhead.</p>
<p>When node-oracledb is using Oracle Client libraries 12.2 or later,
then node-oracledb uses ‘multi-property tags’ and the tag string must
be of the form of one or more “name=value” pairs separated by a
semi-colon, for example <code class="docutils literal notranslate"><span class="pre">&quot;loc=uk;lang=cy&quot;</span></code>.  The Oracle <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C">session
pool</a> used by node-oracledb has various heuristics to determine
which connection is returned to the application.  Refer to the
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C">multi-property tags documentation</a>.  The callback function can
parse the requested multi-property tag and compare it with the
connection’s actual properties in <a class="reference external" href="#propconntag"><code class="docutils literal notranslate"><span class="pre">connection.tag</span></code></a> to
determine what exact state to set and what value to update
<code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> to.</p>
</div>
<div class="section" id="a-name-sessiontaggingnode-a-14-4-7-3-node-js-session-tagging-callback">
<h5><a name="sessiontaggingnode"></a> 14.4.7.3 Node.js Session Tagging Callback<a class="headerlink" href="#a-name-sessiontaggingnode-a-14-4-7-3-node-js-session-tagging-callback" title="Permalink to this headline">¶</a></h5>
<p>This example Node.js callback function ensures the connection contains
valid settings for an application-specific “location=USA” property and
ignores any other properties in the tag that represent session state
set by other parts of the application (not shown) that are using the
same pool:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">sessionTag</span> <span class="o">=</span> <span class="s2">&quot;location=USA&quot;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">initSession</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">requestedTag</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">connection</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="s2">&quot;LOCATION=GB&quot;</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">seen</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">tag</span> <span class="o">?</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">).</span><span class="nx">includes</span><span class="p">(</span><span class="nx">requestedTag</span><span class="p">)</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">seen</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">cb</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
      <span class="sb">`ALTER SESSION SET NLS_DATE_FORMAT = &#39;MM/DD/YY&#39; NLS_LANGUAGE = AMERICAN`</span><span class="p">,</span>
      <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Update the tag the record the connection&#39;s new state</span>
        <span class="kr">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">requestedTag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">requestedTag</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// Update value of an existing, matching property in the tag</span>
          <span class="kr">const</span> <span class="nx">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot;[^;]*&quot;</span><span class="p">);</span>
          <span class="nx">connection</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">re</span><span class="p">,</span> <span class="nx">requestedTag</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">// the requested property was not previously set in the tag</span>
          <span class="nx">connection</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">requestedTag</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span> <span class="o">+</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">tag</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">cb</span><span class="p">();</span>
     <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span>
               <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
               <span class="nx">password</span><span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
               <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/XEPDB1&#39;</span><span class="p">,</span>
               <span class="nx">sessionCallback</span><span class="o">:</span> <span class="nx">initSession</span>
             <span class="p">});</span>

  <span class="c1">// Request a connection with a given tag from the pool cache, but accept any tag being returned.</span>
  <span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span><span class="nx">poolAlias</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span> <span class="nx">sessionTag</span><span class="p">,</span> <span class="nx">matchAnyTag</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>

  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// Use the connection</span>

  <span class="c1">// The connection will be returned to the pool with the tag value of connection.tag</span>
  <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>

  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>For runnable examples, see <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/sessiontagging1.js"><code class="docutils literal notranslate"><span class="pre">sessiontagging1.js</span></code></a> and <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/sessiontagging2.js"><code class="docutils literal notranslate"><span class="pre">sessiontagging2.js</span></code></a>.</p>
</div>
<div class="section" id="a-name-sessiontaggingplsql-a-14-4-7-4-pl-sql-session-tagging-callback">
<h5><a name="sessiontaggingplsql"></a> 14.4.7.4 PL/SQL Session Tagging Callback<a class="headerlink" href="#a-name-sessiontaggingplsql-a-14-4-7-4-pl-sql-session-tagging-callback" title="Permalink to this headline">¶</a></h5>
<p>When node-oracledb is using Oracle Client libraries 12.2 or later,
<code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code> can be a string containing the name of a PL/SQL
procedure that is called when the requested tag does not match the
actual tag in the connection.  When the application uses <a class="reference external" href="#drcp">DRCP
connections</a>, a PL/SQL callback can avoid the
<a class="reference external" href="#roundtrips">round-trip</a> calls that a Node.js function would require
to set session state.  For non-DRCP connections, the PL/SQL callback
will require a round-trip from the application.</p>
<p>After a PL/SQL callback completes and <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> returns,
<a class="reference external" href="#propconntag"><code class="docutils literal notranslate"><span class="pre">connection.tag</span></code></a> will have the same property values as
the requested tag.  The property order may be different.  For example
you may request “USER_TZ=UTC;LANGUAGE=FRENCH” but <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> may
be “LANGUAGE=FRENCH;USER_TZ=UTC”.  When <code class="docutils literal notranslate"><span class="pre">matchAnyTag</span></code> is <em>true</em>, then
various heuristics are used to determine which connection in the pool
to use.  See the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C">multi-property tags documentation</a>.  Additional
properties may be present in <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code>.</p>
<p>There is no direct way for Node.js to know if the PL/SQL procedure was
called or what session state it changed.  After <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code>
returns, care must be taken to set <code class="docutils literal notranslate"><span class="pre">connection.tag</span></code> to an appropriate
value.</p>
<p>A sample PL/SQL callback procedure looks like:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">myPackage</span> <span class="k">AS</span>
  <span class="k">TYPE</span> <span class="n">property_t</span> <span class="k">IS</span> <span class="k">TABLE</span> <span class="k">OF</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">INDEX</span> <span class="k">BY</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
  <span class="k">PROCEDURE</span> <span class="n">buildTab</span><span class="p">(</span>
    <span class="n">tag</span>          <span class="k">IN</span>  <span class="n">VARCHAR2</span><span class="p">,</span>
    <span class="n">propertyTab</span>  <span class="k">OUT</span> <span class="n">property_t</span>
  <span class="p">);</span>
  <span class="k">PROCEDURE</span> <span class="n">myPlsqlCallback</span> <span class="p">(</span>
    <span class="n">requestedTag</span> <span class="k">IN</span>  <span class="n">VARCHAR2</span><span class="p">,</span>
    <span class="n">actualTag</span>    <span class="k">IN</span>  <span class="n">VARCHAR2</span>
  <span class="p">);</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">BODY</span> <span class="n">myPackage</span> <span class="k">AS</span>

  <span class="c1">-- Parse the &quot;property=value&quot; pairs in the tag</span>
  <span class="k">PROCEDURE</span> <span class="n">buildTab</span><span class="p">(</span><span class="n">tag</span> <span class="k">IN</span> <span class="n">VARCHAR2</span><span class="p">,</span> <span class="n">propertyTab</span> <span class="k">OUT</span> <span class="n">property_t</span><span class="p">)</span> <span class="k">IS</span>
    <span class="n">property</span>  <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
    <span class="n">propertyName</span>  <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
    <span class="n">propertyValue</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
    <span class="n">propertyEndPos</span> <span class="nb">NUMBER</span> <span class="p">:</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">propertyStartPos</span> <span class="nb">NUMBER</span> <span class="p">:</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">propertyNameEndPos</span> <span class="nb">NUMBER</span> <span class="p">:</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">begin</span>
    <span class="n">WHILE</span> <span class="p">(</span><span class="k">LENGTH</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">propertyEndPos</span><span class="p">)</span>
    <span class="n">LOOP</span>
      <span class="n">propertyEndPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">propertyStartPos</span><span class="p">);</span>
      <span class="k">IF</span> <span class="p">(</span><span class="n">propertyEndPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
        <span class="n">propertyEndPos</span> <span class="p">:</span><span class="o">=</span> <span class="k">LENGTH</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">END</span> <span class="k">IF</span><span class="p">;</span>
      <span class="n">propertyNameEndPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">propertyStartPos</span><span class="p">);</span>
      <span class="n">propertyName</span> <span class="p">:</span><span class="o">=</span> <span class="n">SUBSTR</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">propertyStartPos</span><span class="p">,</span>
                   <span class="n">propertyNameEndPos</span> <span class="o">-</span> <span class="n">propertyStartPos</span><span class="p">);</span>
      <span class="n">propertyValue</span> <span class="p">:</span><span class="o">=</span> <span class="n">SUBSTR</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">propertyNameEndPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">propertyEndPos</span> <span class="o">-</span> <span class="n">propertyNameEndPos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">propertyTab</span><span class="p">(</span><span class="n">propertyName</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="n">propertyValue</span><span class="p">;</span>
      <span class="n">propertyStartPos</span> <span class="p">:</span><span class="o">=</span> <span class="n">propertyEndPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">END</span> <span class="n">LOOP</span><span class="p">;</span>
  <span class="k">END</span><span class="p">;</span>

  <span class="k">PROCEDURE</span> <span class="n">myPlsqlCallback</span> <span class="p">(</span>
    <span class="n">requestedTag</span> <span class="k">IN</span> <span class="n">VARCHAR2</span><span class="p">,</span>
    <span class="n">actualTag</span> <span class="k">IN</span> <span class="n">VARCHAR2</span>
  <span class="p">)</span> <span class="k">IS</span>
    <span class="n">reqPropTab</span> <span class="n">property_t</span><span class="p">;</span>
    <span class="n">actPropTab</span> <span class="n">property_t</span><span class="p">;</span>
    <span class="n">propertyName</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
  <span class="k">BEGIN</span>
    <span class="n">buildTab</span><span class="p">(</span><span class="n">requestedTag</span><span class="p">,</span> <span class="n">reqPropTab</span><span class="p">);</span>
    <span class="n">buildTab</span><span class="p">(</span><span class="n">actualTag</span><span class="p">,</span> <span class="n">actPropTab</span><span class="p">);</span>

    <span class="c1">-- Iterate over requested properties to set state when it&#39;s not</span>
    <span class="c1">-- currently set, or not set to the desired value</span>
    <span class="n">propertyName</span> <span class="p">:</span><span class="o">=</span> <span class="n">reqPropTab</span><span class="p">.</span><span class="k">FIRST</span><span class="p">;</span>
    <span class="n">WHILE</span> <span class="p">(</span><span class="n">propertyName</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">)</span>
    <span class="n">LOOP</span>
      <span class="k">IF</span> <span class="p">((</span><span class="k">NOT</span> <span class="n">actPropTab</span><span class="p">.</span><span class="k">exists</span><span class="p">(</span><span class="n">propertyName</span><span class="p">))</span> <span class="k">OR</span>
         <span class="p">(</span><span class="n">actPropTab</span><span class="p">(</span><span class="n">propertyName</span><span class="p">)</span> <span class="o">!=</span> <span class="n">reqPropTab</span><span class="p">(</span><span class="n">propertyName</span><span class="p">)))</span> <span class="k">THEN</span>
        <span class="k">IF</span> <span class="p">(</span><span class="n">propertyName</span> <span class="o">=</span> <span class="s1">&#39;SDTZ&#39;</span><span class="p">)</span> <span class="k">THEN</span>
          <span class="k">EXECUTE</span> <span class="k">IMMEDIATE</span>
            <span class="s1">&#39;ALTER SESSION SET TIME_ZONE=&#39;&#39;&#39;</span> <span class="o">||</span> <span class="n">reqPropTab</span><span class="p">(</span><span class="n">propertyName</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">ELSE</span>
          <span class="n">RAISE_APPLICATION_ERROR</span><span class="p">(</span><span class="o">-</span><span class="mi">20001</span><span class="p">,</span><span class="s1">&#39;Unexpected session setting requested&#39;</span><span class="p">);</span>
        <span class="k">END</span> <span class="k">IF</span><span class="p">;</span>
      <span class="k">END</span> <span class="k">IF</span><span class="p">;</span>
      <span class="n">propertyName</span> <span class="p">:</span><span class="o">=</span> <span class="n">reqPropTab</span><span class="p">.</span><span class="k">NEXT</span><span class="p">(</span><span class="n">propertyName</span><span class="p">);</span>
    <span class="k">END</span> <span class="n">LOOP</span><span class="p">;</span>
    <span class="c1">-- Could iterate over other actual properties to set any to a default state</span>
  <span class="k">END</span><span class="p">;</span>

<span class="k">END</span> <span class="n">myPackage</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>This could be used in your application like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">sessionTag</span> <span class="o">=</span> <span class="s2">&quot;SDTZ=UTC&quot;</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span>
               <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
               <span class="nx">password</span><span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
               <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/XEPDB1&#39;</span><span class="p">,</span>
               <span class="nx">sessionCallback</span><span class="o">:</span> <span class="s2">&quot;myPackage.myPlsqlCallback&quot;</span>
             <span class="p">});</span>
  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>

  <span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span><span class="nx">tag</span><span class="o">:</span> <span class="nx">sessionTag</span><span class="p">});</span>

  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// The value of connection.tag will be sessionTag</span>
        <span class="c1">// Use connection.</span>

  <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-connpoolproxy-a-14-4-8-heterogeneous-connection-pools-and-pool-proxy-authentication">
<h4><a name="connpoolproxy"></a> 14.4.8 Heterogeneous Connection Pools and Pool Proxy Authentication<a class="headerlink" href="#a-name-connpoolproxy-a-14-4-8-heterogeneous-connection-pools-and-pool-proxy-authentication" title="Permalink to this headline">¶</a></h4>
<p>By default, connection pools are ‘homogeneous’ meaning that all
connections use the same database credentials.  However, if the pool
option <a class="reference external" href="#createpoolpoolattrshomogeneous"><code class="docutils literal notranslate"><span class="pre">homogeneous</span></code></a> is <em>false</em> at
pool creation, then a ‘heterogeneous’ pool will be created.  This
allows different credentials to be used each time a connection is
acquired from the pool with
<a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code></a>.</p>
<div class="section" id="heterogeneous-pools">
<h5>Heterogeneous Pools<a class="headerlink" href="#heterogeneous-pools" title="Permalink to this headline">¶</a></h5>
<p>When a heterogeneous pool is created by setting
<a class="reference external" href="#createpoolpoolattrshomogeneous"><code class="docutils literal notranslate"><span class="pre">homogeneous</span></code></a> to <em>false</em> and no
credentials supplied during pool creation, then a user name and
password may be passed to <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span><span class="p">,</span>  <span class="c1">// no user name or password</span>
    <span class="nx">homogeneous</span>   <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>  <span class="c1">// other pool options such as poolMax</span>
  <span class="p">});</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>     <span class="o">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
    <span class="nx">password</span> <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
  <span class="p">});</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// use connection</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">connectString</span></code> is required during pool creation since the pool is
created for one database instance.</p>
<p>Different user names may be used each time <code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> is
called.</p>
<p>When applications want to use connection pools but are not able to use
<a class="reference external" href="#propconnclientid"><code class="docutils literal notranslate"><span class="pre">connection.clientId</span></code></a> to distinguish application
users from database schema owners, a ‘heterogeneous’ connection pool
might be an option.</p>
<p>Note heterogeneous pools cannot be used with the <a class="reference external" href="#connpoolcache">connection pool
cache</a>.  Applications should ensure the pool object is
explicitly passed between code modules, or use a homogeneous pool and
make use of <a class="reference external" href="#propconnclientid"><code class="docutils literal notranslate"><span class="pre">connection.clientId</span></code></a>.</p>
<p>For heterogeneous pools, the number of connections initially created
is zero even if a larger value is specified for
<a class="reference external" href="#propdbpoolmin"><code class="docutils literal notranslate"><span class="pre">poolMin</span></code></a>.  The pool increment is always 1,
regardless of the value of
<a class="reference external" href="#createpoolpoolattrspoolincrement"><code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code></a>.  Once the number
of open connections exceeds <code class="docutils literal notranslate"><span class="pre">poolMin</span></code> and connections are idle for
more than the <a class="reference external" href="#propdbpooltimeout"><code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code></a> seconds, then the
number of open connections does not fall below <code class="docutils literal notranslate"><span class="pre">poolMin</span></code>.</p>
</div>
<div class="section" id="pool-proxy-authentication">
<h5>Pool Proxy Authentication<a class="headerlink" href="#pool-proxy-authentication" title="Permalink to this headline">¶</a></h5>
<p>Pool proxy authentication requires a heterogeneous pool.</p>
<p>The idea of a proxy is to create a schema in one database user name.
Privilege is granted on that schema to other database users so they
can access the schema and manipulate its data.  This aids three-tier
applications where one user owns the schema while multiple end-users
access the data.</p>
<p>To grant access, typically a DBA would execute:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">USER</span> <span class="n">sessionuser</span> <span class="k">GRANT</span> <span class="k">CONNECT</span> <span class="n">THROUGH</span> <span class="n">proxyuser</span><span class="p">;</span>
</pre></div>
</div>
<p>For example, to allow a user called <code class="docutils literal notranslate"><span class="pre">MYPROXYUSER</span></code> to access the schema
of <code class="docutils literal notranslate"><span class="pre">HR</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SQL</span><span class="o">&gt;</span> <span class="n">CONNECT</span> <span class="n">system</span>

<span class="n">SQL</span><span class="o">&gt;</span> <span class="n">ALTER</span> <span class="n">USER</span> <span class="n">hr</span> <span class="n">GRANT</span> <span class="n">CONNECT</span> <span class="n">THROUGH</span> <span class="n">myproxyuser</span><span class="p">;</span>

<span class="n">SQL</span><span class="o">&gt;</span> <span class="n">CONNECT</span> <span class="n">myproxyuser</span><span class="p">[</span><span class="n">hr</span><span class="p">]</span><span class="o">/</span><span class="n">myproxyuserpassword</span>

<span class="n">SQL</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">SYS_CONTEXT</span><span class="p">(</span><span class="s1">&#39;USERENV&#39;</span><span class="p">,</span> <span class="s1">&#39;SESSION_USER&#39;</span><span class="p">)</span> <span class="n">AS</span> <span class="n">SESSION_USER</span><span class="p">,</span>
  <span class="mi">2</span>         <span class="n">SYS_CONTEXT</span><span class="p">(</span><span class="s1">&#39;USERENV&#39;</span><span class="p">,</span> <span class="s1">&#39;PROXY_USER&#39;</span><span class="p">)</span>   <span class="n">AS</span> <span class="n">PROXY_USER</span>
  <span class="mi">3</span>  <span class="n">FROM</span> <span class="n">DUAL</span><span class="p">;</span>

<span class="n">SESSION_USER</span>         <span class="n">PROXY_USER</span>
<span class="o">--------------------</span> <span class="o">--------------------</span>
<span class="n">HR</span>                   <span class="n">MYPROXYUSER</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D77D0D4A-7483-423A-9767-CBB5854A15CC">Client Access Through a Proxy</a> section in the Oracle Call
Interface manual for more details about proxy authentication.</p>
<p>To use the proxy user with a node-oracledb heterogeneous connection
pool you could do:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">myproxyuserpw</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// the password of the &#39;myproxyuser&#39; proxy user</span>

<span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">({</span> <span class="nx">connectString</span><span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span><span class="p">,</span> <span class="nx">homogeneous</span><span class="o">:</span> <span class="kc">false</span> <span class="p">});</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;myproxyuser[hr]&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="nx">myproxyuserpw</span><span class="p">});</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// connection has access to the HR schema objects</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
<p>Other proxy cases are supported such as:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">myproxyuserpw</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// the password of the &#39;myproxyuser&#39; proxy user</span>

<span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s1">&#39;myproxyuser&#39;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">myproxyuserpw</span><span class="p">,</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span><span class="p">,</span>
    <span class="nx">homogeneous</span>   <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>  <span class="c1">// other pool options such as poolMax can be used</span>
  <span class="p">});</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span> <span class="nx">user</span> <span class="o">:</span> <span class="s1">&#39;hr&#39;</span> <span class="p">});</span>  <span class="c1">// the session user</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// connection has access to the HR schema objects</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-extauth-a-14-4-external-authentication">
<h3><a name="extauth"></a> 14.4 External Authentication<a class="headerlink" href="#a-name-extauth-a-14-4-external-authentication" title="Permalink to this headline">¶</a></h3>
<p>External Authentication allows applications to use an external
password store (such as an <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-E3E16C82-E174-4814-98D5-EADF1BCB3C37">Oracle Wallet</a>), the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-6AD89576-526F-4D6B-A539-ADF4B840819F">Secure Socket
Layer</a> (SSL), or the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-37BECE32-58D5-43BF-A098-97936D66968F">operating system</a> to validate user
access.  One of the benefits is that database credentials do not need
to be hard coded in the application.</p>
<p>To use external authentication, set the
<a class="reference external" href="#propdbisexternalauth"><code class="docutils literal notranslate"><span class="pre">oracledb.externalAuth</span></code></a> property to <em>true</em>.  This property can
also be set in the <code class="docutils literal notranslate"><span class="pre">connAttrs</span></code> or <code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code> parameters of the
<a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a> or
<a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">oracledb.createPool()</span></code></a> calls, respectively.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">externalAuth</span></code> is set, any subsequent connections obtained using
the <a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a> or
<a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code></a> calls will use external
authentication.  Setting this property does not affect the operation
of existing connections or pools.</p>
<p>For a standalone connection:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">connectString</span><span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span><span class="p">,</span> <span class="nx">externalAuth</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// connection has access to the schema objects of the externally identified user</span>
</pre></div>
</div>
<p>If a user <code class="docutils literal notranslate"><span class="pre">HR</span></code> has been given the <code class="docutils literal notranslate"><span class="pre">CONNECT</span> <span class="pre">THROUGH</span></code> grant from the
externally identified user <code class="docutils literal notranslate"><span class="pre">MYPROXYUSER</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">USER</span> <span class="n">hr</span> <span class="k">GRANT</span> <span class="k">CONNECT</span> <span class="n">THROUGH</span> <span class="n">myproxyuser</span><span class="p">;</span>
</pre></div>
</div>
<p>then to specify that the session user of the connection should be
<code class="docutils literal notranslate"><span class="pre">HR</span></code>, use:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">connectString</span><span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span><span class="p">,</span> <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;[hr]&quot;</span><span class="p">,</span> <span class="nx">externalAuth</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// connection has access to the HR schema objects</span>
</pre></div>
</div>
<p>For a <em>Pool</em>, you can authenticate as an externally identified user like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">connectString</span><span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span><span class="p">,</span> <span class="nx">externalAuth</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// connection has access to the schema objects of the externally identified user</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
<p>If a user <code class="docutils literal notranslate"><span class="pre">HR</span></code> has been given the <code class="docutils literal notranslate"><span class="pre">CONNECT</span> <span class="pre">THROUGH</span></code> grant from the
externally identified user, then to specify that the session user of
the connection should be <code class="docutils literal notranslate"><span class="pre">HR</span></code>, use:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">connectString</span><span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span><span class="p">,</span> <span class="nx">externalAuth</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">pool</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">createPool</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">pool</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;[hr]&quot;</span> <span class="p">});</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// connection has access to the HR schema objects</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
<p>Note this last case needs Oracle Client libraries version 18 or later.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">externalAuth</span></code> in the <code class="docutils literal notranslate"><span class="pre">connAttrs</span></code> parameter of a
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> call is not possible.  The connections from a <em>Pool</em>
object are always obtained in the manner in which the pool was
initially created.</p>
<p>For pools created with external authentication, the number of
connections initially created is zero even if a larger value is
specified for <a class="reference external" href="#propdbpoolmin"><code class="docutils literal notranslate"><span class="pre">poolMin</span></code></a>.  The pool increment is
always 1, regardless of the value of
<a class="reference external" href="#proppoolpoolincrement"><code class="docutils literal notranslate"><span class="pre">poolIncrement</span></code></a>.  Once the number
of open connections exceeds <code class="docutils literal notranslate"><span class="pre">poolMin</span></code> and connections are idle for
more than the <a class="reference external" href="#propdbpooltimeout"><code class="docutils literal notranslate"><span class="pre">poolTimeout</span></code></a> seconds, then the
number of open connections does not fall below <code class="docutils literal notranslate"><span class="pre">poolMin</span></code>.</p>
</div>
<div class="section" id="a-name-drcp-a-14-5-database-resident-connection-pooling-drcp">
<h3><a name="drcp"></a> 14.5 Database Resident Connection Pooling (DRCP)<a class="headerlink" href="#a-name-drcp-a-14-5-database-resident-connection-pooling-drcp" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-015CA8C1-2386-4626-855D-CC546DDC1086">Database Resident Connection Pooling</a> (DRCP) enables database
resource sharing for applications that run in multiple client
processes or run on multiple middle-tier application servers.  DRCP
reduces the overall number of connections that a database must handle.</p>
<p>DRCP is useful for applications which share the same database credentials, have
similar session settings (for example date format settings and PL/SQL
package state), and where the application gets a database connection,
works on it for a relatively short duration, and then releases it.</p>
<p>To use DRCP in node-oracledb:</p>
<ol class="simple">
<li><p>The DRCP pool must be started in the database: <code class="docutils literal notranslate"><span class="pre">SQL&gt;</span> <span class="pre">EXECUTE</span> <span class="pre">DBMS_CONNECTION_POOL.START_POOL();</span></code></p></li>
<li><p>The <a class="reference external" href="#propdbconclass"><code class="docutils literal notranslate"><span class="pre">connectionClass</span></code></a> should be set by the node-oracledb application.  If it is not set, the pooled server session memory will not be reused optimally, and the statistic views will record large values for <code class="docutils literal notranslate"><span class="pre">NUM_MISSES</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">pool.createPool()</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code> property <code class="docutils literal notranslate"><span class="pre">connectString</span></code> (or its alias <code class="docutils literal notranslate"><span class="pre">connectionString</span></code>) must specify to use a pooled server, either by the Easy Connect syntax like <a class="reference external" href="#easyconnect"><code class="docutils literal notranslate"><span class="pre">myhost/sales:POOLED</span></code></a>, or by using a <a class="reference external" href="#tnsnames"><code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code></a> alias for a connection that contains <code class="docutils literal notranslate"><span class="pre">(SERVER=POOLED)</span></code>.</p></li>
</ol>
<p>For efficiency, it is recommended that DRCP connections should be used
with node-oracledb’s local <a class="reference external" href="#poolclass">connection pool</a>.</p>
<p>The DRCP ‘Purity’ is SELF for DRCP connections.  This allows reuse of
both the pooled server process and session memory, giving maximum
benefit from DRCP.  See the Oracle documentation on <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-661BB906-74D2-4C5D-9C7E-2798F76501B3">benefiting from
scalability</a>.</p>
<p>The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-015CA8C1-2386-4626-855D-CC546DDC1086">Oracle DRCP documentation</a> has more details, including when
to use, and when not to use DRCP.</p>
<p>There are a number of Oracle Database <code class="docutils literal notranslate"><span class="pre">V$</span></code> views that can be used to
monitor DRCP.  These are discussed in the Oracle documentation and in
the Oracle white paper <a class="reference external" href="http://www.oracle.com/technetwork/topics/php/php-scalability-ha-twp-128842.pdf">PHP Scalability and High Availability</a>.
This paper also gives more detail on configuring DRCP.</p>
</div>
<div class="section" id="a-name-privconn-a-14-6-privileged-connections">
<h3><a name="privconn"></a> 14.6 Privileged Connections<a class="headerlink" href="#a-name-privconn-a-14-6-privileged-connections" title="Permalink to this headline">¶</a></h3>
<p>Database privileges such as <code class="docutils literal notranslate"><span class="pre">SYSDBA</span></code> can be obtained when using
standalone connections.  Use one of the <a class="reference external" href="#oracledbconstantsprivilege">Privileged Connection
Constants</a> with the connection
<a class="reference external" href="#getconnectiondbattrsprivilege"><code class="docutils literal notranslate"><span class="pre">privilege</span></code></a> property, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">connection</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="n">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="n">oracledb</span><span class="o">.</span><span class="n">getConnection</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="n">user</span>          <span class="p">:</span> <span class="s1">&#39;sys&#39;</span><span class="p">,</span>
      <span class="n">password</span>      <span class="p">:</span> <span class="s1">&#39;secret&#39;</span><span class="p">,</span>
      <span class="n">connectString</span> <span class="p">:</span> <span class="s1">&#39;localhost/orclpdb1&#39;</span><span class="p">,</span>
      <span class="n">privilege</span>     <span class="p">:</span> <span class="n">oracledb</span><span class="o">.</span><span class="n">SYSDBA</span>
    <span class="p">});</span>

  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;I have power&#39;</span><span class="p">);</span>

  <span class="o">.</span> <span class="o">.</span> <span class="o">.</span>  <span class="o">//</span> <span class="n">use</span> <span class="n">connection</span>

<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that if node-oracledb is using the Oracle client libraries
located in the Oracle Database installation, i.e. is on the same
machine as the database and is not using Oracle Instant Client, then
operating system privileges may be used for authentication.  In this
case the password value is ignored.  For example on Linux, membership
of the operating system <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-0A789F28-169A-43D6-9E48-AAE20D7B0C44"><code class="docutils literal notranslate"><span class="pre">dba</span></code></a> group allows <code class="docutils literal notranslate"><span class="pre">SYSDBA</span></code> connections.</p>
<p>Administrative privileges can allow access to a database instance even
when the database is not open.  Control of these privileges is totally
outside of the database itself.  Care must be taken with
authentication to ensure security.  See the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-C48021EF-6AEA-427F-95B2-37EFCFEA2400">Database Administrators
Guide</a> for information.</p>
</div>
<div class="section" id="a-name-securenetwork-a-14-7-securely-encrypting-network-traffic-to-oracle-database">
<h3><a name="securenetwork"></a> 14.7 Securely Encrypting Network Traffic to Oracle Database<a class="headerlink" href="#a-name-securenetwork-a-14-7-securely-encrypting-network-traffic-to-oracle-database" title="Permalink to this headline">¶</a></h3>
<p>Data transferred between Oracle Database and the Oracle client
libraries used by node-oracledb can be <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-7F12066A-2BA1-476C-809B-BB95A3F727CF">encrypted</a> so that
unauthorized parties are not able to view plain text data as it passes
over the network.  The easiest configuration is Oracle’s native
network encryption.  The standard SSL protocol can also be used if you
have a PKI, but setup is necessarily more involved.</p>
<p>With native network encryption, the client and database server
negotiate a key using Diffie-Hellman key exchange.  There is
protection against man-in-the-middle attacks.</p>
<p>Native network encryption can be configured by editing Oracle Net’s
optional <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2041545B-58D4-48DC-986F-DCC9D0DEC642"><code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code></a> configuration files, on either the
database server and/or on each node-oracledb ‘client’.  Parameters
control whether data integrity checking and encryption is required or
just allowed, and which algorithms the client and server should
consider for use.</p>
<p>As an example, to ensure all connections to the database are checked
for integrity and are also encrypted, create or edit the Oracle
Database <code class="docutils literal notranslate"><span class="pre">$ORACLE_HOME/network/admin/sqlnet.ora</span></code> file.  Set the
checksum negotiation to always validate a checksum and set the
checksum type to your desired value.  The network encryption settings
can similarly be set.  For example, to use the SHA512 checksum and
AES256 encryption use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SQLNET</span><span class="o">.</span><span class="n">CRYPTO_CHECKSUM_SERVER</span> <span class="o">=</span> <span class="n">required</span>
<span class="n">SQLNET</span><span class="o">.</span><span class="n">CRYPTO_CHECKSUM_TYPES_SERVER</span> <span class="o">=</span> <span class="p">(</span><span class="n">SHA512</span><span class="p">)</span>
<span class="n">SQLNET</span><span class="o">.</span><span class="n">ENCRYPTION_SERVER</span> <span class="o">=</span> <span class="n">required</span>
<span class="n">SQLNET</span><span class="o">.</span><span class="n">ENCRYPTION_TYPES_SERVER</span> <span class="o">=</span> <span class="p">(</span><span class="n">AES256</span><span class="p">)</span>
</pre></div>
</div>
<p>If you definitely know that the database server enforces integrity and
encryption, then you do not need to configure Node.js separately.
However you can also, or alternatively, do so depending on your
business needs.  Create a file <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> (see <a class="reference external" href="#tnsadmin">Optional Oracle Net
Configuration</a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SQLNET</span><span class="o">.</span><span class="n">CRYPTO_CHECKSUM_CLIENT</span> <span class="o">=</span> <span class="n">required</span>
<span class="n">SQLNET</span><span class="o">.</span><span class="n">CRYPTO_CHECKSUM_TYPES_CLIENT</span> <span class="o">=</span> <span class="p">(</span><span class="n">SHA512</span><span class="p">)</span>
<span class="n">SQLNET</span><span class="o">.</span><span class="n">ENCRYPTION_CLIENT</span> <span class="o">=</span> <span class="n">required</span>
<span class="n">SQLNET</span><span class="o">.</span><span class="n">ENCRYPTION_TYPES_CLIENT</span> <span class="o">=</span> <span class="p">(</span><span class="n">AES256</span><span class="p">)</span>
</pre></div>
</div>
<p>The client and server sides can negotiate the protocols used if the
settings indicate more than one value is accepted.</p>
<p>Note these are example settings only.  You must review your security
requirements and read the documentation for your Oracle version.  In
particular review the available algorithms for security and
performance.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NETWORK_SERVICE_BANNER</span></code> column of the database view
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-9F0DCAEA-A67E-4183-89E7-B1555DC591CE"><code class="docutils literal notranslate"><span class="pre">V$SESSION_CONNECT_INFO</span></code></a> can be used to verify the encryption
status of a connection.</p>
<p>For more information about Oracle Data Network Encryption and
Integrity, and for information about configuring SSL network
encryption, refer to the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=DBSEG">Oracle Database Security Guide</a>.  This
manual also contains information about other important security
features that Oracle Database provides, such Transparent Data
Encryption of data-at-rest in the database.</p>
</div>
<div class="section" id="a-name-changingpassword-a-14-8-changing-passwords-and-connecting-with-an-expired-password">
<h3><a name="changingpassword"></a> 14.8 Changing Passwords and Connecting with an Expired Password<a class="headerlink" href="#a-name-changingpassword-a-14-8-changing-passwords-and-connecting-with-an-expired-password" title="Permalink to this headline">¶</a></h3>
<div class="section" id="changing-passwords">
<h4>Changing Passwords<a class="headerlink" href="#changing-passwords" title="Permalink to this headline">¶</a></h4>
<p>Database passwords can be changed with
<a class="reference external" href="#changepassword"><code class="docutils literal notranslate"><span class="pre">connection.changePassword()</span></code></a>.  For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">currentpw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// the current password for the hr schema</span>
<span class="kr">const</span> <span class="nx">newpw</span> <span class="o">=</span> <span class="p">...</span>      <span class="c1">// the new hr schema password</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">currentpw</span><span class="p">,</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span>
  <span class="p">});</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">changePassword</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="nx">currentpw</span><span class="p">,</span> <span class="nx">newpw</span><span class="p">);</span>
</pre></div>
</div>
<p>Only DBAs, or users with the ALTER USER privilege, can change the
password of another user.  In this case, the old password value is
ignored and can be an empty string:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">newpw</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// the new password</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>  <span class="c1">// a privileged user</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>      <span class="c1">// mypw contains the hr schema password</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span>
  <span class="p">});</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">changePassword</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">newpw</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="connecting-with-an-expired-password">
<h4>Connecting with an Expired Password<a class="headerlink" href="#connecting-with-an-expired-password" title="Permalink to this headline">¶</a></h4>
<p>When creating a standalone, non-pooled connection the user’s password
can be changed at time of connection.  This is most useful when the
user’s password has expired, because it allows a user to connect
without requiring a DBA to reset their password.</p>
<p>Both the current and new passwords must be given when connecting.  For
example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oldpw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// the hr schema&#39;s old password</span>
<span class="kr">const</span> <span class="nx">newpw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// the new password</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">oldpw</span><span class="p">,</span>
    <span class="nx">newPassword</span>   <span class="o">:</span> <span class="nx">newpw</span><span class="p">,</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span>
  <span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-connectionha-a-14-9-connections-and-high-availability">
<h3><a name="connectionha"></a> 14.9 Connections and High Availability<a class="headerlink" href="#a-name-connectionha-a-14-9-connections-and-high-availability" title="Permalink to this headline">¶</a></h3>
<p>For applications that need to be highly available, use the latest
versions of Oracle Client and Database, and use the latest
node-oracledb driver.</p>
<p>The immediate usability of connections from a connection pool can be
aided by tuning
<a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">oracledb.poolPingInterval</span></code></a>.  However note
this can mask scalability-reducing issues such as firewalls
terminating idle connections.</p>
<p>You can configure your OS network settings and Oracle Net (which
handles communication between node-oracledb and the database).</p>
<p>For Oracle Net configuration, a <a class="reference external" href="#tnsnames"><code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code></a> file can
be used to configure the database service settings such as for
failover using Oracle RAC or a standby database.  A
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-7A18022A-E40D-4880-B3CE-7EE9864756CA"><code class="docutils literal notranslate"><span class="pre">ENABLE=BROKEN</span></code></a> option can be used to aid detection of a
terminated remote server.</p>
<p>A <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2041545B-58D4-48DC-986F-DCC9D0DEC642"><code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code></a> file can be used to configure settings like
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-0857C817-675F-4CF0-BFBB-C3667F119176"><code class="docutils literal notranslate"><span class="pre">SQLNET.OUTBOUND_CONNECT_TIMEOUT</span></code></a>, <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-4A19D81A-75F0-448E-B271-24E5187B5909"><code class="docutils literal notranslate"><span class="pre">SQLNET.RECV_TIMEOUT</span></code></a>
and <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-48547756-9C0B-4D14-BE85-E7ADDD1A3A66"><code class="docutils literal notranslate"><span class="pre">SQLNET.SEND_TIMEOUT</span></code></a> to bound the amount of time the
application will wait for responses from the database service.  Note
that <a class="reference external" href="#dbcalltimeouts"><code class="docutils literal notranslate"><span class="pre">connection.callTimeout</span></code></a> is a newer
alternative to the latter two options.  On systems that drop (or
in-line) out-of-band breaks, you may want to add
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-42E939DC-EF37-49A0-B4F0-14158F0E55FD"><code class="docutils literal notranslate"><span class="pre">DISABLE_OOB=ON</span></code></a> to your <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> file.</p>
<p>See <a class="reference external" href="#tnsadmin">Optional Oracle Net Configuration</a> for where to place
<code class="docutils literal notranslate"><span class="pre">tnsnames.ora</span></code> and <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code>.</p>
<p>Other <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=NETRF">Oracle Net Services</a> options may also be useful for high
availability and performance tuning.  For example the database’s
<code class="docutils literal notranslate"><span class="pre">listener.ora</span></code> file can have <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-F302BF91-64F2-4CE8-A3C7-9FDB5BA6DCF8"><code class="docutils literal notranslate"><span class="pre">RATE_LIMIT</span></code></a> and
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-FF87387C-1779-4CC3-932A-79BB01391C28"><code class="docutils literal notranslate"><span class="pre">QUEUESIZE</span></code></a> parameters that can help handle connection storms.</p>
<div class="section" id="a-name-connectionfan-a-14-9-1-fast-application-notification-fan">
<h4><a name="connectionfan"></a> 14.9.1 Fast Application Notification (FAN)<a class="headerlink" href="#a-name-connectionfan-a-14-9-1-fast-application-notification-fan" title="Permalink to this headline">¶</a></h4>
<p>Users of <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-F3FBE48B-468B-4393-8B0C-D5C8E0E4374D">Oracle Database FAN</a> must connect to a FAN-enabled
database service.  The application should have
<a class="reference external" href="#propdbevents"><code class="docutils literal notranslate"><span class="pre">oracledb.events</span></code></a> is set to <em>true</em>, which is the
default.  This value can also be changed via <a class="reference external" href="#oraaccess">Oracle Client
Configuration</a>.</p>
<p>FAN support is useful for planned and unplanned outages.  It provides
immediate notification to node-oracledb following outages related to
the database, computers, and networks.  Without FAN, node-oracledb can
hang until a TCP timeout occurs and an error is returned, which might
be several minutes.</p>
<p>FAN allows node-oracledb to provide high availability features without
the application being aware of an outage.  Unused, idle connections in
a connection pool will be automatically cleaned up.  A future
<code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code> call will establish a fresh connection to a
surviving database instance without the application being aware of any
service disruption.</p>
<p>To handle errors that affect active connections, you can add
application logic to re-connect (this will connect to a surviving
database instance) and replay application logic without having to
return an error to the application user.</p>
<p>FAN benefits users of Oracle Database’s clustering technology (<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D04AA2A7-2E68-4C5C-BD6E-36C62427B98E">Oracle
RAC</a>) because connections to surviving database instances can be
immediately made.  Users of Oracle’s Data Guard with a broker will get
FAN events generated when the standby database goes online.
Standalone databases will send FAN events when the database restarts.</p>
<p>For a more information on FAN see the <a class="reference external" href="http://www.oracle.com/technetwork/database/options/clustering/applicationcontinuity/learnmore/fastapplicationnotification12c-2538999.pdf">whitepaper on Fast Application
Notification</a>.</p>
</div>
<div class="section" id="a-name-connectionrlb-a-14-9-2-runtime-load-balancing-rlb">
<h4><a name="connectionrlb"></a> 14.9.2 Runtime Load Balancing (RLB)<a class="headerlink" href="#a-name-connectionrlb-a-14-9-2-runtime-load-balancing-rlb" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D04AA2A7-2E68-4C5C-BD6E-36C62427B98E">Oracle Database RAC</a> users with <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-25F85237-702B-4609-ACE2-1454EBC8284B">Oracle Database (RLB)</a>
advisory events configured should use node-oracledb <a class="reference external" href="#connpooling">Connection
Pooling</a> and make sure
<a class="reference external" href="#propdbevents"><code class="docutils literal notranslate"><span class="pre">oracledb.events</span></code></a> is <em>true</em>.  The events mode can
also be changed via <a class="reference external" href="#oraaccess">Oracle Client Configuration</a>.</p>
<p>RLB allows optimal use of database resources by balancing database
requests across RAC instances.</p>
<p>For a more information on RLB, see the <a class="reference external" href="http://www.oracle.com/technetwork/database/options/clustering/applicationcontinuity/learnmore/fastapplicationnotification12c-2538999.pdf">whitepaper on Fast Application
Notification</a>.</p>
</div>
<div class="section" id="a-name-dbcalltimeouts-a-14-9-3-database-call-timeouts">
<h4><a name="dbcalltimeouts"></a> 14.9.3 Database Call Timeouts<a class="headerlink" href="#a-name-dbcalltimeouts-a-14-9-3-database-call-timeouts" title="Permalink to this headline">¶</a></h4>
<p>When node-oracledb is using Oracle client libraries version 18, or
later, a millisecond timeout for database calls can be set with
<a class="reference external" href="#propconncalltimeout"><code class="docutils literal notranslate"><span class="pre">connection.callTimeout</span></code></a>.</p>
<p>The call timeout is on each individual <a class="reference external" href="#roundtrips">round-trip</a>
between node-oracledb and Oracle Database.  Each node-oracledb method
or operation may require zero or more round-trips to Oracle Database.
The <code class="docutils literal notranslate"><span class="pre">callTimeout</span></code> value applies to each round-trip individually, not
to the sum of all round-trips.  Time spent processing in node-oracledb
before or after the completion of each round-trip is not counted.</p>
<ul class="simple">
<li><p>If the time from the start of any one round-trip to the completion
of that same round-trip exceeds <code class="docutils literal notranslate"><span class="pre">callTimeout</span></code> milliseconds, then the
operation is halted and an error is returned.</p></li>
<li><p>In the case where a node-oracledb operation requires more than one
round-trip and each round-trip takes less than <code class="docutils literal notranslate"><span class="pre">callTimeout</span></code>
milliseconds, then no timeout will occur, even if the sum of all
round-trip calls exceeds <code class="docutils literal notranslate"><span class="pre">callTimeout</span></code>.</p></li>
<li><p>If no round-trip is required, the operation will never be
interrupted.</p></li>
</ul>
<p>After a timeout occurs, node-oracledb attempts to clean up the
internal connection state.  The cleanup is allowed to take another
<code class="docutils literal notranslate"><span class="pre">callTimeout</span></code> milliseconds.</p>
<p>If the cleanup was successful, a <em>DPI-1067</em> error will be returned and
the application can continue to use the connection.</p>
<p>For small values of <code class="docutils literal notranslate"><span class="pre">callTimeout</span></code>, the connection cleanup may not
complete successfully within the additional <code class="docutils literal notranslate"><span class="pre">callTimeout</span></code> period.  In
this case an <em>ORA-3114</em> is returned and the connection will no longer
be usable.  It should be released.</p>
<p>Users of pre-Oracle 18c client libraries can set call timeouts by
setting <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-4A19D81A-75F0-448E-B271-24E5187B5909"><code class="docutils literal notranslate"><span class="pre">SQLNET.RECV_TIMEOUT</span></code></a> and <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-48547756-9C0B-4D14-BE85-E7ADDD1A3A66"><code class="docutils literal notranslate"><span class="pre">SQLNET.SEND_TIMEOUT</span></code></a> in
a <a class="reference external" href="#tnsadmin"><code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> file</a>.</p>
</div>
</div>
</div>
<div class="section" id="a-name-sqlexecution-a-15-sql-execution">
<h2><a name="sqlexecution"></a> 15. SQL Execution<a class="headerlink" href="#a-name-sqlexecution-a-15-sql-execution" title="Permalink to this headline">¶</a></h2>
<p>A single SQL or PL/SQL statement may be executed using the
<em>Connection</em> <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> method.  The callback style shown
below, or <a class="reference external" href="#promiseoverview">promises</a>, or
<a class="reference external" href="#asyncawaitoverview">Async/Await</a> may be used.</p>
<p>Results may be returned in a single array, or fetched in batches with
a <a class="reference external" href="#resultsetclass">ResultSet</a>.  Queries may optionally be streamed
using the <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">connection.queryStream()</span></code></a> method.</p>
<p>Node-oracledb’s <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> and
<a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> methods use <a class="reference external" href="#stmtcache">Statement
Caching</a> to make re-execution of statements efficient.
This removes the need for a separate ‘prepare’ method to parse
statements.</p>
<p>For queries that return a large number of rows, the network traffic
for fetching data from Oracle Database can be optimized by increasing
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code></a>.  For queries that
are known to return a small set of rows, reduce
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a> to avoid unnecessary memory
allocation.  The <code class="docutils literal notranslate"><span class="pre">execute()</span></code> option
<a class="reference external" href="#propexecfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a> can be used to override
the global property for individual queries.</p>
<p>Connections can handle one database operation at a time.  Other
database operations will block.  Structure your code to avoid starting
parallel operations on a connection.  For example, instead of using
<code class="docutils literal notranslate"><span class="pre">async.parallel</span></code> or <code class="docutils literal notranslate"><span class="pre">async.each()</span></code> which calls each of its items in
parallel, use <code class="docutils literal notranslate"><span class="pre">async.series</span></code> or <code class="docutils literal notranslate"><span class="pre">async.eachSeries()</span></code>.  Also see
<a class="reference external" href="#numberofthreads">Connections and Number of Threads</a>.</p>
<p>After all database calls on the connection complete, the application
should use the <a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">connection.close()</span></code></a> call to
release the connection.</p>
<div class="section" id="a-name-select-a-15-1-select-statements">
<h3><a name="select"></a> 15.1 SELECT Statements<a class="headerlink" href="#a-name-select-a-15-1-select-statements" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-name-fetchingrows-a-15-1-1-fetching-rows-with-direct-fetches">
<h4><a name="fetchingrows"></a> 15.1.1 Fetching Rows with Direct Fetches<a class="headerlink" href="#a-name-fetchingrows-a-15-1-1-fetching-rows-with-direct-fetches" title="Permalink to this headline">¶</a></h4>
<p>By default, queries are handled as ‘direct fetches’, meaning all
results are returned in the callback <a class="reference external" href="#execrows"><code class="docutils literal notranslate"><span class="pre">result.rows</span></code></a>
property:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT department_id, department_name</span>
<span class="sb">   FROM departments</span>
<span class="sb">   WHERE department_id = :did`</span><span class="p">,</span>
  <span class="p">[</span><span class="mi">180</span><span class="p">],</span>
  <span class="p">{</span> <span class="nx">maxRows</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span>  <span class="c1">// a maximum of 10 rows will be returned</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>  <span class="c1">// print all returned rows</span>
</pre></div>
</div>
<p>Any rows beyond the <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> limit are not returned.  If <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> is
0 (the default), then the number of rows is only limited by Node.js
memory.</p>
<p>To improve database efficiency, SQL queries should use a row limiting
clause like <a class="reference external" href="#pagingdata"><code class="docutils literal notranslate"><span class="pre">OFFSET</span></code> / <code class="docutils literal notranslate"><span class="pre">FETCH</span></code></a> or equivalent. The
<code class="docutils literal notranslate"><span class="pre">maxRows</span></code> property can be used to stop badly coded queries from
returning unexpectedly large numbers of rows.</p>
<p>Internally, rows are fetched from Oracle Database in batches.  The
internal batch size is based on the lesser of <code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code> and
<code class="docutils literal notranslate"><span class="pre">maxRows</span></code>.  Each batch is concatenated into the array returned to the
application.</p>
<p>For queries expected to return a small number of rows, reduce
<code class="docutils literal notranslate"><span class="pre">maxRows</span></code> or <a class="reference external" href="#propexecfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a> to reduce
internal memory overhead by node-oracledb.</p>
<p>For direct fetches, JavaScript memory can become a limitation in two
cases:</p>
<ul class="simple">
<li><p>the absolute amount of data returned is simply too large for
JavaScript to hold in a single array.</p></li>
<li><p>the JavaScript heap can be exceeded, or become fragmented, due to
concatenation of the buffers of records fetched from the database.
To minimize this, use a <code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code> value determined by tuning.</p></li>
</ul>
<p>In both cases, use a <a class="reference external" href="#resultsethandling">ResultSet</a> or <a class="reference external" href="#streamingresults">Query
Stream</a> instead of a direct fetch.</p>
</div>
<div class="section" id="a-name-resultsethandling-a-15-1-2-fetching-rows-with-result-sets">
<h4><a name="resultsethandling"></a> 15.1.2 Fetching Rows with Result Sets<a class="headerlink" href="#a-name-resultsethandling-a-15-1-2-fetching-rows-with-result-sets" title="Permalink to this headline">¶</a></h4>
<p>When the number of query rows is relatively big, or cannot be
predicted, it is recommended to use a <a class="reference external" href="#resultsetclass">ResultSet</a>
with callbacks, as described in this section, or via query streaming,
as described <a class="reference external" href="#streamingresults">later</a>.  This prevents query results
being unexpectedly truncated by the <a class="reference external" href="#propdbmaxrows"><code class="docutils literal notranslate"><span class="pre">maxRows</span></code></a> limit,
or exceeding Node.js memory constraints.  Otherwise, for queries that
return a known small number of rows, non-ResultSet queries may have
less overhead.</p>
<p>A ResultSet is created when the <code class="docutils literal notranslate"><span class="pre">execute()</span></code> option property
<a class="reference external" href="#executeoptions"><code class="docutils literal notranslate"><span class="pre">resultSet</span></code></a> is <em>true</em>.  ResultSet rows can be
fetched using <a class="reference external" href="#getrow"><code class="docutils literal notranslate"><span class="pre">getRow()</span></code></a> or <a class="reference external" href="#getrows"><code class="docutils literal notranslate"><span class="pre">getRows()</span></code></a> on the
<code class="docutils literal notranslate"><span class="pre">execute()</span></code> callback function’s <code class="docutils literal notranslate"><span class="pre">result.resultSet</span></code> property.</p>
<p>For ResultSets, the <a class="reference external" href="#propdbmaxrows"><code class="docutils literal notranslate"><span class="pre">maxRows</span></code></a> limit is ignored.  All
rows can be fetched.</p>
<p>When all rows have been fetched, or the application does not want to
continue getting more rows, then the ResultSet should be freed using
<a class="reference external" href="#close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a>.  The ResultSet should also be explicitly closed
in the cases where no rows will be fetched from it.</p>
<p>REF CURSORS returned from a PL/SQL block via an
<a class="reference external" href="#oracledbconstants"><code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code></a> OUT binds are also available
as a ResultSet. See <a class="reference external" href="#refcursors">REF CURSOR Bind Parameters</a>.</p>
<p>The format of each row will be an array or object, depending on the
value of <a class="reference external" href="#propdboutformat">outFormat</a>.</p>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/resultset1.js">resultset1.js</a>, <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/resultset2.js">resultset2.js</a> and <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/refcursor.js">refcursor.js</a>
for full examples.</p>
<p>To fetch one row at a time use getRow() :</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT employee_id, last_name</span>
<span class="sb">   FROM employees</span>
<span class="sb">   WHERE ROWNUM &lt; 5</span>
<span class="sb">   ORDER BY employee_id`</span><span class="p">,</span>
  <span class="p">[],</span> <span class="c1">// no bind variables</span>
  <span class="p">{</span>
    <span class="nx">resultSet</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// return a ResultSet (default is false)</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">rs</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">resultSet</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">row</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">while</span> <span class="p">((</span><span class="nx">row</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">getRow</span><span class="p">()))</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;getRow(): row &quot;</span> <span class="o">+</span> <span class="nx">i</span><span class="o">++</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// always close the ResultSet</span>
<span class="nx">await</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
<p>To fetch multiple rows at a time, use <code class="docutils literal notranslate"><span class="pre">getRows()</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">numRows</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT employee_id, last_name</span>
<span class="sb">   FROM   employees</span>
<span class="sb">   WHERE ROWNUM &lt; 25</span>
<span class="sb">   ORDER BY employee_id`</span><span class="p">,</span>
  <span class="p">[],</span> <span class="c1">// no bind variables</span>
  <span class="p">{</span>
    <span class="nx">resultSet</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// return a ResultSet (default is false)</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Fetch rows from the ResultSet.</span>

<span class="kr">const</span> <span class="nx">rs</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">resultSet</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">rows</span><span class="p">;</span>

<span class="k">do</span> <span class="p">{</span>
  <span class="nx">rows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">getRows</span><span class="p">(</span><span class="nx">numRows</span><span class="p">);</span> <span class="c1">// get numRows rows at a time</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;getRows(): Got &quot;</span> <span class="o">+</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; rows&quot;</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">rows</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">numRows</span><span class="p">);</span>

<span class="c1">// always close the ResultSet</span>
<span class="nx">await</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-streamingresults-a-15-1-3-query-streaming">
<h4><a name="streamingresults"></a> 15.1.3 Query Streaming<a class="headerlink" href="#a-name-streamingresults-a-15-1-3-query-streaming" title="Permalink to this headline">¶</a></h4>
<p>Streaming of query results allows data to be piped to other streams,
for example when dealing with HTTP responses.</p>
<p>Use <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">connection.queryStream()</span></code></a> to create a stream from
a top level query and listen for events.  You can also call
<a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code></a> and use
<a class="reference external" href="#toquerystream"><code class="docutils literal notranslate"><span class="pre">toQueryStream()</span></code></a> to return a stream from the
returned <a class="reference external" href="#resultsetclass">ResultSet</a>, an OUT bind REF CURSOR
ResultSet, or <a class="reference external" href="#implicitresults">Implicit Results</a> ResultSet.</p>
<p>With streaming, each row is returned as a <code class="docutils literal notranslate"><span class="pre">data</span></code> event.  Query
metadata is available via a <code class="docutils literal notranslate"><span class="pre">metadata</span></code> event.  The <code class="docutils literal notranslate"><span class="pre">end</span></code> event
indicates the end of the query results.</p>
<p>Query results should be fetched to completion to avoid resource leaks, or the
Stream <a class="reference external" href="https://nodejs.org/api/stream.html#stream_readable_destroy_error"><code class="docutils literal notranslate"><span class="pre">destroy()</span></code></a> method can be used to terminate a stream early.</p>
<p>The connection must remain open until the stream is completely read
and any returned <a class="reference external" href="#lobclass">Lob</a> objects have been processed.</p>
<p>The query stream implementation is a wrapper over the <a class="reference external" href="#resultsetclass">ResultSet
Class</a>.  In particular, successive calls to
<a class="reference external" href="#getrow">getRow()</a> are made internally.  Each row will generate a
<code class="docutils literal notranslate"><span class="pre">data</span></code> event.  For tuning, adjust the value of
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchArraySize</span></code></a> or the <code class="docutils literal notranslate"><span class="pre">execute()</span></code>
option <a class="reference external" href="#propexecfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a>.</p>
<p>An example of streaming query results is:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">queryStream</span><span class="p">(</span><span class="sb">`SELECT employees_name FROM employees`</span><span class="p">);</span>

<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle any error...</span>
<span class="p">});</span>

<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle data row...</span>
<span class="p">});</span>

<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// release connection...</span>
<span class="p">});</span>

<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">metadata</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// access metadata of query</span>
<span class="p">});</span>

<span class="c1">// listen to any other standard stream events...</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/selectstream.js">selectstream.js</a> for a runnable example using
<code class="docutils literal notranslate"><span class="pre">connection.queryStream()</span></code>.</p>
<p>The <a class="reference external" href="#refcursors">REF CURSOR Bind Parameters</a> section shows using
<code class="docutils literal notranslate"><span class="pre">toQueryStream()</span></code> to return a stream for a REF CURSOR.</p>
</div>
<div class="section" id="a-name-queryoutputformats-a-15-1-4-query-output-formats">
<h4><a name="queryoutputformats"></a> 15.1.4 Query Output Formats<a class="headerlink" href="#a-name-queryoutputformats-a-15-1-4-query-output-formats" title="Permalink to this headline">¶</a></h4>
<p>Query rows may be returned as an array of column values, or as
JavaScript objects, depending on the values of
<a class="reference external" href="#propdboutformat">outFormat</a>.</p>
<p>The default format for each row is an array of column values.  For
example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT department_id, department_name</span>
<span class="sb">   FROM departments</span>
<span class="sb">   WHERE manager_id &lt; :id`</span><span class="p">,</span>
  <span class="p">[</span><span class="mi">110</span><span class="p">]</span>  <span class="c1">// bind value for :id</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
</pre></div>
</div>
<p>If run with Oracle’s sample HR schema, the output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;IT&#39;</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;Executive&#39;</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;Finance&#39;</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>Using this format is recommended for efficiency.</p>
<p>Alternatively, rows may be fetched as JavaScript objects. To do so,
specify the <code class="docutils literal notranslate"><span class="pre">outFormat</span></code> option to be <code class="docutils literal notranslate"><span class="pre">oracledb.OUT_FORMAT_OBJECT</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">outFormat</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">OUT_FORMAT_OBJECT</span><span class="p">;</span>
</pre></div>
</div>
<p>The value can also be set as an <code class="docutils literal notranslate"><span class="pre">execute()</span></code> option:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT department_id, department_name</span>
<span class="sb">   FROM departments</span>
<span class="sb">   WHERE manager_id &lt; :id`</span><span class="p">,</span>
  <span class="p">[</span><span class="mi">110</span><span class="p">],</span>  <span class="c1">// bind value for :id</span>
  <span class="p">{</span> <span class="nx">outFormat</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">OUT_FORMAT_OBJECT</span> <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">{</span> <span class="n">DEPARTMENT_ID</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="n">DEPARTMENT_NAME</span><span class="p">:</span> <span class="s1">&#39;IT&#39;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">DEPARTMENT_ID</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="n">DEPARTMENT_NAME</span><span class="p">:</span> <span class="s1">&#39;Executive&#39;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">DEPARTMENT_ID</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">DEPARTMENT_NAME</span><span class="p">:</span> <span class="s1">&#39;Finance&#39;</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<p>In the preceding example, each row is a JavaScript object that
specifies column names and their respective values.  Note the property
names follow Oracle’s standard name-casing rules.  They will commonly
be uppercase, since most applications create tables using unquoted,
case-insensitive names.</p>
<p>Prior to node-oracledb 4.0, the constants <code class="docutils literal notranslate"><span class="pre">oracledb.ARRAY</span></code> and <code class="docutils literal notranslate"><span class="pre">oracledb.OBJECT</span></code>
where used.  These are now deprecated.</p>
</div>
<div class="section" id="a-name-querymeta-a-15-1-5-query-column-metadata">
<h4><a name="querymeta"></a> 15.1.5 Query Column Metadata<a class="headerlink" href="#a-name-querymeta-a-15-1-5-query-column-metadata" title="Permalink to this headline">¶</a></h4>
<p>The column names of a query are returned in the <code class="docutils literal notranslate"><span class="pre">execute()</span></code> callback’s
<a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">result.metaData</span></code></a> attribute:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT department_id, department_name</span>
<span class="sb">   FROM departments</span>
<span class="sb">   WHERE manager_id &lt; :id`</span><span class="p">,</span>
  <span class="p">[</span><span class="mi">110</span><span class="p">]</span>  <span class="c1">// bind value for :id</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">metaData</span><span class="p">);</span>  <span class="c1">// show the metadata</span>
</pre></div>
</div>
<p>When using a <a class="reference external" href="#resultsetclass">ResultSet</a>, metadata is also available
in <a class="reference external" href="#rsmetadata"><code class="docutils literal notranslate"><span class="pre">result.resultSet.metaData</span></code></a>.  For queries using
<a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a>, metadata is available via the
<code class="docutils literal notranslate"><span class="pre">metadata</span></code> event.</p>
<p>The metadata is an array of objects, one per column.  By default each
object has a <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;DEPARTMENT_ID&#39;</span> <span class="p">},</span> <span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;DEPARTMENT_NAME&#39;</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<p>The names are in uppercase.  This is the default casing behavior for
Oracle client programs when a database table is created with unquoted,
case-insensitive column names.</p>
<div class="section" id="extended-metadata">
<h5>Extended Metadata<a class="headerlink" href="#extended-metadata" title="Permalink to this headline">¶</a></h5>
<p>More metadata is included when the
<a class="reference external" href="#propdbextendedmetadata"><code class="docutils literal notranslate"><span class="pre">oracledb.extendedMetaData</span></code></a> or
<code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code> option
<a class="reference external" href="#propexecextendedmetadata"><code class="docutils literal notranslate"><span class="pre">extendedMetaData</span></code></a> is <em>true</em>.  For
example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT department_id, department_name</span>
<span class="sb">   FROM departments</span>
<span class="sb">   WHERE manager_id &lt; :id`</span><span class="p">,</span>
  <span class="p">[</span><span class="mi">110</span><span class="p">],</span>  <span class="c1">// bind value for :id</span>
  <span class="p">{</span> <span class="nx">extendedMetaData</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">metaData</span><span class="p">);</span>  <span class="c1">// show the extended metadata</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;DEPARTMENT_ID&#39;</span><span class="p">,</span>
    <span class="n">fetchType</span><span class="p">:</span> <span class="mi">2002</span><span class="p">,</span>
    <span class="n">dbType</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">precision</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">scale</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">nullable</span><span class="p">:</span> <span class="n">false</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;DEPARTMENT_NAME&#39;</span><span class="p">,</span>
    <span class="n">fetchType</span><span class="p">:</span> <span class="mi">2001</span><span class="p">,</span>
    <span class="n">dbType</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">byteSize</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">nullable</span><span class="p">:</span> <span class="n">false</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<p>Description of the properties is given in the
<a class="reference external" href="#execmetadata"><code class="docutils literal notranslate"><span class="pre">result.metaData</span></code></a> description.</p>
<p>Also see <a class="reference external" href="#getstmtinfo"><code class="docutils literal notranslate"><span class="pre">connection.getStatementInfo()</span></code></a>.</p>
</div>
</div>
<div class="section" id="a-name-typemap-a-15-1-6-query-result-type-mapping">
<h4><a name="typemap"></a> 15.1.6 Query Result Type Mapping<a class="headerlink" href="#a-name-typemap-a-15-1-6-query-result-type-mapping" title="Permalink to this headline">¶</a></h4>
<p>Supported Oracle number, date, character, ROWID, UROWID, LONG and LONG
RAW column types are selected as Numbers, Dates, Strings, or Buffers.
BLOBs and CLOBs are selected into <a class="reference external" href="#lobclass">Lobs</a>.</p>
<p>The default mapping for some types can be changed using
<a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a>, or
<a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a>.  The
<a class="reference external" href="#propexecfetchinfo"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a> property can also be used to change
the default mapping, or override a global mapping, for individual
columns.</p>
<p>Data types in <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statements that are unsupported give an error
<em>NJS-010: unsupported data type in select list</em>.  These include
INTERVAL, BFILE and XMLType types.</p>
<p>Details are in the following sections.</p>
<div class="section" id="a-name-stringhandling-a-15-1-6-1-fetching-char-varchar2-nchar-and-nvarchar">
<h5><a name="stringhandling"></a> 15.1.6.1 Fetching CHAR, VARCHAR2, NCHAR and NVARCHAR<a class="headerlink" href="#a-name-stringhandling-a-15-1-6-1-fetching-char-varchar2-nchar-and-nvarchar" title="Permalink to this headline">¶</a></h5>
<p>Columns of database type CHAR, VARCHAR2, NCHAR and NVARCHAR are
returned from queries as JavaScript strings.</p>
<p>Note that binding NCHAR and NVARCHAR for <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2E008D4A-F6FD-4F34-9071-7E10419CA24D">DML</a> is not supported
and may cause unexpected character set translation, see <a class="reference external" href="#binddatatypenotes">Bind Data
Type Notes</a>.</p>
</div>
<div class="section" id="a-name-numberhandling-a-15-1-6-2-fetching-numbers">
<h5><a name="numberhandling"></a> 15.1.6.2 Fetching Numbers<a class="headerlink" href="#a-name-numberhandling-a-15-1-6-2-fetching-numbers" title="Permalink to this headline">¶</a></h5>
<p>By default all numeric columns are mapped to JavaScript numbers.
Node.js uses double floating point numbers as its native number type.</p>
<p>When numbers are fetched from the database, conversion to JavaScript’s
less precise binary number format can result in “unexpected”
representations.  For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT 38.73 FROM dual`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// gives 38.730000000000004</span>
</pre></div>
</div>
<p>Similar issues can occur with binary floating-point arithmetic purely
in Node.js, for example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">);</span> <span class="c1">// gives 0.8999999999999999</span>
</pre></div>
</div>
<p>Node.js can also only represent numbers up to 2 ^ 53 which
is 9007199254740992.  Numbers larger than this will be truncated.</p>
<p>The primary recommendation for number handling is to use Oracle SQL or
PL/SQL for mathematical operations, particularly for currency
calculations.</p>
<p>To reliably work with numbers in Node.js, use <code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code> or
<code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code> (see <a class="reference external" href="#fetchasstringhandling">below</a>) to fetch numbers in
string format, and then use one of the available third-party
JavaScript number libraries that handles large values and more
precision.</p>
</div>
<div class="section" id="a-name-datehandling-a-15-1-6-3-fetching-dates-and-timestamps">
<h5><a name="datehandling"></a> 15.1.6.3 Fetching Dates and Timestamps<a class="headerlink" href="#a-name-datehandling-a-15-1-6-3-fetching-dates-and-timestamps" title="Permalink to this headline">¶</a></h5>
<p>By default, date and timestamp columns are mapped to JavaScript Date
objects.  Internally, DATE, TIMESTAMP, TIMESTAMP WITH LOCAL TIME ZONE,
and TIMESTAMP WITH TIME ZONE columns are fetched as TIMESTAMP WITH
LOCAL TIME ZONE using the session time zone.  Oracle INTERVAL types
are not supported.</p>
<p>Note that JavaScript Date has millisecond precision therefore
timestamps will lose any sub-millisecond fractional part when fetched.</p>
<p>To make applications more portable, it is recommended to always set
the session time zone to a pre-determined value, such as UTC.  This
can be done by setting the environment variable <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-578B5988-31E2-4D0F-ACEA-95C827F6012B"><code class="docutils literal notranslate"><span class="pre">ORA_SDTZ</span></code></a>
before starting Node.js, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export ORA_SDTZ=&#39;UTC&#39;
$ node myapp.js
</pre></div>
</div>
<p>The session time zone can also be changed at runtime for each
connection by executing:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`ALTER SESSION SET TIME_ZONE=&#39;UTC&#39;`</span><span class="p">);</span>
</pre></div>
</div>
<p>With pooled connections, you could make use of a
<a class="reference external" href="#createpoolpoolattrssessioncallback"><code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code></a> function to
minimize the number of times the ALTER SESSION needs to be executed.</p>
<p>To set the time zone without requiring the overhead of a
<a class="reference external" href="#roundtrips">round-trip</a> to execute the <code class="docutils literal notranslate"><span class="pre">ALTER</span></code> statement, you could
use a PL/SQL trigger:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TRIGGER</span> <span class="n">my_logon_trigger</span>
  <span class="k">AFTER</span> <span class="n">LOGON</span>
  <span class="k">ON</span> <span class="n">hr</span><span class="p">.</span><span class="k">SCHEMA</span>
<span class="k">BEGIN</span>
  <span class="k">EXECUTE</span> <span class="k">IMMEDIATE</span> <span class="s1">&#39;ALTER SESSION SET TIME_ZONE=&#39;&#39;UTC&#39;&#39;&#39;</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://jsao.io/2016/09/working-with-dates-using-the-nodejs-driver/">Working with Dates Using the Node.js Driver</a> for more
discussion of date handling.</p>
</div>
<div class="section" id="a-name-fetchasstringhandling-a-15-1-6-4-fetching-numbers-and-dates-as-string">
<h5><a name="fetchasstringhandling"></a> 15.1.6.4 Fetching Numbers and Dates as String<a class="headerlink" href="#a-name-fetchasstringhandling-a-15-1-6-4-fetching-numbers-and-dates-as-string" title="Permalink to this headline">¶</a></h5>
<p>The global <a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a> property can be used to force
all number or date columns (and <a class="reference external" href="#queryinglobs">CLOB columns</a>) queried by an
application to be fetched as strings instead of in native format.  Allowing data
to be fetched as strings helps avoid situations where using JavaScript types can
lead to numeric precision loss, or where date conversion is unwanted.  This
method can be used for CLOBs up to 1 GB in length.</p>
<p>For example, to force all dates and numbers used by queries in an
application to be fetched as strings:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nx">fetchAsString</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">DATE</span><span class="p">,</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">];</span>
</pre></div>
</div>
<p>For dates and numbers, the maximum length of a string created can be
200 bytes.</p>
<p>Individual queries can use the <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> option
<a class="reference external" href="#propexecfetchinfo"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a> to map individual number or date
columns to strings without affecting other columns or other queries.
Any global <code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code> setting can be overridden to allow specific
columns to have data returned in native format:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// set mypw to the hr schema password</span>

<span class="nx">oracledb</span><span class="p">.</span><span class="nx">fetchAsString</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">];</span>  <span class="c1">// any number queried will be returned as a string</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT last_name, hire_date, salary, commission_pct FROM employees WHERE employee_id = :id`</span><span class="p">,</span>
  <span class="p">[</span><span class="mi">178</span><span class="p">],</span>
  <span class="p">{</span>
    <span class="nx">fetchInfo</span> <span class="o">:</span>
    <span class="p">{</span>
      <span class="s2">&quot;HIRE_DATE&quot;</span><span class="o">:</span>      <span class="p">{</span> <span class="nx">type</span> <span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span> <span class="p">},</span>  <span class="c1">// return the date as a string</span>
      <span class="s2">&quot;COMMISSION_PCT&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span> <span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">DEFAULT</span> <span class="p">}</span>  <span class="c1">// override oracledb.fetchAsString and fetch as native type</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="s1">&#39;Grant&#39;</span><span class="p">,</span> <span class="s1">&#39;24-MAY-07&#39;</span><span class="p">,</span> <span class="s1">&#39;7000&#39;</span><span class="p">,</span> <span class="mf">0.15</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>The date and salary columns are returned as strings, but the
commission is a number.  The date is mapped using the current session
date format, which was <code class="docutils literal notranslate"><span class="pre">DD-MON-YY</span></code> in this example.  The default date
format can be set, for example, with the environment variable
<code class="docutils literal notranslate"><span class="pre">NLS_DATE_FORMAT</span></code>.  Note this variable will only be read if <code class="docutils literal notranslate"><span class="pre">NLS_LANG</span></code>
is also set.</p>
<p>Without the mapping capabilities provided by <code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code> and
<code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code> the hire date would have been a JavaScript date in the
local time zone, and both numeric columns would have been represented
as numbers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="s1">&#39;Grant&#39;</span><span class="p">,</span> <span class="n">Thu</span> <span class="n">May</span> <span class="mi">24</span> <span class="mi">2007</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">GMT</span><span class="o">+</span><span class="mi">1000</span> <span class="p">(</span><span class="n">AEST</span><span class="p">),</span> <span class="mi">7000</span><span class="p">,</span> <span class="mf">0.15</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>To map columns returned from REF CURSORS, use <code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code>.  The
<code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code> settings do not apply.</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code> or <code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code> for numbers, you may need to
explicitly use <code class="docutils literal notranslate"><span class="pre">NLS_NUMERIC_CHARACTERS</span></code> to override your NLS settings
and force the decimal separator to be a period.  This can be done for
each connection by executing the statement:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`ALTER SESSION SET NLS_NUMERIC_CHARACTERS = &#39;.,&#39;`</span><span class="p">);</span>
</pre></div>
</div>
<p>Alternatively you can set the equivalent environment variable prior to
starting Node.js:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export NLS_NUMERIC_CHARACTERS=&#39;.,&#39;
</pre></div>
</div>
<p>Note this environment variable is not used unless the <code class="docutils literal notranslate"><span class="pre">NLS_LANG</span></code>
environment variable is also set.</p>
</div>
<div class="section" id="a-name-fetchlob-a-15-1-6-5-fetching-blob-clob-and-nclob">
<h5><a name="fetchlob"></a> 15.1.6.5 Fetching BLOB, CLOB and NCLOB<a class="headerlink" href="#a-name-fetchlob-a-15-1-6-5-fetching-blob-clob-and-nclob" title="Permalink to this headline">¶</a></h5>
<p>By default BLOB, CLOB and NCLOB columns are fetched into <a class="reference external" href="#lobclass">Lob</a>
instances.  For LOBs less than 1 GB in length it can be more convenient to fetch
them directly into Buffers or Strings by using the global
<a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a> or
<a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a> settings, or the per-column
<a class="reference external" href="#propexecfetchinfo"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a> setting.  See the section <a class="reference external" href="#lobhandling">Working with CLOB
and BLOB Data</a>.</p>
<p>Note that binding NCLOB for <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2E008D4A-F6FD-4F34-9071-7E10419CA24D">DML</a> is not supported and may cause
unexpected character set translation, see <a class="reference external" href="#binddatatypenotes">Bind Data Type
Notes</a>.</p>
</div>
<div class="section" id="a-name-fetchlong-a-15-1-6-6-fetching-long-and-long-raw">
<h5><a name="fetchlong"></a> 15.1.6.6 Fetching LONG and LONG RAW<a class="headerlink" href="#a-name-fetchlong-a-15-1-6-6-fetching-long-and-long-raw" title="Permalink to this headline">¶</a></h5>
<p>LONG columns in queries will be fetched as Strings.  LONG RAW columns
will be fetched as Buffers.</p>
<p>Unlike for LOBs, there is no support for streaming LONG types.  Oracle
Database allows values 2 GB in length, but Node.js and V8 memory
limitations typically only allow memory chunks in the order of tens of
megabytes.  This means complete data may not be able to fetched from
the database.  The SQL function <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-35810313-029E-4CB8-8C27-DF432FA3C253"><code class="docutils literal notranslate"><span class="pre">TO_LOB</span></code></a> can be used to migrate
data to LOB columns which can be streamed to node-oracledb, however
<code class="docutils literal notranslate"><span class="pre">TO_LOB</span></code> cannot be used directly in a <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>.</p>
</div>
<div class="section" id="a-name-fetchrowid-a-15-1-6-7-fetching-rowid-and-urowid">
<h5><a name="fetchrowid"></a> 15.1.6.7 Fetching ROWID and UROWID<a class="headerlink" href="#a-name-fetchrowid-a-15-1-6-7-fetching-rowid-and-urowid" title="Permalink to this headline">¶</a></h5>
<p>Queries will return ROWID and UROWID columns as Strings.</p>
</div>
<div class="section" id="a-name-fetchxml-a-15-1-6-8-fetching-xmltype">
<h5><a name="fetchxml"></a> 15.1.6.8 Fetching XMLType<a class="headerlink" href="#a-name-fetchxml-a-15-1-6-8-fetching-xmltype" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">XMLType</span></code> columns queried will returns as Strings.  They can also be
handled as CLOBs, see <a class="reference external" href="#xmltype">Working with XMLType</a>.</p>
</div>
<div class="section" id="a-name-fetchraw-a-15-1-6-9-fetching-raw">
<h5><a name="fetchraw"></a> 15.1.6.9 Fetching RAW<a class="headerlink" href="#a-name-fetchraw-a-15-1-6-9-fetching-raw" title="Permalink to this headline">¶</a></h5>
<p>Queries will return RAW columns as Node.js Buffers.</p>
</div>
<div class="section" id="a-name-fetchobjects-a-15-1-6-10-fetching-oracle-database-objects-and-collections">
<h5><a name="fetchobjects"></a> 15.1.6.10 Fetching Oracle Database Objects and Collections<a class="headerlink" href="#a-name-fetchobjects-a-15-1-6-10-fetching-oracle-database-objects-and-collections" title="Permalink to this headline">¶</a></h5>
<p>See <a class="reference external" href="#objects">Oracle Database Objects and Collections</a>.</p>
</div>
</div>
<div class="section" id="a-name-pagingdata-a-15-1-7-limiting-rows-and-creating-paged-datasets">
<h4><a name="pagingdata"></a> 15.1.7 Limiting Rows and Creating Paged Datasets<a class="headerlink" href="#a-name-pagingdata-a-15-1-7-limiting-rows-and-creating-paged-datasets" title="Permalink to this headline">¶</a></h4>
<p>Query data is commonly broken into one or more sets:</p>
<ul class="simple">
<li><p>To give an upper bound on the number of rows that a query has to process,
which can help improve database scalability.</p></li>
<li><p>To perform ‘Web pagination’ that allows moving from one set of rows to a next,
or previous, set on demand.</p></li>
<li><p>For fetching of all data in consecutive small sets for batch processing.  This
happens because the number of records is too large for Python to handle at the
same time.</p></li>
</ul>
<p>The latter can be handled by <a class="reference external" href="#resultsethandling">ResultSets</a> or
<a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> with one execution of the SQL query as
discussed in those links.</p>
<p>‘Web pagination’ and limiting the maximum number of rows are discussed in this
section.  For each ‘page’ of results, a SQL query is executed to get the
appropriate set of rows from a table.  Since the query will be executed more
than once, make sure to use bind variables for row numbers and row limits.</p>
<p>Oracle Database 12c SQL introduced an <code class="docutils literal notranslate"><span class="pre">OFFSET</span></code> / <code class="docutils literal notranslate"><span class="pre">FETCH</span></code> clause which
is similar to the <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> keyword of MySQL.  See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-CFA006CA-6FF1-4972-821E-6996142A51C6">Row Limiting:
Examples</a> in the Oracle documentation.  A node-oracledb example is:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">myoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="c1">// do not skip any rows (start at row 1)</span>
<span class="kr">const</span> <span class="nx">mymaxnumrows</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>  <span class="c1">// get 20 rows</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT last_name</span>
<span class="sb">   FROM employees</span>
<span class="sb">   ORDER BY last_name</span>
<span class="sb">   OFFSET :offset ROWS FETCH NEXT :maxnumrows ROWS ONLY`</span><span class="p">,</span>
  <span class="p">{</span><span class="nx">offset</span><span class="o">:</span> <span class="nx">myoffset</span><span class="p">,</span> <span class="nx">maxnumrows</span><span class="o">:</span> <span class="nx">mymaxnumrows</span><span class="p">});</span>
</pre></div>
</div>
<p>A runnable example is in <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/rowlimit.js">rowlimit.js</a>.</p>
<p>You can use a basic <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> or a
<a class="reference external" href="#resultsetclass">ResultSet</a>, or <a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> with
your query.  For basic <code class="docutils literal notranslate"><span class="pre">execute()</span></code> fetches, make sure that
<code class="docutils literal notranslate"><span class="pre">oracledb.maxRows</span></code> is greater than the value bound to <code class="docutils literal notranslate"><span class="pre">:maxnumrows</span></code>,
or set to 0 (meaning unlimited).</p>
<p>In applications where the SQL query is not known in advance, this
method sometimes involves appending the <code class="docutils literal notranslate"><span class="pre">OFFSET</span></code> clause to the ‘real’
user query. Be very careful to avoid SQL injection security issues.</p>
<p>As an anti-example, another way to limit the number of rows returned
involves setting <a class="reference external" href="#propdbmaxrows"><code class="docutils literal notranslate"><span class="pre">maxRows</span></code></a>.  However it is more
efficient to let Oracle Database do the row selection in the SQL query
and only return the exact number of rows required to node-oracledb.</p>
<p>For Oracle Database 11g and earlier there are several alternative ways
to limit the number of rows returned.  The old, canonical paging query
is:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">ROWNUM</span> <span class="k">AS</span> <span class="n">rnum</span>
      <span class="k">FROM</span> <span class="p">(</span><span class="n">YOUR_QUERY_GOES_HERE</span> <span class="c1">-- including the order by) a</span>
      <span class="k">WHERE</span> <span class="n">ROWNUM</span> <span class="o">&lt;=</span> <span class="n">MAX_ROW</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">rnum</span> <span class="o">&gt;=</span> <span class="n">MIN_ROW</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">MIN_ROW</span></code> is the row number of first row and <code class="docutils literal notranslate"><span class="pre">MAX_ROW</span></code> is the
row number of the last row to return.  For example:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">ROWNUM</span> <span class="k">AS</span> <span class="n">rnum</span>
      <span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">last_name</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">last_name</span><span class="p">)</span> <span class="n">a</span>
      <span class="k">WHERE</span> <span class="n">ROWNUM</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">rnum</span> <span class="o">&gt;=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This always has an ‘extra’ column, here called RNUM.</p>
<p>An alternative and preferred query syntax for Oracle Database 11g uses
the analytic <code class="docutils literal notranslate"><span class="pre">ROW_NUMBER()</span></code> function. For example to get the 1st to
20th names the query is:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">last_name</span> <span class="k">FROM</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">last_name</span><span class="p">,</span>
        <span class="n">ROW_NUMBER</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">last_name</span><span class="p">)</span> <span class="k">AS</span> <span class="n">myr</span>
        <span class="k">FROM</span> <span class="n">employees</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">myr</span> <span class="k">BETWEEN</span> <span class="mi">1</span> <span class="k">and</span> <span class="mi">20</span>
</pre></div>
</div>
<p>Refer to <a class="reference external" href="http://www.oracle.com/technetwork/issue-archive/2007/07-jan/o17asktom-093877.html">On Top-n and Pagination Queries</a> in Oracle Magazine for
details.</p>
</div>
<div class="section" id="a-name-autoincrement-a-15-1-8-auto-increment-columns">
<h4><a name="autoincrement"></a> 15.1.8 Auto-Increment Columns<a class="headerlink" href="#a-name-autoincrement-a-15-1-8-auto-increment-columns" title="Permalink to this headline">¶</a></h4>
<p>From Oracle Database 12c you can create tables with auto-incremented
values.  This is useful to generate unique primary keys for your data
when ROWID or UROWID are not preferred.</p>
<p>In SQL*Plus execute:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mytable</span>
  <span class="p">(</span><span class="n">myid</span> <span class="nb">NUMBER</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">GENERATED</span> <span class="k">BY</span> <span class="k">DEFAULT</span> <span class="k">ON</span> <span class="k">NULL</span> <span class="k">AS</span> <span class="k">IDENTITY</span> <span class="p">(</span><span class="k">START</span> <span class="k">WITH</span> <span class="mi">1</span><span class="p">),</span>
   <span class="n">mydata</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>Refer to the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-F9CE0CC3-13AE-4744-A43C-EAC7A71AAAB6__CJAHCAFF">CREATE TABLE identity column documentation</a>.</p>
<p>If you already have a sequence <code class="docutils literal notranslate"><span class="pre">myseq</span></code> you can use values from it to
auto-increment a column value like this:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mytable</span>
  <span class="p">(</span><span class="n">myid</span> <span class="nb">NUMBER</span> <span class="k">DEFAULT</span> <span class="n">myseq</span><span class="p">.</span><span class="n">NEXTVAL</span><span class="p">,</span>
   <span class="n">mydata</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This also requires Oracle Database 12c or later.</p>
<p>Prior to Oracle Database 12c, auto-increment columns in Oracle
Database can be created using a sequence generator and a trigger.</p>
<p>Sequence generators are defined in the database and return Oracle
numbers.  Sequence numbers are generated independently of tables.
Therefore, the same sequence generator can be used for more than one
table or anywhere that you want to use a unique number.  You can get a
new value from a sequence generator using the NEXTVAL operator in a
SQL statement.  This gives the next available number and increments
the generator.  The similar CURRVAL operator returns the current value
of a sequence without incrementing the generator.</p>
<p>A trigger is a PL/SQL procedure that is automatically invoked at a
predetermined point.  In this example a trigger is invoked whenever an
insert is made to a table.</p>
<p>In SQL*Plus run:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="n">SEQUENCE</span> <span class="n">myseq</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mytable</span> <span class="p">(</span><span class="n">myid</span> <span class="nb">NUMBER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">mydata</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
<span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">mytrigger</span> <span class="k">BEFORE</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="n">mytable</span> <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
<span class="k">BEGIN</span>
  <span class="p">:</span><span class="k">new</span><span class="p">.</span><span class="n">myid</span> <span class="p">:</span><span class="o">=</span> <span class="n">myseq</span><span class="p">.</span><span class="n">NEXTVAL</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>Prior to Oracle Database 11g replace the trigger assignment with a
SELECT like:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">myseq</span><span class="p">.</span><span class="n">NEXTVAL</span> <span class="k">INTO</span> <span class="p">:</span><span class="k">new</span><span class="p">.</span><span class="n">myid</span> <span class="k">FROM</span> <span class="n">dual</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="getting-the-last-insert-id">
<h5>Getting the Last Insert ID<a class="headerlink" href="#getting-the-last-insert-id" title="Permalink to this headline">¶</a></h5>
<p>To get the automatically inserted identifier in node-oracledb, use a
<a class="reference external" href="#dmlreturn">DML RETURNING</a> clause:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO mytable (mydata) VALUES (&#39;Hello&#39;) RETURN myid INTO :id`</span><span class="p">,</span>
  <span class="p">{</span><span class="nx">id</span> <span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>  <span class="c1">// print the ID of the inserted row</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-name-cursors1000-a-15-2-cursor-management">
<h3><a name="cursors1000"></a> 15.2 Cursor Management<a class="headerlink" href="#a-name-cursors1000-a-15-2-cursor-management" title="Permalink to this headline">¶</a></h3>
<p>Developers starting out with Node have to get to grips with the
‘different’ programming style of JavaScript that seems to cause
methods to be called when least expected!  While you are still in the
initial hacking-around-with-node-oracledb phase you may sometimes
encounter the error <em>ORA-01000: maximum open cursors exceeded</em>.  A
cursor is a “handle for the session-specific private SQL area that
holds a parsed SQL statement and other processing information”.</p>
<p>Here are things to do when you see an <em>ORA-1000</em>:</p>
<ul>
<li><p>Avoid having too many incompletely processed statements open at one
time:</p>
<ul class="simple">
<li><p>Make sure your application is handling connections and
statements in the order you expect.</p></li>
<li><p><a class="reference external" href="#close">Close ResultSets</a> before releasing the connection.</p></li>
<li><p>If cursors are opened with <code class="docutils literal notranslate"><span class="pre">DBMS_SQL.OPEN_CURSOR()</span></code> in a PL/SQL
block, close them before the block returns - except for REF
CURSORs being passed back to node-oracledb.</p></li>
</ul>
</li>
<li><p>Choose the appropriate Statement Cache size.  Node-oracledb has a
statement cache per connection.  When node-oracledb internally
releases a statement it will be put into the statement cache of that
connection, and its cursor will remain open. This makes statement
re-execution very efficient.</p>
<p>The cache size is settable with the
<a class="reference external" href="#propdbstmtcachesize"><code class="docutils literal notranslate"><span class="pre">oracle.stmtCacheSize</span></code></a> attribute.  The size
you choose will depend on your knowledge of the locality of the
statements, and of the resources available to the application.  Are
statements re-executed?  Will they still be in the cache when they
get executed?  How many statements do you want to be cached?  In
rare cases when statements are not re-executed, or are likely not to
be in the cache, you might even want to disable the cache to
eliminate its management overheads.</p>
<p>Incorrectly sizing the statement cache will reduce application
efficiency.</p>
<p>To help set the cache size, you can turn on auto-tuning with Oracle
12.1, or later, using an <a class="reference external" href="#oraaccess"><code class="docutils literal notranslate"><span class="pre">oraaccess.xml</span></code></a> file.</p>
<p>For more information, see the <a class="reference external" href="#stmtcache">Statement Caching</a>
documentation.</p>
</li>
<li><p>Use bind variables otherwise each variant of the statement will have
its own statement cache entry and cursor.  With appropriate binding
only one entry and cursor will be needed.</p></li>
<li><p>Set the database’s <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-FAFD1247-06E5-4E64-917F-AEBD4703CF40"><em>open_cursors</em></a> parameter appropriately.
This parameter specifies the maximum number of cursors that each
“session” (i.e each node-oracle connection) can use.  When a
connection exceeds the value, the <em>ORA-1000</em> error is thrown.</p>
<p>Along with a cursor per entry in the connection’s statement cache,
any new statements that a connection is currently executing, or
ResultSets that have not been released (in neither situation are
these yet cached), will also consume a cursor.  Make sure that
<em>open_cursors</em> is large enough to accommodate the maximum open
cursors any connection may have.  The upper bound required is
<em>stmtCacheSize</em> + the maximum number of executing statements in a
connection.</p>
<p>Remember this is all per connection. Also cache management happens
when statements are internally released.  The majority of your
connections may use less than <em>open_cursors</em> cursors, but if one
connection is at the limit and it then tries to execute a new
statement, that connection will get <em>ORA-1000: maximum open cursors
exceeded</em>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="a-name-plsqlexecution-a-16-pl-sql-execution">
<h2><a name="plsqlexecution"></a> 16. PL/SQL Execution<a class="headerlink" href="#a-name-plsqlexecution-a-16-pl-sql-execution" title="Permalink to this headline">¶</a></h2>
<p>PL/SQL stored procedures, functions and anonymous blocks can be called
from node-oracledb using <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a>.</p>
<p>Note the error property of the callback is not set when PL/SQL
“success with info” warnings such as compilation warnings occur.</p>
<div class="section" id="a-name-plsqlproc-a-16-1-pl-sql-stored-procedures">
<h3><a name="plsqlproc"></a> 16.1 PL/SQL Stored Procedures<a class="headerlink" href="#a-name-plsqlproc-a-16-1-pl-sql-stored-procedures" title="Permalink to this headline">¶</a></h3>
<p>The PL/SQL procedure:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">PROCEDURE</span> <span class="n">myproc</span> <span class="p">(</span><span class="n">id</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">name</span> <span class="k">OUT</span> <span class="n">VARCHAR2</span><span class="p">)</span> <span class="k">AS</span>
<span class="k">BEGIN</span>
  <span class="k">SELECT</span> <span class="n">last_name</span> <span class="k">INTO</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">employee_id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
</pre></div>
</div>
<p>can be called:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN</span>
<span class="sb">     myproc(:id, :name);</span>
<span class="sb">   END;`</span><span class="p">,</span>
  <span class="p">{</span>  <span class="c1">// bind variables</span>
    <span class="nx">id</span><span class="o">:</span>   <span class="mi">159</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">40</span> <span class="p">},</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">);</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Smith&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Binding is required for IN OUT and OUT parameters.  It is strongly
recommended for IN parameters.  See <a class="reference external" href="#bind">Bind Parameters for Prepared
Statements</a>.</p>
</div>
<div class="section" id="a-name-plsqlfunc-a-16-2-pl-sql-stored-functions">
<h3><a name="plsqlfunc"></a> 16.2 PL/SQL Stored Functions<a class="headerlink" href="#a-name-plsqlfunc-a-16-2-pl-sql-stored-functions" title="Permalink to this headline">¶</a></h3>
<p>The PL/SQL function:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">myfunc</span> <span class="k">RETURN</span> <span class="n">VARCHAR2</span> <span class="k">AS</span>
<span class="k">BEGIN</span>
  <span class="k">RETURN</span> <span class="s1">&#39;Hello&#39;</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
</pre></div>
</div>
<p>can be called by using an OUT bind variable for the function return
value:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN</span>
<span class="sb">     :ret := myfunc();</span>
<span class="sb">   END;`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">ret</span><span class="o">:</span> <span class="p">{</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">40</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">);</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">ret</span><span class="p">:</span> <span class="s1">&#39;Hello&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#bind">Bind Parameters for Prepared Statements</a> for information
on binding.</p>
</div>
<div class="section" id="a-name-plsqlanon-a-16-3-pl-sql-anonymous-pl-sql-blocks">
<h3><a name="plsqlanon"></a> 16.3 PL/SQL Anonymous PL/SQL Blocks<a class="headerlink" href="#a-name-plsqlanon-a-16-3-pl-sql-anonymous-pl-sql-blocks" title="Permalink to this headline">¶</a></h3>
<p>Anonymous PL/SQL blocks can be called from node-oracledb like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN</span>
<span class="sb">     SELECT last_name INTO :name FROM employees WHERE employee_id = :id;</span>
<span class="sb">   END;`</span><span class="p">,</span>
  <span class="p">{</span>  <span class="c1">// bind variables</span>
    <span class="nx">id</span><span class="o">:</span>   <span class="mi">134</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">40</span> <span class="p">},</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">);</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Rogers&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#bind">Bind Parameters for Prepared Statements</a> for information
on binding.</p>
</div>
<div class="section" id="a-name-dbmsoutput-a-16-4-using-dbms-output">
<h3><a name="dbmsoutput"></a> 16.4 Using DBMS_OUTPUT<a class="headerlink" href="#a-name-dbmsoutput-a-16-4-using-dbms-output" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-C1400094-18D5-4F36-A2C9-D28B0E12FD8C">DBMS_OUTPUT</a> package is the standard way to “print” output
from PL/SQL.  The way DBMS_OUTPUT works is like a buffer.  Your
Node.js application code must first turn on DBMS_OUTPUT buffering for
the current connection by calling the PL/SQL procedure
<code class="docutils literal notranslate"><span class="pre">DBMS_OUTPUT.ENABLE(NULL)</span></code>.  Then any PL/SQL executed by the
connection can put text into the buffer using
<code class="docutils literal notranslate"><span class="pre">DBMS_OUTPUT.PUT_LINE()</span></code>.  Finally <code class="docutils literal notranslate"><span class="pre">DBMS_OUTPUT.GET_LINE()</span></code> is used to
fetch from that buffer.  Note, any PL/SQL code that uses DBMS_OUTPUT
runs to completion before any output is available to the user.  Also,
other database connections cannot access your buffer.</p>
<p>A basic way to fetch DBMS_OUTPUT with node-oracledb is to bind an
output string when calling the PL/SQL <code class="docutils literal notranslate"><span class="pre">DBMS_OUTPUT.GET_LINE()</span></code>
procedure, print the string, and then repeat until there is no more
data.  The following snippet is based on the example
<a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/dbmsoutputgetline.js">dbmsoutputgetline.js</a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">result</span><span class="p">;</span>
<span class="k">do</span> <span class="p">{</span>
  <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
    <span class="sb">`BEGIN</span>
<span class="sb">       DBMS_OUTPUT.GET_LINE(:ln, :st);</span>
<span class="sb">     END;`</span><span class="p">,</span>
    <span class="p">{</span> <span class="nx">ln</span><span class="o">:</span> <span class="p">{</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">32767</span> <span class="p">},</span>
      <span class="nx">st</span><span class="o">:</span> <span class="p">{</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">st</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">ln</span><span class="p">);</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">st</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>Another way is to wrap the <code class="docutils literal notranslate"><span class="pre">DBMS_OUTPUT.GET_LINE()</span></code> call into a
pipelined function and fetch the output using a SQL query.  See
<a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/dbmsoutputpipe.js">dbmsoutputpipe.js</a> for the full example.</p>
<p>The pipelined function could be created like:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TYPE</span> <span class="n">dorow</span> <span class="k">AS</span> <span class="k">TABLE</span> <span class="k">OF</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">32767</span><span class="p">);</span>
<span class="o">/</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">mydofetch</span> <span class="k">RETURN</span> <span class="n">dorow</span> <span class="n">PIPELINED</span> <span class="k">IS</span>
  <span class="n">line</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">32767</span><span class="p">);</span>
  <span class="n">status</span> <span class="nb">INTEGER</span><span class="p">;</span>
  <span class="k">BEGIN</span> <span class="n">LOOP</span>
    <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">GET_LINE</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
    <span class="n">EXIT</span> <span class="k">WHEN</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">PIPE</span> <span class="k">ROW</span> <span class="p">(</span><span class="n">line</span><span class="p">);</span>
  <span class="k">END</span> <span class="n">LOOP</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>To get DBMS_OUTPUT, simply query this function using the same
connection that created the output:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>const result = await connection.execute(
  `SELECT * FROM TABLE(mydofetch())`,
  [],
  { resultSet: true }
);

const rs = result.resultSet;
let row;
while ((row = await rs.getRow())) {
  console.log(row);
}
</pre></div>
</div>
<p>The query rows in this example are handled using a
<a class="reference external" href="#resultsethandling">ResultSet</a>.</p>
<p>Remember to first enable output using <code class="docutils literal notranslate"><span class="pre">DBMS_OUTPUT.ENABLE(NULL)</span></code>.</p>
</div>
<div class="section" id="a-name-ebr-a-16-5-edition-based-redefinition">
<h3><a name="ebr"></a> 16.5 Edition-Based Redefinition<a class="headerlink" href="#a-name-ebr-a-16-5-edition-based-redefinition" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-58DE05A0-5DEF-4791-8FA8-F04D11964906">Edition-Based Redefinition</a> (EBR) feature of Oracle Database
allows multiple versions of views, synonyms, PL/SQL objects and SQL
Translation profiles to be used concurrently.  Each items version is
associated with an ‘edition’ which can be nominated at runtime by
applications.  This lets database logic be updated and tested while
production users are still accessing the original version.  Once every
user has begun using the objects in the new edition, the old objects
can be dropped.</p>
<p>To choose the edition, node-oracledb applications can set
<a class="reference external" href="#propdbedition"><code class="docutils literal notranslate"><span class="pre">oracledb.edition</span></code></a> globally, or specify a value when
<a class="reference external" href="#createpoolpoolattrsedition"><code class="docutils literal notranslate"><span class="pre">creating</span> <span class="pre">a</span> <span class="pre">pool</span></code></a> or a <a class="reference external" href="#getconnectiondbattrsedition"><code class="docutils literal notranslate"><span class="pre">standalone</span> <span class="pre">connection</span></code></a>.</p>
<p>The example below shows how a PL/SQL function <code class="docutils literal notranslate"><span class="pre">DISCOUNT</span></code> can be
created with two different implementations.  The initial procedure is
created as normal in the SQL*Plus command line:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECT</span> <span class="n">nodedemo</span><span class="o">/</span><span class="n">welcome</span>

<span class="c1">-- The default edition&#39;s DISCOUNT procedure</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">discount</span><span class="p">(</span><span class="n">price</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">)</span> <span class="k">RETURN</span> <span class="nb">NUMBER</span>
<span class="k">AS</span>
 <span class="n">newprice</span> <span class="nb">NUMBER</span><span class="p">;</span>
<span class="k">BEGIN</span>
  <span class="n">newprice</span> <span class="p">:</span><span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">IF</span> <span class="p">(</span><span class="n">newprice</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
    <span class="n">newprice</span> <span class="p">:</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">END</span> <span class="k">IF</span><span class="p">;</span>
  <span class="k">RETURN</span> <span class="n">newprice</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>This initial implementation is in the default ‘edition’ <code class="docutils literal notranslate"><span class="pre">ora$base</span></code>,
which is pre-created in new and upgraded databases.</p>
<p>The user <code class="docutils literal notranslate"><span class="pre">nodedemo</span></code> can be given permission to create new ‘editions’:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECT</span> <span class="k">system</span>

<span class="k">GRANT</span> <span class="k">CREATE</span> <span class="k">ANY</span> <span class="n">EDITION</span> <span class="k">TO</span> <span class="n">nodedemo</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">USER</span> <span class="n">nodedemo</span> <span class="n">ENABLE</span> <span class="n">EDITIONS</span> <span class="k">FORCE</span><span class="p">;</span>
</pre></div>
</div>
<p>The next SQL*Plus script creates a new edition <code class="docutils literal notranslate"><span class="pre">e2</span></code>, and changes the
current session to use it.  A new version of <code class="docutils literal notranslate"><span class="pre">DISCOUNT</span></code> is created
under that edition:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CONNECT</span> <span class="n">nodedemo</span><span class="o">/</span><span class="n">welcome</span>

<span class="k">CREATE</span> <span class="n">EDITION</span> <span class="n">e2</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">SESSION</span> <span class="k">SET</span> <span class="n">EDITION</span> <span class="o">=</span> <span class="n">e2</span><span class="p">;</span>

<span class="c1">-- E2 edition&#39;s discount</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">discount</span><span class="p">(</span><span class="n">price</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">)</span> <span class="k">RETURN</span> <span class="nb">NUMBER</span>
<span class="k">AS</span>
 <span class="n">newprice</span> <span class="nb">NUMBER</span><span class="p">;</span>
<span class="k">BEGIN</span>
  <span class="n">newprice</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">75</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">RETURN</span> <span class="n">newprice</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>There are now two implementations of the PL/SQL procedure <code class="docutils literal notranslate"><span class="pre">DISCOUNT</span></code>
with the same prototype.  Applications can choose at runtime which
implementation to use.  Here is a script that calls <code class="docutils literal notranslate"><span class="pre">DISCOUNT</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// set mypw to the nodedemo schema password</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;nodedemo&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
    <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/orclpdb1&#39;</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT name, price, DISCOUNT(price) AS discountprice</span>
<span class="sb">   FROM parts</span>
<span class="sb">   ORDER BY id`</span><span class="p">,</span>
  <span class="p">[],</span>
  <span class="p">{</span> <span class="nx">outFormat</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">OUT_FORMAT_OBJECT</span> <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
</pre></div>
</div>
<p>Since the code does not explicitly set <code class="docutils literal notranslate"><span class="pre">oracledb.edition</span></code> (or
equivalent), then the first implementation of <code class="docutils literal notranslate"><span class="pre">DISCOUNT</span></code> in the
default edition is used.  The output might be like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">{</span> <span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;lamp&#39;</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="n">DISCOUNTPRICE</span><span class="p">:</span> <span class="mi">36</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;wire&#39;</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">DISCOUNTPRICE</span><span class="p">:</span> <span class="mi">6</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;switch&#39;</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">DISCOUNTPRICE</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<p>If the connection uses edition <code class="docutils literal notranslate"><span class="pre">e2</span></code>, then the second implementation of
<code class="docutils literal notranslate"><span class="pre">DISCOUNT</span></code> will be used:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;nodedemo&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the nodedemo schema password</span>
    <span class="nx">connectString</span><span class="o">:</span> <span class="s1">&#39;localhost/orclpdb1&#39;</span><span class="p">,</span>
    <span class="nx">edition</span><span class="o">:</span> <span class="s1">&#39;e2&#39;</span>
  <span class="p">}</span>
<span class="p">);</span>
<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// same query code as before</span>
</pre></div>
</div>
<p>The output might be like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">{</span> <span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;lamp&#39;</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="n">DISCOUNTPRICE</span><span class="p">:</span> <span class="mi">30</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;wire&#39;</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">DISCOUNTPRICE</span><span class="p">:</span> <span class="mf">7.5</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">NAME</span><span class="p">:</span> <span class="s1">&#39;switch&#39;</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">DISCOUNTPRICE</span><span class="p">:</span> <span class="mi">3</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<p>See the Database Development Guide chapter <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-58DE05A0-5DEF-4791-8FA8-F04D11964906">Using Edition-Based
Redefinition</a> for more information about EBR.</p>
</div>
<div class="section" id="a-name-implicitresults-a-16-6-implicit-results">
<h3><a name="implicitresults"></a> 16.6 Implicit Results<a class="headerlink" href="#a-name-implicitresults-a-16-6-implicit-results" title="Permalink to this headline">¶</a></h3>
<p>Oracle Implicit Results allow queries in PL/SQL to be returned to
Node.js without requiring REF CURSORS or bind variables.  Implicit
Results requires node-oracledb 4.0, Oracle Database 12.1 or later, and
Oracle Client 12.1 or later.</p>
<p>PL/SQL code uses <code class="docutils literal notranslate"><span class="pre">DBMS_SQL.RETURN_RESULT()</span></code> to return query results.
These are accessible in the <code class="docutils literal notranslate"><span class="pre">execute()</span></code> callback
<a class="reference external" href="#execimplicitresults"><code class="docutils literal notranslate"><span class="pre">implicitResults</span></code></a> attribute.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const plsql = `
  DECLARE
    c1 SYS_REFCURSOR;
    c2 SYS_REFCURSOR;
  BEGIN
    OPEN c1 FOR SELECT city, postal_code
                FROM locations
                WHERE location_id &lt; 1200;
    DBMS_SQL.RETURN_RESULT(c1);

    OPEN C2 FOR SELECT job_id, employee_id, last_name
                FROM employees
                WHERE employee_id &lt; 103;
    DBMS_SQL.RETURN_RESULT(c2);
  END;`;

result = await connection.execute(plsql);
console.log(result.implicitResults);
</pre></div>
</div>
<p>will display:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">[</span>
    <span class="p">[</span> <span class="s1">&#39;Roma&#39;</span><span class="p">,</span> <span class="s1">&#39;00989&#39;</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;Venice&#39;</span><span class="p">,</span> <span class="s1">&#39;10934&#39;</span> <span class="p">],</span>
  <span class="p">],</span>
  <span class="p">[</span>
    <span class="p">[</span> <span class="s1">&#39;AD_PRES&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;King&#39;</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;AD_VP&#39;</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="s1">&#39;Kochhar&#39;</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;AD_VP&#39;</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="s1">&#39;De Haan&#39;</span> <span class="p">],</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>For larger query results, fetching <a class="reference external" href="#resultsethandling">ResultSets</a> is
recommended:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">plsql</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span> <span class="n">resultSet</span><span class="p">:</span> <span class="n">true</span> <span class="p">});</span>
<span class="k">for</span> <span class="p">(</span><span class="n">const</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="o">.</span><span class="n">implicitResults</span><span class="o">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot; Implicit Result Set&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">const</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">implicitResults</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>  <span class="o">//</span> <span class="n">get</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">ResultSet</span>
  <span class="n">let</span> <span class="n">row</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">((</span><span class="n">row</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rs</span><span class="o">.</span><span class="n">getRow</span><span class="p">()))</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">();</span>
  <span class="k">await</span> <span class="n">rs</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This displays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Implicit</span> <span class="n">Result</span> <span class="n">Set</span> <span class="mi">1</span>
  <span class="p">[</span> <span class="s1">&#39;Roma&#39;</span><span class="p">,</span> <span class="s1">&#39;00989&#39;</span> <span class="p">]</span>
  <span class="p">[</span> <span class="s1">&#39;Venice&#39;</span><span class="p">,</span> <span class="s1">&#39;10934&#39;</span> <span class="p">]</span>

<span class="n">Implicit</span> <span class="n">Result</span> <span class="n">Set</span> <span class="mi">2</span>
  <span class="p">[</span> <span class="s1">&#39;AD_PRES&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;King&#39;</span> <span class="p">]</span>
  <span class="p">[</span> <span class="s1">&#39;AD_VP&#39;</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="s1">&#39;Kochhar&#39;</span> <span class="p">]</span>
  <span class="p">[</span> <span class="s1">&#39;AD_VP&#39;</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="s1">&#39;De Haan&#39;</span> <span class="p">]</span>
</pre></div>
</div>
<p>A runnable example is in <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/impres.js">impres.js</a>.</p>
</div>
</div>
<div class="section" id="a-name-lobhandling-a-17-working-with-clob-and-blob-data">
<h2><a name="lobhandling"></a> 17. Working with CLOB and BLOB Data<a class="headerlink" href="#a-name-lobhandling-a-17-working-with-clob-and-blob-data" title="Permalink to this headline">¶</a></h2>
<p>Oracle Database uses LOB data types to store long objects. The CLOB
type is used for character data and the BLOB type is used for binary
data.  In node-oracledb, LOBs can be represented by instances of the
<a class="reference external" href="#lobclass">Lob</a> class or as Strings and Buffers.</p>
<p>There are runnable LOB examples in the GitHub <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples">examples</a> directory.</p>
<div class="section" id="a-name-basiclobinsert-a-17-1-simple-insertion-of-lobs">
<h3><a name="basiclobinsert"></a> 17.1 Simple Insertion of LOBs<a class="headerlink" href="#a-name-basiclobinsert-a-17-1-simple-insertion-of-lobs" title="Permalink to this headline">¶</a></h3>
<p>Node.js String or Buffer types can be passed into PL/SQL blocks or
inserted into the database by binding to LOB columns or PL/SQL
parameters.</p>
<p>If the data is larger than can be handled as a String or Buffer in
Node.js or node-oracledb, it will need to be streamed to a
<a class="reference external" href="#lobclass">Lob</a>, as discussed in <a class="reference external" href="#streamsandlobs">Streaming Lobs</a>.
See <a class="reference external" href="#lobbinds">LOB Bind Parameters</a> for size considerations regarding
LOB binds.</p>
<p>Given the table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mylobs</span> <span class="p">(</span><span class="n">id</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="k">c</span> <span class="k">CLOB</span><span class="p">,</span> <span class="n">b</span> <span class="nb">BLOB</span><span class="p">);</span>
</pre></div>
</div>
<p>an <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> example is:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;example.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="p">.</span> <span class="p">.</span> <span class="p">.</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO mylobs (id, myclobcol) VALUES (:idbv, :cbv)`</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">idbv</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">cbv</span><span class="o">:</span> <span class="nx">str</span> <span class="p">}</span>  <span class="c1">// type and direction are optional for IN binds</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;CLOB inserted from example.txt&#39;</span><span class="p">);</span>
<span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>Updating LOBs is similar to insertion:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`UPDATE mylobs SET myclobcol = :cbv WHERE id = :idbv`</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">idbv</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">cbv</span><span class="o">:</span> <span class="nx">str</span> <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Buffers can similarly be bound for inserting into, or updating, BLOB
columns.</p>
<p>When using PL/SQL, a procedure:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">PROCEDURE</span> <span class="n">lobs_in</span> <span class="p">(</span><span class="n">p_id</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">c_in</span> <span class="k">IN</span> <span class="k">CLOB</span><span class="p">,</span> <span class="n">b_in</span> <span class="k">IN</span> <span class="nb">BLOB</span><span class="p">)</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>can be called like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bigStr</span> <span class="o">=</span> <span class="s1">&#39;My string to insert&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">bigBuf</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">([.</span> <span class="p">.</span> <span class="p">.]);</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN lobs_in(:id, :c, :b); END;`</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="nx">c</span><span class="o">:</span> <span class="nx">bigStr</span><span class="p">,</span>    <span class="c1">// type and direction are optional for IN binds</span>
    <span class="nx">b</span><span class="o">:</span> <span class="nx">bigBuf</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-queryinglobs-a-17-2-simple-lob-queries-and-pl-sql-out-binds">
<h3><a name="queryinglobs"></a> 17.2 Simple LOB Queries and PL/SQL OUT Binds<a class="headerlink" href="#a-name-queryinglobs-a-17-2-simple-lob-queries-and-pl-sql-out-binds" title="Permalink to this headline">¶</a></h3>
<div class="section" id="querying-lobs">
<h4>Querying LOBs<a class="headerlink" href="#querying-lobs" title="Permalink to this headline">¶</a></h4>
<p>LOBs queried from the database that are shorter than 1 GB can be returned as
Strings or Buffers by using <a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchAsString</span></code></a> or
<a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">oracledb.fetchAsBuffer</span></code></a> (or
<a class="reference external" href="#propexecfetchinfo"><code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code></a>).  If the data is larger than can be handled
as a String or Buffer in Node.js or node-oracledb, it will need to be streamed
from a <a class="reference external" href="#lobclass">Lob</a>, as discussed later in <a class="reference external" href="#streamsandlobs">Streaming
Lobs</a>.</p>
<p>For example, to make every CLOB queried by the application be returned
as a string:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">fetchAsString</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">CLOB</span> <span class="p">];</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT c FROM mylobs WHERE id = 1`</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;No results&quot;</span><span class="p">);</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">clob</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">clob</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>CLOB columns in individual queries can be fetched as strings using
<code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT c FROM mylobs WHERE id = 1`</span><span class="p">,</span>
  <span class="p">[],</span> <span class="c1">// no binds</span>
  <span class="p">{</span> <span class="nx">fetchInfo</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">}}</span> <span class="p">}</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;No results&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">clob</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">clob</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>BLOB query examples are very similar.  To force every BLOB in the
application to be returned as a buffer:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">fetchAsBuffer</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BLOB</span> <span class="p">];</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT b FROM mylobs WHERE id = 2`</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;No results&quot;</span><span class="p">);</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>  <span class="c1">// assuming printable characters</span>
<span class="p">}</span>
</pre></div>
</div>
<p>BLOB columns in individual queries can be fetched as buffers using
<code class="docutils literal notranslate"><span class="pre">fetchInfo</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT b FROM mylobs WHERE id = 2`</span><span class="p">,</span>
  <span class="p">[</span> <span class="p">],</span> <span class="c1">// no binds</span>
  <span class="p">{</span> <span class="nx">fetchInfo</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BUFFER</span><span class="p">}}</span> <span class="p">}</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;No results&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">blob</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>  <span class="c1">// assuming printable characters</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-lobs-as-string-or-buffer-from-pl-sql">
<h4>Getting LOBs as String or Buffer from PL/SQL<a class="headerlink" href="#getting-lobs-as-string-or-buffer-from-pl-sql" title="Permalink to this headline">¶</a></h4>
<p>PL/SQL LOB OUT parameters can be bound as <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> or
<code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>.  See <a class="reference external" href="#lobbinds">LOB Bind Parameters</a> for size
considerations regarding LOB binds.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN lobs_out(:id, :c, :b); END;`</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="nx">c</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">50000</span><span class="p">},</span>
    <span class="nx">b</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BUFFER</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">50000</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>  <span class="c1">// a String</span>
<span class="kr">const</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span>  <span class="c1">// a Buffer</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// do something with str and buf</span>
</pre></div>
</div>
<p>The fetched String and Buffer can be used directly in Node.js.</p>
<p>If data to be bound is larger than can be handled as a String or
Buffer in Node.js or node-oracledb, it will need to be explicitly
streamed to a <a class="reference external" href="#lobclass">Lob</a>, as discussed in <a class="reference external" href="#streamsandlobs">Streaming
Lobs</a>.  See <a class="reference external" href="#lobbinds">LOB Bind Parameters</a> for size
considerations regarding LOB binds.</p>
</div>
</div>
<div class="section" id="a-name-streamsandlobs-a-17-3-streaming-lobs">
<h3><a name="streamsandlobs"></a> 17.3 Streaming Lobs<a class="headerlink" href="#a-name-streamsandlobs-a-17-3-streaming-lobs" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="#lobclass">Lob Class</a> in node-oracledb implements the <a class="reference external" href="https://nodejs.org/api/stream.html">Node.js
Stream</a> interface to provide streaming access to CLOB and BLOB
database columns and to PL/SQL bind parameters.</p>
<p>Node-oracledb Lobs can represent persistent LOBs (those permanently
stored in the database) or temporary LOBs (such as those created with
<a class="reference external" href="#connectioncreatelob"><code class="docutils literal notranslate"><span class="pre">connection.createLob()</span></code></a>, or returned from
some SQL or PL/SQL).</p>
<p>If multiple LOBs are streamed concurrently, worker threads will
effectively be serialized on the connection.</p>
<p>It is the application’s responsibility to make sure the connection
remains open while a Stream operation such as <code class="docutils literal notranslate"><span class="pre">pipe()</span></code> is in progress.</p>
<div class="section" id="readable-lobs">
<h4>Readable Lobs<a class="headerlink" href="#readable-lobs" title="Permalink to this headline">¶</a></h4>
<p>Being a Stream object, a Lob being read from the database has two
modes of operation: “flowing mode” and “paused mode”.  In flowing
mode, data is piped to another stream, or events are posted as data is
read.  In paused mode the application must explicitly call <code class="docutils literal notranslate"><span class="pre">read()</span></code> to
get data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">read(size)</span></code> unit is in characters for CLOBs and in bytes for
BLOBs.</p>
<p>When reading a LOB from the database, resources are automatically
released at completion of the readable stream or if there is a LOB
error.  The <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code> method can also be used to close persistent
LOBs that have not been streamed to completion.</p>
<p>A Readable Lob object starts out in paused mode.  If a ‘data’ event
handler is added, or the Lob is piped to a Writeable stream, then the
Lob switches to flowing mode.</p>
<p>For unpiped Readable Lobs operating in flowing mode where the Lob is
read through event handlers, the Lob object can be switched to paused
mode by calling <code class="docutils literal notranslate"><span class="pre">pause()</span></code>.  Once the Lob is in paused mode, it stops
emitting <code class="docutils literal notranslate"><span class="pre">data</span></code> events.</p>
<p>Similarly, a Readable Lob operating in the paused mode can be switched
to flowing mode by calling <code class="docutils literal notranslate"><span class="pre">resume()</span></code>.  It will then start emitting
‘data’ events again.</p>
</div>
<div class="section" id="writeable-lobs">
<h4>Writeable Lobs<a class="headerlink" href="#writeable-lobs" title="Permalink to this headline">¶</a></h4>
<p>Lobs are written to with <code class="docutils literal notranslate"><span class="pre">pipe()</span></code>. Alternatively the <code class="docutils literal notranslate"><span class="pre">write()</span></code> method
can be called successively, with the last piece being written by the
<code class="docutils literal notranslate"><span class="pre">end()</span></code> method.  The <code class="docutils literal notranslate"><span class="pre">end()</span></code> method must be called because it frees
resources.  If the Lob is being piped into, then the <code class="docutils literal notranslate"><span class="pre">write()</span></code> and
<code class="docutils literal notranslate"><span class="pre">end()</span></code> methods are automatically called.</p>
<p>Writeable Lobs also have events, see the <a class="reference external" href="https://nodejs.org/api/stream.html">Node.js Stream</a>
documentation.</p>
<p>At the conclusion of streaming into a Writeable Lob, the <code class="docutils literal notranslate"><span class="pre">close</span></code> event
will occur.  It is recommended to put logic such as committing and
releasing connections in this event (or after it occurs).  See
<a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/lobinsert2.js">lobinsert2.js</a>.  It is also recommended that persistent LOBs not
use the <code class="docutils literal notranslate"><span class="pre">finish</span></code> event handler for cleanup.</p>
</div>
</div>
<div class="section" id="a-name-lobinsertdiscussion-a-17-4-using-returning-into-to-insert-into-lobs">
<h3><a name="lobinsertdiscussion"></a> 17.4 Using RETURNING INTO to Insert into LOBs<a class="headerlink" href="#a-name-lobinsertdiscussion-a-17-4-using-returning-into-to-insert-into-lobs" title="Permalink to this headline">¶</a></h3>
<p>If Strings or Buffers are too large to be directly inserted into the
database (see <a class="reference external" href="#basiclobinsert">Simple Insertion of LOBs</a>), use a
<code class="docutils literal notranslate"><span class="pre">RETURNING</span> <span class="pre">INTO</span></code> clause to retrieve a <a class="reference external" href="#lobclass">Lob</a> for a table
item.  Data can then be streamed into the Lob and committed directly
to the table:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO mylobs (id, c) VALUES (:id, EMPTY_CLOB()) RETURNING c INTO :lobbv`</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="nx">lobbv</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">CLOB</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">autoCommit</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}</span>  <span class="c1">// a transaction needs to span the INSERT and pipe()</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rowsAffected</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">lobbv</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Error getting a LOB locator&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">doInsert</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">lob</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">lobbv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="nx">lob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>  <span class="c1">// all data is loaded so we can commit it</span>
  <span class="p">});</span>
  <span class="nx">lob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="kr">const</span> <span class="nx">inStream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="s1">&#39;example.txt&#39;</span><span class="p">);</span> <span class="c1">// open the file to read from</span>
  <span class="nx">inStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">inStream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">lob</span><span class="p">);</span>  <span class="c1">// copies the text to the LOB</span>
<span class="p">});</span>

<span class="nx">await</span> <span class="nx">doInsert</span><span class="p">;</span>
</pre></div>
</div>
<p>This example streams from a file into the table.  When the data has
been completely streamed, the Lob is automatically closed and the
‘close’ event triggered.  At this point the data can be committed.</p>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/lobinsert2.js">lobinsert2.js</a> for the full example.</p>
</div>
<div class="section" id="a-name-loboutstream-a-17-5-getting-lobs-as-streams-from-oracle-database">
<h3><a name="loboutstream"></a> 17.5 Getting LOBs as Streams from Oracle Database<a class="headerlink" href="#a-name-loboutstream-a-17-5-getting-lobs-as-streams-from-oracle-database" title="Permalink to this headline">¶</a></h3>
<p>By default, when a <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause contains a LOB column, or a PL/SQL
OUT parameter returns a LOB, instances of <a class="reference external" href="#lobclass">Lob</a> are
created.  (This can be changed, see <a class="reference external" href="#queryinglobs">Simple LOB Queries and PL/SQL OUT
Binds</a>.)</p>
<p>For each Lob instance, the <a class="reference external" href="#proplobtype"><code class="docutils literal notranslate"><span class="pre">lob.type</span></code></a> property will be
<a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code></a> or
<a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code></a>, depending on the column
or PL/SQL parameter type.</p>
<p>Returned Lobs can be used as <a class="reference external" href="https://nodejs.org/api/stream.html">Readable Streams</a>.  Data can be
streamed from each Lob, for example to a file.  At the conclusion of
the stream, persistent LOBs are automatically closed.</p>
<p>Lobs returned from the database that are not streamed can be passed
back to the database as IN binds for PL/SQL blocks, for <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, or
for <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> statements.  The Lobs should then be closed with
<a class="reference external" href="#lobclose"><code class="docutils literal notranslate"><span class="pre">lob.close()</span></code></a>.  If they are passed as IN OUT binds, they
will be automatically closed and the execution
<a class="reference external" href="#execoutbinds"><code class="docutils literal notranslate"><span class="pre">outBinds</span></code></a> property will contain the updated Lob.</p>
<div class="section" id="lob-query-example">
<h4>LOB Query Example<a class="headerlink" href="#lob-query-example" title="Permalink to this headline">¶</a></h4>
<p>Each CLOB or BLOB in a <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> returns a <a class="reference external" href="#lobclass">Lob</a> by default.
The table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mylobs</span> <span class="p">(</span><span class="n">id</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="k">c</span> <span class="k">CLOB</span><span class="p">,</span> <span class="n">b</span> <span class="nb">BLOB</span><span class="p">);</span>
</pre></div>
</div>
<p>can be called to get a Lob <code class="docutils literal notranslate"><span class="pre">clob</span></code> like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT c FROM mylobs WHERE id = 1`</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">clob</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// Instance of a node-oracledb Lob</span>
  <span class="c1">// console.log(clob.type);      // -&gt; 2006 aka oracledb.CLOB</span>
  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>                           <span class="c1">// do something with the Lob</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pl-sql-lob-parameter-fetch-example">
<h4>PL/SQL LOB Parameter Fetch Example<a class="headerlink" href="#pl-sql-lob-parameter-fetch-example" title="Permalink to this headline">¶</a></h4>
<p>A PL/SQL procedure such as this:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">PROCEDURE</span> <span class="n">lobs_out</span> <span class="p">(</span><span class="n">id</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">clob_out</span> <span class="k">OUT</span> <span class="k">CLOB</span><span class="p">,</span> <span class="n">blob_out</span> <span class="k">OUT</span> <span class="nb">BLOB</span><span class="p">)</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>can be called to get the <a class="reference external" href="#lobclass">Lobs</a> <code class="docutils literal notranslate"><span class="pre">clob</span></code> and <code class="docutils literal notranslate"><span class="pre">blob</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN lobs_out(:id, :c, :b); END;`</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">c</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">CLOB</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">},</span>
    <span class="nx">b</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BLOB</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">clob</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span>

<span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="c1">// do something with the Lobs</span>
</pre></div>
</div>
</div>
<div class="section" id="streaming-out-a-lob">
<h4>Streaming Out a Lob<a class="headerlink" href="#streaming-out-a-lob" title="Permalink to this headline">¶</a></h4>
<p>Once a Lob is obtained from a query or PL/SQL OUT bind, it can be
streamed out:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">lob</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// . . . do special handling such as create an empty file or throw an error</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">lob</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">CLOB</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">lob</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>  <span class="c1">// set the encoding so we get a &#39;string&#39; not a &#39;buffer&#39;</span>
<span class="p">}</span>

<span class="nx">lob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">});</span>
<span class="nx">lob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span> <span class="p">});</span>   <span class="c1">// all done.  The Lob is automatically closed.</span>

<span class="kr">const</span> <span class="nx">outStream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="s1">&#39;myoutput.txt&#39;</span><span class="p">);</span>
<span class="nx">outStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">});</span>

<span class="c1">// switch into flowing mode and push the LOB to myoutput.txt</span>
<span class="nx">lob</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">outStream</span><span class="p">);</span>
</pre></div>
</div>
<p>Note the Lob is automatically closed at the end of the stream.</p>
<p>An alternative to the <code class="docutils literal notranslate"><span class="pre">lob.pipe()</span></code> call is to have a <code class="docutils literal notranslate"><span class="pre">data</span></code> event on
the Lob Stream which processes each chunk of LOB data separately.
Either a String or Buffer can be built up or, if the LOB is big, each
chunk can be written to another Stream or to a file:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">lob</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// . . . do special handling such as create an empty file or throw an error</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="nx">lob</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>  <span class="c1">// set the encoding so we get a &#39;string&#39; not a &#39;buffer&#39;</span>
<span class="nx">lob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">});</span>
<span class="nx">lob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span> <span class="p">});</span>   <span class="c1">// all done.  The Lob is automatically closed.</span>
<span class="nx">lob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">str</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">;</span> <span class="c1">// or use Buffer.concat() for BLOBS</span>
<span class="p">});</span>
<span class="nx">lob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(...,</span> <span class="nx">str</span><span class="p">,</span> <span class="p">...);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Node-oracledb’s <a class="reference external" href="#proplobpiecesize"><code class="docutils literal notranslate"><span class="pre">lob.pieceSize</span></code></a> can be used to
control the number of bytes retrieved for each readable ‘data’ event.
This sets the number of bytes (for BLOBs) or characters (for CLOBs).
The default is <a class="reference external" href="#proplobchunksize"><code class="docutils literal notranslate"><span class="pre">lob.chunkSize</span></code></a>.  The
recommendation is for it to be a multiple of <code class="docutils literal notranslate"><span class="pre">chunkSize</span></code>.</p>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/lobbinds.js">lobbinds.js</a> for a full example.</p>
</div>
</div>
<div class="section" id="a-name-templobdiscussion-a-17-6-using-createlob-for-pl-sql-in-binds">
<h3><a name="templobdiscussion"></a> 17.6 Using <code class="docutils literal notranslate"><span class="pre">createLob()</span></code> for PL/SQL IN Binds<a class="headerlink" href="#a-name-templobdiscussion-a-17-6-using-createlob-for-pl-sql-in-binds" title="Permalink to this headline">¶</a></h3>
<p>Node-oracledb applications can create Oracle ‘temporary LOBs’ by
calling <a class="reference external" href="#connectioncreatelob"><code class="docutils literal notranslate"><span class="pre">connection.createLob()</span></code></a>.  These are
instances of the <a class="reference external" href="#lobclass">Lob</a> class. They can be populated with
data and passed to PL/SQL blocks.  This is useful if the data is
larger than feasible for direct binding (see <a class="reference external" href="#basiclobinsert">Simple Insertion of
LOBs</a>).  These Lobs can also be used for SQL
statement IN binds, however the <code class="docutils literal notranslate"><span class="pre">RETURNING</span> <span class="pre">INTO</span></code> method shown above
will be more efficient.</p>
<p>Lobs from <code class="docutils literal notranslate"><span class="pre">createLob()</span></code> will use space in the temporary tablespace
until <a class="reference external" href="#lobclose"><code class="docutils literal notranslate"><span class="pre">lob.close()</span></code></a> is called.  Database Administrators
can track this usage by querying <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D3873ED4-5FAD-479F-85F9-EE56D4B18ED5"><code class="docutils literal notranslate"><span class="pre">V$TEMPORARY_LOBS</span></code></a>.</p>
<div class="section" id="passing-a-lob-into-pl-sql">
<h4>Passing a Lob Into PL/SQL<a class="headerlink" href="#passing-a-lob-into-pl-sql" title="Permalink to this headline">¶</a></h4>
<p>The following insertion example is based on <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/lobplsqltemp.js">lobplsqltemp.js</a>.  It
creates an empty LOB, populates it, and then passes it to a PL/SQL
procedure.</p>
<p>A temporary LOB can be created with
<a class="reference external" href="#connectioncreatelob"><code class="docutils literal notranslate"><span class="pre">connection.createLob()</span></code></a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">templob</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">createLob</span><span class="p">(</span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">CLOB</span><span class="p">);</span>
</pre></div>
</div>
<p>Once created, data can be inserted into it.  For example to read a
text file:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">templob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">somecallback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">});</span>

<span class="c1">// The data was loaded into the temporary LOB, so use it</span>
<span class="nx">templob</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">somecallback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">templob</span><span class="p">);</span> <span class="p">});</span>

<span class="c1">// copies the text from &#39;example.txt&#39; to the temporary LOB</span>
<span class="kr">const</span> <span class="nx">inStream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="s1">&#39;example.txt&#39;</span><span class="p">);</span>
<span class="nx">inStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="p">});</span>
<span class="nx">inStream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">templob</span><span class="p">);</span>
</pre></div>
</div>
<p>Now the LOB has been populated, it can be bound in <code class="docutils literal notranslate"><span class="pre">somecallback()</span></code> to
a PL/SQL IN parameter:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// For PROCEDURE lobs_in (p_id IN NUMBER, c_in IN CLOB, b_in IN BLOB)</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN lobs_in(:id, :c, null); END;`</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="nx">c</span><span class="o">:</span> <span class="nx">templob</span>  <span class="c1">// type and direction are optional for IN binds</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>When the temporary LOB is no longer needed, it must be closed with
<a class="reference external" href="#lobclose"><code class="docutils literal notranslate"><span class="pre">lob.close()</span></code></a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">templob</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-closinglobs-a-17-7-closing-lobs">
<h3><a name="closinglobs"></a> 17.7 Closing Lobs<a class="headerlink" href="#a-name-closinglobs-a-17-7-closing-lobs" title="Permalink to this headline">¶</a></h3>
<p>Closing a Lob frees up resources. In particular, the temporary
tablespace storage used by a temporary LOB is released.  Once a Lob is
closed, it can no longer be bound or used for streaming.</p>
<p>Lobs created with <a class="reference external" href="#connectioncreatelob"><code class="docutils literal notranslate"><span class="pre">createLob()</span></code></a> should be
explicitly closed with <a class="reference external" href="#lobclose"><code class="docutils literal notranslate"><span class="pre">lob.close()</span></code></a>.</p>
<p>Persistent or temporary Lobs returned from the database should be
closed with <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code> unless they have been automatically closed.
Automatic closing of returned Lobs occurs when:</p>
<ul class="simple">
<li><p>streaming has completed</p></li>
<li><p>a stream error occurs</p></li>
<li><p>the Lob was used as the source for an IN OUT bind</p></li>
</ul>
<p>If you try to close a Lob being used for streaming you will get the
error <em>NJS-023: concurrent operations on a Lob are not allowed</em>.</p>
<p>The connection must be open when calling <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code> on a temporary
LOB.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lob.close()</span></code> method emits the <a class="reference external" href="https://nodejs.org/api/stream.html">Node.js Stream</a> ‘close’ event
unless the Lob has already been closed explicitly or automatically.</p>
</div>
</div>
<div class="section" id="a-name-jsondatatype-a-18-oracle-database-json-data-type">
<h2><a name="jsondatatype"></a> 18. Oracle Database JSON Data type<a class="headerlink" href="#a-name-jsondatatype-a-18-oracle-database-json-data-type" title="Permalink to this headline">¶</a></h2>
<p>Oracle Database 12.1.0.2 introduced native support for JSON data.  You
can use JSON with relational database features, including
transactions, indexing, declarative querying, and views.  You can
project JSON data relationally, making it available for relational
processes and tools.</p>
<p>JSON data in the database is stored as BLOB, CLOB or VARCHAR2 data.
This means that node-oracledb can easily insert and query it.</p>
<p>As an example, the following table has a <code class="docutils literal notranslate"><span class="pre">PO_DOCUMENT</span></code> column that is
enforced to be JSON:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">j_purchaseorder</span> <span class="p">(</span><span class="n">po_document</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">4000</span><span class="p">)</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">po_document</span> <span class="k">IS</span> <span class="n">JSON</span><span class="p">));</span>
</pre></div>
</div>
<p>To insert data using node-oracledb:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;userId&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;userName&quot;</span><span class="o">:</span> <span class="s2">&quot;Chris&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="o">:</span> <span class="s2">&quot;Australia&quot;</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>  <span class="c1">// change JavaScript value to a JSON string</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO j_purchaseorder (po_document) VALUES (:bv)`</span><span class="p">,</span>
  <span class="p">[</span><span class="nx">s</span><span class="p">]</span>  <span class="c1">// bind the JSON string</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Queries can access JSON with Oracle JSON path expressions.  These
expressions are matched by Oracle SQL functions and conditions to
select portions of the JSON data.  Path expressions can use wildcards
and array ranges.  An example is <code class="docutils literal notranslate"><span class="pre">$.friends</span></code> which is the value of
JSON field <code class="docutils literal notranslate"><span class="pre">friends</span></code>.</p>
<p>Oracle provides SQL functions and conditions to create, query, and
operate on JSON data stored in the database.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">j_purchaseorder</span></code> can be queried with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">po</span><span class="o">.</span><span class="n">po_document</span><span class="o">.</span><span class="n">location</span> <span class="n">FROM</span> <span class="n">j_purchaseorder</span> <span class="n">po</span>
</pre></div>
</div>
<p>With the earlier JSON inserted into the table, the queried value would
be <code class="docutils literal notranslate"><span class="pre">Australia</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">JSON_EXISTS</span></code> tests for the existence of a particular value within
some JSON data.  To look for JSON entries that have a <code class="docutils literal notranslate"><span class="pre">quantity</span></code>
field:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT po_document FROM j_purchaseorder WHERE JSON_EXISTS (po_document, &#39;$.location&#39;)`</span>
<span class="p">);</span>
<span class="kr">const</span> <span class="nx">js</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>  <span class="c1">// show only first record in this example</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Query results: &#39;</span><span class="p">,</span> <span class="nx">js</span><span class="p">);</span>
</pre></div>
</div>
<p>This query would display:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">userId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">userName</span><span class="p">:</span> <span class="s1">&#39;Chris&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="s1">&#39;Australia&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>In Oracle Database 12.2, or later, the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-1EF347AE-7FDA-4B41-AFE0-DD5A49E8B370"><code class="docutils literal notranslate"><span class="pre">JSON_OBJECT</span></code> </a> function
is a great way to convert relational table data to JSON:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT JSON_OBJECT (&#39;deptId&#39; IS d.department_id, &#39;name&#39; IS d.department_name) department</span>
<span class="sb">   FROM departments d</span>
<span class="sb">   WHERE department_id &lt; :did`</span>
   <span class="nx">ORDER</span> <span class="nx">BY</span> <span class="nx">d</span><span class="p">.</span><span class="nx">department_id</span><span class="sb">`,</span>
<span class="sb">  [50]</span>
<span class="sb">);</span>

<span class="sb">for (const row of result.rows)</span>
<span class="sb">  console.log(row[0]);</span>
</pre></div>
</div>
<p>This produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;deptId&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Administration&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;deptId&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Marketing&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;deptId&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Purchasing&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;deptId&quot;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Human Resources&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/selectjson.js">selectjson.js</a> and <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/selectjsonblob.js">selectjsonblob.js</a> for runnable
examples.</p>
<p>For more information about using JSON in Oracle Database see the
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADJSN">Database JSON Developer’s Guide</a>.</p>
</div>
<div class="section" id="a-name-xmltype-a-19-working-with-xmltype">
<h2><a name="xmltype"></a> 19. Working with XMLType<a class="headerlink" href="#a-name-xmltype-a-19-working-with-xmltype" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">XMLType</span></code> columns queried will returns as Strings by default, limited
to the size of a VARCHAR2.</p>
<p>However, if desired, the SQL query could be changed to return a CLOB,
for example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="k">sql</span> <span class="o">=</span> <span class="o">`</span><span class="k">SELECT</span> <span class="n">XMLTYPE</span><span class="p">.</span><span class="n">GETCLOBVAL</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">resource_view</span><span class="o">`</span><span class="p">;</span>
</pre></div>
</div>
<p>The CLOB can be fetched in node-oracledb as a String or
<a class="reference external" href="#lobclass">Lob</a>.</p>
<p>To insert into an <code class="docutils literal notranslate"><span class="pre">XMLType</span></code> column, directly insert a string
containing the XML, or use a temporary LOB, depending on the data
length.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">myxml</span> <span class="o">=</span>
    <span class="sb">`&lt;Warehouse&gt;</span>
<span class="sb">    &lt;WarehouseId&gt;1&lt;/WarehouseId&gt;</span>
<span class="sb">    &lt;WarehouseName&gt;Melbourne, Australia&lt;/WarehouseName&gt;</span>
<span class="sb">    &lt;Building&gt;Owned&lt;/Building&gt;</span>
<span class="sb">    &lt;Area&gt;2020&lt;/Area&gt;</span>
<span class="sb">    &lt;Docks&gt;1&lt;/Docks&gt;</span>
<span class="sb">    &lt;DockType&gt;Rear load&lt;/DockType&gt;</span>
<span class="sb">    &lt;WaterAccess&gt;false&lt;/WaterAccess&gt;</span>
<span class="sb">    &lt;RailAccess&gt;N&lt;/RailAccess&gt;</span>
<span class="sb">    &lt;Parking&gt;Garage&lt;/Parking&gt;</span>
<span class="sb">    &lt;VClearance&gt;20&lt;/VClearance&gt;</span>
<span class="sb">    &lt;/Warehouse&gt;`</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO xwarehouses (warehouse_id, warehouse_spec) VALUES (:id, XMLType(:bv))`</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">bv</span><span class="o">:</span> <span class="nx">myxml</span> <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>LOB handling as discussed in the section <a class="reference external" href="#lobhandling">Working with CLOB and BLOB
Data</a>.</p>
</div>
<div class="section" id="a-name-bind-a-20-bind-parameters-for-prepared-statements">
<h2><a name="bind"></a> 20. Bind Parameters for Prepared Statements<a class="headerlink" href="#a-name-bind-a-20-bind-parameters-for-prepared-statements" title="Permalink to this headline">¶</a></h2>
<p>SQL and PL/SQL statements may contain bind parameters, indicated by
colon-prefixed identifiers or numerals.  These indicate where
separately specified values are substituted in a statement when it is
executed, or where values are to be returned after execution.</p>
<p>IN binds are values passed into the database.  OUT binds are used to
retrieve data.  IN OUT binds are passed in, and may return a different
value after the statement executes.</p>
<p>Using bind parameters is recommended in preference to constructing SQL
or PL/SQL statements by string concatenation or template literals.
This is for performance and security.</p>
<p>Inserted data that is bound is passed to the database separately from
the statement text.  It can never be executed directly.  This means
there is no need to escape bound data inserted into the database.</p>
<p>If a statement is executed more than once with different values for
the bind parameters, then Oracle can re-use context from the initial
execution, generally improving performance.  However, if similar
statements contain hard coded values instead of bind parameters,
Oracle sees the statement text is different and will be less
efficient.</p>
<p>Bind parameters can be used to substitute data but not the text of the
statement.</p>
<p>Bind variables cannot be used in <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-FD9A8CB4-6B9A-44E5-B114-EFB8DA76FC88">DDL</a> statements, for example
<code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> or <code class="docutils literal notranslate"><span class="pre">ALTER</span></code> commands.</p>
<p>Sets of values can bound for use in <a class="reference external" href="#executemany"><code class="docutils literal notranslate"><span class="pre">connection.executeMany()</span></code></a>,
see <a class="reference external" href="#batchexecution">Batch Statement Execution and Bulk Loading</a>.</p>
<div class="section" id="a-name-inbind-a-20-1-in-bind-parameters">
<h3><a name="inbind"></a> 20.1 IN Bind Parameters<a class="headerlink" href="#a-name-inbind-a-20-1-in-bind-parameters" title="Permalink to this headline">¶</a></h3>
<p>For IN binds, a data value is passed into the database and substituted
into the statement during execution of SQL or PL/SQL.</p>
<div class="section" id="a-name-bindbyname-a-bind-by-name">
<h4><a name="bindbyname"></a> Bind by Name<a class="headerlink" href="#a-name-bindbyname-a-bind-by-name" title="Permalink to this headline">¶</a></h4>
<p>To bind data values, the <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">bindParams</span></code></a> argument
of <code class="docutils literal notranslate"><span class="pre">execute()</span></code> should contain bind variable objects with
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">dir</span></code></a>, <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">val</span></code></a>,
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">type</span></code></a> properties.  Each bind variable object
name must match the statement’s bind parameter name:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO countries VALUES (:country_id, :country_name)`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">country_id</span><span class="o">:</span> <span class="p">{</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_IN</span><span class="p">,</span> <span class="nx">val</span><span class="o">:</span> <span class="mi">90</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">},</span>
    <span class="nx">country_name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_IN</span><span class="p">,</span> <span class="nx">val</span><span class="o">:</span> <span class="s2">&quot;Tonga&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Rows inserted &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rowsAffected</span><span class="p">);</span>
</pre></div>
</div>
<p>For IN binds:</p>
<ul class="simple">
<li><p>The direction <code class="docutils literal notranslate"><span class="pre">dir</span></code> is <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_IN</span></code>, which is the default when
<code class="docutils literal notranslate"><span class="pre">dir</span></code> is not specified.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">val</span></code> attribute may be a constant or a JavaScript variable.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">type</span></code> is omitted, it is inferred from the bind data value.  If
<code class="docutils literal notranslate"><span class="pre">type</span></code> is set, it can be <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code>,
<code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code> matching the standard Node.js
type of the data being passed into the database.  Use a bind type of
<code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code> to pass in <a class="reference external" href="#lobclass">Lob</a>
instances.  The type <code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code> can bind a Node.js Buffer to
an Oracle Database RAW, LONG RAW or BLOB type.  For binding Oracle
Database objects, it can also be the name of an Oracle Database
object or collection, or a <a class="reference external" href="#dbobjectclass">DbObject Class</a> type.</p></li>
</ul>
<p>Since <code class="docutils literal notranslate"><span class="pre">dir</span></code> and <code class="docutils literal notranslate"><span class="pre">type</span></code> have defaults, these attributes are sometimes
omitted for IN binds.  Binds can be like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO countries VALUES (:country_id, :country_name)`</span><span class="p">,</span>
  <span class="p">{</span><span class="nx">country_id</span><span class="o">:</span> <span class="mi">90</span><span class="p">,</span> <span class="nx">country_name</span><span class="o">:</span> <span class="s2">&quot;Tonga&quot;</span><span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Rows inserted &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rowsAffected</span><span class="p">);</span>
</pre></div>
</div>
<p>When a bind parameter name is used more than once in the SQL
statement, it should only occur once in the bind object:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT first_name, last_name FROM employees WHERE first_name = :nmbv OR last_name = :nmbv`</span><span class="p">,</span>
  <span class="p">{</span><span class="nx">nmbv</span><span class="o">:</span> <span class="s1">&#39;Christopher&#39;</span><span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-bindbypos-a-bind-by-position">
<h4><a name="bindbypos"></a> Bind by Position<a class="headerlink" href="#a-name-bindbypos-a-bind-by-position" title="Permalink to this headline">¶</a></h4>
<p>Instead of using named bind parameters, the data can alternatively be
in an array.  In this example, values are bound to the SQL bind
parameters <code class="docutils literal notranslate"><span class="pre">:country_id</span></code> and <code class="docutils literal notranslate"><span class="pre">:country_name</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO countries VALUES (:country_id, :country_name)`</span><span class="p">,</span>
  <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="s2">&quot;Tonga&quot;</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The position of the array values corresponds to the position of the
SQL bind parameters as they occur in the statement, regardless of
their names.  This is still true even if the bind parameters are named
like <code class="docutils literal notranslate"><span class="pre">:0</span></code>, <code class="docutils literal notranslate"><span class="pre">:1</span></code>, etc.  The following snippet will fail because the
country name needs to be the second entry of the array so it becomes
the second value in the <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO countries (country_id, country_name) VALUES (:1, :0)`</span><span class="p">,</span>
  <span class="p">[</span><span class="s2">&quot;Tonga&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>  <span class="c1">// fail</span>
<span class="p">);</span>
</pre></div>
</div>
<p>In the context of SQL statements, the input array position ‘n’
indicates the bind parameter at the n’th position in the
statement. However, in the context of PL/SQL statements the position
‘n’ in the bind call indicates a binding for the n’th unique parameter
name in the statement when scanned left to right.</p>
<p>If a bind parameter name is repeated in the SQL string then <a class="reference external" href="#bindbyname">bind by
name</a> syntax should be used.</p>
</div>
<div class="section" id="a-name-binddatatypenotes-a-bind-data-type-notes">
<h4><a name="binddatatypenotes"></a> Bind Data Type Notes<a class="headerlink" href="#a-name-binddatatypenotes-a-bind-data-type-notes" title="Permalink to this headline">¶</a></h4>
<p>When binding a JavaScript Date value in an <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement, it is
inserted as if it represented a TIMESTAMP WITH LOCAL TIME ZONE value.
In the database, TIMESTAMP WITH LOCAL TIME ZONE dates are normalized
to the database time zone, or to the time zone specified for TIMESTAMP
WITH TIME ZONE columns.  If later queried, they are returned in the
session time zone.  See <a class="reference external" href="#datehandling">Fetching Date and Timestamps</a>
for more information.</p>
<p>The type <code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code> cannot be used with IN binds.</p>
<p>Binding NCHAR, NVARCHAR or NCLOB for <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2E008D4A-F6FD-4F34-9071-7E10419CA24D">DML</a> may result in incorrect
character mapping, depending on the database character set and the
database national character set.  It may work in the case where the
database character set can safely convert to the database national
character set.</p>
</div>
</div>
<div class="section" id="a-name-outbind-a-20-2-out-and-in-out-bind-parameters">
<h3><a name="outbind"></a> 20.2 OUT and IN OUT Bind Parameters<a class="headerlink" href="#a-name-outbind-a-20-2-out-and-in-out-bind-parameters" title="Permalink to this headline">¶</a></h3>
<p>OUT binds are used to retrieve data from the database.  IN OUT binds
are passed in, and may return a different value after the statement
executes.  IN OUT binds can be used for PL/SQL calls, but not for SQL.</p>
<p>For each OUT and IN OUT bind parameter in
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">bindParams</span></code></a>, a bind variable object containing
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">dir</span></code></a>, <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">val</span></code></a>,
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">type</span></code></a>, and <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">maxSize</span></code></a>
properties is used:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">dir</span></code> attribute should be <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_OUT</span></code> or
<code class="docutils literal notranslate"><span class="pre">oracledb.BIND_INOUT</span></code>, depending on whether data is only to be
returned from the database or additionally passed into the database.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">val</span></code> parameter in needed when binding IN OUT to pass a value
into the database.  It is not used for OUT binds.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_INOUT</span></code> parameters, the <code class="docutils literal notranslate"><span class="pre">type</span></code> attribute is
inferred from the input data type.  Alternatively it can be
explicitly set to <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code>,
<code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code> or
<code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>, or the name of an Oracle Database object or
collection, or a <a class="reference external" href="#dbobjectclass">DbObject Class</a> type.  This must
match the data type of the Node.js value or variable.  The output
data type will always be the same as the input data type.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_OUT</span></code> parameters the <code class="docutils literal notranslate"><span class="pre">type</span></code> attribute will be the
node-oracledb or Node.js data type that data will be returned as.
It should be <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code>,
<code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code>, or
<code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code>, or the name of an Oracle Database object or
collection, or a <a class="reference external" href="#dbobjectclass">DbObject Class</a> type.  If <code class="docutils literal notranslate"><span class="pre">type</span></code>
is not specified for OUT binds then <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> is assumed.</p>
<p>Oracle Database CLOB data can be bound with a <code class="docutils literal notranslate"><span class="pre">type</span></code> of
<code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> to return a Node.js String, or as <code class="docutils literal notranslate"><span class="pre">type</span></code> of
<code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code> to return a <a class="reference external" href="#lobclass">Lob instance</a>.</p>
<p>Oracle Database BLOB data can be bound with a <code class="docutils literal notranslate"><span class="pre">type</span></code> of
<code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code> to return a Node.js Buffer, or as <code class="docutils literal notranslate"><span class="pre">type</span></code> of
<code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code> to return a <a class="reference external" href="#lobclass">Lob instance</a>.</p>
<p>Oracle Database RAW and LONG RAW data can be bound with a <code class="docutils literal notranslate"><span class="pre">type</span></code> of
<code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code> to return a Node.js Buffer.</p>
<p>Oracle Database LONG, ROWID and UROWID data can be bound with a
<code class="docutils literal notranslate"><span class="pre">type</span></code> of <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> to return a JavaScript String.</p>
</li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> attribute should be set for <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> or
<code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code> OUT or IN OUT binds.  This is the maximum number
of bytes the bind parameter will return.  If the output value does
not fit in <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> bytes, then an error such <em>ORA-06502: PL/SQL:
numeric or value error: character string buffer too small</em> or
<em>NJS-016: buffer is too small for OUT binds</em> occurs.</p>
<p>A default value of 200 bytes is used when <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> is not provided
for OUT binds of type <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>.</p>
<p>A string representing a UROWID may be up to 5267 bytes long in
node-oracledb.</p>
</li>
</ul>
<p>For <a class="reference external" href="#plsqlindexbybinds">PL/SQL Associative Array binds</a> a
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code></a> property is also required</p>
<p>Note that before a PL/SQL block returns, all OUT binds should be set
to NULL or, for REF CURSORS, to an empty result set.  See this <a class="reference external" href="https://github.com/oracle/node-oracledb/issues/886">GitHub
Issue</a>.</p>
<div class="section" id="a-name-outbinds-a-accessing-out-bind-values">
<h4><a name="outbinds"></a> Accessing OUT Bind Values<a class="headerlink" href="#a-name-outbinds-a-accessing-out-bind-values" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="#executecallback"><code class="docutils literal notranslate"><span class="pre">results</span></code></a> parameter of the <code class="docutils literal notranslate"><span class="pre">execute()</span></code>
callback contains an <a class="reference external" href="#execoutbinds"><code class="docutils literal notranslate"><span class="pre">outBinds</span></code></a> property with the
returned OUT and IN OUT bind values.</p>
<p>Given the creation of the PL/SQL procedure <code class="docutils literal notranslate"><span class="pre">TESTPROC</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">PROCEDURE</span> <span class="n">testproc</span> <span class="p">(</span>
<span class="n">p_in</span> <span class="k">IN</span> <span class="n">VARCHAR2</span><span class="p">,</span> <span class="n">p_inout</span> <span class="k">IN</span> <span class="k">OUT</span> <span class="n">VARCHAR2</span><span class="p">,</span> <span class="n">p_out</span> <span class="k">OUT</span> <span class="nb">NUMBER</span><span class="p">)</span>
<span class="k">AS</span>
<span class="k">BEGIN</span>
  <span class="n">p_inout</span> <span class="p">:</span><span class="o">=</span> <span class="n">p_in</span> <span class="o">||</span> <span class="n">p_inout</span><span class="p">;</span>
  <span class="n">p_out</span> <span class="p">:</span><span class="o">=</span> <span class="mi">101</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
<span class="k">show</span> <span class="n">errors</span>
</pre></div>
</div>
<p>The procedure <code class="docutils literal notranslate"><span class="pre">TESTPROC</span></code> can be called with:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bindVars</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">i</span><span class="o">:</span>  <span class="s1">&#39;Chris&#39;</span><span class="p">,</span> <span class="c1">// default direction is BIND_IN. Data type is inferred from the data</span>
  <span class="nx">io</span><span class="o">:</span> <span class="p">{</span> <span class="nx">val</span><span class="o">:</span> <span class="s1">&#39;Jones&#39;</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_INOUT</span> <span class="p">},</span>
  <span class="nx">o</span><span class="o">:</span>  <span class="p">{</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">},</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN testproc(:i, :io, :o); END;`</span><span class="p">,</span>
  <span class="nx">bindVars</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">);</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">bindParams</span></code> is passed as an object, the <code class="docutils literal notranslate"><span class="pre">outBinds</span></code> property is
also an object.  The Node.js output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">io</span><span class="p">:</span> <span class="s1">&#39;ChrisJones&#39;</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="mi">101</span> <span class="p">}</span>
</pre></div>
</div>
<p>PL/SQL allows named parameters in procedure and function calls.  This
can be used in <code class="docutils literal notranslate"><span class="pre">execute()</span></code> like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  `BEGIN testproc(p_in =&gt; :i, p_inout =&gt; :io, p_out =&gt; :o); END;`,
</pre></div>
</div>
<p>An alternative to node-oracledb’s ‘bind by name’ syntax is ‘bind by
array’ syntax:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bindVars</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">&#39;Chris&#39;</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">val</span><span class="o">:</span> <span class="s1">&#39;Jones&#39;</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_INOUT</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
<p>When <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">bindParams</span></code></a> is passed as an array, then
<code class="docutils literal notranslate"><span class="pre">outBinds</span></code> is returned as an array, with the same order as the OUT
binds in the statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="s1">&#39;ChrisJones&#39;</span><span class="p">,</span> <span class="mi">101</span> <span class="p">]</span>
</pre></div>
</div>
<p>Mixing positional and named syntax is not supported.  The following
will throw an error:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bindVars</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">&#39;Chris&#39;</span><span class="p">,</span>                                                  <span class="c1">// valid</span>
  <span class="p">{</span> <span class="nx">val</span><span class="o">:</span> <span class="s1">&#39;Jones&#39;</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_INOUT</span> <span class="p">},</span>               <span class="c1">// valid</span>
  <span class="p">{</span> <span class="nx">o</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">}</span> <span class="p">}</span>  <span class="c1">// invalid</span>
<span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-dmlreturn-a-20-3-dml-returning-bind-parameters">
<h3><a name="dmlreturn"></a> 20.3 DML RETURNING Bind Parameters<a class="headerlink" href="#a-name-dmlreturn-a-20-3-dml-returning-bind-parameters" title="Permalink to this headline">¶</a></h3>
<p>“DML RETURNING” statements (such as <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">...</span> <span class="pre">RETURNING</span> <span class="pre">...</span> <span class="pre">INTO</span> <span class="pre">...</span></code>) are a way information can be returned about row changes from
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2E008D4A-F6FD-4F34-9071-7E10419CA24D">DML</a> statements.  For example you can use DML RETURNING to get
the ROWIDs of newly inserted rows.  Another common use case is to
return <a class="reference external" href="#autoincrement">auto incremented column values </a>.</p>
<p>Bind parameters for DML RETURNING statements can use <code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code>,
<code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>, <code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code> or
<code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code> for the BIND_OUT <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">type</span></code></a>.  To
bind named Oracle objects use the class name or
<a class="reference external" href="#dbobjectclass">DbObject</a> prototype class for the bind type, as shown
for object binds in <a class="reference external" href="#objects">Fetching Oracle Database Objects and
Collections</a>.</p>
<p>Oracle Database DATE, TIMESTAMP, TIMESTAMP WITH LOCAL TIME ZONE and
TIMESTAMP WITH TIME ZONE types can be bound as <code class="docutils literal notranslate"><span class="pre">oracledb.DATE</span></code> for DML
RETURNING.  These types can also be bound as <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>, if
desired.  ROWID and UROWID data to be returned can be bound as
<code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>.  Note that a string representing a UROWID may be up
to 5267 bytes long.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> types, an error occurs if
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">maxSize</span></code></a> is not large enough to hold a returned
value.</p>
<p>Note each DML RETURNING bind OUT parameter is returned as an array
containing zero or more elements.  Application code that is designed
to expect only one value could be made more robust if it confirms the
returned array length is not greater than one.  This will help
identify invalid data or an incorrect <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause that causes more
results to be returned.</p>
<p>No duplicate binds are allowed in a DML statement with a <code class="docutils literal notranslate"><span class="pre">RETURNING</span></code>
clause, and no duplication is allowed between bind parameters in the
DML section and the <code class="docutils literal notranslate"><span class="pre">RETURNING</span></code> section of the statement.</p>
<p>An example of DML RETURNING binds is:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`UPDATE mytab SET name = :name</span>
<span class="sb">   WHERE id = :id</span>
<span class="sb">   RETURNING id, ROWID INTO :ids, :rids`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span>    <span class="mi">1001</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span>  <span class="s2">&quot;Krishna&quot;</span><span class="p">,</span>
    <span class="nx">ids</span><span class="o">:</span>   <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">},</span>
    <span class="nx">rids</span><span class="o">:</span>  <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">);</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause matches one record, the output would be like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">ids</span><span class="p">:</span> <span class="p">[</span> <span class="mi">1001</span> <span class="p">],</span> <span class="n">rids</span><span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;AAAbvZAAMAAABtNAAA&#39;</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>When a couple of rows match, the output could be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">ids</span><span class="p">:</span> <span class="p">[</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">1002</span> <span class="p">],</span>
  <span class="n">rids</span><span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;AAAbvZAAMAAABtNAAA&#39;</span><span class="p">,</span> <span class="s1">&#39;AAAbvZAAMAAABtNAAB&#39;</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause matches no rows, the output would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">ids</span><span class="p">:</span> <span class="p">[],</span> <span class="n">rids</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-refcursors-a-20-4-ref-cursor-bind-parameters">
<h3><a name="refcursors"></a> 20.4 REF CURSOR Bind Parameters<a class="headerlink" href="#a-name-refcursors-a-20-4-ref-cursor-bind-parameters" title="Permalink to this headline">¶</a></h3>
<p>Oracle REF CURSORS can be fetched in node-oracledb by binding a
<code class="docutils literal notranslate"><span class="pre">oracledb.CURSOR</span></code> to a PL/SQL call.  The resulting bind variable
becomes a <a class="reference external" href="#resultsetclass">ResultSet</a>, allowing rows to be fetched
using <a class="reference external" href="#getrow"><code class="docutils literal notranslate"><span class="pre">getRow()</span></code></a> or <a class="reference external" href="#getrows"><code class="docutils literal notranslate"><span class="pre">getRows()</span></code></a>.  The ResultSet
can also be converted to a Readable Stream by using
<a class="reference external" href="#toquerystream"><code class="docutils literal notranslate"><span class="pre">toQueryStream()</span></code></a>.  Oracle <a class="reference external" href="#implicitresults">Implicit
Results</a> are an alternative way to return query
results from PL/SQL.</p>
<p>If using <code class="docutils literal notranslate"><span class="pre">getRow()</span></code> or <code class="docutils literal notranslate"><span class="pre">getRows()</span></code> the ResultSet must be freed using
<a class="reference external" href="#close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a> when all rows have been fetched, or when the
application does not want to continue getting more rows.  If the REF
CURSOR is set to NULL or is not set in the PL/SQL procedure, then the
returned ResultSet is invalid and methods like <code class="docutils literal notranslate"><span class="pre">getRows()</span></code> will return
an error when invoked.</p>
<p>Given a PL/SQL procedure defined as:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">PROCEDURE</span> <span class="n">get_emp_rs</span> <span class="p">(</span>
  <span class="n">p_sal</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span>
  <span class="n">p_recordset</span> <span class="k">OUT</span> <span class="n">SYS_REFCURSOR</span><span class="p">)</span> <span class="k">AS</span>
<span class="k">BEGIN</span>
  <span class="k">OPEN</span> <span class="n">p_recordset</span> <span class="k">FOR</span>
    <span class="k">SELECT</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">salary</span><span class="p">,</span> <span class="n">hire_date</span>
    <span class="k">FROM</span>   <span class="n">employees</span>
    <span class="k">WHERE</span>  <span class="n">salary</span> <span class="o">&gt;</span> <span class="n">p_sal</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>This PL/SQL procedure can be called in node-oracledb using:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`&quot;BEGIN get_emp_rs(:sal, :cursor); END;`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">sal</span><span class="o">:</span> <span class="mi">6000</span><span class="p">,</span>
    <span class="nx">cursor</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">CURSOR</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">resultSet</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">cursor</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">row</span><span class="p">;</span>
<span class="k">while</span> <span class="p">((</span><span class="nx">row</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">resultSet</span><span class="p">.</span><span class="nx">getRow</span><span class="p">()))</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// always close the ResultSet</span>
<span class="nx">await</span> <span class="nx">resultSet</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/refcursor.js">refcursor.js</a> for a complete example.</p>
<p>To convert the REF CURSOR ResultSet to a stream, use
<a class="reference external" href="#toquerystream"><code class="docutils literal notranslate"><span class="pre">toQueryStream()</span></code></a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`&quot;BEGIN get_emp_rs(:sal, :cursor); END;`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">sal</span><span class="o">:</span> <span class="mi">6000</span><span class="p">,</span>
    <span class="nx">cursor</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">CURSOR</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="kr">const</span> <span class="nx">cursor</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">cursor</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queryStream</span> <span class="o">=</span> <span class="nx">cursor</span><span class="p">.</span><span class="nx">toQueryStream</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">consumeStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">queryStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">queryStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">reject</span><span class="p">);</span>
  <span class="nx">queryStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">await</span> <span class="nx">consumeStream</span><span class="p">;</span>
</pre></div>
</div>
<p>The connection must remain open until the stream is completely read.
Query results must be fetched to completion to avoid resource leaks.
The ResultSet <code class="docutils literal notranslate"><span class="pre">close()</span></code> call for streaming query results will be
executed internally when all data has been fetched.</p>
</div>
<div class="section" id="a-name-lobbinds-a-20-5-lob-bind-parameters">
<h3><a name="lobbinds"></a> 20.5 LOB Bind Parameters<a class="headerlink" href="#a-name-lobbinds-a-20-5-lob-bind-parameters" title="Permalink to this headline">¶</a></h3>
<p>Database CLOBs can be bound with <code class="docutils literal notranslate"><span class="pre">type</span></code> set to
<a class="reference external" href="#oracledbconstants"><code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code></a>.  Database BLOBs can be bound as
<a class="reference external" href="#oracledbconstants"><code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code></a>.  These binds accept, or return,
node-oracledb <a class="reference external" href="#lobclass">Lob</a> instances, which implement the Node.js
Stream interface.</p>
<p>Lobs may represent Oracle Database persistent LOBs (those stored in
tables) or temporary LOBs (such as those created with
<a class="reference external" href="#connectioncreatelob"><code class="docutils literal notranslate"><span class="pre">createLob()</span></code></a> or returned by some SQL and
PL/SQL operations).</p>
<p>LOBs can be bound with direction <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_IN</span></code>,
<code class="docutils literal notranslate"><span class="pre">oracledb.BIND_OUT</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.BIND_INOUT</span></code>, depending on context.</p>
<p>Note that any PL/SQL OUT LOB parameter should be initialized in the
PL/SQL block - even just to NULL - before the PL/SQL code
completes. Make sure to do this in all PL/SQL code paths including in
error handlers. This prevents node-oracledb throwing the error
<em>DPI-007: invalid OCI handle or descriptor</em>.</p>
<p>In many cases it will be easier to work with JavaScript Strings and
Buffers instead of <a class="reference external" href="#lobclass">Lobs</a>.  These types can be bound
directly for SQL IN binds to insert into, or update, LOB columns.
They can also be bound to PL/SQL LOB parameters.  Use the bind type
<a class="reference external" href="#oracledbconstants"><code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code></a> for CLOBs and
<a class="reference external" href="#oracledbconstants"><code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code></a> for BLOBs.  The default size
used for these binds in the OUT direction is 200, so set <code class="docutils literal notranslate"><span class="pre">maxSize</span></code>
appropriately.</p>
<p>See <a class="reference external" href="#lobhandling">Working with CLOB and BLOB Data</a> for examples and
more information on binding and working with LOBs.</p>
<div class="section" id="size-limits-for-binding-lobs-to-strings-and-buffers">
<h4>Size Limits for Binding LOBs to Strings and Buffers<a class="headerlink" href="#size-limits-for-binding-lobs-to-strings-and-buffers" title="Permalink to this headline">¶</a></h4>
<p>When CLOBs are bound as <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code>, or BLOBs are bound as
<code class="docutils literal notranslate"><span class="pre">oracledb.BUFFER</span></code>, the limitation on binding is the memory available
to Node.js and the V8 engine.  For data larger than several megabytes,
it is recommended to bind as <code class="docutils literal notranslate"><span class="pre">oracledb.CLOB</span></code> or <code class="docutils literal notranslate"><span class="pre">oracledb.BLOB</span></code> and
use <a class="reference external" href="#streamsandlobs">Lob streaming</a>.  If you try to create large
Strings or Buffers in Node.js you will see errors like <em>JavaScript
heap out of memory</em>, or other space related messages.</p>
<p>Internally, temporary LOBs are used when binding Strings and Buffers
larger than 32 KB for PL/SQL calls.  Freeing of the temporary LOB is
handled automatically.  For SQL calls no temporary LOBs are used.</p>
</div>
</div>
<div class="section" id="a-name-sqlwherein-a-20-6-binding-multiple-values-to-a-sql-where-in-clause">
<h3><a name="sqlwherein"></a> 20.6 Binding Multiple Values to a SQL <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">IN</span></code> Clause<a class="headerlink" href="#a-name-sqlwherein-a-20-6-binding-multiple-values-to-a-sql-where-in-clause" title="Permalink to this headline">¶</a></h3>
<p>Binding a single JavaScript value into a SQL <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">IN</span></code> clause is
easy:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">sql</span> <span class="o">=</span> <span class="sb">`SELECT last_name FROM employees WHERE first_name IN (:bv)`</span><span class="p">;</span>
<span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Christopher&#39;</span><span class="p">];</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">binds</span><span class="p">,</span> <span class="kd">function</span><span class="p">(...));</span>
</pre></div>
</div>
<p>But a common use case for a query <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">IN</span></code> clause is for multiple
values, for example when a web user selects multiple check-box options
and the query should match all chosen values.</p>
<p>Trying to associate multiple data values with a single bind parameter
will not work.  To use a fixed, small number of values in an <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">IN</span></code> bind clause, the SQL query should have individual bind parameters,
for example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`SELECT last_name FROM employees WHERE first_name IN (:bv1, :bv2, :bv3, :bv4)`</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Alyssa&#39;</span><span class="p">,</span> <span class="s1">&#39;Christopher&#39;</span><span class="p">,</span> <span class="s1">&#39;Hazel&#39;</span><span class="p">,</span> <span class="s1">&#39;Samuel&#39;</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">binds</span><span class="p">);</span>
</pre></div>
</div>
<p>If you sometimes execute the query with a smaller number of items, a
null can be bound for the ‘missing’ values:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Alyssa&#39;</span><span class="p">,</span> <span class="s1">&#39;Christopher&#39;</span><span class="p">,</span> <span class="s1">&#39;Hazel&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">];</span>
</pre></div>
</div>
<p>When the exact same statement text is re-executed many times
regardless of the number of user supplied values, you get performance
and scaling benefits from not having multiple, unique SQL statements
being run.</p>
<p>Another solution when the number of data items is only known at
runtime is to build up an exact SQL string like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Christopher&#39;</span><span class="p">,</span> <span class="s1">&#39;Hazel&#39;</span><span class="p">,</span> <span class="s1">&#39;Samuel&#39;</span><span class="p">];</span>
<span class="kd">let</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`SELECT first_name, last_name FROM employees WHERE first_name IN (`</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">binds</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
   <span class="nx">sql</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;, :&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">:</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
<span class="nx">sql</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This will construct a SQL statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="n">FROM</span> <span class="n">employees</span> <span class="n">WHERE</span> <span class="n">first_name</span> <span class="n">IN</span> <span class="p">(:</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Binds are still used for security.  But, depending how often this
query is executed, and how changeable the number of bind values is,
you can end up with lots of ‘unique’ query strings being executed.
You might not get the statement caching benefits that re-executing a
fixed SQL statement would have.</p>
<p>Another solution for a larger number of values is to construct a SQL
statement like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">...</span> <span class="n">WHERE</span> <span class="n">col</span> <span class="n">IN</span> <span class="p">(</span> <span class="o">&lt;</span><span class="n">something</span> <span class="n">that</span> <span class="n">returns</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">rows</span><span class="o">&gt;</span> <span class="p">)</span>
</pre></div>
</div>
<p>The easiest way to do the <code class="docutils literal notranslate"><span class="pre">&lt;something</span> <span class="pre">that</span> <span class="pre">returns</span> <span class="pre">a</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">rows&gt;</span></code>
will depend on how the data is initially represented and the number of
items.  You might look at using <code class="docutils literal notranslate"><span class="pre">CONNECT</span> <span class="pre">BY</span></code> or nested tables.  Or,
for really large numbers of items, you might prefer to use a global
temporary table.  Some solutions are given in <a class="reference external" href="http://www.oracle.com/technetwork/issue-archive/2007/07-mar/o27asktom-084983.html">On Cursors, SQL, and
Analytics</a> and in <a class="reference external" href="http://stackoverflow.com/a/43330282/4799035">this StackOverflow answer</a>.</p>
</div>
<div class="section" id="a-name-sqlbindtablename-a-20-7-binding-column-and-table-names-in-queries">
<h3><a name="sqlbindtablename"></a> 20.7 Binding Column and Table Names in Queries<a class="headerlink" href="#a-name-sqlbindtablename-a-20-7-binding-column-and-table-names-in-queries" title="Permalink to this headline">¶</a></h3>
<p>It is not possible to bind table names in queries.  Instead use a
hardcoded whitelist of names to build the final SQL statement, for
example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">validTables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LOCATIONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DEPARTMENTS&#39;</span><span class="p">];</span>

<span class="kr">const</span> <span class="nx">tableName</span> <span class="o">=</span> <span class="nx">getTableNameFromEndUser</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validTables</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">tableName</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Invalid table name&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="sb">`SELECT * FROM `</span> <span class="o">+</span> <span class="nx">tableName</span><span class="p">;</span>
</pre></div>
</div>
<p>The same technique can be used to construct the list of selected
column names.  Make sure to use a whitelist of names to avoid SQL
Injection security risks.</p>
<p>Each final SQL statement will obviously be distinct, and will use a
slot in the <a class="reference external" href="#stmtcache">statement cache</a>.</p>
<p>It is possible to bind column names used in an ORDER BY:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`SELECT first_name, last_name</span>
<span class="sb">             FROM employees</span>
<span class="sb">             ORDER BY</span>
<span class="sb">               CASE :ob</span>
<span class="sb">                 WHEN &#39;FIRST_NAME&#39; THEN first_name</span>
<span class="sb">                 ELSE last_name</span>
<span class="sb">               END`</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">columnName</span> <span class="o">=</span> <span class="nx">getColumnNameFromEndUser</span><span class="p">();</span>  <span class="c1">// your function</span>
<span class="kr">const</span> <span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span><span class="nx">columnName</span><span class="p">];</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">binds</span><span class="p">);</span>
</pre></div>
</div>
<p>In this example, when <code class="docutils literal notranslate"><span class="pre">columnName</span></code> is ‘FIRST_NAME’ then the result set
will be ordered by first name, otherwise the order will be by last
name.</p>
<p>You should analyze the statement usage patterns and optimizer query
plan before deciding whether to using binds like this, or to use
multiple hard-coded SQL statements, each with a different ORDER BY.</p>
</div>
</div>
<div class="section" id="a-name-objects-a-21-oracle-database-objects-and-collections">
<h2><a name="objects"></a> 21. Oracle Database Objects and Collections<a class="headerlink" href="#a-name-objects-a-21-oracle-database-objects-and-collections" title="Permalink to this headline">¶</a></h2>
<p>You can query and insert most Oracle Database objects and collections,
with some <a class="reference external" href="#objectlimitations">limitations</a>.</p>
<div class="section" id="a-name-objectinsert-a-21-1-inserting-objects">
<h3><a name="objectinsert"></a> 21.1 Inserting Objects<a class="headerlink" href="#a-name-objectinsert-a-21-1-inserting-objects" title="Permalink to this headline">¶</a></h3>
<p>As an example, the Oracle Spatial type <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-683FF8C5-A773-4018-932D-2AF6EC8BC119">SDO_GEOMETRY</a> can easily
be used in node-oracledb.  Describing SDO_GEOMETRY in SQL*Plus shows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 SDO_GTYPE                                          NUMBER
 SDO_SRID                                           NUMBER
 SDO_POINT                                          MDSYS.SDO_POINT_TYPE
 SDO_ELEM_INFO                                      MDSYS.SDO_ELEM_INFO_ARRAY
 SDO_ORDINATES                                      MDSYS.SDO_ORDINATE_ARRAY
</pre></div>
</div>
<p>In Node.js, a call to
<a class="reference external" href="#getdbobjectclass"><code class="docutils literal notranslate"><span class="pre">connection.getDbObjectClass()</span></code></a> returns a
<a class="reference external" href="#dbobjectclass">DbObject prototype object</a> representing the database
type:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">GeomType</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getDbObjectClass</span><span class="p">(</span><span class="s2">&quot;MDSYS.SDO_GEOMETRY&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">GeomType</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
</pre></div>
</div>
<p>This gives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DbObject</span> <span class="p">{</span>
  <span class="n">schema</span><span class="p">:</span> <span class="s1">&#39;MDSYS&#39;</span><span class="p">,</span>
  <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;SDO_GEOMETRY&#39;</span><span class="p">,</span>
  <span class="n">fqn</span><span class="p">:</span> <span class="s1">&#39;MDSYS.SDO_GEOMETRY&#39;</span><span class="p">,</span>
  <span class="n">attributes</span><span class="p">:</span>
   <span class="p">{</span> <span class="n">SDO_GTYPE</span><span class="p">:</span> <span class="p">{</span> <span class="nb">type</span><span class="p">:</span> <span class="mi">2010</span><span class="p">,</span> <span class="n">typeName</span><span class="p">:</span> <span class="s1">&#39;NUMBER&#39;</span> <span class="p">},</span>
     <span class="n">SDO_SRID</span><span class="p">:</span> <span class="p">{</span> <span class="nb">type</span><span class="p">:</span> <span class="mi">2010</span><span class="p">,</span> <span class="n">typeName</span><span class="p">:</span> <span class="s1">&#39;NUMBER&#39;</span> <span class="p">},</span>
     <span class="n">SDO_POINT</span><span class="p">:</span>
      <span class="p">{</span> <span class="nb">type</span><span class="p">:</span> <span class="mi">2023</span><span class="p">,</span>
        <span class="n">typeName</span><span class="p">:</span> <span class="s1">&#39;MDSYS.SDO_POINT_TYPE&#39;</span><span class="p">,</span>
        <span class="n">typeClass</span><span class="p">:</span> <span class="p">[</span><span class="n">Object</span><span class="p">]</span> <span class="p">},</span>
     <span class="n">SDO_ELEM_INFO</span><span class="p">:</span>
      <span class="p">{</span> <span class="nb">type</span><span class="p">:</span> <span class="mi">2023</span><span class="p">,</span>
        <span class="n">typeName</span><span class="p">:</span> <span class="s1">&#39;MDSYS.SDO_ELEM_INFO_ARRAY&#39;</span><span class="p">,</span>
        <span class="n">typeClass</span><span class="p">:</span> <span class="p">[</span><span class="n">Object</span><span class="p">]</span> <span class="p">},</span>
     <span class="n">SDO_ORDINATES</span><span class="p">:</span>
      <span class="p">{</span> <span class="nb">type</span><span class="p">:</span> <span class="mi">2023</span><span class="p">,</span>
        <span class="n">typeName</span><span class="p">:</span> <span class="s1">&#39;MDSYS.SDO_ORDINATE_ARRAY&#39;</span><span class="p">,</span>
        <span class="n">typeClass</span><span class="p">:</span> <span class="p">[</span><span class="n">Object</span><span class="p">]</span> <span class="p">}</span> <span class="p">},</span>
  <span class="n">isCollection</span><span class="p">:</span> <span class="n">false</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> value of 2023 corresponds to the <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_OBJECT</span></code>
constant.  The value 2010 corresponds to <code class="docutils literal notranslate"><span class="pre">oracledb.DB_TYPE_NUMBER</span></code>.</p>
<p>Now the object prototype has been found, an object can be created by
passing a JavaScript object to the constructor.  The case of the
attributes is important:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">geom</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GeomType</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">SDO_GTYPE</span><span class="o">:</span> <span class="mi">2003</span><span class="p">,</span>
    <span class="nx">SDO_SRID</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">SDO_POINT</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">SDO_ELEM_INFO</span><span class="o">:</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">3</span> <span class="p">],</span>
    <span class="nx">SDO_ORDINATES</span><span class="o">:</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Attributes not assigned values will default to null.  Extra attributes
set that are not present in the database object will be ignored.</p>
<p>An alternative to instantiating the whole object at once is to set
individual attributes:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">geom</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GeomType</span><span class="p">();</span>
<span class="nx">geom</span><span class="p">.</span><span class="nx">S_GTYPE</span> <span class="o">=</span> <span class="mi">2003</span><span class="p">;</span>
<span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>Once created, the DbObject in <code class="docutils literal notranslate"><span class="pre">geom</span></code> can then be bound for insertion.
For example, if TESTGEOMETRY was created as:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">testgeometry</span> <span class="p">(</span><span class="n">id</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">geometry</span> <span class="n">MDSYS</span><span class="p">.</span><span class="n">SDO_GEOMETRY</span><span class="p">)</span>
</pre></div>
</div>
<p>Then the INSERT statement would be:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO testgeometry (id, geometry) VALUES (:id, :g)`</span><span class="p">,</span>
  <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">g</span><span class="o">:</span> <span class="nx">geom</span><span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Node-oracledb automatically detects the type for <code class="docutils literal notranslate"><span class="pre">geom</span></code>.</p>
<p>Insertion can be simplified by setting the bind parameter <code class="docutils literal notranslate"><span class="pre">type</span></code> to
the name of the Oracle Database object and passing a JavaScript object
as the bind value:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO testgeometry (id, geometry) VALUES (:id, :g)`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">g</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;MDSYS.SDO_GEOMETRY&quot;</span><span class="p">,</span>
      <span class="nx">val</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">SDO_GTYPE</span><span class="o">:</span> <span class="mi">2003</span><span class="p">,</span>
              <span class="nx">SDO_SRID</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
              <span class="nx">SDO_POINT</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
              <span class="nx">SDO_ELEM_INFO</span><span class="o">:</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">3</span> <span class="p">],</span>
              <span class="nx">SDO_ORDINATES</span><span class="o">:</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
           <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>For objects that are nested, such as SDO_GEOMETRY is, you only need to
give the name of the top level object.</p>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/selectgeometry.js">selectgeometry.js</a> for a runnable example.</p>
<p>When handling multiple objects of the same type, then use fully
qualified names like “MDSYS.SDO_GEOMETRY” instead of “SDO_GEOMETRY”.
Alternatively retain, and use, the prototype object returned by
<a class="reference external" href="#getdbobjectclass"><code class="docutils literal notranslate"><span class="pre">connection.getDbObjectClass()</span></code></a>.  Node-oracledb
will cache type information using the type’s fully qualified name as
the key to avoid the expense of a <a class="reference external" href="#roundtrips">round-trip</a>, when
possible.  Each connection has its own cache.</p>
<p>When the definition of a type changes in the database, such as might
occur in a development environment, you should fully close connections
to clear the object caches used by node-oracledb and the Oracle client
libraries.  For example, when using a pool you could use <a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">connection.close({drop:</span> <span class="pre">true})</span></code></a>, or restart the
pool.  Then <code class="docutils literal notranslate"><span class="pre">getDbObjectClass()</span></code> can be called again to get the
updated type information.</p>
</div>
<div class="section" id="a-name-objectfetch-a-21-2-fetching-objects">
<h3><a name="objectfetch"></a> 21.2 Fetching Objects<a class="headerlink" href="#a-name-objectfetch-a-21-2-fetching-objects" title="Permalink to this headline">¶</a></h3>
<p>When objects are fetched, they are represented as a
<a class="reference external" href="#dbobjectclass">DbObject</a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT geometry FROM testgeometry WHERE id = 1`</span><span class="p">);</span>
<span class="nx">o</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
</pre></div>
</div>
<p>This gives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MDSYS</span><span class="o">.</span><span class="n">SDO_GEOMETRY</span><span class="p">]</span> <span class="p">{</span> <span class="n">SDO_GTYPE</span><span class="p">:</span> <span class="mi">2003</span><span class="p">,</span>
  <span class="n">SDO_SRID</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
  <span class="n">SDO_POINT</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
  <span class="n">SDO_ELEM_INFO</span><span class="p">:</span> <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">3</span> <span class="p">],</span>
  <span class="n">SDO_ORDINATES</span><span class="p">:</span> <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>The SDO_ELEM_INFO attribute is itself a DbObject.  The following code</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">SDO_ELEM_INFO</span><span class="p">);</span>
</pre></div>
</div>
<p>gives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MDSYS</span><span class="o">.</span><span class="n">SDO_ELEM_INFO_ARRAY</span><span class="p">]</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">3</span> <span class="p">]</span>
</pre></div>
</div>
<p>If a DbObject is for an Oracle Database collection, the
<a class="reference external" href="#dbobjattributesiscollection"><code class="docutils literal notranslate"><span class="pre">dbObject.isCollection</span></code></a> attribute will
be true.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">isCollection</span><span class="p">);</span>                <span class="c1">// false</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">SDO_ELEM_INFO</span><span class="p">.</span><span class="nx">isCollection</span><span class="p">);</span>  <span class="c1">// true</span>
</pre></div>
</div>
<p>For DbObjects representing Oracle collections, methods such as
<a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">dbObject.getKeys()</span></code></a> and
<a class="reference external" href="#dbobjectmethodscolls"><code class="docutils literal notranslate"><span class="pre">dbObject.getValues()</span></code></a> can be used:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">SDO_ELEM_INFO</span><span class="p">.</span><span class="nx">getKeys</span><span class="p">());</span>    <span class="c1">// [ 0, 1, 2 ]</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">SDO_ELEM_INFO</span><span class="p">.</span><span class="nx">getValues</span><span class="p">());</span>  <span class="c1">// [ 1, 1003, 3 ]</span>
</pre></div>
</div>
<p>The options <a class="reference external" href="#propdbfetchasbuffer"><code class="docutils literal notranslate"><span class="pre">fetchAsBuffer</span></code></a> and
<a class="reference external" href="#propdbfetchasstring"><code class="docutils literal notranslate"><span class="pre">fetchAsString</span></code></a> do not affect values in
objects queried from the database.</p>
<p>LOBs will be fetched as <a class="reference external" href="#lobclass">Lob objects</a>.  The
<a class="reference external" href="#lobgetdata"><code class="docutils literal notranslate"><span class="pre">lob.getData()</span></code></a> method is a convenient way to retrieve
the data.  Note it is an asynchronous method and requires a round-trip
to the database.</p>
</div>
<div class="section" id="a-name-plsqlcollections-a-21-3-pl-sql-collection-types">
<h3><a name="plsqlcollections"></a> 21.3 PL/SQL Collection Types<a class="headerlink" href="#a-name-plsqlcollections-a-21-3-pl-sql-collection-types" title="Permalink to this headline">¶</a></h3>
<p>PL/SQL has three collection types: associative arrays, VARRAY
(variable-size arrays), and nested tables.  See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-7E9034D5-0D33-43A1-9012-918350FE148C">Collection
Types</a> in the Database PL/SQL Language Reference.</p>
<div class="section" id="a-name-plsqlindexbybinds-a-21-3-1-pl-sql-collection-associative-arrays-index-by">
<h4><a name="plsqlindexbybinds"></a> 21.3.1 PL/SQL Collection Associative Arrays (Index-by)<a class="headerlink" href="#a-name-plsqlindexbybinds-a-21-3-1-pl-sql-collection-associative-arrays-index-by" title="Permalink to this headline">¶</a></h4>
<p>Arrays of strings and numbers can be bound to PL/SQL IN, IN OUT, and
OUT parameters of PL/SQL INDEX BY associative array types with integer
keys.  This Oracle type was formerly called PL/SQL tables or index-by
tables.</p>
<p>While you could bind associative arrays via named types as shown in previous
examples, it is more efficient to use the method shown below which uses the
type of each element, not the name of the associative array type.  Note that if
you use named types for BIND_IN, then the resulting arrays in PL/SQL will start
from index 0.  The method shown below results in indexes starting from 1.
(Using named type binding for nested tables and VARRAYs results in indexes
starting from 1).</p>
<p>Given this table and PL/SQL package:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">mytab</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mytab</span> <span class="p">(</span><span class="n">id</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">numcol</span> <span class="nb">NUMBER</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">mypkg</span> <span class="k">IS</span>
  <span class="k">TYPE</span> <span class="n">numtype</span> <span class="k">IS</span> <span class="k">TABLE</span> <span class="k">OF</span> <span class="nb">NUMBER</span> <span class="k">INDEX</span> <span class="k">BY</span> <span class="n">BINARY_INTEGER</span><span class="p">;</span>
  <span class="k">PROCEDURE</span> <span class="n">myinproc</span><span class="p">(</span><span class="n">p_id</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">vals</span> <span class="k">IN</span> <span class="n">numtype</span><span class="p">);</span>
  <span class="k">PROCEDURE</span> <span class="n">myoutproc</span><span class="p">(</span><span class="n">p_id</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">vals</span> <span class="k">OUT</span> <span class="n">numtype</span><span class="p">);</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">BODY</span> <span class="n">mypkg</span> <span class="k">IS</span>

  <span class="k">PROCEDURE</span> <span class="n">myinproc</span><span class="p">(</span><span class="n">p_id</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">vals</span> <span class="k">IN</span> <span class="n">numtype</span><span class="p">)</span> <span class="k">IS</span>
  <span class="k">BEGIN</span>
    <span class="n">FORALL</span> <span class="n">i</span> <span class="k">IN</span> <span class="n">INDICES</span> <span class="k">OF</span> <span class="n">vals</span>
      <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytab</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">numcol</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">p_id</span><span class="p">,</span> <span class="n">vals</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="k">END</span><span class="p">;</span>

  <span class="k">PROCEDURE</span> <span class="n">myoutproc</span><span class="p">(</span><span class="n">p_id</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">vals</span> <span class="k">OUT</span> <span class="n">numtype</span><span class="p">)</span> <span class="k">IS</span>
  <span class="k">BEGIN</span>
    <span class="k">SELECT</span> <span class="n">numcol</span> <span class="n">BULK</span> <span class="n">COLLECT</span> <span class="k">INTO</span> <span class="n">vals</span> <span class="k">FROM</span> <span class="n">mytab</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="n">p_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">END</span><span class="p">;</span>

<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>To bind an array in node-oracledb using “bind by name” syntax for
insertion into <code class="docutils literal notranslate"><span class="pre">mytab</span></code> use:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN mypkg.myinproc(:id, :vals); END;`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mi">1234</span><span class="p">,</span>
    <span class="nx">vals</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span>
             <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_IN</span><span class="p">,</span>
             <span class="nx">val</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
          <span class="p">}</span>
  <span class="p">});</span>
</pre></div>
</div>
<p>Alternatively, “bind by position” syntax can be used:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
 <span class="sb">`BEGIN mypkg.myinproc(:id, :vals); END;`</span><span class="p">,</span>
 <span class="p">[</span>
   <span class="mi">1234</span><span class="p">,</span>
   <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span>
      <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_IN</span><span class="p">,</span>
      <span class="nx">val</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
   <span class="p">}</span>
 <span class="p">]);</span>
</pre></div>
</div>
<p>After executing either of these <code class="docutils literal notranslate"><span class="pre">mytab</span></code> will contain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">ID</span>         <span class="n">NUMCOL</span>
<span class="o">----------</span> <span class="o">----------</span>
      <span class="mi">1234</span>          <span class="mi">1</span>
      <span class="mi">1234</span>          <span class="mi">2</span>
      <span class="mi">1234</span>         <span class="mi">23</span>
      <span class="mi">1234</span>          <span class="mi">4</span>
      <span class="mi">1234</span>         <span class="mi">10</span>
</pre></div>
</div>
<p>The <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">type</span></code></a> must be set for PL/SQL array binds.
It can be set to <a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code></a> or
<a class="reference external" href="#oracledbconstantsnodbtype"><code class="docutils literal notranslate"><span class="pre">oracledb.NUMBER</span></code></a>.</p>
<p>For OUT and IN OUT binds, the <a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code></a>
bind property must be set.  Its value is the maximum number of
elements that can be returned in an array.  An error will occur if the
PL/SQL block attempts to insert data beyond this limit.  If the PL/SQL
code returns fewer items, the JavaScript array will have the actual
number of data elements and will not contain null entries.  Setting
<code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code> larger than needed will cause unnecessary memory
allocation.</p>
<p>For IN OUT binds, <code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code> can be greater than the number of
elements in the input array.  This allows more values to be returned
than are passed in.</p>
<p>For IN binds, <code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code> is ignored, as also is <code class="docutils literal notranslate"><span class="pre">maxSize</span></code>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">oracledb.STRING</span></code> IN OUT or OUT binds, the string length
<a class="reference external" href="#executebindParams"><code class="docutils literal notranslate"><span class="pre">maxSize</span></code></a> property may be set.  If it is not set
the memory allocated per string will default to 200 bytes.  If the
value is not large enough to hold the longest string data item in the
collection a runtime error occurs.  To avoid unnecessary memory
allocation, do not let the size be larger than needed.</p>
<p>The next example fetches an array of values from a table.  First,
insert these values:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytab</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">numcol</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytab</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">numcol</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytab</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">numcol</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="k">COMMIT</span><span class="p">;</span>
</pre></div>
</div>
<p>With these values, the following node-oracledb code will print <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">10,</span> <span class="pre">25,</span> <span class="pre">50</span> <span class="pre">]</span></code>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`BEGIN mypkg.myoutproc(:id, :vals); END;`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mi">99</span><span class="p">,</span>
    <span class="nx">vals</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span>
            <span class="nx">dir</span><span class="o">:</span>  <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span>
            <span class="nx">maxArraySize</span><span class="o">:</span> <span class="mi">10</span>          <span class="c1">// allocate memory to hold 10 numbers</span>
        <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">vals</span><span class="p">);</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">maxArraySize</span></code> was reduced to <code class="docutils literal notranslate"><span class="pre">2</span></code>, the script would fail with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ORA</span><span class="o">-</span><span class="mi">06513</span><span class="p">:</span> <span class="n">PL</span><span class="o">/</span><span class="n">SQL</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">PL</span><span class="o">/</span><span class="n">SQL</span> <span class="n">table</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span> <span class="k">for</span> <span class="n">host</span> <span class="n">language</span> <span class="n">array</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#oracledbconstants">Oracledb Constants</a> and <a class="reference external" href="#executebindParams">execute(): Bind
Parameters</a> for more information about binding.</p>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/plsqlarray.js">plsqlarray.js</a> for a runnable example.</p>
</div>
<div class="section" id="a-name-plsqlvarray-a-21-3-2-pl-sql-collection-varray-types">
<h4><a name="plsqlvarray"></a> 21.3.2 PL/SQL Collection VARRAY Types<a class="headerlink" href="#a-name-plsqlvarray-a-21-3-2-pl-sql-collection-varray-types" title="Permalink to this headline">¶</a></h4>
<p>Given a table with a VARRAY column:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TYPE</span> <span class="n">playertype</span> <span class="k">AS</span> <span class="k">OBJECT</span> <span class="p">(</span>
    <span class="n">shirtnumber</span>  <span class="nb">NUMBER</span><span class="p">,</span>
    <span class="n">name</span>         <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
<span class="o">/</span>

<span class="k">CREATE</span> <span class="k">TYPE</span> <span class="n">teamtype</span> <span class="k">AS</span> <span class="n">VARRAY</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">OF</span> <span class="n">playertype</span><span class="p">;</span>
<span class="o">/</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sports</span> <span class="p">(</span><span class="n">sportname</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">team</span> <span class="n">teamtype</span><span class="p">);</span>
</pre></div>
</div>
<p>You can insert values using:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO sports (sportname, team) VALUES (:sn, :t)`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">sn</span><span class="o">:</span> <span class="s2">&quot;Hockey&quot;</span><span class="p">,</span>
    <span class="nx">t</span><span class="o">:</span>
    <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;TEAMTYPE&quot;</span><span class="p">,</span>
      <span class="nx">val</span><span class="o">:</span>
      <span class="p">[</span>
        <span class="p">{</span><span class="nx">SHIRTNUMBER</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Georgia&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="nx">SHIRTNUMBER</span><span class="o">:</span> <span class="mi">22</span><span class="p">,</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Harriet&#39;</span><span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Alternatively:</span>

<span class="nx">TeamTypeClass</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getDbObjectClass</span><span class="p">(</span><span class="s2">&quot;TEAMTYPE&quot;</span><span class="p">);</span>

<span class="nx">hockeyTeam</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TeamTypeClass</span><span class="p">(</span>
  <span class="p">[</span>
    <span class="p">{</span><span class="nx">SHIRTNUMBER</span><span class="o">:</span> <span class="mi">22</span><span class="p">,</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Elizabeth&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">SHIRTNUMBER</span><span class="o">:</span> <span class="mi">33</span><span class="p">,</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Frank&#39;</span><span class="p">},</span>
  <span class="p">]</span>
<span class="p">);</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`INSERT INTO sports (sportname, team) VALUES (:sn, :t)`</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">sn</span><span class="o">:</span> <span class="s2">&quot;Hockey&quot;</span><span class="p">,</span>
    <span class="nx">t</span><span class="o">:</span> <span class="nx">hockeyTeam</span>
  <span class="p">});</span>
</pre></div>
</div>
<p>Querying the table could be done like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
  <span class="sb">`SELECT sportname, team FROM sports`</span><span class="p">,</span>
  <span class="p">[],</span>
  <span class="p">{</span>
    <span class="nx">outFormat</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">OUT_FORMAT_OBJECT</span>
  <span class="p">}</span>
<span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="nx">row</span> <span class="k">of</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The &quot;</span> <span class="o">+</span> <span class="nx">row</span><span class="p">.</span><span class="nx">SPORTNAME</span> <span class="o">+</span> <span class="s2">&quot; team players are:&quot;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">player</span> <span class="k">of</span> <span class="nx">row</span><span class="p">.</span><span class="nx">TEAM</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="nx">player</span><span class="p">.</span><span class="nx">NAME</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The output would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">Hockey</span> <span class="n">team</span> <span class="n">players</span> <span class="n">are</span><span class="p">:</span>
  <span class="n">Elizabeth</span>
  <span class="n">Frank</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/selectvarray.js">selectvarray.js</a> for a runnable example.</p>
</div>
<div class="section" id="a-name-plsqlnestedtables-a-21-3-3-pl-sql-collection-nested-tables">
<h4><a name="plsqlnestedtables"></a> 21.3.3 PL/SQL Collection Nested Tables<a class="headerlink" href="#a-name-plsqlnestedtables-a-21-3-3-pl-sql-collection-nested-tables" title="Permalink to this headline">¶</a></h4>
<p>Given a nested table <code class="docutils literal notranslate"><span class="pre">staffList</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">bonuses</span> <span class="p">(</span><span class="n">id</span> <span class="nb">NUMBER</span><span class="p">,</span> <span class="n">name</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">personnel</span> <span class="k">AS</span>
  <span class="k">TYPE</span> <span class="n">staffList</span> <span class="k">IS</span> <span class="k">TABLE</span> <span class="k">OF</span> <span class="n">bonuses</span><span class="o">%</span><span class="n">ROWTYPE</span><span class="p">;</span>
  <span class="k">PROCEDURE</span> <span class="n">awardBonuses</span> <span class="p">(</span><span class="n">goodStaff</span> <span class="n">staffList</span><span class="p">);</span>
<span class="k">END</span> <span class="n">personnel</span><span class="p">;</span>
<span class="o">/</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">BODY</span> <span class="n">personnel</span> <span class="k">AS</span>
  <span class="k">PROCEDURE</span> <span class="n">awardBonuses</span> <span class="p">(</span><span class="n">goodStaff</span> <span class="n">staffList</span><span class="p">)</span> <span class="k">IS</span>
  <span class="k">BEGIN</span>
    <span class="n">FORALL</span> <span class="n">i</span> <span class="k">IN</span> <span class="n">INDICES</span> <span class="k">OF</span> <span class="n">goodStaff</span>
      <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">bonuses</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">goodStaff</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">id</span><span class="p">,</span> <span class="n">goodStaff</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">name</span><span class="p">);</span>
  <span class="k">END</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>you can call <code class="docutils literal notranslate"><span class="pre">awardBonuses()</span></code> like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">plsql</span> <span class="o">=</span> <span class="sb">`CALL personnel.awardBonuses(:gsbv)`</span><span class="p">;</span>

<span class="nx">binds</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">gsbv</span><span class="o">:</span>
  <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;PERSONNEL.STAFFLIST&quot;</span><span class="p">,</span>
    <span class="nx">val</span><span class="o">:</span>
      <span class="p">[</span>
        <span class="p">{</span><span class="nx">ID</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Chris&#39;</span> <span class="p">},</span>
        <span class="p">{</span><span class="nx">ID</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Sam&#39;</span> <span class="p">}</span>
      <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">plsql</span><span class="p">,</span> <span class="nx">binds</span><span class="p">);</span>
</pre></div>
</div>
<p>Similar with other objects, calling
<a class="reference external" href="#getdbobjectclass"><code class="docutils literal notranslate"><span class="pre">getDbObjectClass()</span></code></a> and using a constructor to
create a <code class="docutils literal notranslate"><span class="pre">DbObject</span></code> for binding can also be used.</p>
</div>
</div>
<div class="section" id="a-name-plsqlrecords-a-21-4-pl-sql-record-types">
<h3><a name="plsqlrecords"></a> 21.4 PL/SQL RECORD Types<a class="headerlink" href="#a-name-plsqlrecords-a-21-4-pl-sql-record-types" title="Permalink to this headline">¶</a></h3>
<p>PL/SQL RECORDS can be bound for insertion and retrieval.  This example
uses the PL/SQL package:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">seachange</span> <span class="k">AS</span>
  <span class="k">TYPE</span> <span class="n">shiptype</span> <span class="k">IS</span> <span class="n">RECORD</span> <span class="p">(</span><span class="n">shipname</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span> <span class="n">weight</span> <span class="nb">NUMBER</span><span class="p">);</span>
  <span class="k">PROCEDURE</span> <span class="n">biggership</span> <span class="p">(</span><span class="n">p_in</span> <span class="k">IN</span> <span class="n">shiptype</span><span class="p">,</span> <span class="n">p_out</span> <span class="k">OUT</span> <span class="n">shiptype</span><span class="p">);</span>
<span class="k">END</span> <span class="n">seachange</span><span class="p">;</span>
<span class="o">/</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">BODY</span> <span class="n">seachange</span> <span class="k">AS</span>
  <span class="k">PROCEDURE</span> <span class="n">biggership</span> <span class="p">(</span><span class="n">p_in</span> <span class="k">IN</span> <span class="n">shiptype</span><span class="p">,</span> <span class="n">p_out</span> <span class="k">OUT</span> <span class="n">shiptype</span><span class="p">)</span> <span class="k">AS</span>
  <span class="k">BEGIN</span>
     <span class="n">p_out</span> <span class="p">:</span><span class="o">=</span> <span class="n">p_in</span><span class="p">;</span>
     <span class="n">p_out</span><span class="p">.</span><span class="n">weight</span> <span class="p">:</span><span class="o">=</span> <span class="n">p_out</span><span class="p">.</span><span class="n">weight</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">END</span><span class="p">;</span>
<span class="k">END</span> <span class="n">seachange</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>Similar to previous examples, you can use a prototype DbObject from
<code class="docutils literal notranslate"><span class="pre">getdbobjectclass()</span></code> for binding, or pass an Oracle type name.</p>
<p>Below a prototype object for the SHIPTYPE record is returned from
<code class="docutils literal notranslate"><span class="pre">getDbObjectClass()</span></code> and then a new object <code class="docutils literal notranslate"><span class="pre">vessel</span></code> is created for a
ship.  This is bound for input when calling the BIGGERSHIP procedure.
To retrieve a SHIPTYPE record back from the the PL/SQL, the prototype
object class is passed for the output bind <code class="docutils literal notranslate"><span class="pre">type</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">ShipTypeClass</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getDbObjectClass</span><span class="p">(</span><span class="s2">&quot;SEACHANGE.SHIPTYPE&quot;</span><span class="p">);</span>

<span class="nx">vessel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ShipTypeClass</span><span class="p">({</span> <span class="nx">SHIPNAME</span><span class="o">:</span> <span class="s1">&#39;BoatFace&#39;</span><span class="p">,</span> <span class="nx">WEIGHT</span><span class="o">:</span> <span class="mi">1200</span> <span class="p">});</span>

<span class="nx">binds</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">inbv</span><span class="o">:</span> <span class="nx">vessel</span><span class="p">,</span>
  <span class="nx">outbv</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">ShipTypeClass</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">}</span>
<span class="p">};</span>

<span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`CALL seachange.biggership(:inbv, :outbv)`</span><span class="p">,</span> <span class="nx">binds</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">outbv</span><span class="p">.</span><span class="nx">SHIPNAME</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">.</span><span class="nx">outbv</span><span class="p">.</span><span class="nx">WEIGHT</span><span class="p">);</span>
</pre></div>
</div>
<p>The output shows the increased ship size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BoatFace</span> <span class="mi">2400</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/plsqlrecord.js">plsqlrecord.js</a> for a runnable example.</p>
</div>
<div class="section" id="a-name-objexecmany-a-21-5-inserting-or-passing-multiple-objects-of-the-same-type">
<h3><a name="objexecmany"></a> 21.5 Inserting or Passing Multiple Objects of the Same Type<a class="headerlink" href="#a-name-objexecmany-a-21-5-inserting-or-passing-multiple-objects-of-the-same-type" title="Permalink to this headline">¶</a></h3>
<p>You can use <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> with objects.  See <a class="reference external" href="#executemanyobjects">Binding Objects with
<code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a>.</p>
</div>
<div class="section" id="a-name-objectlimitations-a-21-6-oracle-database-object-type-limitations">
<h3><a name="objectlimitations"></a> 21.6 Oracle Database Object Type Limitations<a class="headerlink" href="#a-name-objectlimitations-a-21-6-oracle-database-object-type-limitations" title="Permalink to this headline">¶</a></h3>
<p>PL/SQL collections and records can only be bound when both Oracle
client libraries and Oracle Database are 12.1, or higher.</p>
<p>PL/SQL Collection associative array (Index-by) types with INDEX BY
VARCHAR2, or VARCHAR2 sub-types, cannot be used natively by
node-oracledb.</p>
<p>Subclasses of types are not supported.</p>
<p>Oracle objects with REF references are not supported.</p>
<p>Where there is no native support, use a PL/SQL wrapper that accepts
types supported by node-oracledb and converts them to the required
Oracle Database type.</p>
</div>
</div>
<div class="section" id="a-name-batchexecution-a-22-batch-statement-execution-and-bulk-loading">
<h2><a name="batchexecution"></a> 22. Batch Statement Execution and Bulk Loading<a class="headerlink" href="#a-name-batchexecution-a-22-batch-statement-execution-and-bulk-loading" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="#executemany"><code class="docutils literal notranslate"><span class="pre">connection.executeMany()</span></code></a> method allows many sets
of data values to be bound to one DML or PL/SQL statement for
execution.  It is like calling <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">connection.execute()</span></code></a>
multiple times but requires fewer <a class="reference external" href="#roundtrips">round-trips</a>.  This is
an efficient way to handle batch changes, for example when doing bulk
inserts, or for updating multiple rows.  The method cannot be used for
queries.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> method supports IN, IN OUT and OUT binds for most
data types except <a class="reference external" href="#plsqlindexbybinds">PL/SQL Collection Associative
Arrays</a>.</p>
<p>There are runnable examples in the GitHub <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples">examples</a> directory.</p>
<p>For example, to insert three records into the database:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`INSERT INTO mytab VALUES (:a, :b)`</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="s2">&quot;One&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="s2">&quot;Two&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="s2">&quot;Three&quot;</span> <span class="p">}</span>
<span class="p">];</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">autoCommit</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">bindDefs</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">a</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">},</span>
    <span class="nx">b</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">executeMany</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">binds</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rowsAffected</span><span class="p">);</span>  <span class="c1">// 3</span>
</pre></div>
</div>
<p>Strings and Buffers require a <code class="docutils literal notranslate"><span class="pre">maxSize</span></code> value in <code class="docutils literal notranslate"><span class="pre">bindDefs</span></code>.  It must
be the length (or greater) of the longest data value.  For efficiency,
keep the size as small as possible.</p>
<p>The <a class="reference external" href="#executemanyoptions"><code class="docutils literal notranslate"><span class="pre">options</span></code></a> parameter is optional.</p>
<p>If <a class="reference external" href="#executemanyoptbinddefs"><code class="docutils literal notranslate"><span class="pre">bindDefs</span></code></a> is not set, then the bind
direction is assumed to be IN, and the <a class="reference external" href="#executemanybinds">bind data</a>
are used to determine the bind variable types, names and maximum
sizes.  Using <code class="docutils literal notranslate"><span class="pre">bindDefs</span></code> is generally recommended because it removes
the overhead of scanning all records.</p>
<p>The bind definitions <code class="docutils literal notranslate"><span class="pre">bindDefs</span></code> can also use “bind by position”
syntax, see the next examples.</p>
<div class="section" id="identifying-affected-rows-with-executemany">
<h3>Identifying Affected Rows with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code><a class="headerlink" href="#identifying-affected-rows-with-executemany" title="Permalink to this headline">¶</a></h3>
<p>When executing a DML statement the number of database rows affected
for each input record can be shown by setting
<a class="reference external" href="#execmanydmlrowscounts"><code class="docutils literal notranslate"><span class="pre">dmlRowCounts</span></code></a>.  For example when deleting
rows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`DELETE FROM tab WHERE id = :1`</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="mi">20</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">30</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">40</span><span class="p">]</span>
<span class="p">];</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">dmlRowCounts</span><span class="o">:</span> <span class="kc">true</span> <span class="p">};</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">executeMany</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">binds</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">dmlRowCounts</span><span class="p">);</span>
</pre></div>
</div>
<p>If the table originally contained three rows with id of 20, five rows
with id of 30 and six rows with id of 40, then the output would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-handlingbatcherrors-a-handling-data-errors-with-executemany">
<h3><a name="handlingbatcherrors"></a> Handling Data Errors with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code><a class="headerlink" href="#a-name-handlingbatcherrors-a-handling-data-errors-with-executemany" title="Permalink to this headline">¶</a></h3>
<p>With large sets of data, it can be helpful not to abort processing on
the first data error, but to continue processing and resolve the
errors later.</p>
<p>When <a class="reference external" href="#executemanyoptbatcherrors"><code class="docutils literal notranslate"><span class="pre">batchErrors</span></code></a> is <em>true</em>, processing
will continue even if there are data errors in some records.  The
<code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> callback error parameter is not set.  Instead, an
array containing each error will be returned in the callback <code class="docutils literal notranslate"><span class="pre">result</span></code>
parameter.  All valid data records will be processed and a transaction
will be started but not committed, even if <code class="docutils literal notranslate"><span class="pre">autoCommit</span></code> is <em>true</em>.
The application can examine the errors, take action, and explicitly
commit or rollback, as desired.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const sql = `INSERT INTO childtab VALUES (:1, :2, :3)`;

const binds = [
  [1016, 10, &quot;Child 2 of Parent A&quot;],
  [1017, 10, &quot;Child 3 of Parent A&quot;],
  [1018, 20, &quot;Child 4 of Parent B&quot;],
  [1018, 20, &quot;Child 4 of Parent B&quot;],   // duplicate key
  [1019, 30, &quot;Child 3 of Parent C&quot;],
  [1020, 40, &quot;Child 4 of Parent D&quot;],
  [1021, 75, &quot;Child 1 of Parent F&quot;],   // parent does not exist
  [1022, 40, &quot;Child 6 of Parent D&quot;]
];

const options = {
  autoCommit: true,
  batchErrors: true,
  bindDefs: [
    { type: oracledb.NUMBER },
    { type: oracledb.NUMBER },
    { type: oracledb.STRING, maxSize: 20 }
  ]
};

const result = await connection.executeMany(sql, binds, options);

console.log(result.batchErrors);
</pre></div>
</div>
<p>The output is an array of <a class="reference external" href="#errorobj">error objects</a> that were
reported during execution.  The <code class="docutils literal notranslate"><span class="pre">offset</span></code> property corresponds to the
0-based index of the <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> <a class="reference external" href="#executemanybinds">binds
parameter</a> array, indicating which record could not
be processed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">{</span> <span class="n">Error</span><span class="p">:</span> <span class="n">ORA</span><span class="o">-</span><span class="mi">00001</span><span class="p">:</span> <span class="n">unique</span> <span class="n">constraint</span> <span class="p">(</span><span class="n">HR</span><span class="o">.</span><span class="n">CHILDTAB_PK</span><span class="p">)</span> <span class="n">violated</span> <span class="n">errorNum</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="mi">3</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">Error</span><span class="p">:</span> <span class="n">ORA</span><span class="o">-</span><span class="mi">02291</span><span class="p">:</span> <span class="n">integrity</span> <span class="n">constraint</span> <span class="p">(</span><span class="n">HR</span><span class="o">.</span><span class="n">CHILDTAB_FK</span><span class="p">)</span> <span class="n">violated</span> <span class="o">-</span> <span class="n">parent</span> <span class="n">key</span> <span class="ow">not</span> <span class="n">found</span> <span class="n">errorNum</span><span class="p">:</span> <span class="mi">2291</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="mi">6</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<p>Note that some classes of error will always return via the
<code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> callback error object, not as batch errors.  No
transaction is created in this case.  This includes errors where
string or buffer data is larger than the specified
<a class="reference external" href="#executemanyoptbinddefs"><code class="docutils literal notranslate"><span class="pre">maxSize</span></code></a> value.</p>
</div>
<div class="section" id="dml-returning-with-executemany">
<h3>DML RETURNING with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code><a class="headerlink" href="#dml-returning-with-executemany" title="Permalink to this headline">¶</a></h3>
<p>Values can be returned with DML RETURNING syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const sql = `INSERT INTO tab VALUES (:1) RETURNING ROWID INTO :2`;

const binds = [
  [&quot;One&quot;],
  [&quot;Two&quot;],
  [&quot;Three&quot;]
];

const options = {
  bindDefs: [
    { type: oracledb.STRING, maxSize: 5 },
    { type: oracledb.STRING, maxSize: 18, dir: oracledb.BIND_OUT  },
  ]
};

const result = await connection.executeMany(sql, binds, options);

console.log(result.outBinds);
</pre></div>
</div>
<p>Output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="p">[</span> <span class="s1">&#39;AAAmI9AAMAAAAnVAAA&#39;</span> <span class="p">]</span> <span class="p">],</span>
  <span class="p">[</span> <span class="p">[</span> <span class="s1">&#39;AAAmI9AAMAAAAnVAAB&#39;</span> <span class="p">]</span> <span class="p">],</span>
  <span class="p">[</span> <span class="p">[</span> <span class="s1">&#39;AAAmI9AAMAAAAnVAAC&#39;</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="calling-pl-sql-with-executemany">
<h3>Calling PL/SQL with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code><a class="headerlink" href="#calling-pl-sql-with-executemany" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> method can be used to execute a PL/SQL statement
multiple times with different input values.  For example, the
following PL/SQL procedure:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">testproc</span> <span class="p">(</span>
  <span class="n">a_num</span> <span class="k">IN</span> <span class="nb">NUMBER</span><span class="p">,</span>
  <span class="n">a_outnum</span> <span class="k">OUT</span> <span class="nb">NUMBER</span><span class="p">,</span>
  <span class="n">a_outstr</span> <span class="k">OUT</span> <span class="n">VARCHAR2</span><span class="p">)</span>
<span class="k">AS</span>
<span class="k">BEGIN</span>
  <span class="n">a_outnum</span> <span class="p">:</span><span class="o">=</span> <span class="n">a_num</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">FOR</span> <span class="n">i</span> <span class="k">IN</span> <span class="mi">1</span><span class="p">..</span><span class="n">a_num</span> <span class="n">LOOP</span>
    <span class="n">a_outstr</span> <span class="p">:</span><span class="o">=</span> <span class="n">a_outstr</span> <span class="o">||</span> <span class="s1">&#39;X&#39;</span><span class="p">;</span>
  <span class="k">END</span> <span class="n">LOOP</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>can be called like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`BEGIN testproc(:1, :2, :3); END;`</span><span class="p">;</span>

<span class="c1">// IN binds</span>
<span class="kr">const</span> <span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="p">];</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">bindDefs</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">20</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">executeMany</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">binds</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">);</span>
</pre></div>
</div>
<p>The returned bind values are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span> <span class="p">],</span>
  <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;XX&#39;</span> <span class="p">],</span>
  <span class="p">[</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;XXX&#39;</span> <span class="p">],</span>
  <span class="p">[</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;XXXX&#39;</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>The variant of <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> that accepts a number of iterations is
useful when there no bind values, or only OUT bind values.  This
example calls a PL/SQL block eight times:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">plsql</span> <span class="o">=</span> <span class="sb">`DECLARE</span>
<span class="sb">                 t_id NUMBER;</span>
<span class="sb">               BEGIN</span>
<span class="sb">                 SELECT NVL(COUNT(*), 0) + 1 INTO t_id FROM testtable;</span>
<span class="sb">                 INSERT INTO testtable VALUES (t_id, &#39;Test String &#39; || t_id);</span>
<span class="sb">                 SELECT SUM(id) INTO :1 FROM testtable;</span>
<span class="sb">               END;`</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">bindDefs</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">type</span> <span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span><span class="p">,</span> <span class="nx">dir</span> <span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">numIterations</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">executeMany</span><span class="p">(</span><span class="nx">plsql</span><span class="p">,</span> <span class="nx">numIterations</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">);</span>
</pre></div>
</div>
<p>Output would be an array of eight values such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="mi">6</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">10</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">15</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">21</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">28</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">36</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">45</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">55</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-executemanyobjects-a-binding-objects-with-executemany">
<h3><a name="executemanyobjects"></a> Binding Objects with <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code><a class="headerlink" href="#a-name-executemanyobjects-a-binding-objects-with-executemany" title="Permalink to this headline">¶</a></h3>
<p>You can use <code class="docutils literal notranslate"><span class="pre">executeMany()</span></code> with <a class="reference external" href="#objects">Oracle Database objects</a>.
For example, given a procedure <code class="docutils literal notranslate"><span class="pre">myproc</span></code> that accepts and returns a
RECORD:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">PACKAGE</span> <span class="n">rectest</span> <span class="k">AS</span>
   <span class="k">TYPE</span> <span class="n">rectype</span> <span class="k">IS</span> <span class="n">RECORD</span> <span class="p">(</span><span class="n">name</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span> <span class="n">pos</span> <span class="nb">NUMBER</span><span class="p">);</span>
   <span class="k">PROCEDURE</span> <span class="n">myproc</span> <span class="p">(</span><span class="n">p_in</span> <span class="k">IN</span> <span class="n">rectype</span><span class="p">,</span> <span class="n">p_out</span> <span class="k">OUT</span> <span class="n">rectype</span><span class="p">);</span>
<span class="k">END</span> <span class="n">rectest</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>This can be called like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">RectypeClass</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getDbObjectClass</span><span class="p">(</span><span class="s2">&quot;RECTEST.RECTYPE&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">plsql</span> <span class="o">=</span> <span class="sb">`CALL rectest.myproc(:inbv, :outbv)`</span><span class="p">;</span>

<span class="c1">// Input data</span>
<span class="nx">binds</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">inbv</span><span class="o">:</span> <span class="p">{</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Car&#39;</span><span class="p">,</span> <span class="nx">POS</span><span class="o">:</span> <span class="mi">56</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">inbv</span><span class="o">:</span> <span class="p">{</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="nx">POS</span><span class="o">:</span> <span class="mi">78</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">inbv</span><span class="o">:</span> <span class="p">{</span> <span class="nx">NAME</span><span class="o">:</span> <span class="s1">&#39;Bike&#39;</span><span class="p">,</span> <span class="nx">POS</span><span class="o">:</span> <span class="mi">83</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">];</span>

<span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">bindDefs</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">inbv</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">RectypeClass</span> <span class="p">},</span>
    <span class="nx">outbv</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">RectypeClass</span><span class="p">,</span> <span class="nx">dir</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">BIND_OUT</span> <span class="p">},</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">executeMany</span><span class="p">(</span><span class="nx">plsql</span><span class="p">,</span> <span class="nx">binds</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">b</span> <span class="k">of</span> <span class="nx">result</span><span class="p">.</span><span class="nx">outBinds</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">outbv</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each value to be bound to <code class="docutils literal notranslate"><span class="pre">inbv</span></code> is a record’s data.  The attribute
names correspond to the attributes of the PL/SQL record type using
Oracle Database’s standard casing rules.  Since <code class="docutils literal notranslate"><span class="pre">rectype</span></code> was created
with case insensitive names, these are represented as uppercase
attribute names in the JavaScript objects</p>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/plsqlrecord.js">examples/plsqlrecord.js</a> for a runnable sample.</p>
</div>
</div>
<div class="section" id="a-name-transactionmgt-a-23-transaction-management">
<h2><a name="transactionmgt"></a> 23. Transaction Management<a class="headerlink" href="#a-name-transactionmgt-a-23-transaction-management" title="Permalink to this headline">¶</a></h2>
<p>By default, <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-2E008D4A-F6FD-4F34-9071-7E10419CA24D">DML</a> statements are not committed in node-oracledb.</p>
<p>The node-oracledb add-on implements <a class="reference external" href="#commit"><code class="docutils literal notranslate"><span class="pre">commit()</span></code></a> and
<a class="reference external" href="#rollback"><code class="docutils literal notranslate"><span class="pre">rollback()</span></code></a> methods that can be used to explicitly
control transactions.</p>
<p>If the <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">autoCommit</span></code></a> flag is set to <em>true</em>, then
a commit occurs at the end of each <code class="docutils literal notranslate"><span class="pre">execute()</span></code> call.  Unlike an
explicit <code class="docutils literal notranslate"><span class="pre">commit()</span></code>, this does not require a <a class="reference external" href="#roundtrips">round-trip</a>
to the database.  For maximum efficiency, set <code class="docutils literal notranslate"><span class="pre">autoCommit</span></code> to <em>true</em>
for the last <code class="docutils literal notranslate"><span class="pre">execute()</span></code> call of a transaction in preference to using
an additional, explicit <code class="docutils literal notranslate"><span class="pre">commit()</span></code> call.</p>
<p>When a connection is released, any ongoing transaction will be rolled
back.  Therefore if a released, pooled connection is re-used by a
subsequent <a class="reference external" href="#getconnectionpool"><code class="docutils literal notranslate"><span class="pre">pool.getConnection()</span></code></a> call (or
<a class="reference external" href="#getconnectiondb"><code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code></a> call that uses a pool),
then any DML statements performed on the obtained connection are
always in a new transaction.</p>
<p>When an application ends, any uncommitted transaction on a connection
will be rolled back.</p>
<p>Note: Oracle Database will implicitly commit when a <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-FD9A8CB4-6B9A-44E5-B114-EFB8DA76FC88">DDL</a>
statement is executed irrespective of the value of <code class="docutils literal notranslate"><span class="pre">autoCommit</span></code>.</p>
</div>
<div class="section" id="a-name-stmtcache-a-24-statement-caching">
<h2><a name="stmtcache"></a> 24. Statement Caching<a class="headerlink" href="#a-name-stmtcache-a-24-statement-caching" title="Permalink to this headline">¶</a></h2>
<p>Node-oracledb’s <a class="reference external" href="#execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a> and
<a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a> methods use the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-4947CAE8-1F00-4897-BB2B-7F921E495175">Oracle Call Interface
statement cache</a> to make re-execution of statements efficient.
This cache removes the need for the separate ‘prepare’ or ‘parse’
method which is sometimes seen in other Oracle APIs: there is no
separate method in node-oracledb.</p>
<p>Each non-pooled connection and each session in the connection pool has
its own cache of statements with a default size of 30.  Statement
caching lets cursors be used without re-parsing the statement.
Statement caching also reduces meta data transfer costs between the
node-oracledb and the database.  Performance and scalability are
improved.</p>
<p>In general, set the statement cache to the size of the working set of
statements being executed by the application.</p>
<p>Statement caching can be disabled by setting the size to 0.  Disabling
the cache may be beneficial when the quantity or order of statements
causes cache entries to be flushed before they get a chance to be
reused.  For example if there are more distinct statements than cache
slots, and the order of statement execution causes older statements to
be flushed from the cache before the statements are re-executed.</p>
<p>The statement cache size can be set globally with <a class="reference external" href="#propdbstmtcachesize">stmtCacheSize</a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">stmtCacheSize</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
</pre></div>
</div>
<p>The value can be overridden in an <code class="docutils literal notranslate"><span class="pre">oracledb.getConnection()</span></code> call:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// the hr schema password</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span><span class="p">,</span>
    <span class="nx">stmtCacheSize</span> <span class="o">:</span> <span class="mi">40</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The value can also be overridden in the <code class="docutils literal notranslate"><span class="pre">poolAttrs</span></code> parameter to
the <a class="reference external" href="#createpool"><code class="docutils literal notranslate"><span class="pre">createPool()</span></code></a> method.</p>
<p>With Oracle Database 12c, or later, the statement cache size can be
automatically tuned with the <a class="reference external" href="#oraaccess">Oracle Client Configuration</a>
<code class="docutils literal notranslate"><span class="pre">oraaccess.xml</span></code> file.</p>
<p>To manually tune the statement cache size, monitor general application
load and the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-56AEF38E-9400-427B-A818-EDEC145F7ACD">Automatic Workload Repository</a> (AWR) “bytes sent via SQL*Net to client” values.  The
latter statistic should benefit from not shipping statement metadata
to node-oracledb.  Adjust the statement cache size to your
satisfaction.</p>
</div>
<div class="section" id="a-name-cqn-a-25-continuous-query-notification-cqn">
<h2><a name="cqn"></a> 25. Continuous Query Notification (CQN)<a class="headerlink" href="#a-name-cqn-a-25-continuous-query-notification-cqn" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35">Continuous Query Notification (CQN)</a> lets node-oracledb
applications register a JavaScript method that is invoked when changed
data is committed to the database, regardless of the user or the
application that made the change.  For example your application may be
interested in knowing if a table used for lookup data has changed so
the application can update a local cache of that table.</p>
<p>CQN is suitable for infrequently modified tables.  It is recommended
to avoid frequent subscription and unsubscription.</p>
<p>The connection must be created with <a class="reference external" href="#propdbevents"><code class="docutils literal notranslate"><span class="pre">events</span></code></a> mode
<em>true</em>.</p>
<p>The database must be able to connect to the node-oracledb machine for
notifications to be received.  Typically this means that the machine
running node-oracledb needs a fixed IP address.  Note
<code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code> does not verify that this reverse connection
is possible.  If there is any problem sending a notification, then the
callback method will not be invoked.  The configuration options can
include an <a class="reference external" href="#consubscribeoptipaddress"><code class="docutils literal notranslate"><span class="pre">ipAddress</span></code></a> and
<a class="reference external" href="#consubscribeoptport"><code class="docutils literal notranslate"><span class="pre">port</span></code></a> on which to listen for notifications,
otherwise the database chooses values.</p>
<p>To register interest in database changes, the
<a class="reference external" href="#consubscribe"><code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code></a> method is passed an
arbitrary name and an <a class="reference external" href="#consubscribeoptions"><code class="docutils literal notranslate"><span class="pre">options</span></code></a> object that
controls notification.  In particular <code class="docutils literal notranslate"><span class="pre">options</span></code> contains a valid SQL
query and a JavaScript callback:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">myCallback</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">sql</span>      <span class="o">:</span> <span class="sb">`SELECT * FROM mytable`</span><span class="p">,</span>  <span class="c1">// query of interest</span>
    <span class="nx">callback</span> <span class="o">:</span> <span class="nx">myCallback</span>                <span class="c1">// method called by notifications</span>
<span class="p">};</span>

<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;mysub&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</pre></div>
</div>
<p>In this example, whenever a change to <code class="docutils literal notranslate"><span class="pre">mytable</span></code> is committed then
<code class="docutils literal notranslate"><span class="pre">myCallback()</span></code> is invoked.  The callback
<a class="reference external" href="#consubscribeoptcallback"><code class="docutils literal notranslate"><span class="pre">message</span></code></a> parameter contains information
about the notification.</p>
<p>CQN notification behavior is widely configurable by the subscription
<a class="reference external" href="#consubscribeoptions"><code class="docutils literal notranslate"><span class="pre">options</span></code></a>.  Choices include specifying what
types of SQL should trigger a notification, whether notifications
should survive database loss, and control over unsubscription.  You
can also choose whether notification messages will include ROWIDs of
affected rows.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code> method may be called multiple times with
the same <code class="docutils literal notranslate"><span class="pre">name</span></code>.  In this case, the second and subsequent invocations
ignore all <code class="docutils literal notranslate"><span class="pre">options</span></code> properties other than
<a class="reference external" href="#consubscribeoptsql"><code class="docutils literal notranslate"><span class="pre">sql</span></code></a> and <a class="reference external" href="#consubscribeoptbinds"><code class="docutils literal notranslate"><span class="pre">binds</span></code></a>.
Instead, the new SQL statement is registered to the same subscription,
and the same JavaScript notification callback is used.  For
performance reasons this can be preferable to creating a new
subscription for each query.</p>
<p>You can view information about registrations by querying views such
<code class="docutils literal notranslate"><span class="pre">USER_CHANGE_NOTIFICATION_REGS</span></code> table.  The <code class="docutils literal notranslate"><span class="pre">REGID</span></code> column can be
matched with the value contained in <a class="reference external" href="#consubscribecallback"><code class="docutils literal notranslate"><span class="pre">regid</span></code></a>
from the <code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code> callback parameter.  In the database
view <code class="docutils literal notranslate"><span class="pre">USER_SUBSCR_REGISTRATIONS</span></code>, the <code class="docutils literal notranslate"><span class="pre">REG_ID</span></code> column can be matched.</p>
<p>When notifications are no longer required, the subscription name can
be passed to <a class="reference external" href="#conunsubscribe"><code class="docutils literal notranslate"><span class="pre">connection.unsubscribe()</span></code></a>.</p>
<p>By default, object-level (previously known as Database Change
Notification) occurs and the JavaScript notification method is invoked
whenever a database transaction is committed that changes an object
the query references, regardless of whether the actual query result
changed.  However if the subscription option
<a class="reference external" href="#consubscribeoptqos"><code class="docutils literal notranslate"><span class="pre">qos</span></code></a> is
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_QOS_QUERY</span></code></a> then
query-level notification occurs.  In this mode, the database notifies
the application whenever a transaction changes the result of the
registered query and commits.  For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">sql</span>      <span class="o">:</span> <span class="sb">`SELECT * FROM mytable WHERE key &gt; 100`</span><span class="p">,</span>  <span class="c1">// query of interest</span>
    <span class="nx">callback</span> <span class="o">:</span> <span class="nx">myCallback</span><span class="p">,</span>                               <span class="c1">// method called by notifications</span>
    <span class="nx">qos</span>      <span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">SUBSCR_QOS_QUERY</span>                 <span class="c1">// CQN</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In this example, if a new <code class="docutils literal notranslate"><span class="pre">key</span></code> of 10 was inserted then no
notification would be generated.  If a key wth <code class="docutils literal notranslate"><span class="pre">200</span></code> was inserted, then
a notification would occur.</p>
<p>Before using CQN, users must have appropriate permissions, for
example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CONNECT</span> <span class="k">system</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="n">CHANGE</span> <span class="n">NOTIFICATION</span> <span class="k">TO</span> <span class="n">hr</span><span class="p">;</span>
</pre></div>
</div>
<p>Below is an example of CQN that uses object-level notification and
grouped notifications in batches at 10 second intervals.  After 60
seconds, the notification callback is unregistered and no more
notifications will occur.  The quality of service flags indicate
ROWIDs should be returned in the callback:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;waiting...&quot;</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">myCallback</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Message type:&quot;</span><span class="p">,</span> <span class="nx">message</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">SUBSCR_EVENT_TYPE_DEREG</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Deregistration has taken place...&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Message database name:&quot;</span><span class="p">,</span> <span class="nx">message</span><span class="p">.</span><span class="nx">dbName</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Message transaction id:&quot;</span><span class="p">,</span> <span class="nx">message</span><span class="p">.</span><span class="nx">txId</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">table</span> <span class="k">of</span> <span class="nx">message</span><span class="p">.</span><span class="nx">tables</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;--&gt; Table Name:&quot;</span><span class="p">,</span> <span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;--&gt; Table Operation:&quot;</span><span class="p">,</span> <span class="nx">table</span><span class="p">.</span><span class="nx">operation</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">rows</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">row</span> <span class="k">of</span> <span class="nx">table</span><span class="p">.</span><span class="nx">rows</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;--&gt; --&gt; Row Rowid:&quot;</span><span class="p">,</span> <span class="nx">row</span><span class="p">.</span><span class="nx">rowid</span><span class="p">);</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;--&gt; --&gt; Row Operation:&quot;</span><span class="p">,</span> <span class="nx">row</span><span class="p">.</span><span class="nx">operation</span><span class="p">);</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Array</span><span class="p">(</span><span class="mi">61</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Array</span><span class="p">(</span><span class="mi">61</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">sql</span>           <span class="o">:</span> <span class="sb">`SELECT * FROM mytable`</span><span class="p">,</span>
    <span class="nx">callback</span>      <span class="o">:</span> <span class="nx">myCallback</span><span class="p">,</span>
    <span class="nx">timeout</span>       <span class="o">:</span> <span class="mi">60</span><span class="p">,</span>
    <span class="nx">qos</span>           <span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">SUBSCR_QOS_ROWIDS</span><span class="p">,</span>
    <span class="nx">groupingClass</span> <span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">SUBSCR_GROUPING_CLASS_TIME</span><span class="p">,</span>
    <span class="nx">groupingValue</span> <span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nx">groupingType</span>  <span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">SUBSCR_GROUPING_TYPE_SUMMARY</span>
<span class="p">};</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// This is Node 8 syntax, but can be changed to callbacks</span>

    <span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span>
      <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
      <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
      <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span><span class="p">,</span>
      <span class="nx">events</span>        <span class="o">:</span>  <span class="kc">true</span>
    <span class="p">});</span>

    <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;mysub&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Subscription created...&quot;</span><span class="p">);</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If two new rows were inserted into the table and then committed,
output might be like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Message</span> <span class="nb">type</span><span class="p">:</span> <span class="mi">6</span>
<span class="n">Message</span> <span class="n">database</span> <span class="n">name</span><span class="p">:</span> <span class="n">orcl</span>
<span class="n">Message</span> <span class="n">transaction</span> <span class="nb">id</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">Buffer</span> <span class="mi">06</span> <span class="mi">00</span> <span class="mi">21</span> <span class="mi">00</span> <span class="n">f5</span> <span class="mi">0</span><span class="n">a</span> <span class="mi">00</span> <span class="mi">00</span><span class="o">&gt;</span>
<span class="o">--&gt;</span> <span class="n">Table</span> <span class="n">Name</span><span class="p">:</span> <span class="n">CJ</span><span class="o">.</span><span class="n">MYTABLE</span>
<span class="o">--&gt;</span> <span class="n">Table</span> <span class="n">Operation</span><span class="p">:</span> <span class="mi">2</span>
<span class="o">--&gt;</span> <span class="o">--&gt;</span> <span class="n">Row</span> <span class="n">Rowid</span><span class="p">:</span> <span class="n">AAAVH6AAMAAAAHjAAW</span>
<span class="o">--&gt;</span> <span class="o">--&gt;</span> <span class="n">Row</span> <span class="n">Operation</span><span class="p">:</span> <span class="mi">2</span>
<span class="o">------------------------------------------------------------</span>
<span class="o">--&gt;</span> <span class="o">--&gt;</span> <span class="n">Row</span> <span class="n">Rowid</span><span class="p">:</span> <span class="n">AAAVH6AAMAAAAHjAAX</span>
<span class="o">--&gt;</span> <span class="o">--&gt;</span> <span class="n">Row</span> <span class="n">Operation</span><span class="p">:</span> <span class="mi">2</span>
<span class="o">------------------------------------------------------------</span>
</pre></div>
</div>
<p>Here, the message type 6 corresponds to
<a class="reference external" href="#oracledbconstantssubscription"><code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_EVENT_TYPE_OBJ_CHANGE</span></code></a>
and the row operations of 2 correspond to
<a class="reference external" href="#oracledbconstantscqn"><code class="docutils literal notranslate"><span class="pre">oracledb.CQN_OPCODE_INSERT</span></code></a>.</p>
<p>There are runnable examples in the GitHub <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples">examples</a> directory.</p>
</div>
<div class="section" id="a-name-aq-a-26-oracle-advanced-queuing-aq">
<h2><a name="aq"></a> 26. Oracle Advanced Queuing (AQ)<a class="headerlink" href="#a-name-aq-a-26-oracle-advanced-queuing-aq" title="Permalink to this headline">¶</a></h2>
<p>Oracle Advanced Queuing allows applications to use producer-consumer
message passing.  Queuing is highly configurable and scalable,
providing a great way to distribute workloads.  Messages can be queued
by multiple producers.  Different consumers can filter messages.
Messages can also be transformed or propagated to queues in other
databases.  Oracle AQ is available in all editions of the database,
and has interfaces in many languages, allowing different applications
to communicate.  For more details about AQ and its options, refer to
the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADQUE">Oracle Advanced Queuing User’s Guide</a>.</p>
<p>Node-oracledb APIs for AQ were introduced in node-oracledb 4.0.  With
earlier versions, use AQ’s PL/SQL interface.</p>
<p>Oracle Advanced Queues are represented in node-oracledb by several
classes.  A single top level <a class="reference external" href="#aqqueueclass">AqQueue object</a> in
node-oracledb contains <a class="reference external" href="#aqqueuedeqopts"><code class="docutils literal notranslate"><span class="pre">deqOptions</span></code></a> and
<a class="reference external" href="#aqqueueenqopts"><code class="docutils literal notranslate"><span class="pre">enqOptions</span></code></a> object properties which can be used to
change queue behavior.  A single AqQueue object can be used for
enqueuing, or dequeuing, or both at the same time.</p>
<p>Messages are enqueued by passing them to an enqueue method directly,
or by wrapping them in a <a class="reference external" href="#aqjsmessage">JavaScript object</a>.  Dequeued
messages are returned as an <a class="reference external" href="#aqmessageclass">AqMessage object</a>.</p>
<p>The following examples show how to enqueue and dequeue messages in
node-oracledb.  Before using a queue in node-oracledb, it must be
created in the database using the DBMS_AQADM PL/SQL package.  For
these examples, create a new Oracle user <code class="docutils literal notranslate"><span class="pre">demoqueue</span></code> with permission
to create and use queues.  Connect in SQL*Plus as SYSDBA and run:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">demoqueue</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="o">&amp;</span><span class="n">password</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">USER</span> <span class="n">demoqueue</span> <span class="k">DEFAULT</span> <span class="n">TABLESPACE</span> <span class="n">USERS</span> <span class="n">QUOTA</span> <span class="n">UNLIMITED</span> <span class="k">ON</span> <span class="n">USERS</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">CONNECT</span><span class="p">,</span> <span class="n">RESOURCE</span> <span class="k">TO</span> <span class="n">demoqueue</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="n">AQ_ADMINISTRATOR_ROLE</span><span class="p">,</span> <span class="n">AQ_USER_ROLE</span> <span class="k">TO</span> <span class="n">demoqueue</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">EXECUTE</span> <span class="k">ON</span> <span class="n">DBMS_AQ</span> <span class="k">TO</span> <span class="n">demoqueue</span><span class="p">;</span>
</pre></div>
</div>
<p>When you have finished testing, remove the DEMOQUEUE schema.</p>
<div class="section" id="a-name-aqrawexample-a-26-1-sending-simple-aq-messages">
<h3><a name="aqrawexample"></a> 26.1 Sending Simple AQ Messages<a class="headerlink" href="#a-name-aqrawexample-a-26-1-sending-simple-aq-messages" title="Permalink to this headline">¶</a></h3>
<p>To create a queue for simple messaging, use SQL*Plus to connect as the
new DEMOQUEUE user and run:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Create and start a queue</span>
<span class="k">BEGIN</span>
  <span class="n">DBMS_AQADM</span><span class="p">.</span><span class="n">CREATE_QUEUE_TABLE</span><span class="p">(</span>
    <span class="n">QUEUE_TABLE</span>        <span class="o">=&gt;</span>  <span class="s1">&#39;DEMOQUEUE.DEMO_RAW_QUEUE_TAB&#39;</span><span class="p">,</span>
    <span class="n">QUEUE_PAYLOAD_TYPE</span> <span class="o">=&gt;</span>  <span class="s1">&#39;RAW&#39;</span><span class="p">);</span>

  <span class="n">DBMS_AQADM</span><span class="p">.</span><span class="n">CREATE_QUEUE</span><span class="p">(</span>
    <span class="n">QUEUE_NAME</span>         <span class="o">=&gt;</span>  <span class="s1">&#39;DEMOQUEUE.DEMO_RAW_QUEUE&#39;</span><span class="p">,</span>
    <span class="n">QUEUE_TABLE</span>        <span class="o">=&gt;</span>  <span class="s1">&#39;DEMOQUEUE.DEMO_RAW_QUEUE_TAB&#39;</span><span class="p">);</span>

  <span class="n">DBMS_AQADM</span><span class="p">.</span><span class="n">START_QUEUE</span><span class="p">(</span>
    <span class="n">QUEUE_NAME</span>         <span class="o">=&gt;</span> <span class="s1">&#39;DEMOQUEUE.DEMO_RAW_QUEUE&#39;</span><span class="p">);</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>To enqueue a single, simple message, run:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;DEMO_RAW_QUEUE&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">enqOne</span><span class="p">(</span><span class="s2">&quot;This is my message&quot;</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Messages can be passed directly to <code class="docutils literal notranslate"><span class="pre">enqOne()</span></code> as shown above.
Alternatively they can be the <code class="docutils literal notranslate"><span class="pre">payload</span></code> property of a JavaScript
object passed to <code class="docutils literal notranslate"><span class="pre">enqOne()</span></code>, as shown in <a class="reference external" href="#aqoptions">Changing AQ
options</a>.</p>
<p>To dequeue a message, run:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;DEMO_RAW_QUEUE&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">deqOne</span><span class="p">();</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">deqOne()</span></code> will wait until a message is available.</p>
<p>The variable <code class="docutils literal notranslate"><span class="pre">msg</span></code> is returned as an <a class="reference external" href="#aqmessageclass">AqMessage
object</a> which contains the message payload and other
metadata.  String messages are encoded as UTF-8 Buffers.  This example
displays <code class="docutils literal notranslate"><span class="pre">This</span> <span class="pre">is</span> <span class="pre">my</span> <span class="pre">message</span></code>.</p>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/aqraw.js"><code class="docutils literal notranslate"><span class="pre">examples/aqraw.js</span></code></a> for a runnable example.</p>
</div>
<div class="section" id="a-name-aqobjexample-a-26-2-sending-oracle-database-object-aq-messages">
<h3><a name="aqobjexample"></a> 26.2 Sending Oracle Database Object AQ Messages<a class="headerlink" href="#a-name-aqobjexample-a-26-2-sending-oracle-database-object-aq-messages" title="Permalink to this headline">¶</a></h3>
<p>You can use AQ to send Database Object payloads by using <a class="reference external" href="#dbobjectclass">DbObject
Class</a> objects as the message.</p>
<p>The message in this example is an object containing a name and
address.  To create a payload type and to start a queue, connect as
the new <code class="docutils literal notranslate"><span class="pre">demoqueue</span></code> user and run:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- For the data we want to queue</span>
<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TYPE</span> <span class="n">USER_ADDRESS_TYPE</span> <span class="k">AS</span> <span class="k">OBJECT</span> <span class="p">(</span>
   <span class="n">NAME</span>        <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
   <span class="n">ADDRESS</span>     <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>
<span class="o">/</span>

<span class="c1">-- Create and start a queue</span>
<span class="k">BEGIN</span>
 <span class="n">DBMS_AQADM</span><span class="p">.</span><span class="n">CREATE_QUEUE_TABLE</span><span class="p">(</span>
   <span class="n">QUEUE_TABLE</span>        <span class="o">=&gt;</span>  <span class="s1">&#39;DEMOQUEUE.ADDR_QUEUE_TAB&#39;</span><span class="p">,</span>
   <span class="n">QUEUE_PAYLOAD_TYPE</span> <span class="o">=&gt;</span>  <span class="s1">&#39;DEMOQUEUE.USER_ADDRESS_TYPE&#39;</span><span class="p">);</span>

 <span class="n">DBMS_AQADM</span><span class="p">.</span><span class="n">CREATE_QUEUE</span><span class="p">(</span>
   <span class="n">QUEUE_NAME</span>         <span class="o">=&gt;</span>  <span class="s1">&#39;DEMOQUEUE.ADDR_QUEUE&#39;</span><span class="p">,</span>
   <span class="n">QUEUE_TABLE</span>        <span class="o">=&gt;</span>  <span class="s1">&#39;DEMOQUEUE.ADDR_QUEUE_TAB&#39;</span><span class="p">);</span>

 <span class="n">DBMS_AQADM</span><span class="p">.</span><span class="n">START_QUEUE</span><span class="p">(</span>
   <span class="n">QUEUE_NAME</span>         <span class="o">=&gt;</span> <span class="s1">&#39;DEMOQUEUE.ADDR_QUEUE&#39;</span><span class="p">,</span>
   <span class="n">ENQUEUE</span>            <span class="o">=&gt;</span> <span class="k">TRUE</span><span class="p">);</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>
</div>
<p>In the <a class="reference external" href="#aqrawexample">previous section</a> the <code class="docutils literal notranslate"><span class="pre">QUEUE_PAYLOAD_TYPE</span></code> was ‘RAW’
but here the Oracle Database object type name <code class="docutils literal notranslate"><span class="pre">DEMOQUEUE.USER_ADDRESS_TYPE</span></code> is used.</p>
<p>In node-oracledb, a queue is initialized for that type:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;ADDR_QUEUE&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">,</span> <span class="p">{</span><span class="nx">payloadType</span><span class="o">:</span> <span class="s2">&quot;DEMOQUEUE.USER_ADDRESS_TYPE&quot;</span><span class="p">});</span>
</pre></div>
</div>
<p>For efficiency, it is recommended to use a fully qualified name for
the type.</p>
<p>A <a class="reference external" href="#dbobjectclass">DbObject</a> for the message is created and queued:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">payloadTypeClass</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">NAME</span><span class="o">:</span> <span class="s2">&quot;scott&quot;</span><span class="p">,</span>
    <span class="nx">ADDRESS</span><span class="o">:</span> <span class="s2">&quot;The Kennel&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>
<span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">enqOne</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Dequeuing objects is done with:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">,</span> <span class="p">{</span><span class="nx">payloadType</span><span class="o">:</span> <span class="s2">&quot;DEMOQUEUE.USER_ADDRESS_TYPE&quot;</span><span class="p">});</span>
<span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">deqOne</span><span class="p">();</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">deqOne()</span></code> will wait until a message is available.</p>
<p>The message can be printed:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/aqobjects.js"><code class="docutils literal notranslate"><span class="pre">examples/aqobjects.js</span></code></a> for a runnable example.</p>
</div>
<div class="section" id="a-name-aqoptions-a-26-3-changing-aq-options">
<h3><a name="aqoptions"></a> 26.3 Changing AQ options<a class="headerlink" href="#a-name-aqoptions-a-26-3-changing-aq-options" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="#aqqueueclass">AqQueue</a> object created by calling
<a class="reference external" href="#getqueue"><code class="docutils literal notranslate"><span class="pre">connection.getQueue()</span></code></a> contains
<a class="reference external" href="#aqqueueenqopts"><code class="docutils literal notranslate"><span class="pre">enqOptions</span></code></a> and <a class="reference external" href="#aqqueuedeqopts"><code class="docutils literal notranslate"><span class="pre">deqOptions</span></code></a>
attribute objects that can be configured.  These options can be
changed before each enqueue or dequeue call.</p>
<p>Messages that are enqueued can also contain properties, such as an
expiration.  Instead of passing a message String, Buffer or DbObject
directly to <code class="docutils literal notranslate"><span class="pre">enqOne()</span></code>, a <code class="docutils literal notranslate"><span class="pre">payload</span></code> property of a <a class="reference external" href="#aqjsmessage">JavaScript
object</a> is set to the message.  Other object properties
control the message behavior.  For example to expire a message after
five seconds if it hasn’t been dequeued:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
     <span class="nx">expiration</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
     <span class="nx">payload</span><span class="o">:</span> <span class="s2">&quot;This is my message&quot;</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;DEMO_RAW_QUEUE&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">enqOne</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>For RAW queues the <code class="docutils literal notranslate"><span class="pre">payload</span></code> value can be a String or Buffer.  For
object queues <code class="docutils literal notranslate"><span class="pre">payload</span></code> can be a <a class="reference external" href="#dbobjectclass">DbObject</a> object.</p>
<p>To change the enqueue behavior of a queue, alter the
<a class="reference external" href="#aqqueueenqopts"><code class="docutils literal notranslate"><span class="pre">enqOptions</span></code></a> attributes.  For example to make a
message buffered, and not persistent:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;DEMO_RAW_QUEUE&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
<span class="nx">queue</span><span class="p">.</span><span class="nx">enqOptions</span><span class="p">.</span><span class="nx">deliveryMode</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">AQ_MSG_DELIV_MODE_BUFFERED</span><span class="p">;</span>
<span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">enqOne</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>To send a message immediately without requiring a commit, you can
change the queue’s message visibility:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;DEMO_RAW_QUEUE&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
<span class="nx">queue</span><span class="p">.</span><span class="nx">enqOptions</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">AQ_VISIBILITY_IMMEDIATE</span><span class="p">;</span>
<span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">enqOne</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</pre></div>
</div>
<p>To change the queue behavior when dequeuing, alter the
<a class="reference external" href="#aqqueuedeqopts"><code class="docutils literal notranslate"><span class="pre">deqOptions</span></code></a> attributes.  For example, to change
the visibility of the message (so no explicit commit is required after
dequeuing a message) and to continue without blocking if the queue is
empty:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;DEMO_RAW_QUEUE&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
<span class="nx">queue</span><span class="p">.</span><span class="nx">deqOptions</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">AQ_VISIBILITY_IMMEDIATE</span><span class="p">;</span>
<span class="nx">queue</span><span class="p">.</span><span class="nx">deqOptions</span><span class="p">.</span><span class="nx">wait</span> <span class="o">=</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">AQ_DEQ_NO_WAIT</span><span class="p">;</span>
<span class="nx">await</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">deqOne</span><span class="p">();</span>
</pre></div>
</div>
<p>To change multiple properties at once, you can also use syntax like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">deqOptions</span><span class="p">,</span>
              <span class="p">{</span>
                <span class="n">mode</span><span class="p">:</span> <span class="n">oracledb</span><span class="o">.</span><span class="n">AQ_DEQ_MODE_BROWSE</span><span class="p">,</span>
                <span class="n">visibility</span><span class="p">:</span> <span class="n">oracledb</span><span class="o">.</span><span class="n">AQ_VISIBILITY_IMMEDIATE</span><span class="p">,</span>
                <span class="n">wait</span><span class="p">:</span> <span class="mi">10</span>
              <span class="p">});</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/aqoptions.js"><code class="docutils literal notranslate"><span class="pre">examples/aqoptions.js</span></code></a> for a runnable example.</p>
</div>
<div class="section" id="a-name-aqmultiplemessages-a-26-4-enqueuing-and-dequeuing-multiple-messages">
<h3><a name="aqmultiplemessages"></a> 26.4 Enqueuing and Dequeuing Multiple Messages<a class="headerlink" href="#a-name-aqmultiplemessages-a-26-4-enqueuing-and-dequeuing-multiple-messages" title="Permalink to this headline">¶</a></h3>
<p>Enqueuing multiple messages in one operation is similar to the basic
examples.  However, instead of passing a single message to
<a class="reference external" href="#aqqueuemethodenqone"><code class="docutils literal notranslate"><span class="pre">queue.enqOne()</span></code></a>, the
<a class="reference external" href="#aqqueuemethodenqmany"><code class="docutils literal notranslate"><span class="pre">queue.enqMany()</span></code></a> method is passed an array
of messages:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;DEMO_RAW_QUEUE&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Message 1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Message 2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Message 3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Message 4&quot;</span>
<span class="p">];</span>
<span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">enqMany</span><span class="p">(</span><span class="nx">messages</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Warning: see the advisory note in <a class="reference external" href="#aqqueuemethodenqmany"><code class="docutils literal notranslate"><span class="pre">enqMany()</span></code></a>
documentation.</p>
<p>Multiple messages can be dequeued in one call with
<a class="reference external" href="#aqqueuemethoddeqmany"><code class="docutils literal notranslate"><span class="pre">queue.deqMany()</span></code></a>.  This method takes a
<code class="docutils literal notranslate"><span class="pre">maxMessages</span></code> parameter indicating the maximum number of messages that
should be dequeued in one call.  Depending on the queue options, zero
or more messages up to the limit will be dequeued:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">messages</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">deqMany</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Dequeued &quot;</span> <span class="o">+</span> <span class="nx">messages</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; messages&quot;</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">msg</span> <span class="k">of</span> <span class="nx">messages</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="p">}</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">deqMany()</span></code> will wait until a message is available.</p>
<p>Each element of the <code class="docutils literal notranslate"><span class="pre">messages</span></code> array is an <a class="reference external" href="#aqmessageclass">AqMessage
object</a>, the same as returned by
<a class="reference external" href="#aqqueuemethoddeqone"><code class="docutils literal notranslate"><span class="pre">queue.deqOne()</span></code></a>.</p>
<p>See <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples/aqmulti.js"><code class="docutils literal notranslate"><span class="pre">examples/aqmulti.js</span></code></a> for a runnable example.</p>
</div>
<div class="section" id="a-name-aqnotifications-a-26-5-advanced-queuing-notifications">
<h3><a name="aqnotifications"></a> 26.5 Advanced Queuing Notifications<a class="headerlink" href="#a-name-aqnotifications-a-26-5-advanced-queuing-notifications" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="#consubscribe"><code class="docutils literal notranslate"><span class="pre">connection.subscribe()</span></code></a> method can be used to
register interest in a queue, allowing a callback to be invoked when
there are messages to dequeue.  To subscribe to a queue, pass its name
to <code class="docutils literal notranslate"><span class="pre">subscribe()</span></code> and set the <a class="reference external" href="#consubscribeoptnamespace"><code class="docutils literal notranslate"><span class="pre">namespace</span></code></a>
option to <code class="docutils literal notranslate"><span class="pre">oracledb.SUBSCR_NAMESPACE_AQ</span></code>:</p>
<p>For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">queueName</span> <span class="o">=</span> <span class="s2">&quot;DEMO_RAW_QUEUE&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">subscrOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">namespace</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">SUBSCR_NAMESPACE_AQ</span><span class="p">,</span>
  <span class="nx">callback</span><span class="o">:</span> <span class="nx">ProcessAqMessages</span>
<span class="p">};</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">ProcessAqMessages</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>  <span class="c1">// get connection from a pool</span>
  <span class="kr">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">queueName</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">deqOne</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>  <span class="c1">// get connection from a pool</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">queueName</span><span class="p">,</span> <span class="nx">subscrOptions</span><span class="p">);</span>
<span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#cqn">Continuous Query Notification (CQN)</a> for more information
about subscriptions and notifications.</p>
<p>AQ notifications require the same configuration as CQN.  Specifically
the database must be able to connect back to node-oracledb.</p>
</div>
</div>
<div class="section" id="a-name-nls-a-27-globalization-and-national-language-support-nls">
<h2><a name="nls"></a> 27. Globalization and National Language Support (NLS)<a class="headerlink" href="#a-name-nls-a-27-globalization-and-national-language-support-nls" title="Permalink to this headline">¶</a></h2>
<p>Node-oracledb can use Oracle’s <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=NLSPG">National Language Support (NLS)</a>
to assist in globalizing applications.</p>
<p>Node-oracledb always uses Oracle’s AL32UTF8 character set internally.
Data will be converted between AL32UTF8 and the
database character set when it is inserted into, or queried from, the
database.  The environment variable <code class="docutils literal notranslate"><span class="pre">NLS_LANG</span></code> can be used to
configure the Oracle ‘client’ (i.e. node-oracledb) language and territory only.</p>
<p>Oracle NLS environment variables, or statements like <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">SESSION</span></code>,
can be used to configure further aspects of node-oracledb data access
globalization. Examples are <code class="docutils literal notranslate"><span class="pre">NLS_NUMERIC_CHARACTERS</span></code> (discussed in
<a class="reference external" href="#numberhandling">Fetching Numbers</a>), and <code class="docutils literal notranslate"><span class="pre">NLS_DATE_FORMAT</span></code> (discussed
in <a class="reference external" href="#fetchasstringhandling">Fetching Numbers and Dates as String</a>).
Refer to <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D5C74C82-8622-46F4-8760-0F8ABA28A816">NLS Documentation</a> for others.</p>
<p>To find the database character set, execute the query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">value</span> <span class="k">AS</span> <span class="n">db_charset</span>
<span class="k">FROM</span> <span class="n">nls_database_parameters</span>
<span class="k">WHERE</span> <span class="k">parameter</span> <span class="o">=</span> <span class="s1">&#39;NLS_CHARACTERSET&#39;</span>
</pre></div>
</div>
<p>The general Oracle statement to find the ‘client’ character set is:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">client_charset</span> <span class="k">AS</span> <span class="n">client_charset</span>
<span class="k">FROM</span> <span class="n">v$session_connect_info</span>
<span class="k">WHERE</span> <span class="n">sid</span> <span class="o">=</span> <span class="n">SYS_CONTEXT</span><span class="p">(</span><span class="s1">&#39;USERENV&#39;</span><span class="p">,</span> <span class="s1">&#39;SID&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>In node-oracledb this will always show AL32UTF8.</p>
</div>
<div class="section" id="a-name-endtoend-a-28-end-to-end-tracing-mid-tier-authentication-and-auditing">
<h2><a name="endtoend"></a> 28. End-to-end Tracing, Mid-tier Authentication, and Auditing<a class="headerlink" href="#a-name-endtoend-a-28-end-to-end-tracing-mid-tier-authentication-and-auditing" title="Permalink to this headline">¶</a></h2>
<p>The Connection properties <a class="reference external" href="#propconnaction">action</a>,
<a class="reference external" href="#propconnmodule">module</a>, and <a class="reference external" href="#propconnclientid">clientId</a> set
metadata for <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-246A5A52-E666-4DBC-BDF6-98B83260A7AD">end-to-end tracing</a>.  The values can be tracked in
database views, shown in audit trails, and seen in tools such as
Enterprise Manager.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">clientId</span></code> property can also be used by applications that do their
own mid-tier authentication but connect to the database using the one
database schema.  By setting <code class="docutils literal notranslate"><span class="pre">clientId</span></code> to the application’s
authenticated user name, the database is aware of who the actual end
user is.  This can, for example, be used by Oracle <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-89DB0C3C-A36F-4254-8C82-020F5F6DE31F">Virtual Private
Database</a> policies to automatically restrict data access by that
user.</p>
<p>Applications should set the properties because they can greatly help
to identify and resolve unnecessary database resource usage, or
improper access.</p>
<p>The attributes are set on a <a class="reference external" href="#propdbconclass">connection</a> object and
sent to the database on the next <a class="reference external" href="#roundtrips">round-trip</a> from
node-oracledb, for example, with <code class="docutils literal notranslate"><span class="pre">execute()</span></code>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>  <span class="c1">// mypw contains the hr schema password</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/orclpdb1&quot;</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">clientId</span> <span class="o">=</span> <span class="s2">&quot;Chris&quot;</span><span class="p">;</span>
<span class="nx">connection</span><span class="p">.</span><span class="nx">module</span> <span class="o">=</span> <span class="s2">&quot;End-to-end example&quot;</span><span class="p">;</span>
<span class="nx">connection</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="s2">&quot;Query departments&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT . . .`</span><span class="p">);</span>
</pre></div>
</div>
<p>While the connection is open the attribute values can be seen, for example with SQL*Plus:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL&gt; SELECT username, client_identifier, action, module FROM v$session WHERE username = &#39;HR&#39;;

USERNAME   CLIENT_IDENTIFIER    ACTION               MODULE
---------- -------------------- -------------------- --------------------
HR         Chris                Query departments    End-to-end example
</pre></div>
</div>
<p>The values can also be manually set by calling
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-14484F86-44F2-4B34-B34E-0C873D323EAD"><code class="docutils literal notranslate"><span class="pre">DBMS_APPLICATION_INFO</span></code></a> procedures or
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-988EA930-BDFE-4205-A806-E54F05333562"><code class="docutils literal notranslate"><span class="pre">DBMS_SESSION.SET_IDENTIFIER</span></code></a>, however these cause explicit
<a class="reference external" href="#roundtrips">round-trips</a>, reducing scalability.</p>
<p>In general, applications should be consistent about how, and when,
they set the end-to-end tracing attributes so that current values are
recorded by the database.</p>
<p>Idle connections released back to a connection pool will retain the
previous attribute values of that connection. This avoids the overhead
of a round-trip to reset the values.  The Oracle design assumption is
that pools are actively used and have few idle connections. After
getting a connection from a pool, an application that uses end-to-end
tracing should set new values appropriately.</p>
<p>When a Connection object is displayed, such as with <code class="docutils literal notranslate"><span class="pre">console.log()</span></code>,
the end-to-end tracing attributes will show as <code class="docutils literal notranslate"><span class="pre">null</span></code> even if values
have been set and are being sent to the database.  This is for
architectural, efficiency and consistency reasons.  When an already
established connection is retrieved from a local pool, node-oracledb
is not able to efficiently retrieve values previously established in
the connection.  The same occurs if the values are set by a call to
PL/SQL code - there is no efficient way for node-oracledb to know the
values have changed.</p>
<p>The attribute values are commonly useful to DBAs.  However, if knowing
the current values is useful in an application, the application should
save the values as part of its application state whenever the
node-oracledb attributes are set.  Applications can also find the
current values by querying the Oracle data dictionary or using PL/SQL
procedures such as <code class="docutils literal notranslate"><span class="pre">DBMS_APPLICATION_INFO.READ_MODULE()</span></code> with the
understanding that these require round-trips to the database.</p>
<div class="section" id="the-add-on-name">
<h3>The Add-on Name<a class="headerlink" href="#the-add-on-name" title="Permalink to this headline">¶</a></h3>
<p>The Oracle Database <code class="docutils literal notranslate"><span class="pre">V$SESSION_CONNECT_INFO</span></code> view shows the version of
node-oracledb in use.  This allows DBAs to verify that applications
are using the desired add-on version.  For example, a DBA might see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SQL&gt; SELECT UNIQUE sid, client_driver
     FROM v$session_connect_info
     WHERE client_driver LIKE &#39;node-oracledb%&#39;
     ORDER BY sid;

       SID CLIENT_DRIVER
---------- ------------------------------
        16 node-oracledb : 2.2.0
        33 node-oracledb : 2.2.0
</pre></div>
</div>
<p>Note if <a class="reference external" href="#propdbconclass"><code class="docutils literal notranslate"><span class="pre">oracledb.connectionClass</span></code></a> is set for a
non-pooled connection, the <code class="docutils literal notranslate"><span class="pre">CLIENT_DRIVER</span></code> value will not be set for
that connection.</p>
</div>
</div>
<div class="section" id="a-name-sodaoverview-a-29-simple-oracle-document-access-soda">
<h2><a name="sodaoverview"></a> 29. Simple Oracle Document Access (SODA)<a class="headerlink" href="#a-name-sodaoverview-a-29-simple-oracle-document-access-soda" title="Permalink to this headline">¶</a></h2>
<p>Oracle Database Simple Oracle Document Access (SODA) is available in
node-oracledb through a set of NoSQL-style APIs.  Documents can be inserted,
queried, and retrieved from Oracle Database using node-oracledb methods.  By
default, documents are JSON strings.</p>
<p>The <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADSDI">Oracle Database Introduction to SODA</a> manual contains much
information relevant to using SODA.  You can use Oracle SODA
implementations in Node.js, <a class="reference external" href="https://cx-oracle.readthedocs.org/en/latest/index.html">Python</a>, <a class="reference external" href="https://docs.oracle.com/en/database/oracle/simple-oracle-document-access/java-1/adsda/index.html">Java</a>, <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=ADSDP">PL/SQL</a>
or <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-23206C89-891E-43D7-827C-5C6367AD62FD">Oracle Call Interface</a> to perform operations on documents of
nearly any kind (including video, image, sound, and other binary
content).  Create, read, update and delete operations can be performed
via document key lookups, or by query-by-example (QBE)
pattern-matching.</p>
<p>SODA uses a SQL schema to store documents but you do not need to know
SQL or how the documents are stored. However, access via SQL does
allow use of advanced Oracle Database functionality such as analytics
for reporting.</p>
<p>Applications that access a mixture of SODA objects and relational
objects (or access SODA objects via SQL) are supported, but be aware
of the commit behavior, since any commit or rollback on a connection
will affect all work.</p>
<p>Node-oracledb uses the following objects for SODA:</p>
<ul class="simple">
<li><p><a class="reference external" href="#sodadatabaseclass">SodaDatabase</a>: The top level object for
node-oracledb SODA operations. This is acquired from an Oracle
Database connection.  A ‘SODA database’ is an abstraction, allowing
access to SODA collections in that ‘SODA database’, which then allow
access to documents in those collections.  A SODA database is
analogous to an Oracle Database user or schema, a collection is
analogous to a table, and a document is analogous to a table row
with one column for a unique document key, a column for the document
content, and other columns for various document attributes.</p></li>
<li><p><a class="reference external" href="#sodacollectionclass">SodaCollection</a>: Represents a collection of
SODA documents.  By default, collections allow JSON documents to be
stored.  This is recommended for most SODA users.  However optional
metadata can set various details about a collection, such as its
database storage, whether it should track version and time stamp
document components, how such components are generated, and what
document types are supported.  See <a class="reference external" href="#sodaclientkeys">Collection
Metadata</a> for more information.  By default, the
name of the Oracle Database table storing a collection is the same
as the collection name. Note: do not use SQL to drop the database
table, since SODA metadata will not be correctly removed.  Use the
<a class="reference external" href="#sodacolldrop"><code class="docutils literal notranslate"><span class="pre">sodaCollection.drop()</span></code></a> method instead.</p></li>
<li><p><a class="reference external" href="#sodadocumentclass">SodaDocument</a>: Represents a document.
Typically the document content will be JSON.  The document has
properties including the content, a key, timestamps, and the media
type.  By default, document keys are automatically generated.  See
<a class="reference external" href="#sodadocumentclass">SodaDocument Class</a> for the forms of
SodaDocument.</p></li>
<li><p><a class="reference external" href="#sodadocumentcursorclass">SodaDocumentCursor</a>: A cursor object
representing the result of the
<a class="reference external" href="#sodaoperationclassgetcursor"><code class="docutils literal notranslate"><span class="pre">getCursor()</span></code></a> method from a
<a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">find()</span></code></a> operation.  It can be iterated over to
access each SodaDocument.</p></li>
<li><p><a class="reference external" href="#sodaoperationclass">SodaOperation</a>: An internal object used with
<a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">find()</span></code></a> to perform read and write operations on
documents.  Chained methods set properties on a SodaOperation object
which is then used by a terminal method to find, count, replace, or
remove documents.  This is an internal object that should not be
directly accessed.</p></li>
</ul>
<div class="section" id="a-name-sodarequirements-a-29-1-node-oracledb-soda-requirements">
<h3><a name="sodarequirements"></a> 29.1 Node-oracledb SODA Requirements<a class="headerlink" href="#a-name-sodarequirements-a-29-1-node-oracledb-soda-requirements" title="Permalink to this headline">¶</a></h3>
<p>SODA is available to Node.js applications using Oracle Database 18.3 and above,
when node-oracledb uses Oracle Client 18.5 or Oracle Client 19.3, or later.  The
SODA bulk insert methods <a class="reference external" href="#sodacollinsertmany"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertMany()</span></code></a>
and <a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a> are in
Preview status.</p>
<p>To execute SODA operations, Oracle Database users require the SODA_APP
role granted to them by a DBA:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="n">SODA_APP</span> <span class="k">TO</span> <span class="n">hr</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> system privilege is also needed.  Advanced users
who are using Oracle sequences for keys will also need the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">SEQUENCE</span></code> privilege.</p>
<p>The general recommendation for SODA applications is to turn on
<a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">autoCommit</span></code></a> globally:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">autoCommit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>
</div>
<p>If your SODA document write operations are mostly independent of each
other, this removes the overhead of explicit
<a class="reference external" href="#commit"><code class="docutils literal notranslate"><span class="pre">connection.commit()</span></code></a> calls.</p>
<p>When deciding how to commit transactions, beware of transactional
consistency and performance requirements.  If you are inserting or
updating a large number of documents, you should turn <code class="docutils literal notranslate"><span class="pre">autoCommit</span></code> off
and issue a single, explicit <a class="reference external" href="#commit"><code class="docutils literal notranslate"><span class="pre">connection.commit()</span></code></a> after
all documents have been processed.</p>
<p>If you are not autocommitting, and one of the SODA operations in your
transaction fails, then your application must explicitly roll back the
transaction with <a class="reference external" href="#rollback"><code class="docutils literal notranslate"><span class="pre">connection.rollback()</span></code></a>.</p>
<p>Note:</p>
<ul class="simple">
<li><p>SODA DDL operations do not commit an open transaction the way that SQL always does for DDL statements.</p></li>
<li><p>When <a class="reference external" href="#propdbisautocommit"><code class="docutils literal notranslate"><span class="pre">oracledb.autoCommit</span></code></a> is <em>true</em>, most SODA methods will issue a commit before successful return.</p></li>
<li><p>SODA provides optimistic locking, see <a class="reference external" href="#sodaoperationclassversion"><code class="docutils literal notranslate"><span class="pre">sodaOperation.version()</span></code></a>.</p></li>
</ul>
</div>
<div class="section" id="a-name-creatingsodacollections-a-29-2-creating-soda-collections">
<h3><a name="creatingsodacollections"></a> 29.2 Creating SODA Collections<a class="headerlink" href="#a-name-creatingsodacollections-a-29-2-creating-soda-collections" title="Permalink to this headline">¶</a></h3>
<p>The following examples use Node.js 8’s
<a class="reference external" href="#asyncawaitoverview">async/await</a> syntax, however callbacks can also
be used.  There are runnable examples in the GitHub <a class="reference external" href="https://github.com/oracle/node-oracledb/tree/master/examples">examples</a>
directory.</p>
<p>Collections can be created like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">autoCommit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">soda</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getSodaDatabase</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">soda</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="s2">&quot;mycollection&quot;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">indexSpec</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;CITY_IDX&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;fields&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span>
                          <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;address.city&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;datatype&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;order&quot;</span><span class="o">:</span> <span class="s2">&quot;asc&quot;</span> <span class="p">}</span> <span class="p">]</span> <span class="p">};</span>
  <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="nx">indexSpec</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This example creates a collection that, by default, allows JSON
documents to be stored. A non-unique B-tree index is created on the
<code class="docutils literal notranslate"><span class="pre">address.city</span></code> path to improve search performance.</p>
<p>If the collection name passed to
<a class="reference external" href="#sodadbcreatecollection"><code class="docutils literal notranslate"><span class="pre">createCollection()</span></code></a> already exists, it
will simply be opened. Alternatively you can open a known, existing
collection with
<a class="reference external" href="#sodadbopencollection"><code class="docutils literal notranslate"><span class="pre">sodaDatabase.openCollection()</span></code></a>.</p>
<p>Collections will be visible as tables in your Oracle Database
schema. Do not use DROP TABLE to drop these database tables, since
SODA metadata will not be correctly removed. Use the
<a class="reference external" href="#sodacolldrop"><code class="docutils literal notranslate"><span class="pre">sodaCollection.drop()</span></code></a> method instead.  If you
accidentally execute DROP SQL, you should call <code class="docutils literal notranslate"><span class="pre">sodaCollection.drop()</span></code>
or execute the SQL statement <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">DBMS_SODA.DROP_COLLECTION('myCollection')</span> <span class="pre">FROM</span> <span class="pre">dual;</span></code></p>
<p>See <a class="reference external" href="#sodaclientkeys">SODA Client-Assigned Keys and Collection
Metadata</a> for how to create a collection with custom
metadata.</p>
</div>
<div class="section" id="a-name-accessingsodadocuments-a-29-3-creating-and-accessing-soda-documents">
<h3><a name="accessingsodadocuments"></a> 29.3 Creating and Accessing SODA documents<a class="headerlink" href="#a-name-accessingsodadocuments-a-29-3-creating-and-accessing-soda-documents" title="Permalink to this headline">¶</a></h3>
<p>To insert a document into an opened collection, a JavaScript object
that is the document content can be used directly.  In the following
example, it is the object myContent:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">myContent</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Sally&quot;</span><span class="p">,</span> <span class="nx">address</span><span class="o">:</span> <span class="p">{</span><span class="nx">city</span><span class="o">:</span> <span class="s2">&quot;Melbourne&quot;</span><span class="p">}};</span>
  <span class="kr">const</span> <span class="nx">newDoc</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">insertOneAndGet</span><span class="p">(</span><span class="nx">myContent</span><span class="p">);</span>
  <span class="c1">// a system generated key is created by default</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The key of the new SODA document is: &quot;</span><span class="p">,</span> <span class="nx">newDoc</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference external" href="#sodacollinsertone"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOne()</span></code></a> for more
information.</p>
<p>For many users, passing your document content directly to the
<a class="reference external" href="#sodacollinsertone"><code class="docutils literal notranslate"><span class="pre">insertOne()</span></code></a>,
<a class="reference external" href="#sodacollinsertoneandget"><code class="docutils literal notranslate"><span class="pre">insertOneAndGet()</span></code></a>,
<a class="reference external" href="#sodaoperationclassreplaceone"><code class="docutils literal notranslate"><span class="pre">replaceOne()</span></code></a>,
<a class="reference external" href="#sodaoperationclassreplaceoneandget"><code class="docutils literal notranslate"><span class="pre">replaceOneAndGet()</span></code></a>,
<a class="reference external" href="#sodacollinsertmany"><code class="docutils literal notranslate"><span class="pre">insertMany()</span></code></a>, or
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">insertManyAndGet()</span></code></a> methods will be fine.  System
generated values for the key and other document components will be added to the
stored SODA document.  For cases where you want to insert Buffers or Strings, or
when you need more control over the SodaDocument, such as to use a
client-assigned key, then you can call the
<a class="reference external" href="#sodadbcreatedocument"><code class="docutils literal notranslate"><span class="pre">sodaDatabase.createDocument()</span></code></a> method and pass its
result to an insert or replace method, for example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
  <span class="nx">myContent</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Sally&quot;</span><span class="p">,</span> <span class="nx">address</span><span class="o">:</span> <span class="p">{</span><span class="nx">city</span><span class="o">:</span> <span class="s2">&quot;Melbourne&quot;</span><span class="p">}};</span>
  <span class="nx">newDoc</span> <span class="o">=</span> <span class="nx">soda</span><span class="p">.</span><span class="nx">createDocument</span><span class="p">(</span><span class="nx">myContent</span><span class="p">,</span> <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;123&quot;</span><span class="p">});</span>
  <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span><span class="nx">myContent</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note: to use client-assigned keys, collections must be created with
custom metadata, see <a class="reference external" href="#sodaclientkeys">SODA Client-Assigned Keys and Collection
Metadata</a>.</p>
<p>To extract documents from a collection, the <a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">find()</span></code></a>
method can be used to build a <a class="reference external" href="#sodaoperationclass">SodaOperation</a>
object specifying the keys of desired documents, or searches can be
performed on JSON documents using query-by-example (QBE) methods.
Each document has a unique key. If the key for a document is “k1”, the
document can be fetched like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">myKey</span> <span class="o">=</span> <span class="s2">&quot;k1&quot;</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">soda</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getSodaDatabase</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">soda</span><span class="p">.</span><span class="nx">openCollection</span><span class="p">(</span><span class="s2">&quot;mycollection&quot;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">key</span><span class="p">(</span><span class="nx">myKey</span><span class="p">).</span><span class="nx">getOne</span><span class="p">();</span> <span class="c1">// A SodaDocument</span>
  <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getContent</span><span class="p">();</span>  <span class="c1">// A JavaScript object</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Name: &quot;</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// Sally</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Lives in: &quot;</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">city</span><span class="p">);</span>  <span class="c1">// Melbourne</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The content of queried SodaDocument objects is only accessible via one
of the accessor methods <a class="reference external" href="#sodadocgetcontent"><code class="docutils literal notranslate"><span class="pre">getContent()</span></code></a>,
<a class="reference external" href="#sodadocgetcontentasbuffer"><code class="docutils literal notranslate"><span class="pre">getContentAsBuffer()</span></code></a> or
<a class="reference external" href="#sodadocgetcontentasstring"><code class="docutils literal notranslate"><span class="pre">getContentAsString()</span></code></a>.  Which one to
use depends on the media type, and how you want to use it in the
application. By default, the media type is ‘application/json’.</p>
<p>The <a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">find()</span></code></a> method creates a SodaOperation object
used with method chaining to specify desired properties of documents
that a terminal method like <a class="reference external" href="#sodaoperationclassgetone"><code class="docutils literal notranslate"><span class="pre">getOne()</span></code></a> or
<a class="reference external" href="#sodaoperationclassremove"><code class="docutils literal notranslate"><span class="pre">remove()</span></code></a> then applies to.</p>
<p>Other examples of chained read and write operations include:</p>
<ul>
<li><p>To see if a document exists:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">c</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">col</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;k1&quot;</span><span class="p">).</span><span class="nx">getOne</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="nx">then</span> <span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.}</span>
</pre></div>
</div>
</li>
<li><p>To return a cursor that can be iterated over to get documents with
keys “k1” and “k2”:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">docCursor</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">keys</span><span class="p">([</span><span class="s2">&quot;k1&quot;</span><span class="p">,</span> <span class="s2">&quot;k2&quot;</span><span class="p">]).</span><span class="nx">getCursor</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>To remove the documents matching the supplied keys</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">keys</span><span class="p">([</span><span class="s2">&quot;k1&quot;</span><span class="p">,</span> <span class="s2">&quot;k2&quot;</span><span class="p">])).</span><span class="nx">remove</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>To remove the document with the key ‘k1’ and version ‘v1’:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;k1&quot;</span><span class="p">).</span><span class="nx">version</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
</pre></div>
</div>
<p>The version field is a value that automatically changes whenever
the document is updated. By default it is a hash of the document’s
content.  Using <a class="reference external" href="#sodaoperationclassversion"><code class="docutils literal notranslate"><span class="pre">version()</span></code></a> allows
optimistic locking, so that the <a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">find()</span></code></a> terminal
method (which is <a class="reference external" href="#sodaoperationclassremove"><code class="docutils literal notranslate"><span class="pre">remove()</span></code></a> in this
example) does not affect a document that someone else has already
modified. If the requested document version is not matched, then
the terminal operation will not impact any documents.  The
application can then query to find the latest document version and
apply any desired change.</p>
</li>
<li><p>To update a document with a given key and version. The new document
content will be the <code class="docutils literal notranslate"><span class="pre">newContent</span></code> object:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">newContent</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Fred&quot;</span><span class="p">,</span> <span class="nx">address</span><span class="o">:</span> <span class="p">{</span><span class="nx">city</span><span class="o">:</span> <span class="s2">&quot;Melbourne&quot;</span><span class="p">}};</span>
<span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;k1&quot;</span><span class="p">).</span><span class="nx">version</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">).</span><span class="nx">replaceOne</span><span class="p">(</span><span class="nx">newContent</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>To find the new version of an updated document:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">newContent</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Fred&quot;</span><span class="p">,</span> <span class="nx">address</span><span class="o">:</span> <span class="p">{</span><span class="nx">city</span><span class="o">:</span> <span class="s2">&quot;Melbourne&quot;</span><span class="p">}};</span>
<span class="kr">const</span> <span class="nx">updatedDoc</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;k1&quot;</span><span class="p">).</span><span class="nx">version</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">).</span><span class="nx">replaceOneAndGet</span><span class="p">(</span><span class="nx">newContent</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;New version is: &#39;</span> <span class="o">+</span> <span class="nx">updatedDoc</span><span class="p">.</span><span class="nx">version</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>To count all documents, no keys are needed:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">count</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ul>
<p>The <a class="reference external" href="#sodacollfind"><code class="docutils literal notranslate"><span class="pre">sodaCollection.find()</span></code></a> operators that return documents
produce complete SodaDocument objects that can be used for reading document
content and attributes such as the key.  They can also be used for passing to
methods like <a class="reference external" href="#sodacollinsertone"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOne()</span></code></a>,
<a class="reference external" href="#sodacollinsertoneandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOneAndGet()</span></code></a>,
<a class="reference external" href="#sodaoperationclassreplaceone"><code class="docutils literal notranslate"><span class="pre">sodaOperation.replaceOne()</span></code></a>,
<a class="reference external" href="#sodaoperationclassreplaceoneandget"><code class="docutils literal notranslate"><span class="pre">sodaOperation.replaceOneAndGet()</span></code></a>,
<a class="reference external" href="#sodacollinsertmany"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertMany()</span></code></a>, and
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a>.</p>
<p>Note that for efficiency, the SodaDocuments returned from
<a class="reference external" href="#sodacollinsertoneandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertOneAndGet()</span></code></a>,
<a class="reference external" href="#sodaoperationclassreplaceoneandget"><code class="docutils literal notranslate"><span class="pre">sodaOperation.replaceOneAndGet()</span></code></a>, and
<a class="reference external" href="#sodacollinsertmanyandget"><code class="docutils literal notranslate"><span class="pre">sodaCollection.insertManyAndGet()</span></code></a> do not contain
document content.  These SodaDocuments are useful for getting other document
components such as the key and version.</p>
</div>
<div class="section" id="a-name-sodaqbesearches-a-29-4-soda-query-by-example-searches-for-json-documents">
<h3><a name="sodaqbesearches"></a> 29.4 SODA Query-by-Example Searches for JSON Documents<a class="headerlink" href="#a-name-sodaqbesearches-a-29-4-soda-query-by-example-searches-for-json-documents" title="Permalink to this headline">¶</a></h3>
<p>JSON documents stored in SODA can easily be searched using
query-by-example (QBE) syntax with
<code class="docutils literal notranslate"><span class="pre">collection.find().filter()</span></code>. Filtering and ordering easily allows
subsets of documents to be retrieved, replaced or removed.  Filter
specifications can include comparisons, regular expressions, logical,
and spatial operators, among others.  See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-CB09C4E3-BBB1-40DC-88A8-8417821B0FBE">Overview of SODA Filter
Specifications (QBEs)</a></p>
<p>Some QBE examples are:</p>
<ul>
<li><p>To find the number of documents where ‘age’ is less than 30, the
city is San Francisco and the salary is greater than 500000:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$lt&quot;</span><span class="o">:</span> <span class="mi">30</span><span class="p">},</span>
                                          <span class="s2">&quot;address.city&quot;</span><span class="o">:</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;salary&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$gt&quot;</span><span class="o">:</span> <span class="mi">500000</span><span class="p">}}).</span><span class="nx">count</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>To return all documents that have an age less than 30, an address in
San Francisco, and a salary greater than 500000:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">docCursor</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$lt&quot;</span><span class="o">:</span> <span class="mi">30</span><span class="p">},</span>
                                                  <span class="s2">&quot;address.city&quot;</span><span class="o">:</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;salary&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$gt&quot;</span><span class="o">:</span> <span class="mi">500000</span><span class="p">}}).</span><span class="nx">getCursor</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>Same as the previous example, but allowing for pagination of results
by only getting 10 documents:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">docCursor</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$lt&quot;</span><span class="o">:</span> <span class="mi">30</span><span class="p">},</span>
                                                  <span class="s2">&quot;address.city&quot;</span><span class="o">:</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;salary&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$gt&quot;</span><span class="o">:</span> <span class="mi">500000</span><span class="p">}}).</span><span class="nx">skip</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">getCursor</span><span class="p">();</span>
</pre></div>
</div>
<p>To get the next 10 documents, the QBE could be repeated with the
<code class="docutils literal notranslate"><span class="pre">skip()</span></code> value set to 10.</p>
</li>
<li><p>To get JSON documents with an “age” attribute with values greater
than 60, and where either the name is “Max” or where tea or coffee
is drunk.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">filterSpec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$and&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$gt&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">}</span> <span class="p">},</span>
                      <span class="p">{</span><span class="s2">&quot;$or&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Max&quot;</span><span class="p">},</span>
                               <span class="p">{</span><span class="s2">&quot;drinks&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;tea&quot;</span><span class="p">,</span> <span class="s2">&quot;coffee&quot;</span><span class="p">]}}]}];</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">docCursor</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nx">filterSpec</span><span class="p">).</span><span class="nx">getCursor</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">$orderby</span></code> specification can be used to order any returned documents:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">filterSpec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$query&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;salary&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">$between</span> <span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">]}},</span>
                    <span class="s2">&quot;$orderby&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">}};</span>
<span class="kr">const</span> <span class="nx">docCursor</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nx">filterSpec</span><span class="p">).</span><span class="nx">getCursor</span><span class="p">();</span>
</pre></div>
</div>
<p>This ‘orderby abbreviated syntax’ returns documents within a
particular salary range, sorted by descending age and ascending
name. Sorting is done first by age and then by name, because the
absolute value of -1 is less than the absolute value of 2 - not
because -1 is less than 2, and not because field age appears
before field name in the <code class="docutils literal notranslate"><span class="pre">$orderby</span></code> object.</p>
<p>An alternate <code class="docutils literal notranslate"><span class="pre">$orderby</span></code> syntax allows specifying the data types and
maximum number of string characters to be used for comparison.
See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-3B182089-9A38-45DA-B7D7-8232E13C8F83">Overview of QBE Operator $orderby</a>.</p>
</li>
<li><p>Documents that contain a <a class="reference external" href="https://tools.ietf.org/html/rfc7946">GeoJSON</a> geometry can be searched.
For example if the collection contained documents of the form:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;location&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mf">33.7243</span><span class="p">,</span> <span class="o">-</span><span class="mf">118.1579</span><span class="p">]}}</span>
</pre></div>
</div>
<p>Then a Spatial QBE like the following could be used to find documents within a 50 km range of a specified point:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">filterSpec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;location&quot;</span> <span class="o">:</span>
  <span class="p">{</span><span class="s2">&quot;$near&quot;</span> <span class="o">:</span>
    <span class="p">{</span><span class="s2">&quot;$geometry&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mf">34.0162</span><span class="p">,</span> <span class="o">-</span><span class="mf">118.2019</span><span class="p">]},</span>
      <span class="s2">&quot;$distance&quot;</span> <span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
      <span class="s2">&quot;$unit&quot;</span>     <span class="o">:</span> <span class="s2">&quot;KM&quot;</span><span class="p">}}};</span>
<span class="kr">const</span> <span class="nx">docCursor</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="nx">filterSpec</span><span class="p">).</span><span class="nx">getCursor</span><span class="p">();</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-12994E27-DA98-40C7-8D4F-84341106F8D9">Overview of QBE Spatial Operators</a>.</p>
</li>
</ul>
</div>
<div class="section" id="a-name-sodatextsearches-a-29-5-soda-text-searches">
<h3><a name="sodatextsearches"></a> 29.5 SODA Text Searches<a class="headerlink" href="#a-name-sodatextsearches-a-29-5-soda-text-searches" title="Permalink to this headline">¶</a></h3>
<p>To perform text searches through documents, a <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-4848E6A0-58A7-44FD-8D6D-A033D0CCF9CB">JSON search index</a>
must be defined.  For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span> <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;mySearchIdx&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-00C06941-6FFD-4CEB-81B6-9A7FBD577A2C">SODA Index Specifications (Reference)</a> for information on
SODA indexing.</p>
<p>Documents in the indexed collection can be searched by running a
filter (QBE) using the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-C4C426FC-FD23-4B2E-8367-FA5F83F3F23A"><code class="docutils literal notranslate"><span class="pre">$contains</span></code></a> operator:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">documents</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">filter</span><span class="p">({</span><span class="nx">item</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">$contains</span> <span class="o">:</span> <span class="s2">&quot;books&quot;</span><span class="p">}}).</span><span class="nx">getDocuments</span><span class="p">();</span>
</pre></div>
</div>
<p>This example will find all documents that have an <code class="docutils literal notranslate"><span class="pre">item</span></code> field
containing the string “books” (case-insensitive).  For example, a
document that contained <code class="docutils literal notranslate"><span class="pre">{item</span> <span class="pre">:</span> <span class="pre">&quot;Books</span> <span class="pre">by</span> <span class="pre">Brothers</span> <span class="pre">Grimm&quot;}</span></code> would be
returned.</p>
</div>
<div class="section" id="a-name-sodaclientkeys-a-29-6-soda-client-assigned-keys-and-collection-metadata">
<h3><a name="sodaclientkeys"></a> 29.6 SODA Client-Assigned Keys and Collection Metadata<a class="headerlink" href="#a-name-sodaclientkeys-a-29-6-soda-client-assigned-keys-and-collection-metadata" title="Permalink to this headline">¶</a></h3>
<p>Default collections support JSON documents and use system generated
document keys. Various storage options are also configured which
should suit most users. Overriding the default configuration is
possible by passing custom metadata when a collection is created with
<a class="reference external" href="#sodadbcreatecollection"><code class="docutils literal notranslate"><span class="pre">sodaDatabase.createCollection()</span></code></a>.
Metadata specifies things such as:</p>
<ul class="simple">
<li><p>Storage details, such as the name of the table that stores the
collection and the names and data types of its columns.</p></li>
<li><p>The presence or absence of columns for creation time stamp,
last-modified time stamp, and version.</p></li>
<li><p>Whether the collection can store only JSON documents.</p></li>
<li><p>Methods of document key generation, and whether document keys are
client- assigned or generated automatically.</p></li>
<li><p>Methods of version generation.</p></li>
</ul>
<p>Note that changing storage options should only be done with care.</p>
<p>The metadata attributes are described in <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-49EFF3D3-9FAB-4DA6-BDE2-2650383566A3">SODA Collection Metadata Components</a>.</p>
<p>Collection metadata in SODA is represented as a JavaScript object.</p>
<p>The default collection metadata specifies that a collection stores
five components for each document: key, JSON content, version,
last-modified timestamp, and a created-on timestamp.  An example of
default metadata is:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;schemaName&quot;</span><span class="o">:</span> <span class="s2">&quot;mySchemaName&quot;</span><span class="p">,</span>
   <span class="s2">&quot;tableName&quot;</span><span class="o">:</span> <span class="s2">&quot;myCollectionName&quot;</span><span class="p">,</span>
   <span class="s2">&quot;keyColumn&quot;</span><span class="o">:</span>
   <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span>
      <span class="s2">&quot;sqlType&quot;</span><span class="o">:</span> <span class="s2">&quot;VARCHAR2&quot;</span><span class="p">,</span>
      <span class="s2">&quot;maxLength&quot;</span><span class="o">:</span> <span class="mi">255</span><span class="p">,</span>
      <span class="s2">&quot;assignmentMethod&quot;</span><span class="o">:</span> <span class="s2">&quot;UUID&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;contentColumn&quot;</span><span class="o">:</span>
   <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;JSON_DOCUMENT&quot;</span><span class="p">,</span>
      <span class="s2">&quot;sqlType&quot;</span><span class="o">:</span> <span class="s2">&quot;BLOB&quot;</span><span class="p">,</span>
      <span class="s2">&quot;compress&quot;</span><span class="o">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
      <span class="s2">&quot;cache&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;encrypt&quot;</span><span class="o">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
      <span class="s2">&quot;validation&quot;</span><span class="o">:</span> <span class="s2">&quot;STANDARD&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;versionColumn&quot;</span><span class="o">:</span>
   <span class="p">{</span>
     <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;VERSION&quot;</span><span class="p">,</span>
     <span class="s2">&quot;method&quot;</span><span class="o">:</span> <span class="s2">&quot;SHA256&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;lastModifiedColumn&quot;</span><span class="o">:</span>
   <span class="p">{</span>
     <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;LAST_MODIFIED&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;creationTimeColumn&quot;</span><span class="o">:</span>
   <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;CREATED_ON&quot;</span>
   <span class="p">},</span>
   <span class="s2">&quot;readOnly&quot;</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-C107707F-E135-493F-9112-98691C80D3E9">Overview of SODA Document Collections</a> for more information
on collections and their metadata.</p>
<p>The following example shows how to create a collection that supports
keys supplied by the application, instead of being system
generated. Here, numeric keys will be used.  The metadata used when
creating the collection will be the same as the above default metadata
with the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-1938641C-B5BF-4B77-9A54-17EE06FEA94C">keyColumn</a> object changed.  Here the type becomes
NUMBER and the <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-53AA7D85-80A9-4F98-994F-E3BD91769146">assignment method</a> is noted as client-assigned:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">mymetadata</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span> <span class="p">.</span> <span class="p">.</span> <span class="p">};</span>   <span class="c1">// the default metadata shown above</span>

<span class="c1">// update the keyColumn info</span>
<span class="nx">mymetadata</span><span class="p">.</span><span class="nx">keyColumn</span> <span class="o">=</span>
<span class="p">{</span>
   <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span>
   <span class="s2">&quot;sqlType&quot;</span><span class="o">:</span> <span class="s2">&quot;NUMBER&quot;</span><span class="p">,</span>
   <span class="s2">&quot;assignmentMethod&quot;</span><span class="o">:</span> <span class="s2">&quot;CLIENT&quot;</span>
<span class="p">};</span>

<span class="c1">// Set schemaName to the connected user</span>
<span class="nx">mymetadata</span><span class="p">.</span><span class="nx">schemaName</span> <span class="o">=</span> <span class="s1">&#39;HR&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>This custom metadata is then used when creating the collection:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">autoCommit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">soda</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">getSodaDatabase</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">collection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">soda</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="s2">&quot;mycollection&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">metaData</span><span class="o">:</span> <span class="nx">mymetadata</span><span class="p">});</span>
  <span class="kr">const</span> <span class="nx">indexSpec</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;CITY_IDX&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;fields&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span>
                          <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;address.city&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;datatype&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;order&quot;</span><span class="o">:</span> <span class="s2">&quot;asc&quot;</span> <span class="p">}</span> <span class="p">]</span> <span class="p">};</span>
  <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="nx">indexSpec</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To insert a document into the collection, a key must be supplied by
the application.  Note it is set to a string:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">myContent</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Sally&quot;</span><span class="p">,</span> <span class="nx">address</span><span class="o">:</span> <span class="p">{</span><span class="nx">city</span><span class="o">:</span> <span class="s2">&quot;Melbourne&quot;</span><span class="p">}};</span>
  <span class="kr">const</span> <span class="nx">newDoc</span> <span class="o">=</span> <span class="nx">soda</span><span class="p">.</span><span class="nx">createDocument</span><span class="p">(</span><span class="nx">myContent</span><span class="p">,</span> <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;123&quot;</span><span class="p">});</span>
  <span class="nx">await</span> <span class="nx">collection</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span><span class="nx">newDoc</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-sodajsondataguide-a-29-7-json-data-guides-in-soda">
<h3><a name="sodajsondataguide"></a> 29.7 JSON Data Guides in SODA<a class="headerlink" href="#a-name-sodajsondataguide-a-29-7-json-data-guides-in-soda" title="Permalink to this headline">¶</a></h3>
<p>SODA exposes Oracle Database’s <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-219FC30E-89A7-4189-BC36-7B961A24067C">JSON data guide</a> feature.  This
lets you discover information about the structure and content of JSON
documents by giving details such as property names, data types and
data lengths. In SODA, it can be useful for exploring the schema of a
collection.</p>
<p>To get a data guide in SODA, the collection must be JSON-only and have
a <a class="reference external" href="#sodacollcreateindex">JSON Search index</a> where the <code class="docutils literal notranslate"><span class="pre">&quot;dataguide&quot;</span></code>
option is <code class="docutils literal notranslate"><span class="pre">&quot;on&quot;</span></code>. Data guides are returned from
<a class="reference external" href="#sodacollgetdataguide"><code class="docutils literal notranslate"><span class="pre">sodaCollection.getDataGuide()</span></code></a> as JSON
content in a <a class="reference external" href="#sodadocumentclass">SodaDocument</a>.  The data guide is
inferred from the collection as it currently is.  As a collection
grows and documents change, a new data guide may be returned each
subsequent time <code class="docutils literal notranslate"><span class="pre">getDataGuide()</span></code> is called.</p>
<p>As an example, suppose a collection was created with default settings,
meaning it can store JSON content. If the collection contained these
documents:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;ukraine&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;chris&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;australia&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;venkat&quot;</span> <span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;india&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;anthony&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="o">:</span> <span class="s2">&quot;canada&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Then the following code:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">await</span> <span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;myIndex&quot;</span><span class="p">});</span>  <span class="c1">// dataguide is &quot;on&quot; by default</span>
<span class="kr">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">sodaCollection</span><span class="p">.</span><span class="nx">getDataGuide</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">dg</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getContentAsString</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dg</span><span class="p">);</span>
</pre></div>
</div>
<p>Will display the data guide:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;object&quot;</span><span class="p">,</span><span class="s2">&quot;properties&quot;</span><span class="o">:</span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="s2">&quot;o:length&quot;</span><span class="o">:</span><span class="mi">8</span><span class="p">,</span><span class="s2">&quot;o:preferred_column_name&quot;</span><span class="o">:</span><span class="s2">&quot;JSON_DOCUMENT$name&quot;</span><span class="p">},</span>
  <span class="s2">&quot;country&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="s2">&quot;o:length&quot;</span><span class="o">:</span><span class="mi">16</span><span class="p">,</span><span class="s2">&quot;o:preferred_column_name&quot;</span><span class="o">:</span><span class="s2">&quot;JSON_DOCUMENT$country&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>This indicates that the collection documents are JSON objects, and
currently have “name” and “country” fields. The types (“string” in
this case) and lengths of the values of these fields are listed.  The
“preferred_column_name” fields can be helpful for advanced users who
want to define SQL views over JSON data. They suggest how to name the
columns of a view.</p>
</div>
</div>
<div class="section" id="a-name-roundtrips-a-30-database-round-trips">
<h2><a name="roundtrips"></a> 30. Database Round-trips<a class="headerlink" href="#a-name-roundtrips-a-30-database-round-trips" title="Permalink to this headline">¶</a></h2>
<p>Along with tuning an application’s architecture and tuning its SQL
statements, a general performance and scalability goal is to minimize
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-9B2F05F9-D841-4493-A42D-A7D89694A2D1">round-trips</a>.  A round-trip is defined as the trip from the
Oracle client libraries (used by node-oracledb) to the database and
back.</p>
<p>Some general tips for reducing round-trips are:</p>
<ul class="simple">
<li><p>Tune <a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a>.</p></li>
<li><p>Use <a class="reference external" href="#executemany"><code class="docutils literal notranslate"><span class="pre">executeMany()</span></code></a> for optimal DML execution.</p></li>
<li><p>Only commit when necessary.  Use <a class="reference external" href="#propexecautocommit"><code class="docutils literal notranslate"><span class="pre">autoCommit</span></code></a> on the last statement of a transaction.</p></li>
<li><p>Avoid over pinging with <a class="reference external" href="#connectionping"><code class="docutils literal notranslate"><span class="pre">connection.ping()</span></code></a> or by setting <a class="reference external" href="#proppoolpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">poolPingInterval</span></code></a> too low.</p></li>
<li><p>For connection pools, use a callback to set connection state, see <a class="reference external" href="#connpooltagging">Connection Tagging and Session State</a></p></li>
<li><p>Make use of PL/SQL procedures which execute multiple SQL statements instead of executing them individually from node-oracledb.</p></li>
</ul>
<p>Oracle’s <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-56AEF38E-9400-427B-A818-EDEC145F7ACD">Automatic Workload Repository</a> (AWR) reports show
‘SQL*Net roundtrips to/from client’ and are useful for finding the
overall behavior of a system.</p>
<p>Sometimes you may wish to find the number of round-trips used for a
specific application.  Snapshots of the <code class="docutils literal notranslate"><span class="pre">V$SESSTAT</span></code> view taken before
and after doing some work can be used for this.</p>
<p>First, find the session id of the current connection:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`SELECT sys_context(&#39;userenv&#39;,&#39;sid&#39;) FROM dual`</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">sid</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>  <span class="c1">// session id</span>
</pre></div>
</div>
<p>This can be used with <code class="docutils literal notranslate"><span class="pre">V$SESSTAT</span></code> to find the current number of
round-trips.  A second connection is used to avoid affecting the
count.  If your user doesn’t have access to the V$ views, then use a
SYSTEM connection:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">async</span> <span class="kd">function</span> <span class="nx">getRT</span><span class="p">(</span><span class="nx">sid</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">systemconnection</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">systemconnection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
       <span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SYSTEMPASSWORD</span><span class="p">,</span> <span class="s1">&#39;localhost/orclpdb1&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">systemconnection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
      <span class="sb">`SELECT ss.value</span>
<span class="sb">      FROM v$sesstat ss, v$statname sn</span>
<span class="sb">      WHERE ss.sid = :sid</span>
<span class="sb">      AND ss.statistic# = sn.statistic#</span>
<span class="sb">      AND sn.name LIKE &#39;%roundtrip%client%&#39;`</span><span class="p">,</span>
      <span class="p">[</span><span class="nx">sid</span><span class="p">]</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">systemconnection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">await</span> <span class="nx">systemconnection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The main part of the application performs the “work” and calls
<code class="docutils literal notranslate"><span class="pre">getRT()</span></code> to calculate the number of round-trips the work takes:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">before</span><span class="p">,</span> <span class="nx">after</span><span class="p">;</span>

<span class="c1">//</span>
<span class="c1">// Multiple execute() calls with explicit commit()</span>
<span class="c1">//</span>

<span class="nx">before</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getRT</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">bindArray</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Victory&#39;</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Beagle&#39;</span><span class="p">],</span>
<span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">binds</span> <span class="k">of</span> <span class="nx">bindArray</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
    <span class="sb">`INSERT INTO ships (id, name) values (:i, :n)`</span><span class="p">,</span>
    <span class="nx">binds</span>
  <span class="p">);</span>
<span class="p">}</span>
<span class="nx">connection</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>

<span class="nx">after</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getRT</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Round-trips required: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">after</span> <span class="o">-</span> <span class="nx">before</span><span class="p">));</span>   <span class="c1">// 3 round-trips</span>

<span class="c1">//</span>
<span class="c1">// executeMany() with autoCommit</span>
<span class="c1">//</span>

<span class="nx">before</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getRT</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">autoCommit</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">bindDefs</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">NUMBER</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span> <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">20</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">executeMany</span><span class="p">(</span>
  <span class="sb">`INSERT INTO ships (id, name) values (:1, :2)`</span><span class="p">,</span>
  <span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Victory&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Beagle&#39;</span><span class="p">],</span>
  <span class="p">],</span>
  <span class="nx">options</span>
<span class="p">);</span>

<span class="nx">after</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getRT</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Round-trips required: &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">after</span> <span class="o">-</span> <span class="nx">before</span><span class="p">));</span>   <span class="c1">// 1 round-trip</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-bindtrace-a-a-name-tracingsql-a-31-tracing-sql-and-pl-sql-statements">
<h2><a name="bindtrace"></a> <a name="tracingsql"></a> 31. Tracing SQL and PL/SQL Statements<a class="headerlink" href="#a-name-bindtrace-a-a-name-tracingsql-a-31-tracing-sql-and-pl-sql-statements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="end-to-end-tracing">
<h3>End-to-End Tracing<a class="headerlink" href="#end-to-end-tracing" title="Permalink to this headline">¶</a></h3>
<p>Applications that have implemented <a class="reference external" href="#endtoend">End-to-end Tracing</a>
calls such as <a class="reference external" href="#propconnaction">action</a> and <a class="reference external" href="#propconnmodule">module</a>,
will make it easier in database monitoring tools to identify SQL
statement execution.</p>
</div>
<div class="section" id="tracing-executed-statements">
<h3>Tracing Executed Statements<a class="headerlink" href="#tracing-executed-statements" title="Permalink to this headline">¶</a></h3>
<p>Database statement tracing is commonly used to identify performance
issues.  Oracle Database trace files can be analyzed after statements
are executed.  Tracing can be enabled in various ways at a database
system or individual session level.  Refer to <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=TGSQL">Oracle Database Tuning
documentation</a>.  Setting a customer identifier is recommended to
make searching for relevant log files easier:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">SESSION</span> <span class="n">SET</span> <span class="n">tracefile_identifier</span><span class="o">=</span><span class="s1">&#39;My-identifier&#39;</span> <span class="n">SQL_TRACE</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>In node-oracledb itself, the <a class="reference external" href="https://oracle.github.io/odpi/doc/user_guide/debugging.html">ODPI-C tracing capability</a> can be
used to log executed statements to the standard error stream.  Before
executing Node.js, set the environment variable <code class="docutils literal notranslate"><span class="pre">DPI_DEBUG_LEVEL</span></code>
to 16.  At a Windows command prompt, this could be done with <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">DPI_DEBUG_LEVEL=16</span></code>.  On Linux, you might use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">DPI_DEBUG_LEVEL</span><span class="o">=</span><span class="mi">16</span>
<span class="n">node</span> <span class="n">myapp</span><span class="o">.</span><span class="n">js</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="n">log</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>For an application that does a single query, the log file might
contain a tracing line consisting of the prefix ‘ODPI’, a thread
identifier, a timestamp, and the SQL statement executed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ODPI</span> <span class="p">[</span><span class="mi">6905309</span><span class="p">]</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">13</span> <span class="mi">09</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">46.140</span><span class="p">:</span> <span class="n">SQL</span> <span class="n">select</span> <span class="n">sysdate</span> <span class="kn">from</span> <span class="nn">dual</span> <span class="n">where</span> <span class="p">:</span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="tracing-bind-values">
<h3>Tracing Bind Values<a class="headerlink" href="#tracing-bind-values" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is useful to trace the bind data values that have been
used when executing statements.  Several methods are available.</p>
<p>In the Oracle Database, the view <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-D353F4BE-5943-4F5B-A99B-BC9505E9579C"><code class="docutils literal notranslate"><span class="pre">V$SQL_BIND_CAPTURE</span></code></a> can
capture bind information.  Tracing with Oracle Database’s
<a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-C9054D20-3A70-484F-B11B-CC591A10D609"><code class="docutils literal notranslate"><span class="pre">DBMS_MONITOR.SESSION_TRACE_ENABLE()</span></code></a> may also be useful.</p>
<p>You can also write your own wrapper around <code class="docutils literal notranslate"><span class="pre">execute()</span></code> and log any
parameters.</p>
</div>
<div class="section" id="other-tracing-utilities">
<h3>Other Tracing Utilities<a class="headerlink" href="#other-tracing-utilities" title="Permalink to this headline">¶</a></h3>
<p>PL/SQL users may be interested in using <a class="reference external" href="https://www.oracle.com/pls/topic/lookup?ctx=dblatest&amp;id=GUID-24109CB5-7BB9-48B2-AD7A-39458AA13C0C">PL/Scope</a>.</p>
</div>
</div>
<div class="section" id="a-name-programstyles-a-32-node-js-programming-styles-and-node-oracledb">
<h2><a name="programstyles"></a> 32. Node.js Programming Styles and node-oracledb<a class="headerlink" href="#a-name-programstyles-a-32-node-js-programming-styles-and-node-oracledb" title="Permalink to this headline">¶</a></h2>
<p>Node.oracle supports <a class="reference external" href="#callbackoverview">callbacks</a>,
<a class="reference external" href="#promiseoverview">Promises</a>, and Node.js 8’s
<a class="reference external" href="#asyncawaitoverview">async/await</a> styles of programming.  The latter
is recommended.</p>
<div class="section" id="a-name-callbackoverview-a-a-name-examplequerycb-a-32-1-callbacks-and-node-oracledb">
<h3><a name="callbackoverview"></a> <a name="examplequerycb"></a> 32.1 Callbacks and node-oracledb<a class="headerlink" href="#a-name-callbackoverview-a-a-name-examplequerycb-a-32-1-callbacks-and-node-oracledb" title="Permalink to this headline">¶</a></h3>
<p>Node-oracledb supports callbacks.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// myscript.js</span>

<span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span>  <span class="c1">// set mypw to the hr schema password</span>

<span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
  <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
      <span class="sb">`SELECT manager_id, department_id, department_name</span>
<span class="sb">       FROM departments</span>
<span class="sb">       WHERE manager_id = :id`</span><span class="p">,</span>
      <span class="p">[</span><span class="mi">103</span><span class="p">],</span>  <span class="c1">// bind value for :id</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
          <span class="nx">doRelease</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
        <span class="nx">doRelease</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>

<span class="kd">function</span> <span class="nx">doRelease</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With Oracle’s sample HR schema, the output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;IT&#39;</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="a-name-promiseoverview-a-32-2-promises-and-node-oracledb">
<h3><a name="promiseoverview"></a> 32.2 Promises and node-oracledb<a class="headerlink" href="#a-name-promiseoverview-a-32-2-promises-and-node-oracledb" title="Permalink to this headline">¶</a></h3>
<p>Node-oracledb supports Promises with all asynchronous methods.  The native Promise
implementation is used.</p>
<p>If an asynchronous method is invoked without a callback, it returns a
Promise:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// the user password</span>

<span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
      <span class="sb">`SELECT department_id, department_name</span>
<span class="sb">       FROM departments</span>
<span class="sb">       WHERE manager_id &lt; :id`</span><span class="p">,</span>
      <span class="p">[</span><span class="mi">110</span><span class="p">]</span>  <span class="c1">// bind value for :id</span>
    <span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">});</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div>
</div>
<p>With Oracle’s sample HR schema, the output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;IT&#39;</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;Executive&#39;</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;Finance&#39;</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>Notice there are two promise “chains”: one to get a connection and the
other to use it.  This is required because it is only possible to
refer to the connection within the function to which it was passed.</p>
<p>When invoking asynchronous methods, it is possible to accidentally
get a Promise by forgetting to pass a callback function:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/WRONG_SERVICE_NAME&quot;</span>
  <span class="p">});</span>
  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>Since the returned promise will not have a catch block, as the
intention was to use the callback programming style, any rejections
that occur will go unnoticed.  Node.js 4.0 added the
<code class="docutils literal notranslate"><span class="pre">unhandledRejection</span></code> event to prevent such rejections from going
unnoticed:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;unhandledRejection&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">reason</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Unhandled Rejection at: &quot;</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="s2">&quot; reason: &quot;</span><span class="p">,</span> <span class="nx">reason</span><span class="p">);</span>
  <span class="c1">// application specific logging, throwing an error, or other logic here</span>
<span class="p">});</span>

<span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
    <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
    <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/WRONG_SERVICE_NAME&quot;</span>
  <span class="p">});</span>
  <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
</pre></div>
</div>
<p>Whereas the code without the <code class="docutils literal notranslate"><span class="pre">unhandledRejection</span></code> exception silently
exited, adding the handler could, for example, show:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ node myapp.js
Unhandled Rejection at:  Promise {
  &lt;rejected&gt; [Error: ORA-12514: TNS:listener does not currently know of service requested in connect descriptor
] }  reason:  [Error: ORA-12514: TNS:listener does not currently know of service requested in connect descriptor
]
</pre></div>
</div>
<p>For more information, see <a class="reference external" href="https://jsao.io/2017/06/how-to-get-use-and-close-a-db-connection-using-promises/">How to get, use, and close a DB connection
using promises</a>.</p>
<div class="section" id="a-name-custompromises-a-32-2-1-custom-promise-libraries">
<h4><a name="custompromises"></a> 32.2.1 Custom Promise Libraries<a class="headerlink" href="#a-name-custompromises-a-32-2-1-custom-promise-libraries" title="Permalink to this headline">¶</a></h4>
<p>The Promise implementation is designed to be overridden, allowing a
custom Promise library to be used.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">mylib</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;myfavpromiseimplementation&#39;</span><span class="p">);</span>
<span class="nx">oracledb</span><span class="p">.</span><span class="nb">Promise</span> <span class="o">=</span> <span class="nx">mylib</span><span class="p">;</span>
</pre></div>
</div>
<p>Promises can be completely disabled by setting</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">oracledb</span><span class="p">.</span><span class="nb">Promise</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-name-asyncawaitoverview-a-32-3-async-await-and-node-oracledb">
<h3><a name="asyncawaitoverview"></a> 32.3 Async/Await and node-oracledb<a class="headerlink" href="#a-name-asyncawaitoverview-a-32-3-async-await-and-node-oracledb" title="Permalink to this headline">¶</a></h3>
<p>Node.js 7.6 supports async functions, also known as Async/Await.  These
can be used with node-oracledb.  For example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">oracledb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;oracledb&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mypw</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// the hr schema password</span>

<span class="kd">function</span> <span class="nx">getEmployee</span><span class="p">(</span><span class="nx">empid</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">connection</span><span class="p">;</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">connection</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">oracledb</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">({</span>
        <span class="nx">user</span>          <span class="o">:</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span>
        <span class="nx">password</span>      <span class="o">:</span> <span class="nx">mypw</span><span class="p">,</span>
        <span class="nx">connectString</span> <span class="o">:</span> <span class="s2">&quot;localhost/XEPDB1&quot;</span>
      <span class="p">});</span>

      <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span>
        <span class="sb">`SELECT * FROM employees WHERE employee_id = :bv`</span><span class="p">,</span>
        <span class="p">[</span><span class="nx">empid</span><span class="p">]</span>
      <span class="p">);</span>
      <span class="nx">resolve</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>

    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// catches errors in getConnection and the query</span>
      <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>   <span class="c1">// the connection assignment worked, must release</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">release</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getEmployee</span><span class="p">(</span><span class="mi">101</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">();</span>
</pre></div>
</div>
<p>If you are using <a class="reference external" href="#lobclass">Lob instances</a> for LOB data, then the
Lobs must be streamed since there is no Promisified interface for
them.  Alternatively you can work with the data directly as Strings or
Buffers.</p>
<p>For more information, see <a class="reference external" href="https://jsao.io/2017/07/how-to-get-use-and-close-a-db-connection-using-async-functions/">How to get, use, and close a DB connection
using async functions</a>.</p>
</div>
</div>
<div class="section" id="a-name-migrate-a-33-migrating-from-previous-node-oracledb-releases">
<h2><a name="migrate"></a> 33. Migrating from Previous node-oracledb Releases<a class="headerlink" href="#a-name-migrate-a-33-migrating-from-previous-node-oracledb-releases" title="Permalink to this headline">¶</a></h2>
<p>Documentation about node-oracledb version 1 is <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/node-oracledb-v1/doc/api">here</a>.</p>
<p>Documentation about node-oracledb version 2 is <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/v2.3.0/doc/api">here</a>.</p>
<p>Documentation about node-oracledb version 3 is <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/v3.1.2/doc/api">here</a>.</p>
<div class="section" id="a-name-migratev1v2-a-33-1-migrating-from-node-oracledb-1-13-to-node-oracledb-2-0">
<h3><a name="migratev1v2"></a> 33.1 Migrating from node-oracledb 1.13 to node-oracledb 2.0<a class="headerlink" href="#a-name-migratev1v2-a-33-1-migrating-from-node-oracledb-1-13-to-node-oracledb-2-0" title="Permalink to this headline">¶</a></h3>
<p>When upgrading from node-oracledb version 1.13 to version 2.0:</p>
<ul class="simple">
<li><p>Review the <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/master/CHANGELOG">CHANGELOG</a>.</p></li>
<li><p>Installation has changed.  Pre-built binaries are available for
common platforms.  To build from source code, change your
package.json dependency to install from GitHub.  Refer to
<a class="reference external" href="https://oracle.github.io/node-oracledb/INSTALL.html#github">INSTALL</a>.</p></li>
<li><p>Users of Instant Client RPMs must now always have the Instant Client
libraries in the library search path.  Refer to <a class="reference external" href="https://oracle.github.io/node-oracledb/INSTALL.html#instrpm">INSTALL</a>.</p></li>
<li><p>Users of macOS must now always have the Instant Client
libraries in <code class="docutils literal notranslate"><span class="pre">~/lib</span></code> or <code class="docutils literal notranslate"><span class="pre">/usr/local/lib</span></code>.  Refer to <a class="reference external" href="https://oracle.github.io/node-oracledb/INSTALL.html#instosx">INSTALL</a>.</p></li>
<li><p>For queries and REF CURSORS, the internal buffer sizing and tuning
of round-trips to Oracle Database is now done with
<a class="reference external" href="#propdbfetcharraysize"><code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code></a>.  This replaces
<a class="reference external" href="#propdbprefetchrows"><code class="docutils literal notranslate"><span class="pre">prefetchRows</span></code></a>, which is no longer used.  It
also replaces the overloaded use of <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> for
<a class="reference external" href="#querystream"><code class="docutils literal notranslate"><span class="pre">queryStream()</span></code></a>.  To upgrade scripts:</p>
<ul>
<li><p>Replace the property <code class="docutils literal notranslate"><span class="pre">prefetchRows</span></code> with <code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code> and make
sure all values are greater than 0.</p></li>
<li><p>Tune <code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code> instead of <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> for <code class="docutils literal notranslate"><span class="pre">queryStream()</span></code>.</p></li>
<li><p>For <a class="reference external" href="#fetchingrows">direct fetches</a>, optionally tune
<code class="docutils literal notranslate"><span class="pre">fetchArraySize</span></code>.</p></li>
<li><p>For <a class="reference external" href="#fetchingrows">direct fetches</a>, optionally replace enormously
over-sized <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> values with 0, meaning an unlimited number of
rows can be returned.</p></li>
</ul>
</li>
<li><p>For <a class="reference external" href="#fetchingrows">direct fetches</a> that relied on the version 1
default value of <a class="reference external" href="#propdbmaxrows"><code class="docutils literal notranslate"><span class="pre">maxRows</span></code></a> to limit the number of
returned rows to 100, it is recommended to use an <a class="reference external" href="#pagingdata"><code class="docutils literal notranslate"><span class="pre">OFFSET</span></code> /
<code class="docutils literal notranslate"><span class="pre">FETCH</span></code></a> query clause.  Alternatively explicitly set
<code class="docutils literal notranslate"><span class="pre">maxRows</span></code> to 100.</p></li>
<li><p>Review and update code that checks for specific <em>NJS-XXX</em> or
<em>DPI-XXX</em> error messages.</p></li>
<li><p>Ensure that all <a class="reference external" href="#resultsetclass">ResultSets</a> and <a class="reference external" href="#lobclass">LOBs</a>
are closed prior to calling
<a class="reference external" href="#connectionclose"><code class="docutils literal notranslate"><span class="pre">connection.close()</span></code></a>. Otherwise you will get the
error <em>DPI-1054: connection cannot be closed when open statements or
LOBs exist</em>.  (<em>Note</em>: this limitation was removed in node-oracledb 2.1)</p></li>
<li><p>Test applications to check if changes such as the improved property
validation uncover latent problems in your code.</p></li>
</ul>
</div>
<div class="section" id="a-name-migratev20v21-a-33-2-migrating-from-node-oracledb-2-0-to-node-oracledb-2-1">
<h3><a name="migratev20v21"></a> 33.2 Migrating from node-oracledb 2.0 to node-oracledb 2.1<a class="headerlink" href="#a-name-migratev20v21-a-33-2-migrating-from-node-oracledb-2-0-to-node-oracledb-2-1" title="Permalink to this headline">¶</a></h3>
<p>When upgrading from node-oracledb version 2.0 to version 2.1:</p>
<ul class="simple">
<li><p>If using the experimental <code class="docutils literal notranslate"><span class="pre">_close</span></code> method with <a class="reference external" href="#streamingresults">Query
Streaming</a> in Node 8 or later:</p>
<ul>
<li><p>Change the method name from <code class="docutils literal notranslate"><span class="pre">_close()</span></code> to <a class="reference external" href="https://nodejs.org/api/stream.html#stream_readable_destroy_error"><code class="docutils literal notranslate"><span class="pre">destroy()</span></code></a>.</p></li>
<li><p>Stop passing a callback.</p></li>
<li><p>Optionally pass an error.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="a-name-migratev23v30-a-33-3-migrating-from-node-oracledb-2-3-to-node-oracledb-3-0">
<h3><a name="migratev23v30"></a> 33.3 Migrating from node-oracledb 2.3 to node-oracledb 3.0<a class="headerlink" href="#a-name-migratev23v30-a-33-3-migrating-from-node-oracledb-2-3-to-node-oracledb-3-0" title="Permalink to this headline">¶</a></h3>
<p>When upgrading from node-oracledb version 2.3 to version 3.0:</p>
<ul class="simple">
<li><p>Review the <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/master/CHANGELOG">CHANGELOG</a>.  Implement new features such as the
<a class="reference external" href="#poolclose"><code class="docutils literal notranslate"><span class="pre">pool.close()</span></code></a> <code class="docutils literal notranslate"><span class="pre">drainTime</span></code> parameter.</p></li>
<li><p>If using a connection pool and Oracle Client libraries 12.2 or
later, tune <a class="reference external" href="#propdbpoolpinginterval"><code class="docutils literal notranslate"><span class="pre">oracledb.poolPingInterval</span></code></a>,
since this property is now additionally used with these versions of
Oracle Client.</p></li>
<li><p>Before migrating, ensure your application works with the <a class="reference external" href="#connpoolqueue">Connection
Pool Queue</a>, since this mode is always enabled in
node-oracledb 3.0 and the value of
<a class="reference external" href="#propdbqueuerequests"><code class="docutils literal notranslate"><span class="pre">oracledb.queueRequests</span></code></a> is ignored.</p></li>
<li><p>Change code that relied on unused properties in objects such as the
<code class="docutils literal notranslate"><span class="pre">execute()</span></code> result being set to <code class="docutils literal notranslate"><span class="pre">undefined</span></code>.  These properties are
no longer set in node-oracledb 3.</p></li>
</ul>
</div>
<div class="section" id="a-name-migratev30v31-a-33-4-migrating-from-node-oracledb-3-0-to-node-oracledb-3-1">
<h3><a name="migratev30v31"></a> 33.4 Migrating from node-oracledb 3.0 to node-oracledb 3.1<a class="headerlink" href="#a-name-migratev30v31-a-33-4-migrating-from-node-oracledb-3-0-to-node-oracledb-3-1" title="Permalink to this headline">¶</a></h3>
<p>When upgrading from node-oracledb version 3.0 to version 3.1:</p>
<ul class="simple">
<li><p>Review the <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/master/CHANGELOG">CHANGELOG</a>.  Implement new features such as the
Connection Pool
<a class="reference external" href="#createpoolpoolattrssessioncallback"><code class="docutils literal notranslate"><span class="pre">sessionCallback</span></code></a> to
efficiently set session state.</p></li>
<li><p>Code that catches <code class="docutils literal notranslate"><span class="pre">require('oracledb')</span></code> errors to check
node-oracledb and the Oracle Client libraries are installed
correctly will need to be changed.  In node-oracledb 3.1,
<code class="docutils literal notranslate"><span class="pre">require()</span></code> will always succeed if node-oracledb is installed even
if Oracle Client is not configured.  To confirm that node-oracle
will be usable, access
<a class="reference external" href="#propdboracleclientversion"><code class="docutils literal notranslate"><span class="pre">oracledb.oracleClientVersion</span></code></a> or
<a class="reference external" href="#propdboracleclientversionstring"><code class="docutils literal notranslate"><span class="pre">oracledb.oracleClientVersionString</span></code></a>,
or try opening a connection.</p></li>
</ul>
</div>
<div class="section" id="a-name-migratev31v40-a-33-5-migrating-from-node-oracledb-3-1-to-node-oracledb-4-0">
<h3><a name="migratev31v40"></a> 33.5 Migrating from node-oracledb 3.1 to node-oracledb 4.0<a class="headerlink" href="#a-name-migratev31v40-a-33-5-migrating-from-node-oracledb-3-1-to-node-oracledb-4-0" title="Permalink to this headline">¶</a></h3>
<p>When upgrading from node-oracledb version 3.1 to version 4.0:</p>
<ul class="simple">
<li><p>Review the <a class="reference external" href="https://github.com/oracle/node-oracledb/blob/master/CHANGELOG">CHANGELOG</a> and take advantage of new features.</p></li>
<li><p>Update Node.js, if necessary.  Node-oracledb 4.0 requires</p>
<ul>
<li><p>Node.js 8.16 or higher</p></li>
<li><p>Node.js 10.16, or higher</p></li>
<li><p>Node.js 12</p></li>
</ul>
</li>
<li><p>Review error handling.  Some errors have changed.  All exceptions
are now passed through the error callback.</p></li>
<li><p>Code that relied on numeric values for the <a class="reference external" href="#oracledbconstantsnodbtype">node-oracledb Type
Constants</a> and <a class="reference external" href="#oracledbconstantsdbtype">Oracle Database Type
Constants</a> will need updating.  Use the
constant names instead of their values.</p></li>
<li><p>To view node-oracledb class information, update code to use <code class="docutils literal notranslate"><span class="pre">Object.getPrototypeOf()</span></code>.</p></li>
<li><p>Optionally migrate <a class="reference external" href="#propdboutformat"><code class="docutils literal notranslate"><span class="pre">outFormat</span></code></a> constants to the
new, preferred names
<a class="reference external" href="#oracledbconstantsoutformat"><code class="docutils literal notranslate"><span class="pre">OUT_FORMAT_ARRAY</span></code></a> and
<a class="reference external" href="#oracledbconstantsoutformat"><code class="docutils literal notranslate"><span class="pre">OUT_FORMAT_OBJECT</span></code></a>.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to NodeJsDocument’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, 2020 Oracle

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>